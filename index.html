<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Essential Radio Player</title>
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp">
  <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    /* --- NAVBAR & MODALS ONLY --- */
    @media (max-width: 750px) {
  .navbar { display: none !important; }
  #burgerMenuBtn { display: block !important; }
   { display: flex; }
}
@media (min-width: 751px) {
  #burgerMenuBtn, #burgerDropdown { display: none !important; }
}
.menu-link {
  display: block;
  background: #fed351;   /* <-- This line adds the yellow background */
  color: #191c29;
  font-size: 1.07em;
  font-weight: 600;
  border-radius: 8px;
  padding: 10px 0;
  text-align: center;
  text-decoration: none;
  margin-bottom: 0;
  box-shadow: 0 2px 10px #0001;
  transition: background 0.2s, color 0.2s;
}
.menu-link:active,
.menu-link:hover {
  background: #ffe67c;
  color: #191c29;
}


.navbar {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      background: #222;
      z-index: 1001;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      padding: 9px 0 8px 0;
      box-shadow: 0 2px 12px #111a;
    }
    .navbar a {
      color: #222;
      background: #fed351;
      padding: 8px 18px;
      border-radius: 16px;
      font-weight: bold;
      text-decoration: none;
      font-size: 16px;
      margin: 0 2px;
      transition: background 0.2s, color 0.2s;
      border: none;
      cursor: pointer;
      outline: none;
      display: inline-block;
    }
    .navbar a:hover, .navbar a:focus {
      background: #00818a;
      color: #fff;
    }
    @media (max-width: 750px) {
      .navbar {
        flex-direction: column;
        gap: 2px;
        padding: 5px 0 5px 0;
      }
      .navbar a {
        margin: 2px 0;
        font-size: 15px;
        padding: 8px 12px;
        border-radius: 10px;
      }
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0; top: 0;
      width: 100vw; height: 100vh;
      overflow: auto;
      background: rgba(0,0,0,0.78);
      transition: background 0.2s;
    }
    .modal-content {
      background: #fff;
      color: #222;
      margin: 8% auto;
      padding: 30px 20px 20px 20px;
      border-radius: 16px;
      width: 94vw;
      max-width: 920px;
      min-height: 80px;
      box-shadow: 0 0 34px #00818a99;
      position: relative;
      text-align: left;
      animation: modalpop 0.2s;
    }
    @keyframes modalpop {
      0% { transform: scale(0.85); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    .close {
      position: absolute;
      right: 16px; top: 14px;
      font-size: 32px;
      font-weight: bold;
      color: #00818a;
      cursor: pointer;
      transition: color 0.2s;
    }
    .close:hover { color: #ff4d4d; }
    .modal-content h2 {
      margin-top: 0;
      color: #00818a;
      font-size: 1.25em;
      margin-bottom: 6px;
    }
    .modal-content p {
      margin: 0 0 5px 0;
    }
    /* --- END NAVBAR & MODALS ONLY --- */

    /* --- PLAYER AND PANEL STYLES --- */
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 88px 30px 30px;
      background: linear-gradient(135deg, #00818a, #7e1974);
      color: white;
      display: flex;
      justify-content: center;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    @media (max-width: 750px) {
      body {
        padding: 112px 8px 24px 8px;
      }
    }
    .strip-container {
      display: flex;
      flex-direction: row;
      width: 100%;
      max-width: 1100px;
      min-height: 280px;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 0 25px rgba(0, 0, 0, 0.5);
      background-color: #111;
      position: relative;
      z-index: 1;
    }
    .left-panel, .right-panel {
      width: 50%;
      padding: 20px 30px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .left-panel {
      background: #111;
      align-items: center;
      text-align: center;
      border-right: 1px solid #333;
      justify-content: flex-start;
      padding-top: 30px;
    }
    .right-panel {
  background: #222;
  border-left: 1px solid #333;
}

/* Only give it its own scrollbar on desktop, never on phones */
@media (min-width: 769px) {
  .right-panel { overflow-y: auto; }
}

/* And let wheel / swipe bubble out when you hit the end */
.right-panel { overscroll-behavior: contain; }
    #player-box {
      max-width: 420px;
      width: 100%;
    }
    button {
      background-color: #fed351;
      color: #111;
      border-radius: 8px;
      padding: 12px 24px;
      font-weight: 600;
      font-size: 18px;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      user-select: none;
    }
    button:hover,
    button:focus {
      background-color: #e5c73f;
      box-shadow: 0 0 10px #fed351cc;
      outline: none;
    }
    #mute-toggle {
      font-size: 16px;
      padding: 6px 12px;
      vertical-align: middle;
      margin-left: 10px;
    }
    #volume-container {
      margin-top: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    #volume-container label {
      font-size: 16px;
      margin: 0;
      user-select: none;
    }
    #volume-slider {
      width: 180px;
      cursor: pointer;
    }
    #volume-display {
      font-size: 16px;
      color: #ccc;
      min-width: 40px;
      text-align: left;
      user-select: none;
    }
    #onAirNow {
      margin-top: 10px;
      margin-bottom: 10px;
      text-align: center;
      padding-right: 0;
      max-width: 95%;
      margin-left: auto;
      margin-right: auto;
    }
    .pulsing-label {
      color: #ff4d4d;
      font-weight: 700;
     # animation: pulseText 5s infinite;
    }
  #   @keyframes pulseText {
     #  0%, 100% { opacity: 0.6; transform: scale(1); }
    #   50% { opacity: 1; transform: scale(1.1); }
    }
    @media (max-width: 768px) {
      button#play-toggle {
        font-size: 16px;
        padding: 12px 16px;
        width: 100%;
        margin-top: 10px;
      }
      #volume-container {
        display: none !important;
      }
      #volume-slider {
        width: 100%;
      }
      #volume-display, #mute-toggle {
        align-self: flex-end;
      }
      #nowPlaying {
        margin-top: 18px;
      }
      .artwork-container img {
        width: 100%;
        height: auto;
        border-radius: 10px;
      }
    }
    #now-playing-card {
      margin-top: 25px;
      background: #1a1a1a;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 15px rgba(0, 131, 138, 0.7);
      max-width: 420px;
      text-align: left;
      font-size: 17px;
      line-height: 1.7;
      color: white;
    }
    #artwork {
      margin-top: 25px;
      border-radius: 8px;
      width: 280px;
      height: 280px;
      object-fit: cover;
      border: 2px solid #fed351;
      box-shadow: 0 0 15px #fed351aa;
      user-select: none;
      opacity: 0;
      filter: blur(10px) brightness(0.8);
      transition: opacity 0.4s ease-in-out, filter 0.4s ease-in-out;
    }
    #artwork.loaded {
      opacity: 1;
      filter: blur(0) brightness(1);
    }
    #artwork.fallback {
      filter: blur(5px) brightness(0.8);
      opacity: 0.7;
      box-shadow: 0 0 10px rgba(254, 211, 81, 0.4);
    }
    .recent-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 20px;
      color: #fed351;
      user-select: none;
    }
    ul#recent-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    ul#recent-list li {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px 0;
      border-bottom: 1px solid #444;
      transition: background 0.2s ease;
    }
    ul#recent-list li:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    ul#recent-list img {
      width: 50px;
      height: 50px;
      border-radius: 6px;
      object-fit: cover;
      border: 1px solid #fed351;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.4);
      user-select: none;
      opacity: 0;
      transition: opacity 0.4s ease-in-out;
    }
    ul#recent-list img.loaded {
      opacity: 1;
    }
    ul#recent-list span.time {
      color: #fed351;
      font-weight: 600;
      width: 50px;
      text-align: right;
      flex-shrink: 0;
      user-select: none;
    }
    ul#recent-list span.info {
      flex: 1;
      color: white;
      font-size: 16px;
      user-select: none;
    }
    .refresh-indicator {
      display: inline-block;
      margin-left: 8px;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #fed351;
      animation: pulse 1.2s infinite;
      vertical-align: middle;
    }
    .strip-container { position: relative; z-index: 1; }
    .player-wrapper { position: relative; display: flex; justify-content: center; }
    .logo-overhang {
      position: absolute;
      top: 0;
      left: 0;
      transform: translate(-30%, -30%);
      width: 220px;
      z-index: 2;
      opacity: 0.97;
      pointer-events: none;
      user-select: none;
      filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.35));
    }
    @media (min-width: 769px) and (max-width: 1024px) {
      .logo-overhang {
        width: 170px;
        transform: translate(-30%, -30%);
      }
    }
    @media (max-width: 768px) {
      .logo-overhang {
        width: 120px;
        transform: (-25%, -25%);
        top: 2px;
        left: 20px;
      }
    }
    .live-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: bold;
      color: #ff4d4d;
      font-size: 0.95em;
      margin-left: 10px;
      user-select: none;
    }
    .live-indicator .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #ff4d4d;
      animation: pulse 1.2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 0.2; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.4); }
    }
    @media (max-width: 768px) {
      .strip-container { flex-direction: column; }
      .left-panel, .right-panel { width: 100%; padding: 20px; }
      #artwork { width: 100%; max-width: 280px; height: auto; }
      #onAirNow { text-align: center; }
    }
    #onAirNow { margin-top: 10px; margin-bottom: 10px; text-align: center; padding-right: 16px; max-width: 95%; margin-left: auto; margin-right: 0; }
    #onAirNow br { display: none; }
    #play-toggle { margin-bottom: 12px; }
    #onAirNow span { display: block; line-height: 1.2; }
    .show-title { font-weight: 600; }
    .show-presenter {
  font-weight: 400;
  font-size: 0.95em;
  opacity: 0.9;
  font-style: italic;
  padding-bottom: 6px !important;
  padding-right: 4px !important;   /* extra gap from the rounded corner   */
  line-height: 1.45em !important;
  display: block;
  overflow: visible !important;
}
    .left-panel { padding-top: 4px; }
    #player-box { margin-top: -4px; }
    #nowPlaying { margin-top: 8px; margin-bottom: 8px; }
    @media (max-width: 768px) {
      .recent-title { font-size: 16px; margin-bottom: 14px; }
      ul#recent-list li { gap: 10px; padding: 10px 0; }
      ul#recent-list img { width: 38px; height: 38px; }
      ul#recent-list span.info { font-size: 12px; }
      ul#recent-list span.time { font-size: 12px; width: 40px; }
    }
    /* Weather Widget - styled block above Recently Played */
   
    /* Modal Schedule Styling */
    #modalScheduleContainer .day-card {
      background: #111;
      border: 1px solid #333;
      border-radius: 12px;
      padding: 20px;
      width: 100%;
      max-width: 860px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      margin-bottom: 10px;
    }
    #modalScheduleContainer .day-card h2,
    #modalScheduleContainer .day-card h3 {
      font-size: 21px;
      margin: 0 0 18px;
      color: #fed351;
      text-align: center;
    }
    #modalScheduleContainer .split-columns {
      display: flex;
      gap: 24px;
    }
    #modalScheduleContainer .column {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    #modalScheduleContainer .show-entry {
      display: flex;
      align-items: flex-start;
      gap: 14px;
      margin-bottom: 18px;
    }
    #modalScheduleContainer .show-entry img {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #fed351;
      flex-shrink: 0;
    }
    #modalScheduleContainer .show-info {
      display: flex;
      flex-direction: column;
    }
    #modalScheduleContainer .show-info time {
      font-weight: 600;
      color: #fed351;
      font-size: 14px;
    }
    #modalScheduleContainer .show-title-presenter {
      margin-top: 2px;
      margin-bottom: 2px;
    }
    #modalScheduleContainer .show-title-presenter .show-title {
      font-weight: 600;
      color: #fff;
      display: block;
      font-size: 1.04em;
      line-height: 1.2;
      margin-bottom: 2px;
    }
    #modalScheduleContainer .show-title-presenter .show-presenter {
      font-size: 0.96em;
      color: #fed351;
      font-style: italic;
      text-decoration: none;
      line-height: 1.2;
      display: inline-block;
    }
    #modalScheduleContainer .show-title-presenter .show-presenter:hover {
      text-decoration: underline;
      color: #ffd866;
    }
    #modalScheduleContainer .show-details {
      font-size: 13px;
      color: #ccc;
      margin-top: 4px;
      line-height: 1.5;
    }
    @media (max-width: 900px) {
      #modalScheduleContainer .split-columns { flex-direction: column; gap:0; }
    }
    /* Playlist Modal Styling */
    .playlist-image {
  width: 100%;
  max-width: 600px; /* or 650px */
  border-radius: 18px;
  display: block;
  margin: 0 auto 18px auto;
}
  /* --- IMPROVED RESPONSIVE CSS FOR MOBILE (‚â§ 768px) --- */
@media (max-width: 768px) {

  body {
    padding: 48px 2vw 8vw 2vw !important;
  }

  .strip-container {
    flex-direction: column !important;
    border-radius: 10px !important;
    max-width: 100vw !important;
    min-height: 0 !important;
    box-shadow: 0 0 14px rgba(0,0,0,0.22) !important;
  }

  .left-panel, .right-panel {
    width: 100% !important;
    padding: 10px 4px 12px 4px !important;
    border: none !important;
    min-height: unset !important;
  }

  .left-panel {
    padding-top: 8px !important;
    align-items: stretch !important;
  }

  #player-box, #now-playing-card {
    max-width: 98vw !important;
    width: 100% !important;
    padding: 0 !important;
    margin: 0 auto !important;
    box-shadow: none !important;
  }

.presenter-line, .show-title-presenter span {
  font-size: 0.96em;
  color: #fed351;
  font-style: italic;
  display: inline-block;
  margin-top: 0.5px;
  line-height: 1.4;
  padding-bottom: 3px;
}

  #now-playing-card {
    font-size: 15px !important;
    padding: 10px 4px !important;
    border-radius: 7px !important;
    margin-top: 12px !important;
  }

  #artwork {
    width: 94vw !important;
    max-width: 140px !important;
    height: auto !important;
    margin-top: 8px !important;
    margin-bottom: 8px !important;
    border-radius: 7px !important;
  }

  .logo-overhang {
    width: 70px !important;
    left: 8px !important;
    top: 6px !important;
    transform: none !important;
    filter: drop-shadow(0 2px 2px rgba(0,0,0,0.25)) !important;
  }

  .recent-title {
    font-size: 13px !important;
    margin-bottom: 5px !important;
    padding-top: 3px !important;
  }

  ul#recent-list li {
    gap: 6px !important;
    padding: 8px 0 !important;
  }

  ul#recent-list img {
    width: 26px !important;
    height: 26px !important;
    border-radius: 4px !important;
  }

  ul#recent-list span.info, ul#recent-list span.time {
    font-size: 11px !important;
  }

  button, #mute-toggle {
    font-size: 14px !important;
    padding: 8px 14px !important;
    border-radius: 7px !important;
  }

  #volume-container label, #volume-display {
    font-size: 11px !important;
  }

  #volume-slider {
    width: 84px !important;
  }

  /* ON AIR NOW & SHOW */
  #onAirNow {
    font-size: 15px !important;
    margin-top: 4px !important;
    margin-bottom: 4px !important;
    padding-right: 0 !important;
    max-width: 100vw !important;
  }
  .show-title { font-size: 0.9em !important; }
  .show-presenter { font-size: 0.8em !important; }

  /* Modal Styling */
  .modal-content {
    padding: 13px 2vw 8px 2vw !important;
    font-size: 15px !important;
    min-height: 30px !important;
    border-radius: 9px !important;
    max-width: 97vw !important;
  }
  .close {
    font-size: 24px !important;
    top: 8px !important;
    right: 8px !important;
  }

  .playlist-image {
    max-width: 97vw !important;
    border-radius: 9px !important;
    margin-bottom: 10px !important;
  }

  /* Weather Panel */
  #weatherPanel {
    padding: 7px 8px 7px 8px !important;
    font-size: 13px !important;
    border-radius: 8px !important;
    margin-bottom: 10px !important;
    min-width: 80px !important;
    max-width: 98vw !important;
  }
  #weatherPanel img { width: 22px !important; height: 22px !important; }

  /* Studio Clock */
  #liveClock {
    padding: 6px 7px 6px 7px !important;
    min-width: 80px !important;
    max-width: 110px !important;
    border-radius: 7px !important;
    margin-bottom: 10px !important;
  }
  #clockTime {
    font-size: 1.2em !important;
  }
  #clockDate {
    font-size: 0.96em !important;
  }
}
@media (max-width: 768px) {
  #burgerMenuBtn {
    left: 7px !important;
    top: 7px !important;
    right: auto !important;
    font-size: 1.45em !important;
    padding: 7px 11px !important;
    border-radius: 8px !important;
    box-shadow: 0 1px 4px #0001 !important;
  }
}

</style>
</head>
<body>
<!-- BURGER MENU (mobile only) -->
<div id="burgerMenuBtn" onclick="toggleBurgerMenu()" style="display:none;position:fixed;top:16px;left:10px;z-index:2001;background:#fed351;padding:11px 18px;border-radius:11px;box-shadow:0 2px 8px #0002;font-size:2.1em;cursor:pointer;color:#000;">
  ‚ò∞
</div>
<!-- MOBILE DROPDOWN MENU -->
<div id="burgerDropdown" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.92);z-index:2000;flex-direction:column;align-items:center;justify-content:flex-start; padding-top:28px;">
  <div style="width:92vw;max-width:430px;margin:0 auto;display:flex;flex-direction:column;gap:10px;">
  <a href="#" onclick="openModal('aboutModal');closeBurgerMenu();return false;" class="menu-link">About Us</a>
  <a href="#" onclick="openModal('scheduleModal');closeBurgerMenu();return false;" class="menu-link">Schedule</a>
  <a href="#" onclick="openModal('playlistModal');closeBurgerMenu();return false;" class="menu-link">Playlist</a>
  <a href="#" onclick="openModal('listenModal');closeBurgerMenu();return false;" class="menu-link">Listen Again</a>
  <a href="#" onclick="openModal('searchModal');closeBurgerMenu();return false;" class="menu-link">Song Search</a>
  <a href="#" onclick="openModal('requestsModal');closeBurgerMenu();return false;" class="menu-link">Requests</a>
  <a href="#" onclick="openModal('contactModal');closeBurgerMenu();return false;" class="menu-link">Contact Us</a>
  <a href="#" onclick="openModal('newsModal');closeBurgerMenu();return false;" class="menu-link">News</a>
  <a href="#" onclick="openModal('travelModal');closeBurgerMenu();return false;" class="menu-link">Travel</a>
</div>

</div>

<!-- DESKTOP NAVIGATION -->
<nav class="navbar" role="navigation">
  <a href="#" onclick="openModal('aboutModal');return false;">About Us</a>
  <a href="#" onclick="openModal('scheduleModal');return false;">Schedule</a>
  <a href="#" onclick="openModal('playlistModal');return false;">Playlist</a>
  <a href="#" onclick="openModal('listenModal');return false;">Listen Again</a>
  <a href="#" onclick="openModal('searchModal');return false;">Song Search</a>
  <a href="#" onclick="openModal('requestsModal');return false;">Requests</a>
  <a href="#" onclick="openModal('contactModal');return false;">Contact Us</a>
  <a href="#" onclick="openModal('newsModal');return false;">News</a>
  <a href="#" onclick="openModal('travelModal');return false;">Travel</a>
</nav>

  <!-- NAVIGATION MENU -->
  <nav class="navbar" role="navigation">
    <a href="#" onclick="openModal('aboutModal');return false;">About Us</a>
    <a href="#" onclick="openModal('scheduleModal');return false;">Schedule</a>
    <a href="#" onclick="openModal('playlistModal');return false;">Playlist</a>
    <a href="#" onclick="openModal('listenModal');return false;">Listen Again</a>
    <a href="#" onclick="openModal('searchModal');return false;">Song Search</a>
    <a href="#" onclick="openModal('requestsModal');return false;">Requests</a>
    <a href="#" onclick="openModal('contactModal');return false;">Contact Us</a>
    <a href="#" onclick="openModal('newsModal');return false;">News</a>
    <a href="#" onclick="openModal('travelModal');return false;">Travel</a>
  </nav>

  <!-- PLAYER LAYOUT -->
  <div class="player-wrapper">
    <img src="ERLogo2.png" alt="Essential Radio Logo" class="logo-overhang" />
    <div class="strip-container">
      <div class="left-panel">
        <div id="onAirNow" style="text-align: right;">
          <span class="pulsing-label">ON AIR NOW</span>
          <span id="currentShow" style="font-weight: 600;">Loading...</span>
        </div>
        <div id="player-box">
          <audio id="stream" preload="none">
            <source src="https://streaming06.liveboxstream.uk/proxy/ayrshire/stream" type="audio/mpeg" />
          </audio>
          <button id="play-toggle">‚ñ∂Ô∏è Play Essential Radio</button>
          <div id="volume-container">
            <label for="volume-slider">Volume:</label>
            <input type="range" id="volume-slider" min="0" max="100" value="100" />
            <span id="volume-display">100%</span>
            <button id="mute-toggle">üîä</button>
          </div>
          <div id="now-playing-card">
            <div id="now-playing">Loading current track‚Ä¶</div>
          </div>
          <img id="artwork" src="Essential Radio Logo.png" alt="Artwork" class="loaded" />
        </div>
      </div>
     <div class="right-panel" style="display:flex;flex-direction:column;">

  <!-- Studio Clock at the very top -->
  <div id="liveClock"
    style="background:#151516; border-radius:12px; border:2px solid #500; box-shadow:0 1px 10px #111a;
           min-width:140px; max-width:175px; padding:8px 18px 9px 18px; margin:0 auto 14px auto;
           display:flex;flex-direction:column;align-items:center;justify-content:center;">
    <span id="clockTime"
      style="color:#e53935; font-family:'Consolas','Courier New',monospace;
             font-size:2em; font-weight:700; letter-spacing:0.05em; line-height:1.08; text-align:center;display:block;">
      --:--:--
    </span>
    <span id="clockDate"
      style="font-size:1.02em;color:#fed351;font-family:'Montserrat',sans-serif;
             letter-spacing:0.07em;text-align:center;text-shadow:0 1px 2px #111;margin-top:2px;display:block;">
    </span>
  </div>

  <!-- Weather underneath -->
 <!-- ‚ñë‚ñë ESSENTIAL RADIO ‚ñë‚ñë  ADVANCED WEATHER WIDGET (dusk-fix) ‚ñë‚ñë -->
<!-- 1 ‚ñ™ Mark-up ------------------------------------------------>
<div id="weather-widget" class="day">
  <div style="display:flex;align-items:center;gap:10px;">
    <select id="wxLocation">
      <option value="Kilwinning,55.6558,-4.7057">Kilwinning</option>
      <option value="Kilmarnock,55.6118,-4.4955">Kilmarnock</option>
      <option value="Ayr,55.4586,-4.6292">Ayr</option>
    </select>
    <img id="weather-icon" width="46" height="46" alt="Weather icon">
    <span id="weather-text">Loading weather‚Ä¶</span>
  </div>

  <!-- extras -->
  <div id="wxStrip"  style="margin-top:4px;font-size:0.9em;"></div>
  <div id="wxAlert"  style="color:#ff4d4d;font-weight:700;"></div>
</div>

<!-- 2 ‚ñ™ Styles (tweak colours if you like) --------------------->
<style>
  #weather-widget{font-family:inherit;font-size:15px;line-height:1.35;}
  #weather-widget select{
    background:#fed351;border:none;font-weight:600;padding:4px 6px;border-radius:6px;
  }
  #weather-widget.day  {color:#000;}
  #weather-widget.night{background:#111;color:#eee;border-radius:8px;padding:6px;}
  #weather-widget.night select{background:#333;color:#fff;}

  #wxStrip span{margin-right:10px;white-space:nowrap;}
  @media (max-width:500px){
    #weather-widget{font-size:14px;}
    #weather-widget select{font-size:0.9em;}
    #wxStrip{font-size:0.8em;}
  }
</style>

<!-- 3 ‚ñ™ Script ----------------------------------------------->
<script>
(function(){
  const API_KEY='YOUR_API_KEY_HERE';                 //  ‚Üê  add your key
  const SEL  =document.getElementById('wxLocation');
  const ICON =document.getElementById('weather-icon');
  const TEXT =document.getElementById('weather-text');
  const STRIP=document.getElementById('wxStrip');
  const ALERT=document.getElementById('wxAlert');
  const WID  =document.getElementById('weather-widget');

  if(localStorage.wxChoice) SEL.value=localStorage.wxChoice;

  const pick=a=>a[Math.floor(Math.random()*a.length)];

  /* --- friendly wording table (full) --- */
  const variants={
    'clear sky':{day:['Sunny','Bright sunshine','Clear & bright','Blue skies','Wall-to-wall sunshine'],
                 night:['Clear night','Starry sky','Moonlit sky','Calm, clear night']},
    'few clouds':{day:['Mostly sunny','Sunny spells','Plenty of sunshine','Sunshine peeking through'],
                  night:['Mainly clear','A few clouds','Clear breaks']},
    'scattered clouds':{day:['Partly cloudy','Sunny intervals','Mix of sun & cloud'],
                        night:['Variable cloud','Partly cloudy night']},
    'broken clouds':{day:['Sunny intervals','Some sun breaking through'],
                     night:['Cloudy night','Intermittent cloud']},
    'overcast clouds':{day:['Cloudy','Overcast','Dull grey skies'],
                       night:['Overcast night','Blanket of cloud']},
    'light rain':{day:['Light rain','Drizzly','Spits of rain'],
                  night:['Light rain','Drizzly night']},
    'moderate rain':{day:['Rain','Showery rain'],
                     night:['Steady rain night','Rainy night']},
    'heavy intensity rain':{day:['Heavy rain','Pouring'],
                            night:['Heavy rain overnight','Downpours at night']},
    'light drizzle':{day:['Fine drizzle','Damp & drizzly'],
                     night:['Drizzly night','Occasional drizzle']},
    'light snow':{day:['Light snow','Flurries'],
                  night:['Light snow','Snow flurries']},
    'snow':{day:['Snowy','Snow showers'],
            night:['Snowy night','Overnight snow']},
    'fog':{day:['Foggy','Thick fog'],
           night:['Dense fog','Foggy night']},
    'mist':{day:['Misty'],night:['Misty night']},
    'thunderstorm':{day:['Thunderstorms'],night:['Thunderstorms']},
    default:{day:['Daytime weather'],night:['Night-time weather']}
  };

  function extra(cur,next){
    let s=''; const uv=cur.uvi, pop=Math.round((next?.pop||0)*100),
          wind=Math.round(cur.wind_speed*3.6);
    if(uv>=6)   s+=` ‚Ä¢ <span title="High UV">UV ${uv}</span>`;
    if(pop>=40) s+=` ‚Ä¢ ${pop}% rain`;
    if(wind>=25)s+=` ‚Ä¢ ${wind} km/h wind`;
    return s;
  }

  function strip(hr){
    STRIP.innerHTML='';
    hr.slice(1,5).forEach(h=>{
      const t=new Date(h.dt*1000).getHours().toString().padStart(2,'0')+':00';
      STRIP.innerHTML+=`<span>${t}<img src="https://openweathermap.org/img/wn/${h.weather[0].icon}.png" width="22"> ${Math.round(h.temp)}¬∞</span>`;
    });
  }

  async function load(){
    const [city,lat,lon]=SEL.value.split(',');
    localStorage.wxChoice=SEL.value;
    const url=`https://api.openweathermap.org/data/3.0/onecall?lat=${lat}&lon=${lon}&units=metric&exclude=minutely,daily&appid=${API_KEY}`;
    try{
      const d=await (await fetch(url)).json();
      const cur=d.current, nxt=d.hourly?.[1];
      const raw=cur.weather[0].description.toLowerCase();
      const icon=cur.weather[0].icon, temp=Math.round(cur.temp), clouds=cur.clouds;

      /* refined daylight: sunrise+1h ‚Ä¶ sunset-1h */
      const day=(cur.dt>=cur.sunrise+3600)&&(cur.dt<cur.sunset-3600);
      WID.className=day?'day':'night';

      /* choose description */
      let desc;
      if(day && temp>20 && clouds<20) desc='Warm and sunny';
      else{
        const set=variants[raw]||variants.default;
        desc=pick(set[day?'day':'night']);
      }

      /* guards */
      if(!day && /sunny|bright/i.test(desc))          desc=pick(variants['clear sky'].night);
      if(clouds>90 && /sunny|bright/i.test(desc))     desc=pick(variants['overcast clouds'][day?'day':'night']);
      if(temp<10 && /warm|hot/i.test(desc))           desc=pick(variants['few clouds'][day?'day':'night']);

      TEXT.innerHTML=`${desc}, ${temp}¬∞C${extra(cur,nxt)}`;
      ICON.src=`https://openweathermap.org/img/wn/${icon}@2x.png`;
      ICON.alt=desc;

      strip(d.hourly);
      ALERT.textContent=d.alerts?.length?`‚ö† ${d.alerts[0].event}`:'';
    }catch{TEXT.textContent='Weather unavailable';}
  }
  load(); let t=setInterval(load,900000);
  SEL.addEventListener('change',()=>{clearInterval(t);load();t=setInterval(load,900000);});
})();
</script>

  <!-- Recently Played fills the rest of the panel -->
  <div class="recently-played-container" style="flex:1;display:flex;flex-direction:column;min-height:0;">
    <div class="recent-title" style="color:#fed351;font-size:1.1em;margin-bottom:7px;">Recently Played</div>
    <ul id="recent-list" style="list-style:none;padding:0;margin:0;flex:1;overflow-y:auto;"></ul>
  </div>
</div>


    <!-- MODALS -->
  <div id="aboutModal" class="modal">
  <div class="modal-content" style="max-width:740px;width:97vw;">
    <span class="close" onclick="closeModal('aboutModal')">&times;</span>
    <div style="display:flex;align-items:center;gap:20px;margin-bottom:24px;">
      <h2 style="margin:0;color:#00818a;font-size:1.55em;">About Us</h2>
    </div>
    <div style="background:#111;border:1px solid #333;border-radius:12px;padding:22px 18px 12px 18px;box-shadow:0 0 20px rgba(0,0,0,0.21);margin-bottom:0; color:#fff;">
      <p style="margin-bottom:18px;">
        Essential Radio is Ayrshire College‚Äôs very own 24/7 station, broadcasting music, student content and campus updates from our Kilwinning base. The station launched in June 2022 with initial funding from the Ayrshire College Foundation, and brings a fresh and dynamic voice to the college community.
      </p>
      <p style="margin-bottom:18px;">
        We‚Äôre more than just great music. Essential Radio is a creative platform for students across all departments. Whether as part of a class project or an extra-curricular activity, learners can contribute shows, features and ideas that reflect their interests and studies.
      </p>
      <p style="margin-bottom:18px;">
        Any student with a passion for broadcasting is welcome to get involved. From presenting to production, advert scripting to playlist curation ‚Äì we offer hands-on experience and skill-building opportunities with real impact.
      </p>
      <p style="margin-bottom:24px;">
        The station enhances college life with music, event coverage and a direct link between students, staff and local employers. It‚Äôs a modern, flexible way to keep our community connected, supported and inspired ‚Äì on all of our campuses and beyond.
      </p>
      <hr style="border:0;border-top:1px solid #444;margin:28px 0 18px 0;">
      <h3 style="color:#fed351;font-size:1.08em;margin:0 0 13px 0;">Our Aims</h3>
      <ul style="color:#ddd;font-size:1em;line-height:1.6;padding-left:20px;margin:0 0 14px 0;">
        <li>To provide a positive, inclusive broadcast platform for the college community.</li>
        <li>To support learning, creativity and employability through media skills.</li>
        <li>To share news, opportunities and achievements across all campuses.</li>
        <li>To promote student and staff voices, with original content and music.</li>
      </ul>
      <hr style="border:0;border-top:1px solid #444;margin:28px 0 18px 0;">
      <h3 style="color:#fed351;font-size:1.08em;margin:0 0 13px 0;">Contact Us</h3>
      <p>
        You can email the team at <a href="mailto:essentialradio@ayrshire.ac.uk" style="color:#fed351;">essentialradio@ayrshire.ac.uk</a> or use the Contact form on this site.
      </p>
      <p style="font-size:0.97em;color:#bbb;margin:20px 0 0 0;">
        Essential Radio is fully licensed for music broadcast in the UK by PPL and PRS for Music.
      </p>
      <div style="text-align:center;margin-top:18px;">
        <img src="PPL_PRSLogo.png" alt="PPL_PRSLogo" style="width:120px;max-width:100%;filter:brightness(1.08);" />
      </div>
    </div>
    <div style="margin-top:20px;text-align:center;color:#888;font-size:14px;opacity:0.8;">
      Essential Radio &copy; 2025
    </div>
  </div>
</div>

  <div id="scheduleModal" class="modal">
    <div class="modal-content" style="max-width:920px;width:95vw;">
      <span class="close" onclick="closeModal('scheduleModal')">&times;</span>
      <h2 style="margin-top:0;">Programme Schedule</h2>
      <div style="margin-bottom:18px;">
        <label for="modalDaySelect" style="color:#222;font-weight:600;">Choose a day: </label>
        <select id="modalDaySelect" style="padding:8px 12px;border-radius:7px;border:none;background:#fed351;color:#111;font-weight:600;"></select>
      </div>
      <div id="modalScheduleContainer">
        <div class="day-card" id="modalDaySchedule">
          <h3>Loading‚Ä¶</h3>
        </div>
      </div>
    </div>
  </div>

  <div id="playlistModal" class="modal">
    <div class="modal-content" style="max-width:650px;width:97vw;">
      <span class="close" onclick="closeModal('playlistModal')">&times;</span>
      <h2 style="margin-top:0;color:#00818a;">Essential Radio Playlist</h2>
      <img src="ERPlaylist.png" alt="Essential Radio Playlist" class="playlist-image" />
    </div>
  </div>

 <div id="listenModal" class="modal">
  <div class="modal-content" style="max-width:700px;width:97vw;">
    <span class="close" onclick="closeModal('listenModal')">&times;</span>
    <div style="display:flex;align-items:center;gap:20px;margin-bottom:24px;">
      <h2 style="margin:0;color:#00818a;font-size:1.5em;">Listen Again</h2>
    </div>
    <div style="background:#111;border:1px solid #333;border-radius:12px;padding:24px 18px;box-shadow:0 0 20px rgba(0,0,0,0.28); color:#eee;">
      <p style="font-size:17px;line-height:1.6;margin-bottom:18px;">
        Missed a show? No problem! Catch up on your favourite Essential Radio programmes here.<br>
        Browse recent shows, select your favourites, and listen again anytime.
      </p>
      <div id="mixcloud-embeds"></div>
    </div>
    <div style="margin-top:18px;text-align:center;color:#888;font-size:14px;opacity:0.8;">
      Essential Radio &copy; 2025
    </div>

    <script>
      fetch('https://api.mixcloud.com/essentialradio/cloudcasts/')
        .then(response => response.json())
        .then(data => {
          const container = document.getElementById('mixcloud-embeds');
          const shows = data.data.slice(0, 6); // Only show 6
          shows.forEach(show => {
            const block = document.createElement('div');
            block.className = 'show-block';

            const title = document.createElement('div');
            title.className = 'show-title';
            title.textContent = show.name || show.slug || 'Previous Show';

            const iframe = document.createElement('iframe');
            iframe.className = 'mixcloud-player';
            iframe.src = `https://www.mixcloud.com/widget/iframe/?feed=${encodeURIComponent(show.url)}&hide_cover=1&light=0`;
            iframe.allow = 'autoplay';

            block.appendChild(title);
            block.appendChild(iframe);
            container.appendChild(block);
          });
        })
        .catch(error => {
          document.getElementById('mixcloud-embeds').innerHTML =
            '<div style="color:#fed351;font-size:1.1em;margin-top:12px;">Unable to load previous shows at the moment.</div>';
        });
    </script>
    <style>
      .show-block {
        margin-bottom: 30px;
      }
      .show-title {
        font-size: 18px;
        margin-bottom: 8px;
        color: #fff;
        word-break: break-word;
        line-height: 1.2;
        font-weight: 500;
      }
      .mixcloud-player {
        width: 100%;
        min-width: 0;
        height: 120px;
        border: 0;
        display: block;
        border-radius: 8px;
        background: #222;
      }
      @media (max-width: 600px) {
        .show-title {
          font-size: 16px;
        }
        .mixcloud-player {
          height: 150px;
        }
      }
      @media (max-width: 400px) {
        .mixcloud-player {
          height: 165px;
        }
      }
    </style>
  </div>
</div>

    </script>
    <style>
      .show-block {
        margin-bottom: 30px;
      }
      .show-title {
        font-size: 18px;
        margin-bottom: 8px;
        color: #fff;
        word-break: break-word;
        line-height: 1.2;
        font-weight: 500;
      }
      .mixcloud-player {
        width: 100%;
        min-width: 0;
        height: 120px;
        border: 0;
        display: block;
        border-radius: 8px;
        background: #222;
      }
      @media (max-width: 600px) {
        .show-title {
          font-size: 16px;
        }
        .mixcloud-player {
          height: 150px;
        }
      }
      @media (max-width: 400px) {
        .mixcloud-player {
          height: 165px;
        }
      }
    </style>
  </div>
</div>

 <div id="searchModal" class="modal">
  <div class="modal-content" style="max-width:950px;width:97vw;">
    <span class="close" onclick="closeModal('searchModal')">&times;</span>
    <div style="display:flex;align-items:center;gap:20px;margin-bottom:24px;">
      <h2 style="margin:0;color:#00818a;font-size:1.45em;">Song Search</h2>
    </div>
    <div style="background:#111;border:1px solid #333;border-radius:12px;padding:0 0 20px 0;box-shadow:0 0 20px rgba(0,0,0,0.23);margin-bottom:0; color:#eee;">
      <!-- Original intro wording -->
      <div class="content-card" style="background:#151921ea;border:1px solid #343648;border-radius:16px;padding:24px 18px 12px 18px;max-width:850px;margin:24px auto 16px auto;box-shadow:0 0 18px #0008;">
        <p style="font-size:17px;line-height:1.6;margin-bottom:0;">
          Trying to remember that amazing track we just played?<br>
          Use our Song Search to find recent songs and discover more about what‚Äôs been on Essential Radio.
        </p>
      </div>
      <!-- Playout Log Viewer Embed Starts -->
      <div class="container" style="background:#191b24f2;border-radius:18px;box-shadow:0 0 18px #0008;max-width:850px;margin:0 auto 36px auto;padding:20px 18px 32px 18px;">
        <div class="filters" style="margin-bottom:1.5rem;display:flex;flex-wrap:wrap;align-items:center;gap:0.7rem 1.2rem;">
          <label for="dateSelect">Date:</label>
          <select id="dateSelect"></select>
          <label for="hourSelect">Hour:</label>
          <select id="hourSelect"></select>
          <button id="prevHour">‚≠† Previous Hour</button>
          <button id="nextHour">Next Hour ‚û°</button>
          <label for="searchInput">Filter:</label>
          <input type="text" id="searchInput" placeholder="Search by Artist or Title...">
          <button id="resetFilters">Reset</button>
        </div>
        <table style="width:100%;border-collapse:collapse;margin-top:0.7rem;background:transparent;color:#fff;font-size:17px;border-radius:8px;overflow:hidden;">
          <thead style="background:#fed351;color:#7e1974;font-size:17.5px;">
            <tr>
              <th>Time</th>
              <th>Artist ‚Äì Title</th>
            </tr>
          </thead>
          <tbody id="logTableBody"></tbody>
        </table>
        <div id="noResultsMessage" class="no-results" style="display: none;text-align:center;font-style:italic;color:#fed351;padding:1.4rem 0 0.7rem 0;font-size:18px;letter-spacing:0.1px;">No tracks found for this time period.</div>
      </div>
      <!-- End Playout Log Viewer Embed -->
    </div>
    <div style="margin-top:18px;text-align:center;color:#888;font-size:14px;opacity:0.8;">
      Essential Radio &copy; 2025
    </div>
    <style>
      /* Extra modal-specific responsive tweaks for Song Search */
      @media (max-width: 950px) {
        #searchModal .content-card, #searchModal .container { max-width: 98vw; }
        #searchModal .content-card, #searchModal .container { padding: 2vw 3vw; }
      }
      @media (max-width: 700px) {
        #searchModal .content-card { padding: 13px 3vw 10px 3vw; font-size: 16px; }
        #searchModal .container { padding: 8px 1vw 10px 1vw; }
        #searchModal table, #searchModal th, #searchModal td { font-size: 15px; }
        #searchModal .filters { gap: 0.5rem 0.7rem; }
        #searchModal select, #searchModal input[type="text"], #searchModal button { font-size: 14px; }
      }
      @media (max-width: 540px) {
        #searchModal .content-card { padding: 7px 1vw 4px 1vw; }
        #searchModal .container { padding: 5px 0vw 5px 0vw; }
        #searchModal .filters { flex-direction: column; gap: 0.6rem 0; }
      }
    </style>
    <script>
      let fullData = [];
      const dateMap = new Map();
      let latestDate = null;
      let latestHour = null;

      function populateDropdowns(data) {
        dateMap.clear();
        latestDate = null;
        latestHour = null;
        let latestDateTime = new Date(0);
        const now = new Date();

        data.forEach(item => {
          const dt = new Date(item["Hour"]);
          const dtLocal = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate(), dt.getHours());
          const localDate = dt.toLocaleDateString("en-GB");
          const localHour = dt.getHours().toString().padStart(2, '0') + ":00";

          if (dtLocal <= now) {
            if (!dateMap.has(localDate)) dateMap.set(localDate, new Set());
            dateMap.get(localDate).add(localHour);

            if (dtLocal > latestDateTime) {
              latestDateTime = dtLocal;
              latestDate = localDate;
              latestHour = localHour;
            }
          }
        });

        const dateDropdown = document.getElementById("dateSelect");
        const dates = Array.from(dateMap.keys()).sort();
        dateDropdown.innerHTML = dates.map(d => `<option value="${d}">${d}</option>`).join('');
        dateDropdown.value = latestDate;
        updateHourDropdown(latestDate, latestHour);
      }

      function updateHourDropdown(selectedDate, selectedHour = null) {
        const hourDropdown = document.getElementById("hourSelect");
        const hours = Array.from(dateMap.get(selectedDate) || []).sort();
        hourDropdown.innerHTML = hours.map(h => `<option value="${h}">${h}</option>`).join('');
        hourDropdown.value = selectedHour || hours[hours.length - 1];
      }

      function renderTable(data) {
        const tbody = document.getElementById("logTableBody");
        const searchText = document.getElementById("searchInput").value.toLowerCase();
        const selectedDate = document.getElementById("dateSelect").value;
        const selectedHour = document.getElementById("hourSelect").value;
        const noResultsMessage = document.getElementById("noResultsMessage");
        tbody.innerHTML = "";
        const seen = new Set();

        const filtered = data.filter(item => {
          const dt = new Date(item["Hour"]);
          const localDate = dt.toLocaleDateString("en-GB");
          const localHour = dt.getHours().toString().padStart(2, '0') + ":00";
          const key = `${item["Artist"]} - ${item["Title"]}`;

          const durationMinutes = item["Duration (mins)"] || 0;
          const isMatch = localDate === selectedDate && localHour === selectedHour && key.toLowerCase().includes(searchText) && durationMinutes <= 10;

          if (isMatch && !seen.has(key)) {
            seen.add(key);
            return true;
          }
          return false;
        });

        if (filtered.length === 0) {
          noResultsMessage.style.display = "block";
        } else {
          noResultsMessage.style.display = "none";
          filtered.forEach(item => {
            const time = item["Displayed Time"] || item["Scheduled Time"]?.substring(0, 5) || "";
            const row = `<tr><td>${time}</td><td>${item["Artist"]} ‚Äì ${item["Title"]}</td></tr>`;
            tbody.innerHTML += row;
          });
        }
      }

      document.getElementById("searchInput").addEventListener("input", () => renderTable(fullData));
      document.getElementById("dateSelect").addEventListener("change", () => {
        updateHourDropdown(document.getElementById("dateSelect").value);
        renderTable(fullData);
      });
      document.getElementById("hourSelect").addEventListener("change", () => renderTable(fullData));

      document.getElementById("prevHour").addEventListener("click", () => {
        const hourDropdown = document.getElementById("hourSelect");
        const options = Array.from(hourDropdown.options);
        const idx = options.findIndex(opt => opt.selected);
        if (idx > 0) {
          hourDropdown.selectedIndex = idx - 1;
          renderTable(fullData);
        }
      });

      document.getElementById("nextHour").addEventListener("click", () => {
        const hourDropdown = document.getElementById("hourSelect");
        const options = Array.from(hourDropdown.options);
        const idx = options.findIndex(opt => opt.selected);
        if (idx < options.length - 1) {
          hourDropdown.selectedIndex = idx + 1;
          renderTable(fullData);
        }
      });

      document.getElementById("resetFilters").addEventListener("click", () => {
        document.getElementById("searchInput").value = "";

        let latestDate = null;
        let latestHour = null;
        let latestDateTime = new Date(0);
        const now = new Date();

        fullData.forEach(item => {
          const dt = new Date(item["Hour"]);
          const dtLocal = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate(), dt.getHours());
          const localDate = dt.toLocaleDateString("en-GB");
          const localHour = dt.getHours().toString().padStart(2, '0') + ":00";

          if (dtLocal <= now && dtLocal > latestDateTime) {
            latestDateTime = dtLocal;
            latestDate = localDate;
            latestHour = localHour;
          }
        });

        if (latestDate && latestHour) {
          document.getElementById("dateSelect").value = latestDate;
          updateHourDropdown(latestDate, latestHour);
          renderTable(fullData);
        }
      });

      fetch("playout_log_rolling.json")
        .then(res => res.json())
        .then(data => {
          fullData = data;
          populateDropdowns(data);
          renderTable(data);
        });
    </script>
  </div>
</div>
<div id="requestsModal" class="modal">
  <div class="modal-content" style="max-width:700px;width:97vw;">
    <span class="close" onclick="closeModal('requestsModal')">&times;</span>
    <div style="display:flex;align-items:center;gap:20px;margin-bottom:24px;">
      <h2 style="margin:0;color:#00818a;font-size:1.5em;">Request a Song</h2>
    </div>
    <div style="background:#111;border:1px solid #333;border-radius:12px;padding:28px 18px 32px 18px;box-shadow:0 0 20px rgba(0,0,0,0.28);margin-bottom:0; color:#eee;">
      <p style="font-size:17px;line-height:1.6;margin-bottom:22px;">
        Got a favourite track or a shout-out for someone special?<br>
        Send us your song requests and messages ‚Äì and we might play them live on air!<br>
        <span style="color:#aaa;font-size:15px;">
          (Note: Many of our shows are pre-recorded, so requests may not always be instant.)
        </span>
      </p>
      <div style="width:100%;min-height:340px;">
        <!-- Elfsight Contact Form | Request a song -->
        <script src="https://static.elfsight.com/platform/platform.js" async></script>
        <div class="elfsight-app-69585003-61ea-407e-a005-4861876e1a5b" data-elfsight-app-lazy></div>
      </div>
      <div id="thank-you-message" class="thank-you" style="font-size:18px;margin-top:18px;min-height:36px;"></div>
    </div>
    <div style="margin-top:18px;text-align:center;color:#888;font-size:14px;opacity:0.8;">
      Essential Radio &copy; 2025
    </div>
  </div>
</div>
  <div id="contactModal" class="modal">
  <div class="modal-content" style="max-width:620px;width:97vw;">
    <span class="close" onclick="closeModal('contactModal')">&times;</span>
    <div style="display:flex;align-items:center;gap:18px;margin-bottom:24px;">
      <h2 style="margin:0;color:#00818a;font-size:1.35em;">Contact</h2>
    </div>
    <div style="background:#111;border:1px solid #333;border-radius:12px;padding:24px 18px 18px 18px;box-shadow:0 0 20px rgba(0,0,0,0.23);margin-bottom:0; color:#eee;">
      <p style="font-size:17px;line-height:1.6;">
        We‚Äôd love to hear from you! Whether it‚Äôs feedback, a shout-out, or just to say hello, drop us a message and we‚Äôll get back to you as soon as we can. Essential Radio ‚Äì always here, always listening.
      </p>
      <div style="margin-top:22px;margin-bottom:22px;">
        <!-- Elfsight Contact Form | Contact Us -->
        <script src="https://static.elfsight.com/platform/platform.js" async></script>
        <div class="elfsight-app-974fdef7-6e84-49a1-8384-9604e1f7be5c" data-elfsight-app-lazy></div>
      </div>
      <div class="contact-details" style="margin-top:8px;">
        <p style="margin-bottom:12px;"><strong>Email:</strong>
          <a href="mailto:essentialradio@ayrshire.ac.uk" style="color:#00e0ff;text-decoration:none;font-weight:600;">essentialradio@ayrshire.ac.uk</a>
        </p>
        <p style="margin-bottom:8px;"><strong>Follow us:</strong> @ERadioAyrshire on</p>
        <ul style="list-style:none;padding-left:0;margin:0 0 0 6px;">
          <li style="margin-bottom:7px;font-size:17px;">üê¶ <a href="https://x.com/eradioayrshire" target="_blank" style="color:#00e0ff;text-decoration:none;font-weight:600;">X</a></li>
          <li style="margin-bottom:7px;font-size:17px;">üì∏ <a href="https://instagram.com/eradioayrshire" target="_blank" style="color:#00e0ff;text-decoration:none;font-weight:600;">Instagram</a></li>
          <li style="margin-bottom:7px;font-size:17px;">‚òÅÔ∏è <a href="https://bsky.app/profile/eradioayrshire" target="_blank" style="color:#00e0ff;text-decoration:none;font-weight:600;">Bluesky</a></li>
          <li style="margin-bottom:7px;font-size:17px;">üìò <a href="https://facebook.com/eradioayrshire" target="_blank" style="color:#00e0ff;text-decoration:none;font-weight:600;">Facebook</a></li>
        </ul>
      </div>
    </div>
    <div style="margin-top:16px;text-align:center;color:#888;font-size:14px;opacity:0.8;">
      Essential Radio &copy; 2025
    </div>
  </div>
</div>

<div id="newsModal" class="modal">
  <div class="modal-content" style="max-width:700px;width:97vw;">
    <span class="close" onclick="closeModal('newsModal')">&times;</span>
    <div style="display:flex;align-items:center;gap:18px;margin-bottom:24px;">
      <h2 style="margin:0;color:#00818a;font-size:1.3em;">News & Weather</h2>
    </div>
    <div style="background:#111;border:1px solid #333;border-radius:12px;padding:28px 18px 32px 18px;box-shadow:0 0 20px rgba(0,0,0,0.28);margin-bottom:0; color:#eee;">
      <h3 style="color:#00e0ff;margin-top:0;font-size:1.15em;">üì∞ Latest Headlines</h3>
      <!-- Elfsight RSS Feed | News Feed from RNH -->
      <script src="https://static.elfsight.com/platform/platform.js" async></script>
      <div class="elfsight-app-9b4542e0-7fb9-4bfb-a258-38a84ee937a7" data-elfsight-app-lazy></div>
    </div>
    <div style="margin-top:18px;text-align:center;color:#888;font-size:14px;opacity:0.8;">
      Essential Radio &copy; 2025
    </div>
  </div>
</div>
  <div id="travelModal" class="modal">
  <div class="modal-content" style="max-width:900px;width:97vw;">
    <span class="close" onclick="closeModal('travelModal')">&times;</span>
    <div style="display:flex;align-items:center;gap:18px;margin-bottom:20px;">
      <h2 style="margin:0;color:#00818a;font-size:1.3em;">Travel & Transport</h2>
    </div>
    <div style="background:#111;border:1px solid #333;border-radius:12px;padding:24px 18px 24px 18px;box-shadow:0 0 20px rgba(0,0,0,0.20);margin-bottom:0; color:#eee;">
      <p style="font-size:17px;line-height:1.65;margin-bottom:18px;">
        Stay up-to-date with live road, rail, and travel news across Ayrshire and the West of Scotland. This page brings you <b>real-time delays, incidents, roadworks and ScotRail disruption</b> - all updated automatically for Essential Radio listeners.<br>
        <span style="color:#fed351;">Tip:</span> Click or tap the sections below to browse maps, incidents and more.
      </p>
      <details style="margin-bottom:20px;">
        <summary style="font-size:18px;font-weight:600;color:#fed351;cursor:pointer;outline:none;">üó∫Ô∏è Combined Travel Report (All Modes)</summary>
        <div style="margin:10px 0 0 0;">
          <iframe src="https://travel-ac.vercel.app/Current_Combined_Travel_Report.html" width="100%" height="650" style="border-radius:10px;border:none;box-shadow:0 2px 14px #0004;background:#fff;" title="Combined Travel Report" loading="lazy"></iframe>
        </div>
      </details>
      <details style="margin-bottom:20px;">
        <summary style="font-size:18px;font-weight:600;color:#fed351;cursor:pointer;outline:none;">üö¶ Current Road Delays & Hotspots</summary>
        <div style="margin:10px 0 0 0;">
          <iframe src="https://travel-ac.vercel.app/Current_Hotspots_Traffic_Scotland.html" width="100%" height="420" style="border-radius:10px;border:none;box-shadow:0 2px 14px #0004;background:#fff;" title="Current Road Delays & Hotspots" loading="lazy"></iframe>
        </div>
      </details>
      <details style="margin-bottom:20px;">
        <summary style="font-size:18px;font-weight:600;color:#fed351;cursor:pointer;outline:none;">üöß Current Roadworks & Closures</summary>
        <div style="margin:10px 0 0 0;">
          <iframe src="https://travel-ac.vercel.app/Current_Roadworks_Traffic_Scotland.html" width="100%" height="340" style="border-radius:10px;border:none;box-shadow:0 2px 14px #0004;background:#fff;" title="Current Roadworks" loading="lazy"></iframe>
        </div>
      </details>
      <details style="margin-bottom:20px;">
        <summary style="font-size:18px;font-weight:600;color:#fed351;cursor:pointer;outline:none;">üö® Current Incidents & Queues</summary>
        <div style="margin:10px 0 0 0;">
          <iframe src="https://travel-ac.vercel.app/Current_Incidents_Traffic_Scotland.html" width="100%" height="340" style="border-radius:10px;border:none;box-shadow:0 2px 14px #0004;background:#fff;" title="Current Incidents" loading="lazy"></iframe>
        </div>
      </details>
      <details>
        <summary style="font-size:18px;font-weight:600;color:#fed351;cursor:pointer;outline:none;">üöÜ ScotRail Live Service Updates</summary>
        <div style="margin:10px 0 0 0;">
          <iframe src="https://travel-ac.vercel.app/Scotrail_Incidents.html" width="100%" height="360" style="border-radius:10px;border:none;box-shadow:0 2px 14px #0004;background:#fff;" title="ScotRail Live Updates" loading="lazy"></iframe>
        </div>
      </details>
    </div>
    <div style="margin-top:18px;text-align:center;color:#888;font-size:14px;opacity:0.8;">
      Essential Radio &copy; 2025
    </div>
  </div>
</div>

  <!-- WEATHER WIDGET SCRIPT -->
  <script>
    async function fetchWeather() {
      const API_KEY = 'e4a309c7e76f09b85a2ff7d34305505f';
  const url = 'https://api.openweathermap.org/data/2.5/weather?q=Kilmarnock,GB&units=metric&appid=' + API_KEY;
  const variants = {
    'clear sky': {
      day:  ['Sunny','Bright sunshine','Blue skies','Clear & bright','Wall-to-wall sunshine'],
      night:['Clear night','Starry sky','Starlit evening','Calm, clear night','Moonlit sky']
    },
    'few clouds': {
      day:  ['Mostly sunny','Sunny spells','Bright with a few clouds','Plenty of sunshine','Sunshine peeking through'],
      night:['Mainly clear','A few clouds','Partly clear night','Patchy cloud at night','Clear breaks']
    },
    'scattered clouds': {
      day:  ['Partly cloudy','Patchy cloud','Mix of sun and cloud','Sunny intervals','Fair-weather cloud'],
      night:['Partly cloudy night','Some cloud, some clear','Variable cloud','Broken cloud cover','Intervals of cloud']
    },
    'broken clouds': {
      day:  ['Sunny intervals','Partly cloudy','Some sun breaking through','Brighter spells','Clouds with sunny breaks'],
      night:['Cloudy night','Large cloud breaks','Partly cloudy after dark','Cloud gaps overnight','Intermittent cloud']
    },
    'overcast clouds': {
      day:  ['Cloudy','Overcast','Grey skies','Thick cloud cover','Dull and overcast'],
      night:['Overcast night','Thick clouds','Dark & cloudy','Blanket of cloud','Grey, overcast night']
    },
    'light rain': {
      day:  ['Light rain','Drizzly','Spits of rain','Passing light rain','Fine rain'],
      night:['Light rain','Drizzly night','Patchy light rain','Light showers overnight','On-off drizzle']
    },
    'moderate rain': {
      day:  ['Rain','Steady rain','Showery rain','On-and-off rain','Persistent rain'],
      night:['Rainy night','Steady rain after dark','Overnight rain','Continuous rain','Showery night']
    },
    'heavy intensity rain': {
      day:  ['Heavy rain','Pouring','Soaking rain','Torrential downpours','Lashing rain'],
      night:['Heavy rain overnight','Downpours at night','Driving rain','Bucketing rain','Torrential rain']
    },
    'light drizzle': {
      day:  ['Light drizzle','Fine drizzle','Misty drizzle','Damp and drizzly'],
      night:['Light drizzle','Damp night','Occasional drizzle','Drizzly conditions']
    },
    'light snow': {
      day:  ['Light snow','Flurries','Light snowflakes','Brief snow showers'],
      night:['Light snow','Flurries overnight','Light snow showers','Snow flurries']
    },
    'snow': {
      day:  ['Snowy','Snow falling','Wintry snow','Snow showers','Steady snow'],
      night:['Snowy night','Snow continuing','Wintry night','Overnight snow','Snow showers after dark']
    },
    'fog': {
      day:  ['Foggy','Thick fog','Low-lying fog','Murky conditions'],
      night:['Dense fog','Foggy night','Night fog','Thick mist']
    },
    'mist': {
      day:  ['Misty','Morning mist','Hazy mist','Mist lingering'],
      night:['Misty night','Light mist','Patchy mist','Evening mist']
    },
    'thunderstorm': {
      day:  ['Thunderstorms','Stormy with thunder','Rumbles of thunder','Thundery showers'],
      night:['Thunderstorms','Stormy night','Night-time thunder','Lightning & thunder']
    },
    default:{ day:['Daytime weather'], night:['Night-time weather'] }
  };

  const pick = a => a[Math.floor(Math.random()*a.length)];

  try {
    const data   = await (await fetch(url)).json();
    const raw    = data.weather[0].description.toLowerCase();
    const temp   = Math.round(data.main.temp);
    const cloud  = data.clouds.all;
    const icon   = data.weather[0].icon;             // "01d" / "01n"
    const isDay  = icon.endsWith('d');

    /* Day-only warm & sunny override */
    let desc;
    if (isDay && temp > 20 && cloud < 20) {
      desc = 'Warm and sunny';
    } else {
      const set = variants[raw] || variants.default;
      desc = isDay ? pick(set.day) : pick(set.night);
    }

    /* ----- Guard clauses against mismatches ----- */

    /* No sunny/bright words at night */
    if (!isDay && /sunny|bright/i.test(desc)) {
      desc = pick(variants['clear sky'].night);
    }

    /* No warm/hot words if cold */
    if (temp < 10 && /warm|hot/i.test(desc)) {
      desc = pick(variants['few clouds'][isDay ? 'day' : 'night']);
    }

    /* No cold/chilly if warm */
    if (temp > 18 && /cold|chilly/i.test(desc)) {
      desc = pick(variants['scattered clouds'][isDay ? 'day' : 'night']);
    }

    /* Avoid bright phrases if >90 % cloud */
    if (cloud > 90 && /sunny|bright/i.test(desc)) {
      desc = pick(variants['overcast clouds'][isDay ? 'day' : 'night']);
    }

    /* -------------- Update DOM -------------- */
    document.getElementById('weather-icon').src =
      `https://openweathermap.org/img/wn/${icon}@2x.png`;
    document.getElementById('weather-icon').alt = desc;
    document.getElementById('weather-text').textContent = `${desc}, ${temp}¬∞C`;

  } catch (err) {
    document.getElementById('weather-text').textContent = 'Weather unavailable';
  }
}

/* initial + 15-min refresh */
fetchWeather();
setInterval(fetchWeather, 15*60*1000);
</script>


  <!-- MODAL JS -->
  <script>
    function openModal(id) {
      document.getElementById(id).style.display = 'block';
      document.body.style.overflow = 'hidden';
    }
    function closeModal(id) {
      document.getElementById(id).style.display = 'none';
      document.body.style.overflow = '';
    }
    window.onclick = function(event) {
      document.querySelectorAll('.modal').forEach(modal => {
        if (event.target === modal) {
          modal.style.display = 'none';
          document.body.style.overflow = '';
        }
      });
    }
    window.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        document.querySelectorAll('.modal').forEach(modal => {
          modal.style.display = 'none';
        });
        document.body.style.overflow = '';
      }
    });
  </script>

  <!-- NATIVE MODAL SCHEDULE LOGIC -->
  <script>
  (function() {
    const daysOfWeek = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
    const todayIndex = new Date().getDay() === 0 ? 6 : new Date().getDay() - 1;

    const modalScheduleContainer = document.getElementById("modalDaySchedule");
    const modalDaySelect = document.getElementById("modalDaySelect");
    let modalFullSchedule = null;

    // Populate dropdown
    daysOfWeek.forEach((day, idx) => {
      const opt = document.createElement("option");
      opt.value = day;
      opt.textContent = day;
      if (idx === todayIndex) opt.selected = true;
      modalDaySelect.appendChild(opt);
    });

    async function fetchScheduleModal() {
      try {
        const res = await fetch("https://essentialradio.github.io/player/schedule.json");
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        return await res.json();
      } catch (e) {
        modalScheduleContainer.innerHTML = `<h3>Schedule Unavailable</h3>`;
        console.error("Schedule fetch failed:", e);
        return null;
      }
    }

    function renderDayScheduleModal(day, shows) {
      modalScheduleContainer.innerHTML = `
        <h3>${day}</h3>
        <div class="split-columns">
          <div class="column left-column" id="modalLeftCol"></div>
          <div class="column right-column" id="modalRightCol"></div>
        </div>
      `;

      const mid = Math.ceil(shows.length / 2);
      const leftShows = shows.slice(0, mid);
      const rightShows = shows.slice(mid);

      [leftShows, rightShows].forEach((group, i) => {
        const col = document.getElementById(i === 0 ? "modalLeftCol" : "modalRightCol");
        group.forEach(show => {
          const presenter = show.presenter || {};
          const presenterImg = presenter.photo || "images/presenters/default.jpg";
          const presenterName = presenter.name || "";
          const presenterLink = presenter.bio || "#";
          const description = show.info || "";

          let mainTitle = show.title || '';
          let presenterLine = "";
          if (mainTitle && mainTitle.toLowerCase().includes(" with ")) {
            const idx = mainTitle.toLowerCase().indexOf(" with ");
            const showTitlePart = mainTitle.slice(0, idx);
            const withPart = mainTitle.slice(idx); // includes 'with'
            mainTitle = showTitlePart.trim();
            presenterLine = `<span class="show-presenter">${withPart.trim()}</span>`;
          } else if (presenterName) {
            presenterLine = `<a href="${presenterLink}" target="_blank" rel="noopener" class="show-presenter">${presenterName}</a>`;
          }

          const entry = document.createElement("div");
          entry.className = "show-entry";
          entry.innerHTML = `
            <img src="${presenterImg}" alt="${presenterName}" onerror="this.src='images/presenters/default.jpg'">
            <div class="show-info">
              <time>${show.start}‚Äì${show.end}</time>
              <div class="show-title-presenter">
                <span class="show-title">${mainTitle}</span>
                ${presenterLine}
              </div>
              <div class="show-details">${description}</div>
            </div>`;
          col.appendChild(entry);
        });
      });
    }

    modalDaySelect.addEventListener("change", () => {
      const selectedDay = modalDaySelect.value;
      if (modalFullSchedule && modalFullSchedule[selectedDay]) {
        renderDayScheduleModal(selectedDay, modalFullSchedule[selectedDay]);
      }
    });

    fetchScheduleModal().then(data => {
      if (data) {
        modalFullSchedule = data;
        const todayName = daysOfWeek[todayIndex];
        renderDayScheduleModal(todayName, data[todayName]);
      }
    });
  })();
  </script>

  <!-- PLAYER SCRIPTS (UNCHANGED) -->
  <script>
    async function fetchSchedule() {
      try {
        const res = await fetch("https://essentialradio.github.io/player/schedule.json");
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        return await res.json();
      } catch (e) {
        console.error("Schedule fetch error:", e);
        return null;
      }
    }
    function getCurrentShow(schedule) {
      const now = new Date();
      const day = now.toLocaleString("en-GB", { weekday: "long" });
      const shows = schedule && schedule[day];
      if (!shows) return "No schedule available";
      const nowMins = now.getHours() * 60 + now.getMinutes();
      for (const show of shows) {
        const [sh, sm] = show.start.split(":").map(Number);
        const [eh, em] = show.end.split(":").map(Number);
        let start = sh * 60 + sm;
        let end = eh * 60 + em;
        if (end === 0 && start > 0) end = 1440;
        if (nowMins >= start && nowMins < end) {
          return show.title;
        }
      }
      return "Off Air";
    }
    async function updateOnAirNow() {
      const schedule = await fetchSchedule();
      const fullShow = schedule ? getCurrentShow(schedule) : "Schedule unavailable";
      const el = document.getElementById("currentShow");
      if (fullShow.includes(" with ")) {
        const [title, presenter] = fullShow.split(" with ");
        el.innerHTML = `
          <span class="show-title">${title.trim()}</span>
          <span class="show-presenter">with ${presenter.trim()}</span>`;
      } else {
        el.textContent = fullShow;
      }
    }
    updateOnAirNow();
    setInterval(updateOnAirNow, 60_000);
  </script>
  <script>
    const audio = document.getElementById('stream');
    const playBtn = document.getElementById('play-toggle');
    const muteBtn = document.getElementById('mute-toggle');
    const volumeSlider = document.getElementById('volume-slider');
    if (window.innerWidth <= 768) {
      volumeSlider.disabled = true;
      muteBtn.disabled = true;
    }
    const volumeDisplay = document.getElementById('volume-display');
    const nowPlaying = document.getElementById('now-playing');
    const artworkImg = document.getElementById('artwork');
    const observer = new IntersectionObserver(entries => {
      for (const e of entries) {
        if (e.isIntersecting) {
          e.target.classList.add('loaded');
          observer.unobserve(e.target);
        }
      }
    }, { threshold: 0.1 });
    let isPlaying = false, lastVolume = 1;
    playBtn.addEventListener('click', () => {
      if (!isPlaying) {
        audio.load();
        audio.play().catch(() => {});
        playBtn.textContent = '‚è∏ Pause';
        isPlaying = true;
      } else {
        audio.pause();
        playBtn.textContent = '‚ñ∂Ô∏è Play Essential Radio';
        isPlaying = false;
      }
    });
    volumeSlider.addEventListener('input', () => {
      const vol = volumeSlider.value / 100;
      audio.volume = vol;
      volumeDisplay.textContent = `${volumeSlider.value}%`;
      muteBtn.textContent = vol === 0 ? 'üîá' : vol < 0.5 ? 'üîà' : 'üîä';
    });
    muteBtn.addEventListener('click', () => {
      if (!audio.muted) {
        audio.muted = true;
        muteBtn.textContent = 'üîá';
        volumeDisplay.textContent = 'Muted';
      } else {
        audio.muted = false;
        muteBtn.textContent = audio.volume < 0.5 ? 'üîà' : 'üîä';
        volumeDisplay.textContent = `${volumeSlider.value}%`;
      }
    });
    async function fetchDurationAndStartTime(artist, title) {
      try {
        const logUrl = 'https://essentialradio.github.io/player/playout_log_rolling.json';
        const res = await fetch(`${logUrl}?_=${Date.now()}`, { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        const match = data.reverse().find(item =>
          item.Artist?.toLowerCase() === artist.toLowerCase() &&
          item.Title?.toLowerCase() === title.toLowerCase()
        );
        if (match && match["Scheduled Time"] && match["Duration (s)"] && match["Hour"]) {
          const hourDate = new Date(match["Hour"]);
          const [sh, sm] = match["Scheduled Time"].split(":").map(Number);
          const start = new Date(
            hourDate.getFullYear(),
            hourDate.getMonth(),
            hourDate.getDate(),
            sh,
            sm,
            0
          );
          return {
            duration: parseInt(match["Duration (s)"], 10),
            startTime: start
          };
        }
      } catch (e) {
        console.warn("Duration/start time fetch failed:", e);
      }
      return null;
    }
    function showMoreMusicSoon() {
      nowPlaying.innerHTML = `
        <span style="color:#fed351;">Now Playing:</span>
        <span class="live-indicator"><span class="dot"></span>LIVE</span><br/>
        <span style="color:white;font-weight:600;font-size:1.2em;">More music soon</span><br/>
        <span style="color:white;">on Essential Radio</span>`;
      document.title = `Essential Radio: More music soon`;
      applyFallbackImmediate();
    }
    let currentTrackID = null;
    let songHasEnded = false;
    let trackEndTimeout = null;
    async function fetchNowPlaying() {
      try {
        const res = await fetch('https://player-green.vercel.app/api/metadata', { cache: 'no-store' });
        const data = await res.json();
        const decode = str => {
          const t = document.createElement('textarea');
          t.innerHTML = str;
          return t.value;
        };
        const raw = decode(data.nowPlaying || '').trim();
        let artist = '', title = '';
        const sep = raw.includes(' ‚Äì ') ? ' ‚Äì ' : raw.includes(' - ') ? ' - ' : null;
        if (sep) {
          [artist, title] = raw.split(sep).map(s => s.trim());
        } else {
          showMoreMusicSoon();
          return;
        }
        currentTrackID = `${artist} ‚Äì ${title}`;
        songHasEnded = false;
        nowPlaying.innerHTML = `
          <span style="color:#fed351;">Now Playing:</span>
          <span class="live-indicator"><span class="dot"></span>LIVE</span><br/>
          <span style="color:white;font-weight:600;font-size:1.2em;">${title}</span><br/>
          <span style="color:white;">by ${artist}</span>`;
        document.title = `Essential Radio: ${artist} ‚Äì ${title}`;
        fetchArtwork(`${artist} - ${title}`);
        const latestRes = await fetch('https://essentialradio.github.io/player/latestTrack.json?_=' + Date.now());
        const latest = await latestRes.json();
        if (!latest || !latest.artist || !latest.title || !latest.duration || !latest.startTime) {
          console.warn("latestTrack.json missing fields");
          return;
        }
        if (
          latest.artist.toLowerCase() !== artist.toLowerCase() ||
          latest.title.toLowerCase() !== title.toLowerCase()
        ) {
          console.log("latestTrack.json does not match metadata track");
          return;
        }
        const startTime = new Date(latest.startTime);
        const durationMs = latest.duration * 1000;
        const endTime = new Date(startTime.getTime() + durationMs);
        const now = new Date();
        const timeRemaining = endTime - now;
        if (trackEndTimeout) clearTimeout(trackEndTimeout);
        if (timeRemaining <= 0) {
          showMoreMusicSoon();
          songHasEnded = true;
          currentTrackID = null;
        } else {
          trackEndTimeout = setTimeout(() => {
            showMoreMusicSoon();
            songHasEnded = true;
            currentTrackID = null;
          }, timeRemaining);
        }
      } catch (e) {
        console.error("Now playing error:", e);
        showMoreMusicSoon();
        currentTrackID = null;
        songHasEnded = false;
      }
    }
    async function fetchRecentFromGitHub() {
      try {
        const baseUrl = 'https://essentialradio.github.io/player/playout_log_rolling.json';
        const res = await fetch(`${baseUrl}?_=${Date.now()}`, { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        const recentItems = data
          .filter(item => {
            const name = `${item.Artist} ‚Äì ${item.Title}`;
            return item.Artist && item.Title && (songHasEnded || name !== currentTrackID);
          })
          .slice(-5)
          .reverse();
        const entries = await Promise.all(recentItems.map(async item => {
          const time = item['Scheduled Time'] || item.time || '';
          const name = `${item.Artist} ‚Äì ${item.Title}`;
          const art = await getTrackArtwork(name) || 'Essential Radio Logo.png';
          return `
            <li>
              <span class="time">${time}</span>
              <img src="${art}"
                   alt="Cover for ${name}"
                   loading="lazy" />
              <span class="info">${name}</span>
            </li>`;
        }));
        const list = document.getElementById('recent-list');
        list.innerHTML = entries.join('');
        document.querySelectorAll('#recent-list img').forEach(img => observer.observe(img));
      } catch (e) {
        console.error('Recent fetch failed:', e);
      }
    }
    async function fetchArtwork(trackName) {
      artworkImg.src = 'Essential Radio Logo.png';
      artworkImg.classList.remove('loaded', 'fallback');
      try {
        const res = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(trackName)}&limit=1`);
        const js = await res.json();
        if (js.results[0]?.artworkUrl100) {
          const url = js.results[0].artworkUrl100.replace('100x100', '300x300');
          artworkImg.onload = () => artworkImg.classList.add('loaded');
          artworkImg.onerror = applyFallbackImmediate;
          artworkCache[trackName] = url;
          artworkImg.src = url;
          return;
        }
      } catch {}
      const safe = trackName
        .replace(/\s*\(.*?\)/g, '')
        .replace(/[^a-zA-Z0-9\s-]/g, '')
        .trim()
        .replace(/\s+/g, '_');
      const [artist, title] = safe.split('_-_');
      const autoUrl = `https://cdn.autopo.st/images/coverart/${artist?.[0]?.toLowerCase()||'a'}/${artist}_${title}.jpg`;
      try {
        const head = await fetch(autoUrl, { method: 'HEAD' });
        if (head.ok) {
          artworkImg.onload = () => artworkImg.classList.add('loaded');
          artworkImg.onerror = applyFallbackImmediate;
          artworkImg.src = autoUrl;
          return;
        }
      } catch {}
      applyFallbackImmediate();
    }
    function applyFallbackImmediate() {
      artworkImg.src = 'Essential Radio Logo.png';
      artworkImg.classList.remove('loaded');
      artworkImg.classList.add('fallback');
    }
    const artworkCache = {};
    async function getTrackArtwork(query) {
      if (artworkCache[query]) return artworkCache[query];
      try {
        const res = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(query)}&limit=1`);
        const d = await res.json();
        if (d.results[0]?.artworkUrl100) {
          return d.results[0].artworkUrl100.replace('100x100', '300x300');
        }
      } catch {}
      return '';
    }
    fetchNowPlaying();
    fetchRecentFromGitHub();
    setInterval(fetchNowPlaying, 15000);
    setInterval(fetchRecentFromGitHub, 15000);
  </script>
  <script>
    function formatShowTitleMobileOnly(title) {
      if (window.innerWidth <= 600) {
        const match = title.match(/(.*)\s+with\s+(.*)/i);
        if (match) {
          return `${match[1]}<br>with ${match[2]}`;
        }
      }
      return title;
    }
    const showSpan = document.getElementById("currentShow");
    const rawTitle = showSpan?.textContent || "";
    showSpan.innerHTML = formatShowTitleMobileOnly(rawTitle);
  </script>
  <script>
    function formatShowTitleMobileOnly(title) {
      if (window.innerWidth <= 600) {
        const match = title.match(/(.*)\s+with\s+(.*)/i);
        if (match) {
          return `${match[1]}<br>with ${match[2]}`;
        }
      }
      return title;
    }
    const showSpan2 = document.getElementById("currentShow");
    // MutationObserver ensures that when the schedule updates, we reformat it
    const observer = new MutationObserver(() => {
      const raw = showSpan2?.textContent || "";
      showSpan2.innerHTML = formatShowTitleMobileOnly(raw);
    });
    if (showSpan2) {
      observer.observe(showSpan2, { childList: true });
      // initial format
      showSpan2.innerHTML = formatShowTitleMobileOnly(showSpan2.textContent);
    }
  </script>
</body>
<script>
function updateLiveClock() {
      const now = new Date();
      // 24-hour, 2 digits always
      const pad = n => n.toString().padStart(2, '0');
      const time = `${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;
      const days = ['SUN','MON','TUE','WED','THU','FRI','SAT'];
      const months = [
        'JANUARY','FEBRUARY','MARCH','APRIL','MAY','JUNE',
        'JULY','AUGUST','SEPTEMBER','OCTOBER','NOVEMBER','DECEMBER'
      ];
      const dow = days[now.getDay()];
      const day = now.getDate();
      const month = months[now.getMonth()];
      const year = now.getFullYear();
      const dateStr = `${dow} ${day} ${month} ${year}`;
      document.getElementById('clockTime').textContent = time;
      document.getElementById('clockDate').textContent = dateStr;
    }
    updateLiveClock();
    setInterval(updateLiveClock, 1000);

function toggleBurgerMenu() {
  var menu = document.getElementById('burgerDropdown');
  if (menu.style.display === 'flex') {
    menu.style.display = 'none';
    document.body.style.overflow = '';
  } else {
    menu.style.display = 'flex';
    document.body.style.overflow = 'hidden';
  }
}
function closeBurgerMenu() {
  var menu = document.getElementById('burgerDropdown');
  menu.style.display = 'none';
  document.body.style.overflow = '';
}
// Close when clicking outside the menu panel
document.addEventListener('click', function(e) {
  var menu = document.getElementById('burgerDropdown');
  var btn = document.getElementById('burgerMenuBtn');
  if (
    window.innerWidth <= 750 &&
    menu.style.display === 'flex' &&
    !menu.contains(e.target) &&
    !btn.contains(e.target)
  ) {
    closeBurgerMenu();
  }
});
// Optional: ESC key closes burger menu
window.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') closeBurgerMenu();
});

</script>

</html>
