<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Essential Radio Player</title>
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp">
  <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    /* ===== RESET & FONTS ===== */
    html, body { margin: 0; padding: 0; }
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #00818a, #7e1974);
      color: #fff;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    a { color: #fed351; text-decoration: none; }
    a:hover, a:focus { text-decoration: underline; }

    /* ===== NAVBAR / BURGER ===== */
    .navbar {
      position: fixed;
      top: 0; left: 0; width: 100vw;
      background: #222; z-index: 1001;
      display: flex; justify-content: center; gap: 8px;
      padding: 9px 0 8px 0; box-shadow: 0 2px 12px #111a;
      flex-wrap: wrap;
    }
    .navbar a {
      color: #222; background: #fed351;
      padding: 8px 18px; border-radius: 16px; font-weight: bold;
      text-decoration: none; font-size: 16px;
      margin: 0 2px; transition: background 0.2s, color 0.2s;
      border: none; cursor: pointer; outline: none;
      display: inline-block;
    }
    .navbar a:hover, .navbar a:focus { background: #00818a; color: #fff; }
    @media (max-width: 750px) {
      .navbar { display: none !important; }
    }
    #burgerMenuBtn {
      display: none;
      position: fixed; top: 20px; left: 8px;
      width: 32px; height: 32px;
      background: #fed351; border-radius: 7px; z-index: 2001;
      flex-direction: column; align-items: center; justify-content: center;
      box-shadow: 0 2px 8px #0002; padding: 0; transition: box-shadow 0.18s;
    }
    #burgerMenuBtn .burger-bar {
      width: 17px; height: 2.7px; background: #191c29;
      border-radius: 2px; margin: 2.8px 0; transition: all 0.2s;
    }
    @media (max-width: 750px) { #burgerMenuBtn { display: flex !important; } }

    /* ======= BURGER DROPDOWN ======= */
    #burgerDropdown {
      display: none; position: fixed; top: 0; left: 0;
      width: 100vw; height: 100vh; background: rgba(0,0,0,0.92);
      z-index: 2000; flex-direction: column; align-items: center;
      justify-content: flex-start; padding-top: 28px;
    }
    #burgerDropdown .menu-link {
      background: #fed351; color: #191c29;
      font-size: 1.07em; font-weight: 600; border-radius: 8px;
      padding: 10px 0; text-align: center;
      margin-bottom: 0; box-shadow: 0 2px 10px #0001;
      transition: background 0.2s, color 0.2s;
    }
    #burgerDropdown .menu-link:hover { background: #ffe67c; color: #191c29; }

    /* ======= HEADER SPACER ======= */
    .header-spacer { height: 92px; }
    @media (max-width: 750px) { .header-spacer { height: 8px; } }

    /* ===== LOGO ===== */
    .logo-overhang {
      position: absolute; top: 0; left: 0;
      transform: translate(-36%, -36%);
      width: 220px; z-index: 2002; opacity: 0.97;
      pointer-events: none; user-select: none;
      filter: drop-shadow(0 4px 6px rgba(0,0,0,0.35));
    }
    .logo-hide { display: none !important; }
    @media (max-width: 768px) {
      .logo-overhang {
        width: 100px !important;
        top: 0 !important; left: 0 !important; transform: none !important;
      }
    }

    /* ===== PLAYER LAYOUT ===== */
    .player-wrapper {
      position: relative; margin: 0 auto; width: 100%;
      max-width: 1100px;
    }
    .strip-container {
      display: flex; flex-direction: row;
      width: 100%; max-width: 1100px; min-height: 280px;
      border-radius: 15px; overflow: hidden; box-shadow: 0 0 25px rgba(0,0,0,0.5);
      background-color: #111; position: relative; z-index: 1;
    }
    .left-panel, .right-panel {
      width: 50%; padding: 20px 30px; box-sizing: border-box;
      display: flex; flex-direction: column; justify-content: center;
    }
    .left-panel { background: #111; align-items: center; text-align: center; border-right: 1px solid #333; padding-top: 30px; }
    .right-panel { background: #222; border-left: 1px solid #333; }
    @media (max-width: 768px) {
      .strip-container { flex-direction: column !important; }
      .left-panel, .right-panel { width: 100% !important; padding: 10px 4px !important; border: none !important; }
    }

    /* ===== BASE & FONT ===== */
html, body { margin: 0; padding: 0; }
body {
  font-family: 'Inter', sans-serif;
  background: linear-gradient(135deg, #00818a, #7e1974);
  color: #fff;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

a { color: #fed351; text-decoration: none; }
a:hover, a:focus { text-decoration: underline; }

/* ===== NAVBAR & BURGER ===== */
.navbar {
  position: fixed;
  top: 0; left: 0; width: 100vw;
  background: #222; z-index: 1001;
  display: flex; justify-content: center; gap: 8px;
  padding: 9px 0 8px 0; box-shadow: 0 2px 12px #111a;
  flex-wrap: wrap;
}
.navbar a {
  color: #222; background: #fed351;
  padding: 8px 18px; border-radius: 16px; font-weight: bold;
  text-decoration: none; font-size: 16px;
  margin: 0 2px; transition: background 0.2s, color 0.2s;
  border: none; cursor: pointer; outline: none;
  display: inline-block;
}
.navbar a:hover, .navbar a:focus { background: #00818a; color: #fff; }
@media (max-width: 750px) { .navbar { display: none !important; } }
@media (max-width: 750px) {
  .navbar { flex-direction: column; gap: 2px; padding: 5px 0; }
  .navbar a { margin: 2px 0; font-size: 15px; padding: 8px 12px; border-radius: 10px; }
}
@media (min-width: 751px) { #burgerMenuBtn, #burgerDropdown { display: none !important; } }

#burgerMenuBtn {
  display: none;
  position: fixed; top: 20px; left: 8px;
  width: 32px; height: 32px;
  background: #fed351; border-radius: 7px; z-index: 2001;
  flex-direction: column; align-items: center; justify-content: center;
  box-shadow: 0 2px 8px #0002; padding: 0; transition: box-shadow 0.18s;
}
#burgerMenuBtn .burger-bar {
  display: block;
  width: 17px; height: 2.7px; background: #191c29;
  border-radius: 2px; margin: 2.8px 0; transition: all 0.2s;
}
@media (max-width: 750px) { #burgerMenuBtn { display: flex !important; } }

#burgerDropdown {
  display: none; position: fixed; top: 0; left: 0;
  width: 100vw; height: 100vh; background: rgba(0,0,0,0.92);
  z-index: 2000; flex-direction: column; align-items: center;
  justify-content: flex-start; padding-top: 28px;
}
.menu-link {
  display: block;
  background: #fed351;
  color: #191c29;
  font-size: 1.07em;
  font-weight: 600;
  border-radius: 8px;
  padding: 10px 0;
  text-align: center;
  text-decoration: none;
  margin-bottom: 0;
  box-shadow: 0 2px 10px #0001;
  transition: background 0.2s, color 0.2s;
}
.menu-link:active, .menu-link:hover { background: #ffe67c; color: #191c29; }

/* ===== MODALS ===== */
.modal {
  display: none;
  position: fixed;
  z-index: 2000;
  left: 0; top: 0;
  width: 100vw; height: 100vh;
  overflow: auto;
  background: rgba(0,0,0,0.78);
  transition: background 0.2s;
  overscroll-behavior: contain;
}
.modal-content {
  background: #fff;
  color: #222;
  margin: 8% auto;
  padding: 30px 20px 20px 20px;
  border-radius: 16px;
  width: 94vw;
  max-width: 920px;
  min-height: 80px;
  box-shadow: 0 0 34px #00818a99;
  position: relative;
  text-align: left;
  animation: modalpop 0.2s;
  max-height: 85vh;
  overflow-y: auto !important;
  -webkit-overflow-scrolling: touch;
}
@keyframes modalpop {
  0% { transform: scale(0.85); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}
.close {
  position: absolute;
  right: 16px; top: 14px;
  font-size: 32px;
  font-weight: bold;
  color: #00818a;
  cursor: pointer;
  transition: color 0.2s;
}
.close:hover { color: #ff4d4d; }
.modal-content h2 {
  margin-top: 0; color: #00818a; font-size: 1.25em; margin-bottom: 6px;
}
.modal-content p { margin: 0 0 5px 0; }

/* Prevent body scroll when modal is open */
body.modal-open {
  overflow: hidden !important;
  position: fixed !important;
  width: 100vw;
}

.logo-hide { display: none !important; }

/* ===== PANELS & PLAYER ===== */
.header-spacer { height: 92px; }
@media (max-width: 750px) { .header-spacer { height: 8px; } }
.player-wrapper {
  position: relative;
  margin: 0 auto;
  width: 100%;
  max-width: 1100px;
}
.strip-container {
  display: flex; flex-direction: row;
  width: 100%; max-width: 1100px; min-height: 280px;
  border-radius: 15px; overflow: hidden; box-shadow: 0 0 25px rgba(0,0,0,0.5);
  background-color: #111; position: relative; z-index: 1;
}
.left-panel, .right-panel {
  width: 50%; padding: 20px 30px; box-sizing: border-box;
  display: flex; flex-direction: column; justify-content: center;
}
.left-panel {
  background: #111; align-items: center; text-align: center;
  border-right: 1px solid #333; justify-content: flex-start; padding-top: 30px;
}
.right-panel { background: #222; border-left: 1px solid #333; }
@media (max-width: 768px) {
  .strip-container { flex-direction: column !important; }
  .left-panel, .right-panel { width: 100% !important; padding: 10px 4px !important; border: none !important; min-height: unset !important; }
  .left-panel { padding-top: 8px !important; align-items: stretch !important; }
}

/* Only right panel scrolls on desktop */
@media (min-width: 769px) { .right-panel { overflow-y: auto; } }
.right-panel { overscroll-behavior: contain; }

/* PLAYER/ARTWORK */
#player-box { max-width: 420px; width: 100%; }
#now-playing-card {
  margin-top: 25px; background: #1a1a1a; border-radius: 10px;
  padding: 20px; box-shadow: 0 0 15px rgba(0, 131, 138, 0.7);
  max-width: 420px; text-align: left; font-size: 17px; line-height: 1.7; color: white;
}
#artwork {
  margin-top: 25px; border-radius: 8px; width: 280px; height: 280px;
  object-fit: cover; border: 2px solid #fed351; box-shadow: 0 0 15px #fed351aa;
  user-select: none; opacity: 0; filter: blur(10px) brightness(0.8);
  transition: opacity 0.4s ease-in-out, filter 0.4s ease-in-out;
}
#artwork.loaded { opacity: 1; filter: blur(0) brightness(1); }
#artwork.fallback { filter: blur(5px) brightness(0.8); opacity: 0.7; box-shadow: 0 0 10px rgba(254, 211, 81, 0.4); }
#onAirNow { margin-top: 10px; margin-bottom: 10px; text-align: center; padding-right: 0; max-width: 95%; margin-left: auto; margin-right: auto; }
.pulsing-label { color: #ff4d4d; font-weight: 700; }
.live-indicator { display: inline-flex; align-items: center; gap: 6px; font-weight: bold; color: #ff4d4d; font-size: 0.95em; margin-left: 10px; user-select: none; }
.live-indicator .dot { width: 10px; height: 10px; border-radius: 50%; background: #ff4d4d; animation: pulse 1.2s infinite; }
@keyframes pulse { 0%, 100% { opacity: 0.2; transform: scale(1); } 50% { opacity: 1; transform: scale(1.4); } }

/* VOLUME/BUTTONS */
button {
  background-color: #fed351; color: #111; border-radius: 8px;
  padding: 12px 24px; font-weight: 600; font-size: 18px;
  border: none; cursor: pointer; transition: background-color 0.3s, box-shadow 0.3s;
  user-select: none;
}
button:hover, button:focus { background-color: #e5c73f; box-shadow: 0 0 10px #fed351cc; outline: none; }
#mute-toggle { font-size: 16px; padding: 6px 12px; vertical-align: middle; margin-left: 10px; }
#volume-container { margin-top: 15px; display: flex; align-items: center; justify-content: center; gap: 10px; }
#volume-container label { font-size: 16px; margin: 0; user-select: none; }
#volume-slider { width: 180px; cursor: pointer; }
#volume-display { font-size: 16px; color: #ccc; min-width: 40px; text-align: left; user-select: none; }

/* NOW PLAYING / RECENT */
.recent-title { font-size: 20px; font-weight: 600; margin-bottom: 20px; color: #fed351; user-select: none; }
ul#recent-list { list-style: none; padding: 0; margin: 0; }
ul#recent-list li { display: flex; align-items: center; gap: 14px; padding: 14px 0; border-bottom: 1px solid #444; transition: background 0.2s; }
ul#recent-list li:hover { background: rgba(255, 255, 255, 0.05); }
ul#recent-list img { width: 50px; height: 50px; border-radius: 6px; object-fit: cover; border: 1px solid #fed351; box-shadow: 0 0 5px rgba(0,0,0,0.4); user-select: none; opacity: 0; transition: opacity 0.4s; }
ul#recent-list img.loaded { opacity: 1; }
ul#recent-list span.time { color: #fed351; font-weight: 600; width: 50px; text-align: right; flex-shrink: 0; user-select: none; }
ul#recent-list span.info { flex: 1; color: white; font-size: 16px; user-select: none; }
.refresh-indicator { display: inline-block; margin-left: 8px; width: 10px; height: 10px; border-radius: 50%; background: #fed351; animation: pulse 1.2s infinite; vertical-align: middle; }

/* LOGO */
.logo-overhang {
  position: absolute;
  top: 0; left: 0; transform: translate(-36%, -36%);
  width: 220px; z-index: 2002; opacity: 0.97;
  pointer-events: none; user-select: none;
  filter: drop-shadow(0 4px 6px rgba(0,0,0,0.35));
}
@media (max-width: 768px) {
  .logo-overhang {
    width: 100px !important; top: 0 !important; left: 0 !important; transform: none !important;
    filter: drop-shadow(0 2px 5px rgba(0,0,0,0.20)) !important;
  }
}

/* CLOCK */
#liveClock {
  background: #151516;
  border: 2px solid #500;
  border-radius: 14px;
  padding: 8px 16px;
  margin: 0 auto 14px auto;
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: 'Consolas', 'Courier New', monospace;
  white-space: nowrap;
  overflow: hidden;
  box-shadow: 0 1px 10px #111a;
  max-width: 95vw;
  text-align: center;
}
#clockCombined { display: inline-flex; flex-direction: row; align-items: center; gap: 16px; line-height: 1.2; word-spacing: 0.1em; }
#clockTime { color: #e53935; font-size: 1.4em; font-weight: 700; letter-spacing: 0.04em; }
#clockDate { font-size: 1.05em; color: #fed351; font-family: 'Montserrat', sans-serif; text-shadow: 0 1px 2px #111; }
@media (max-width: 480px) {
  #clockTime { font-size: 1.2em; }
  #clockDate { font-size: 0.95em; }
  #clockCombined { gap: 10px; }
  #liveClock { padding: 6px 12px; }
}

/* ===== SCHEDULE/PRESENTERS MODAL ===== */
#modalScheduleContainer .day-card {
  background: #111; border: 1px solid #333; border-radius: 12px; padding: 20px;
  width: 100%; max-width: 860px; box-shadow: 0 0 20px rgba(0,0,0,0.3); margin-bottom: 10px;
}
#modalScheduleContainer .day-card h2, #modalScheduleContainer .day-card h3 {
  font-size: 21px; margin: 0 0 18px; color: #fed351; text-align: center;
}
#modalScheduleContainer .split-columns { display: flex; gap: 24px; }
#modalScheduleContainer .column { flex: 1; display: flex; flex-direction: column; }
#modalScheduleContainer .show-entry { display: flex; align-items: flex-start; gap: 14px; margin-bottom: 18px; }
#modalScheduleContainer .show-entry img { width: 44px; height: 44px; border-radius: 50%; object-fit: cover; border: 2px solid #fed351; flex-shrink: 0; }
#modalScheduleContainer .show-info { display: flex; flex-direction: column; }
#modalScheduleContainer .show-info time { font-weight: 600; color: #fed351; font-size: 14px; }
#modalScheduleContainer .show-title-presenter { margin-top: 2px; margin-bottom: 2px; }
#modalScheduleContainer .show-title-presenter .show-title {
  font-weight: 600; color: #fff; display: block; font-size: 1.04em; line-height: 1.2; margin-bottom: 2px;
}
#modalScheduleContainer .show-title-presenter .show-presenter {
  font-size: 0.96em; color: #fed351; font-style: italic; text-decoration: none; line-height: 1.2; display: inline-block;
}
#modalScheduleContainer .show-title-presenter .show-presenter:hover { text-decoration: underline; color: #ffd866; }
#modalScheduleContainer .show-details { font-size: 13px; color: #ccc; margin-top: 4px; line-height: 1.5; }
@media (max-width: 900px) { #modalScheduleContainer .split-columns { flex-direction: column; gap:0; } }

/* PLAYLIST MODAL IMAGE */
.playlist-image {
  width: 100%; max-width: 600px; border-radius: 18px; display: block; margin: 0 auto 18px auto;
}

/* ===== MOBILE & RESPONSIVE TWEAKS ===== */
@media (max-width: 768px) {
  body { padding: 48px 2vw 8vw 2vw !important; }
  .strip-container { flex-direction: column !important; border-radius: 10px !important; max-width: 100vw !important; min-height: 0 !important; box-shadow: 0 0 14px rgba(0,0,0,0.22) !important; }
  .left-panel, .right-panel { width: 100% !important; padding: 10px 4px 12px 4px !important; border: none !important; min-height: unset !important; }
  .left-panel { padding-top: 8px !important; align-items: stretch !important; }
  #player-box, #now-playing-card { max-width: 98vw !important; width: 100% !important; padding: 0 !important; margin: 0 auto !important; box-shadow: none !important; }
  .presenter-line, .show-title-presenter span { font-size: 0.96em; color: #fed351; font-style: italic; display: inline-block; margin-top: 0.5px; line-height: 1.4; padding-bottom: 3px; }
  #now-playing-card { font-size: 15px !important; padding: 10px 4px !important; border-radius: 7px !important; margin-top: 12px !important; }
  #artwork { width: 94vw !important; max-width: 140px !important; height: auto !important; margin-top: 8px !important; margin-bottom: 8px !important; border-radius: 7px !important; }
  .recent-title { font-size: 13px !important; margin-bottom: 5px !important; padding-top: 3px !important; }
  ul#recent-list li { gap: 6px !important; padding: 8px 0 !important; }
  ul#recent-list img { width: 26px !important; height: 26px !important; border-radius: 4px !important; }
  ul#recent-list span.info, ul#recent-list span.time { font-size: 11px !important; }
  button, #mute-toggle { font-size: 14px !important; padding: 8px 14px !important; border-radius: 7px !important; }
  #volume-container label, #volume-display { font-size: 11px !important; }
  #volume-slider { width: 84px !important; }
  #onAirNow { font-size: 15px !important; margin-top: 4px !important; margin-bottom: 4px !important; padding-right: 0 !important; max-width: 100vw !important; }
  .show-title { font-size: 0.9em !important; }
  .show-presenter { font-size: 0.8em !important; }
  .modal-content { padding: 13px 2vw 8px 2vw !important; font-size: 15px !important; min-height: 30px !important; border-radius: 9px !important; max-width: 97vw !important; }
  .close { font-size: 24px !important; top: 8px !important; right: 8px !important; }
  .playlist-image { max-width: 97vw !important; border-radius: 9px !important; margin-bottom: 10px !important; }
  .right-panel { overscroll-behavior: auto !important; overflow-y: auto !important; -webkit-overflow-scrolling: touch !important; }
  .strip-container { display: block !important; height: auto !important; min-height: 0 !important; overflow: visible !important; }
  .left-panel, .right-panel { display: block !important; height: auto !important; overflow: visible !important; }
  .recently-played-container { flex: none !important; height: auto !important; overflow: visible !important; }
  ul#recent-list { max-height: none !important; overflow: visible !important; -webkit-overflow-scrolling: auto !important; touch-action: pan-y !important; }
}

/* MOBILE SCHEDULE */
@media (max-width: 900px) { #modalScheduleContainer .split-columns { flex-direction: column; gap:0; } }
  </style>
</head>

<body>
<!-- ===== BURGER MENU (mobile only) ===== -->
<div id="burgerMenuBtn" onclick="toggleBurgerMenu()" aria-label="Open menu" tabindex="0">
  <span class="burger-bar"></span>
  <span class="burger-bar"></span>
  <span class="burger-bar"></span>
</div>

<!-- ===== MOBILE DROPDOWN MENU ===== -->
<nav id="burgerDropdown">
  <div style="width:92vw;max-width:430px;margin:0 auto;display:flex;flex-direction:column;gap:10px;">
    <a href="#" onclick="openModalAndCloseBurger('aboutModal');return false;" class="menu-link">About Us</a>
    <a href="#" onclick="openModalAndCloseBurger('scheduleModal');return false;" class="menu-link">Schedule</a>
    <a href="#" onclick="openModalAndCloseBurger('playlistModal');return false;" class="menu-link">Playlist</a>
    <a href="#" onclick="openModalAndCloseBurger('listenModal');return false;" class="menu-link">Listen Again</a>
    <a href="#" onclick="openModalAndCloseBurger('searchModal');return false;" class="menu-link">Song Search</a>
    <a href="#" onclick="openModalAndCloseBurger('requestsModal');return false;" class="menu-link">Requests</a>
    <a href="#" onclick="openModalAndCloseBurger('contactModal');return false;" class="menu-link">Contact Us</a>
    <a href="#" onclick="openModalAndCloseBurger('newsModal');return false;" class="menu-link">News</a>
    <a href="#" onclick="openModalAndCloseBurger('travelModal');return false;" class="menu-link">Travel</a>
  </div>
</nav>

<!-- ===== DESKTOP NAVIGATION ===== -->
<nav class="navbar" role="navigation">
  <a href="#" onclick="openModal('aboutModal');return false;">About Us</a>
  <a href="#" onclick="openModal('scheduleModal');return false;">Schedule</a>
  <a href="#" onclick="openModal('playlistModal');return false;">Playlist</a>
  <a href="#" onclick="openModal('listenModal');return false;">Listen Again</a>
  <a href="#" onclick="openModal('searchModal');return false;">Song Search</a>
  <a href="#" onclick="openModal('requestsModal');return false;">Requests</a>
  <a href="#" onclick="openModal('contactModal');return false;">Contact Us</a>
  <a href="#" onclick="openModal('newsModal');return false;">News</a>
  <a href="#" onclick="openModal('travelModal');return false;">Travel</a>
</nav>

<div class="header-spacer"></div>

<!-- ===== RIGHT PANEL: CLOCK, WEATHER, RECENTLY PLAYED ===== -->
<div style="width:100%;display:flex;justify-content:center;">
  <div class="player-wrapper">
    <img src="ERLogo2.png" alt="Essential Radio Logo" class="logo-overhang" />
    <div class="strip-container">
      <!-- ===== LEFT PANEL: PLAYER ===== -->
      <div class="left-panel">
        <div id="onAirNow" style="text-align: right;">
          <span class="pulsing-label">ON AIR NOW</span>
          <span id="currentShow" style="font-weight: 600;">Loading...</span>
        </div>
        <div id="player-box">
          <audio id="stream" preload="none">
            <source src="https://streaming06.liveboxstream.uk/proxy/ayrshire/stream" type="audio/mpeg" />
          </audio>
          <button id="play-toggle">▶️ Play Essential Radio</button>
          <div id="volume-container">
            <label for="volume-slider">Volume:</label>
            <input type="range" id="volume-slider" min="0" max="100" value="100" />
            <span id="volume-display">100%</span>
            <button id="mute-toggle">🔊</button>
          </div>
          <div id="now-playing-card">
            <div id="now-playing">Loading current track…</div>
          </div>
          <img id="artwork" src="Essential Radio Logo.png" alt="Artwork" class="loaded" />
        </div>
      </div>
<div class="right-panel" style="display:flex;flex-direction:column;">

  <!-- LIVE CLOCK -->
  <div id="liveClock">
    <div id="clockCombined">
      <span id="clockTime">--:--:--</span>
      <span id="clockDate">Date</span>
    </div>
  </div>

  <!-- ESSENTIAL WEATHER WIDGET -->
  <div id="wxWrap"
       style="font-family:Inter,sans-serif;background:linear-gradient(135deg,#24243e 0%,#191c29 100%);
              color:#f5f5f5;border-radius:18px;padding:16px;box-shadow:0 6px 32px #0007;
              border:1px solid #252e42;max-width:100%;text-align:center;margin-bottom:18px;
              transition:background 0.3s,box-shadow 0.3s;">
    <!-- Heading -->
    <h3 class="wxHeading">
      Ayrshire Weather
      <span class="mobBreak"><br></span>
      <span class="sub">– select a location</span>
    </h3>
    <style>
      /* desktop / tablet */
      #wxWrap .wxHeading{
        font-size:1.15em;font-weight:600;margin:0 0 10px 0;color:#fed351;letter-spacing:.3px}
      #wxWrap .wxHeading .sub{font-weight:400;font-style:italic;color:#bbb}
      #wxWrap .mobBreak{display:none}
      @media(max-width:500px){
        #wxWrap .wxHeading{font-size:1.05em}
        #wxWrap .wxHeading .sub{font-size:.9em}
        #wxWrap .mobBreak{display:inline}
      }
      .weather-divider {
        border: 0;
        border-top: 1.5px solid #28304c;
        margin: 14px 0 0 0;
        opacity: 0.6;
      }
      #wxNow span {
        text-shadow: 0 2px 10px #000c, 0 1px 0 #fed351;
        font-size: 1.06em;
      }
      #hrWrap, #dyWrap {
        overflow-x: hidden;
        touch-action: pan-y;
        overscroll-behavior: auto;
        transition: opacity 0.35s, transform 0.3s;
        opacity: 1;
        scroll-snap-type: x mandatory;
      }
      @media (max-width: 500px) {
        #hrWrap, #dyWrap {
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
          touch-action: pan-x;
          overscroll-behavior-x: contain;
          overscroll-behavior-y: auto;
        }
        #toggleBtn {
          font-size: 0.72em !important;
          padding: 2px 6px !important;
          border-radius: 5px !important;
        }
        #wxWrap h3 { font-size: 1em !important; }
        .wxRainNote { text-align: right; width: 100%; }
      }
      #wxWrap {
        overscroll-behavior: auto !important;
        -webkit-overflow-scrolling: touch;
      }
      #hrWrap[style*="display: none"],
      #dyWrap[style*="display: none"] {
        opacity: 0 !important;
        transform: translateY(-8px);
      }
      .forecast-icon {
        transition: transform 0.2s ease-in-out, filter 0.2s;
      }
      .forecast-icon:hover {
        filter: brightness(1.15) drop-shadow(0 2px 8px #fed35188);
        transform: scale(1.16) rotate(-8deg);
      }
      #dyWrap > div > div {
        width: 20% !important;
        min-width: 0 !important;
        max-width: none !important;
        box-sizing: border-box;
      }
      .wxRainNote {
        font-size: 90%;
        font-style: italic;
        display: inline-block;
      }
    </style>

    <!-- Location selector -->
    <div style="margin-bottom:7px;">
      <select id="locSel"
              style="background:#222;color:#fed351;border:1px solid #444;
                     border-radius:6px;padding:4px 10px;font-weight:bold;">
        <option value="Kilmarnock,55.6118,-4.4955">Kilmarnock</option>
        <option value="Kilwinning,55.6558,-4.7057">Kilwinning</option>
        <option value="Ayr,55.4586,-4.6292">Ayr</option>
      </select>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;
                border-bottom:1px solid #2224;margin-bottom:10px;padding-bottom:7px;">
      <div id="wxNow" style="text-align:left;font-size:1em;"></div>
      <button id="toggleBtn"
              style="background:#fed351;color:#191c29;font-weight:600;border:none;
                     border-radius:6px;padding:3px 10px;font-size:0.8em;cursor:pointer;
                     box-shadow:0 1px 4px rgba(0,0,0,0.3);transition:all 0.18s;">
        5-day ▸
      </button>
    </div>
    <!-- Hourly and Daily forecast strips -->
    <div id="hrWrap" style="display:grid;grid-template-rows:auto auto;gap:4px;white-space:nowrap;font-size:0.82em;padding:6px 0;transition:opacity 0.35s, transform 0.3s;opacity:1;"></div>
    <div id="dyWrap" style="display:none;grid-template-rows:auto auto;gap:4px;white-space:nowrap;font-size:0.82em;padding:6px 0;transition:opacity 0.35s, transform 0.3s;opacity:1;"></div>
    <div id="wxAlert" style="color:#ff6969;font-size:0.85em;margin-top:5px;"></div>
  </div>

  <hr class="weather-divider">

  <!-- WEATHER WIDGET SCRIPT -->
  <script>
    (() => {
      const KEY = 'e4a309c7e76f09b85a2ff7d34305505f';

      const q = s => document.querySelector(s),
            locSel = q('#locSel'),
            wxNow  = q('#wxNow'),
            tBtn   = q('#toggleBtn'),
            hrWrap = q('#hrWrap'),
            dyWrap = q('#dyWrap'),
            alertBox = q('#wxAlert');

      let show5 = localStorage.wxView === '5';
      if (show5) swapView();
      if (localStorage.wxChoice) locSel.value = localStorage.wxChoice;

      function phrase(desc, isDay, temp = null, pop = null) {
        desc = desc.toLowerCase();
        if (desc.includes('thunder')) return 'Thunderstorm';
        if (desc.includes('snow') && (!temp || temp < 5)) return 'Snow';
        if (desc.includes('snow') && temp && temp >= 5) return 'Showers';
        if (desc.includes('rain') || desc.includes('drizzle')) {
          if (pop !== null && pop < 30) return isDay ? 'Chance of showers' : 'Possible showers';
          return 'Rain';
        }
        if (desc.includes('fog'))   return 'Foggy';
        if (desc.includes('mist'))  return 'Misty';
        if (desc.includes('haze'))  return 'Hazy';
        if (desc.includes('smoke')) return 'Smoky';
        if (desc === 'clear sky')   return isDay ? 'Sunny' : 'Clear';
        if (desc.includes('few clouds'))       return isDay ? 'Mostly sunny' : 'Mainly clear';
        if (desc.includes('scattered clouds')) return isDay ? 'Partly cloudy' : 'Some cloud';
        if (desc.includes('broken clouds'))    return isDay ? 'Sunny intervals' : 'Cloudy';
        if (desc.includes('overcast'))         return 'Overcast';
        if (!isDay && (desc.includes('sun') || desc.includes('bright'))) return 'Clear';
        return isDay ? 'Fair' : 'Calm';
      }

      async function update() {
        const [label, lat, lon] = locSel.value.split(',');
        localStorage.wxChoice = locSel.value;

        try {
          const d = await fetch(`https://api.openweathermap.org/data/3.0/onecall?lat=${lat}&lon=${lon}&units=metric&appid=${KEY}`)
                           .then(r => r.json());

          // ==== CURRENT CONDITIONS ====
          const cur  = d.current,
                nxt  = d.hourly[1],
                day  = cur.dt >= cur.sunrise + 3600 && cur.dt < cur.sunset - 3600,
                pop  = nxt && typeof nxt.pop === 'number' ? Math.round(nxt.pop * 100) : null,
                desc = phrase(cur.weather[0].description, day, cur.temp, pop),
                tmp  = Math.round(cur.temp);

          // Only show % if desc doesn’t already include “rain / showers”
          const showPop = pop !== null && pop >= 30 && !/rain|showers/i.test(desc);

          wxNow.innerHTML =
            `<span style="color:#fed351;font-weight:bold">${desc}</span>, ${tmp}°C` +
            (showPop
               ? `<br><span class="wxRainNote">☔&nbsp;${pop}% chance of rain</span>`
               : '');

          // HOURLY STRIP
          hrWrap.innerHTML = '';
          let times = '', details = '';
          d.hourly.slice(1, 6).forEach(h => {
            const t = new Date(h.dt * 1e3).getHours().toString().padStart(2,'0') + ':00';
            const icon = `https://openweathermap.org/img/wn/${h.weather[0].icon}.png`;
            times   += `<div style="width:52px;text-align:center;">${t}</div>`;
            details += `<div style="width:52px;text-align:center;">
                          <img src="${icon}" width="20" class="forecast-icon"><br>${Math.round(h.temp)}°
                        </div>`;
          });
          hrWrap.innerHTML = `<div style="display:flex;">${times}</div><div style="display:flex;">${details}</div>`;
          hrWrap.style.display = show5 ? 'none' : 'grid';

          // DAILY STRIP
          dyWrap.innerHTML = '';
          let days = '', temps = '';
          d.daily.slice(1, 6).forEach(dd => {
            const wd   = new Date(dd.dt * 1e3).toLocaleDateString('en-GB', {weekday:'short'});
            const icon = `https://openweathermap.org/img/wn/${dd.weather[0].icon}.png`;
            days  += `<div style="text-align:center;">${wd}</div>`;
            temps += `<div style="text-align:center;">
                        <img src="${icon}" width="20" class="forecast-icon"><br>
                        ${Math.round(dd.temp.max)}°/${Math.round(dd.temp.min)}°
                      </div>`;
          });
          dyWrap.innerHTML = `<div style="display:flex;">${days}</div><div style="display:flex;">${temps}</div>`;
          dyWrap.style.display = show5 ? 'grid' : 'none';

          // ALERTS
          if (d.alerts && d.alerts.length) {
            const now = Math.floor(Date.now()/1000);
            const valid = d.alerts.find(a => !a.end || a.end > now);
            alertBox.textContent = valid ? `⚠ ${valid.event}` : '';
          } else {
            alertBox.textContent = '';
          }

        } catch(e) {
          console.error('Weather fetch error', e);
          wxNow.textContent = 'Weather unavailable';
        }
      }

      function swapView() {
        hrWrap.style.opacity = '0';
        dyWrap.style.opacity = '0';
        setTimeout(() => {
          show5 = !show5;
          localStorage.wxView = show5 ? '5' : 'hr';
          hrWrap.style.display = show5 ? 'none':'grid';
          dyWrap.style.display = show5 ? 'grid':'none';
          tBtn.textContent = show5 ? 'Hourly ▶' : '5-day ▸';
          setTimeout(() => {
            hrWrap.style.opacity = show5 ? '0':'1';
            dyWrap.style.opacity = show5 ? '1':'0';
          },20);
        },180);
      }

      tBtn  .addEventListener('click', swapView);
      locSel.addEventListener('change', update);
      update();
      setInterval(update, 900000);
    })();
  </script>

  <!-- RECENTLY PLAYED TRACKS -->
  <div class="recently-played-container" style="flex:1;display:flex;flex-direction:column;min-height:0;">
    <div class="recent-title" style="color:#fed351;font-size:1.1em;margin-bottom:7px;">Recently Played</div>
    <ul id="recent-list" style="list-style:none;padding:0;margin:0;flex:1;overflow-y:auto;"></ul>
  </div>
</div>


<!-- ======= ALL MODALS ======= -->

<!-- ABOUT MODAL -->
<div id="aboutModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('aboutModal')">&times;</span>
    <div style="display:flex;align-items:center;gap:20px;margin-bottom:24px;">
      <h2 style="margin:0;color:#00818a;font-size:1.55em;">About Us</h2>
    </div>
    <div style="background:#111;border:1px solid #333;border-radius:12px;padding:22px 18px 12px 18px;box-shadow:0 0 20px rgba(0,0,0,0.21);margin-bottom:0; color:#fff;">
      <p style="margin-bottom:18px;">
        Essential Radio is Ayrshire College’s very own 24/7 station, broadcasting music, student content and campus updates from our Kilwinning base. The station launched in June 2022 with initial funding from the Ayrshire College Foundation, and brings a fresh and dynamic voice to the college community.
      </p>
      <p style="margin-bottom:18px;">
        We’re more than just great music. Essential Radio is a creative platform for students across all departments. Whether as part of a class project or an extra-curricular activity, learners can contribute shows, features and ideas that reflect their interests and studies.
      </p>
      <p style="margin-bottom:18px;">
        Any student with a passion for broadcasting is welcome to get involved. From presenting to production, advert scripting to playlist curation – we offer hands-on experience and skill-building opportunities with real impact.
      </p>
      <p style="margin-bottom:24px;">
        The station enhances college life with music, event coverage and a direct link between students, staff and local employers. It’s a modern, flexible way to keep our community connected, supported and inspired – on all of our campuses and beyond.
      </p>
      <hr style="border:0;border-top:1px solid #444;margin:28px 0 18px 0;">
      <h3 style="color:#fed351;font-size:1.08em;margin:0 0 13px 0;">Our Aims</h3>
      <ul style="color:#ddd;font-size:1em;line-height:1.6;padding-left:20px;margin:0 0 14px 0;">
        <li>To provide a positive, inclusive broadcast platform for the college community.</li>
        <li>To support learning, creativity and employability through media skills.</li>
        <li>To share news, opportunities and achievements across all campuses.</li>
        <li>To promote student and staff voices, with original content and music.</li>
      </ul>
      <hr style="border:0;border-top:1px solid #444;margin:28px 0 18px 0;">
      <h3 style="color:#fed351;font-size:1.08em;margin:0 0 13px 0;">Contact Us</h3>
      <p>
        You can email the team at <a href="mailto:essentialradio@ayrshire.ac.uk" style="color:#fed351;">essentialradio@ayrshire.ac.uk</a> or use the Contact form on this site.
      </p>
      <p style="font-size:0.97em;color:#bbb;margin:20px 0 0 0;">
        Essential Radio is fully licensed for music broadcast in the UK by PPL and PRS for Music.
      </p>
      <div style="text-align:center;margin-top:18px;">
        <img src="PPL_PRSLogo.png" alt="PPL_PRSLogo" style="width:120px;max-width:100%;filter:brightness(1.08);" />
      </div>
    </div>
    <div style="margin-top:20px;text-align:center;color:#888;font-size:14px;opacity:0.8;">
      Essential Radio &copy; 2025
    </div>
  </div>
</div>

<!-- SCHEDULE MODAL -->
<div id="scheduleModal" class="modal">
  <div class="modal-content" style="max-width:920px;width:95vw;">
    <span class="close" onclick="closeModal('scheduleModal')">&times;</span>
    <h2 style="margin-top:0;">Programme Schedule</h2>
    <div style="margin-bottom:18px;">
      <label for="modalDaySelect" style="color:#222;font-weight:600;">Choose a day: </label>
      <select id="modalDaySelect" style="padding:8px 12px;border-radius:7px;border:none;background:#fed351;color:#111;font-weight:600;"></select>
    </div>
    <div id="modalScheduleContainer">
      <div class="day-card" id="modalDaySchedule">
        <h3>Loading…</h3>
      </div>
    </div>
  </div>
</div>

<!-- PLAYLIST MODAL -->
<div id="playlistModal" class="modal">
  <div class="modal-content" style="max-width:650px;width:97vw;">
    <span class="close" onclick="closeModal('playlistModal')">&times;</span>
    <h2 style="margin-top:0;color:#00818a;">Essential Radio Playlist</h2>
    <img src="ERPlaylist.png" alt="Essential Radio Playlist" class="playlist-image" />
  </div>
</div>

<!-- LISTEN AGAIN MODAL -->
<div id="listenModal" class="modal">
  <div class="modal-content" style="max-width:700px;width:97vw;">
    <span class="close" onclick="closeModal('listenModal')">&times;</span>
    <div style="display:flex;align-items:center;gap:20px;margin-bottom:24px;">
      <h2 style="margin:0;color:#00818a;font-size:1.5em;">Listen Again</h2>
    </div>
    <div style="background:#111;border:1px solid #333;border-radius:12px;padding:24px 18px;box-shadow:0 0 20px rgba(0,0,0,0.28); color:#eee;">
      <p style="font-size:17px;line-height:1.6;margin-bottom:18px;">
        Missed a show? No problem! Catch up on your favourite Essential Radio programmes here.<br>
        Browse recent shows, select your favourites, and listen again anytime.
      </p>
      <div id="mixcloud-embeds"></div>
    </div>
    <div style="margin-top:18px;text-align:center;color:#888;font-size:14px;opacity:0.8;">
      Essential Radio &copy; 2025
    </div>
    <script>
      fetch('https://api.mixcloud.com/essentialradio/cloudcasts/')
        .then(response => response.json())
        .then(data => {
          const container = document.getElementById('mixcloud-embeds');
          const shows = data.data.slice(0, 6); // Only show 6
          shows.forEach(show => {
            const block = document.createElement('div');
            block.className = 'show-block';

            const title = document.createElement('div');
            title.className = 'show-title';
            title.textContent = show.name || show.slug || 'Previous Show';

            const iframe = document.createElement('iframe');
            iframe.className = 'mixcloud-player';
            iframe.src = `https://www.mixcloud.com/widget/iframe/?feed=${encodeURIComponent(show.url)}&hide_cover=1&light=0`;
            iframe.allow = 'autoplay';

            block.appendChild(title);
            block.appendChild(iframe);
            container.appendChild(block);
          });
        })
        .catch(error => {
          document.getElementById('mixcloud-embeds').innerHTML =
            '<div style="color:#fed351;font-size:1.1em;margin-top:12px;">Unable to load previous shows at the moment.</div>';
        });
    </script>
    <style>
      .show-block { margin-bottom: 30px; }
      .show-title { font-size: 18px; margin-bottom: 8px; color: #fff; word-break: break-word; line-height: 1.2; font-weight: 500; }
      .mixcloud-player { width: 100%; min-width: 0; height: 120px; border: 0; display: block; border-radius: 8px; background: #222; }
      @media (max-width: 600px) { .show-title { font-size: 16px; } .mixcloud-player { height: 150px; } }
      @media (max-width: 400px) { .mixcloud-player { height: 165px; } }
    </style>
  </div>
</div>

<!-- SONG SEARCH MODAL -->
<div id="searchModal" class="modal">
  <div class="modal-content" style="max-width:950px;width:97vw;">
    <span class="close" onclick="closeModal('searchModal')">&times;</span>
    <div style="display:flex;align-items:center;gap:20px;margin-bottom:24px;">
      <h2 style="margin:0;color:#00818a;font-size:1.45em;">Song Search</h2>
    </div>
    <div style="background:#111;border:1px solid #333;border-radius:12px;padding:0 0 20px 0;box-shadow:0 0 20px rgba(0,0,0,0.23);margin-bottom:0; color:#eee;">
      <div class="content-card" style="background:#151921ea;border:1px solid #343648;border-radius:16px;padding:24px 18px 12px 18px;max-width:850px;margin:24px auto 16px auto;box-shadow:0 0 18px #0008;">
        <p style="font-size:17px;line-height:1.6;margin-bottom:0;">
          Trying to remember that amazing track we just played?<br>
          Use our Song Search to find recent songs and discover more about what’s been on Essential Radio.
        </p>
      </div>
      <div class="container" style="background:#191b24f2;border-radius:18px;box-shadow:0 0 18px #0008;max-width:850px;margin:0 auto 36px auto;padding:20px 18px 32px 18px;">
        <div class="filters" style="margin-bottom:1.5rem;display:flex;flex-wrap:wrap;align-items:center;gap:0.7rem 1.2rem;">
          <label for="dateSelect">Date:</label>
          <select id="dateSelect"></select>
          <label for="hourSelect">Hour:</label>
          <select id="hourSelect"></select>
          <button id="prevHour">⭠ Previous Hour</button>
          <button id="nextHour">Next Hour ➡</button>
          <label for="searchInput">Filter:</label>
          <input type="text" id="searchInput" placeholder="Search by Artist or Title...">
          <button id="resetFilters">Reset</button>
        </div>
        <table style="width:100%;border-collapse:collapse;margin-top:0.7rem;background:transparent;color:#fff;font-size:17px;border-radius:8px;overflow:hidden;">
          <thead style="background:#fed351;color:#7e1974;font-size:17.5px;">
            <tr>
              <th>Time</th>
              <th>Artist – Title</th>
            </tr>
          </thead>
          <tbody id="logTableBody"></tbody>
        </table>
        <div id="noResultsMessage" class="no-results" style="display: none;text-align:center;font-style:italic;color:#fed351;padding:1.4rem 0 0.7rem 0;font-size:18px;letter-spacing:0.1px;">No tracks found for this time period.</div>
      </div>
    </div>
    <div style="margin-top:18px;text-align:center;color:#888;font-size:14px;opacity:0.8;">
      Essential Radio &copy; 2025
    </div>
    <style>
      /* Extra modal-specific responsive tweaks for Song Search */
      @media (max-width: 950px) {
        #searchModal .content-card, #searchModal .container { max-width: 98vw; }
        #searchModal .content-card, #searchModal .container { padding: 2vw 3vw; }
      }
      @media (max-width: 700px) {
        #searchModal .content-card { padding: 13px 3vw 10px 3vw; font-size: 16px; }
        #searchModal .container { padding: 8px 1vw 10px 1vw; }
        #searchModal table, #searchModal th, #searchModal td { font-size: 15px; }
        #searchModal .filters { gap: 0.5rem 0.7rem; }
        #searchModal select, #searchModal input[type="text"], #searchModal button { font-size: 14px; }
      }
      @media (max-width: 540px) {
        #searchModal .content-card { padding: 7px 1vw 4px 1vw; }
        #searchModal .container { padding: 5px 0vw 5px 0vw; }
        #searchModal .filters { flex-direction: column; gap: 0.6rem 0; }
      }
    </style>
    <script>
      let fullData = [];
      const dateMap = new Map();
      let latestDate = null;
      let latestHour = null;

      function populateDropdowns(data) {
        dateMap.clear();
        latestDate = null;
        latestHour = null;
        let latestDateTime = new Date(0);
        const now = new Date();

        data.forEach(item => {
          const dt = new Date(item["Hour"]);
          const dtLocal = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate(), dt.getHours());
          const localDate = dt.toLocaleDateString("en-GB");
          const localHour = dt.getHours().toString().padStart(2, '0') + ":00";

          if (dtLocal <= now) {
            if (!dateMap.has(localDate)) dateMap.set(localDate, new Set());
            dateMap.get(localDate).add(localHour);

            if (dtLocal > latestDateTime) {
              latestDateTime = dtLocal;
              latestDate = localDate;
              latestHour = localHour;
            }
          }
        });

        const dateDropdown = document.getElementById("dateSelect");
        const dates = Array.from(dateMap.keys()).sort();
        dateDropdown.innerHTML = dates.map(d => `<option value="${d}">${d}</option>`).join('');
        dateDropdown.value = latestDate;
        updateHourDropdown(latestDate, latestHour);
      }

      function updateHourDropdown(selectedDate, selectedHour = null) {
        const hourDropdown = document.getElementById("hourSelect");
        const hours = Array.from(dateMap.get(selectedDate) || []).sort();
        hourDropdown.innerHTML = hours.map(h => `<option value="${h}">${h}</option>`).join('');
        hourDropdown.value = selectedHour || hours[hours.length - 1];
      }

      function renderTable(data) {
        const tbody = document.getElementById("logTableBody");
        const searchText = document.getElementById("searchInput").value.toLowerCase();
        const selectedDate = document.getElementById("dateSelect").value;
        const selectedHour = document.getElementById("hourSelect").value;
        const noResultsMessage = document.getElementById("noResultsMessage");
        tbody.innerHTML = "";
        const seen = new Set();

        const filtered = data.filter(item => {
          const dt = new Date(item["Hour"]);
          const localDate = dt.toLocaleDateString("en-GB");
          const localHour = dt.getHours().toString().padStart(2, '0') + ":00";
          const key = `${item["Artist"]} - ${item["Title"]}`;

          const durationMinutes = item["Duration (mins)"] || 0;
          const isMatch = localDate === selectedDate && localHour === selectedHour && key.toLowerCase().includes(searchText) && durationMinutes <= 10;

          if (isMatch && !seen.has(key)) {
            seen.add(key);
            return true;
          }
          return false;
        });

        if (filtered.length === 0) {
          noResultsMessage.style.display = "block";
        } else {
          noResultsMessage.style.display = "none";
          filtered.forEach(item => {
            const time = item["Displayed Time"] || item["Scheduled Time"]?.substring(0, 5) || "";
            const row = `<tr><td>${time}</td><td>${item["Artist"]} – ${item["Title"]}</td></tr>`;
            tbody.innerHTML += row;
          });
        }
      }

      document.getElementById("searchInput").addEventListener("input", () => renderTable(fullData));
      document.getElementById("dateSelect").addEventListener("change", () => {
        updateHourDropdown(document.getElementById("dateSelect").value);
        renderTable(fullData);
      });
      document.getElementById("hourSelect").addEventListener("change", () => renderTable(fullData));

      document.getElementById("prevHour").addEventListener("click", () => {
        const hourDropdown = document.getElementById("hourSelect");
        const options = Array.from(hourDropdown.options);
        const idx = options.findIndex(opt => opt.selected);
        if (idx > 0) {
          hourDropdown.selectedIndex = idx - 1;
          renderTable(fullData);
        }
      });

      document.getElementById("nextHour").addEventListener("click", () => {
        const hourDropdown = document.getElementById("hourSelect");
        const options = Array.from(hourDropdown.options);
        const idx = options.findIndex(opt => opt.selected);
        if (idx < options.length - 1) {
          hourDropdown.selectedIndex = idx + 1;
          renderTable(fullData);
        }
      });

      document.getElementById("resetFilters").addEventListener("click", () => {
        document.getElementById("searchInput").value = "";

        let latestDate = null;
        let latestHour = null;
        let latestDateTime = new Date(0);
        const now = new Date();

        fullData.forEach(item => {
          const dt = new Date(item["Hour"]);
          const dtLocal = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate(), dt.getHours());
          const localDate = dt.toLocaleDateString("en-GB");
          const localHour = dt.getHours().toString().padStart(2, '0') + ":00";

          if (dtLocal <= now && dtLocal > latestDateTime) {
            latestDateTime = dtLocal;
            latestDate = localDate;
            latestHour = localHour;
          }
        });

        if (latestDate && latestHour) {
          document.getElementById("dateSelect").value = latestDate;
          updateHourDropdown(latestDate, latestHour);
          renderTable(fullData);
        }
      });

      fetch("playout_log_rolling.json")
        .then(res => res.json())
        .then(data => {
          fullData = data;
          populateDropdowns(data);
          renderTable(data);
        });
    </script>
  </div>
</div>

<!-- REQUESTS MODAL -->
<div id="requestsModal" class="modal">
  <div class="modal-content" style="max-width:700px;width:97vw;">
    <span class="close" onclick="closeModal('requestsModal')">&times;</span>
    <div style="display:flex;align-items:center;gap:20px;margin-bottom:24px;">
      <h2 style="margin:0;color:#00818a;font-size:1.5em;">Request a Song</h2>
    </div>
    <div style="background:#111;border:1px solid #333;border-radius:12px;padding:28px 18px 32px 18px;box-shadow:0 0 20px rgba(0,0,0,0.28);margin-bottom:0; color:#eee;">
      <p style="font-size:17px;line-height:1.6;margin-bottom:22px;">
        Got a favourite track or a shout-out for someone special?<br>
        Send us your song requests and messages – and we might play them live on air!<br>
        <span style="color:#aaa;font-size:15px;">
          (Note: Many of our shows are pre-recorded, so requests may not always be instant.)
        </span>
      </p>
      <div style="width:100%;min-height:340px;">
        <!-- Elfsight Contact Form | Request a song -->
        <script src="https://static.elfsight.com/platform/platform.js" async></script>
        <div class="elfsight-app-69585003-61ea-407e-a005-4861876e1a5b" data-elfsight-app-lazy></div>
      </div>
      <div id="thank-you-message" class="thank-you" style="font-size:18px;margin-top:18px;min-height:36px;"></div>
    </div>
    <div style="margin-top:18px;text-align:center;color:#888;font-size:14px;opacity:0.8;">
      Essential Radio &copy; 2025
    </div>
  </div>
</div>

<!-- CONTACT MODAL -->
<div id="contactModal" class="modal">
  <div class="modal-content" style="max-width:620px;width:97vw;">
    <span class="close" onclick="closeModal('contactModal')">&times;</span>
    <div style="display:flex;align-items:center;gap:18px;margin-bottom:24px;">
      <h2 style="margin:0;color:#00818a;font-size:1.35em;">Contact</h2>
    </div>
    <div style="background:#111;border:1px solid #333;border-radius:12px;padding:24px 18px 18px 18px;box-shadow:0 0 20px rgba(0,0,0,0.23);margin-bottom:0; color:#eee;">
      <p style="font-size:17px;line-height:1.6;">
        We’d love to hear from you! Whether it’s feedback, a shout-out, or just to say hello, drop us a message and we’ll get back to you as soon as we can. Essential Radio – always here, always listening.
      </p>
      <div style="margin-top:22px;margin-bottom:22px;">
        <!-- Elfsight Contact Form | Contact Us -->
        <script src="https://static.elfsight.com/platform/platform.js" async></script>
        <div class="elfsight-app-974fdef7-6e84-49a1-8384-9604e1f7be5c" data-elfsight-app-lazy></div>
      </div>
      <div class="contact-details" style="margin-top:8px;">
        <p style="margin-bottom:12px;"><strong>Email:</strong>
          <a href="mailto:essentialradio@ayrshire.ac.uk" style="color:#00e0ff;text-decoration:none;font-weight:600;">essentialradio@ayrshire.ac.uk</a>
        </p>
        <p style="margin-bottom:8px;"><strong>Follow us:</strong> @ERadioAyrshire on</p>
        <ul style="list-style:none;padding-left:0;margin:0 0 0 6px;">
          <li style="margin-bottom:7px;font-size:17px;">🐦 <a href="https://x.com/eradioayrshire" target="_blank" style="color:#00e0ff;text-decoration:none;font-weight:600;">X</a></li>
          <li style="margin-bottom:7px;font-size:17px;">📸 <a href="https://instagram.com/eradioayrshire" target="_blank" style="color:#00e0ff;text-decoration:none;font-weight:600;">Instagram</a></li>
          <li style="margin-bottom:7px;font-size:17px;">☁️ <a href="https://bsky.app/profile/eradioayrshire" target="_blank" style="color:#00e0ff;text-decoration:none;font-weight:600;">Bluesky</a></li>
          <li style="margin-bottom:7px;font-size:17px;">📘 <a href="https://facebook.com/eradioayrshire" target="_blank" style="color:#00e0ff;text-decoration:none;font-weight:600;">Facebook</a></li>
        </ul>
      </div>
    </div>
    <div style="margin-top:16px;text-align:center;color:#888;font-size:14px;opacity:0.8;">
      Essential Radio &copy; 2025
    </div>
  </div>
</div>

<!-- NEWS MODAL -->
<div id="newsModal" class="modal">
  <div class="modal-content" style="max-width:700px;width:97vw;">
    <span class="close" onclick="closeModal('newsModal')">&times;</span>
    <div style="display:flex;align-items:center;gap:18px;margin-bottom:24px;">
      <h2 style="margin:0;color:#00818a;font-size:1.3em;">News & Weather</h2>
    </div>
    <div style="background:#111;border:1px solid #333;border-radius:12px;padding:28px 18px 32px 18px;box-shadow:0 0 20px rgba(0,0,0,0.28);margin-bottom:0; color:#eee;">
      <h3 style="color:#00e0ff;margin-top:0;font-size:1.15em;">📰 Latest Headlines</h3>
      <!-- Elfsight RSS Feed | News Feed from RNH -->
      <script src="https://static.elfsight.com/platform/platform.js" async></script>
      <div class="elfsight-app-9b4542e0-7fb9-4bfb-a258-38a84ee937a7" data-elfsight-app-lazy></div>
    </div>
    <div style="margin-top:18px;text-align:center;color:#888;font-size:14px;opacity:0.8;">
      Essential Radio &copy; 2025
    </div>
  </div>
</div>

<!-- TRAVEL MODAL -->
<div id="travelModal" class="modal">
  <div class="modal-content" style="max-width:900px;width:97vw;">
    <span class="close" onclick="closeModal('travelModal')">&times;</span>
    <div style="display:flex;align-items:center;gap:18px;margin-bottom:20px;">
      <h2 style="margin:0;color:#00818a;font-size:1.3em;">Travel & Transport</h2>
    </div>
    <div style="background:#111;border:1px solid #333;border-radius:12px;padding:24px 18px 24px 18px;box-shadow:0 0 20px rgba(0,0,0,0.20);margin-bottom:0; color:#eee;">
      <p style="font-size:17px;line-height:1.65;margin-bottom:18px;">
        Stay up-to-date with live road, rail, and travel news across Ayrshire and the West of Scotland. This page brings you <b>real-time delays, incidents, roadworks and ScotRail disruption</b> - all updated automatically for Essential Radio listeners.<br>
        <span style="color:#fed351;">Tip:</span> Click or tap the sections below to browse maps, incidents and more.
      </p>
      <details style="margin-bottom:20px;">
        <summary style="font-size:18px;font-weight:600;color:#fed351;cursor:pointer;outline:none;">🗺️ Combined Travel Report (All Modes)</summary>
        <div style="margin:10px 0 0 0;">
          <iframe src="https://travel-ac.vercel.app/Current_Combined_Travel_Report.html" width="100%" height="650" style="border-radius:10px;border:none;box-shadow:0 2px 14px #0004;background:#fff;" title="Combined Travel Report" loading="lazy"></iframe>
        </div>
      </details>
      <details style="margin-bottom:20px;">
        <summary style="font-size:18px;font-weight:600;color:#fed351;cursor:pointer;outline:none;">🚦 Current Road Delays & Hotspots</summary>
        <div style="margin:10px 0 0 0;">
          <iframe src="https://travel-ac.vercel.app/Current_Hotspots_Traffic_Scotland.html" width="100%" height="420" style="border-radius:10px;border:none;box-shadow:0 2px 14px #0004;background:#fff;" title="Current Road Delays & Hotspots" loading="lazy"></iframe>
        </div>
      </details>
      <details style="margin-bottom:20px;">
        <summary style="font-size:18px;font-weight:600;color:#fed351;cursor:pointer;outline:none;">🚧 Current Roadworks & Closures</summary>
        <div style="margin:10px 0 0 0;">
          <iframe src="https://travel-ac.vercel.app/Current_Roadworks_Traffic_Scotland.html" width="100%" height="340" style="border-radius:10px;border:none;box-shadow:0 2px 14px #0004;background:#fff;" title="Current Roadworks" loading="lazy"></iframe>
        </div>
      </details>
      <details style="margin-bottom:20px;">
        <summary style="font-size:18px;font-weight:600;color:#fed351;cursor:pointer;outline:none;">🚨 Current Incidents & Queues</summary>
        <div style="margin:10px 0 0 0;">
          <iframe src="https://travel-ac.vercel.app/Current_Incidents_Traffic_Scotland.html" width="100%" height="340" style="border-radius:10px;border:none;box-shadow:0 2px 14px #0004;background:#fff;" title="Current Incidents" loading="lazy"></iframe>
        </div>
      </details>
      <details>
        <summary style="font-size:18px;font-weight:600;color:#fed351;cursor:pointer;outline:none;">🚆 ScotRail Live Service Updates</summary>
        <div style="margin:10px 0 0 0;">
          <iframe src="https://travel-ac.vercel.app/Scotrail_Incidents.html" width="100%" height="360" style="border-radius:10px;border:none;box-shadow:0 2px 14px #0004;background:#fff;" title="ScotRail Live Updates" loading="lazy"></iframe>
        </div>
      </details>
    </div>
    <div style="margin-top:18px;text-align:center;color:#888;font-size:14px;opacity:0.8;">
      Essential Radio &copy; 2025
    </div>
  </div>
</div>


<!-- ======= SCRIPTS AT BOTTOM ======= -->
<script>
/* === MODAL & BURGER LOGIC (CLEAN, UNIFIED) === */

// Open modal and hide logo
function openModal(id) {
  hideLogo();
  document.getElementById(id).style.display = "block";
  document.body.classList.add("modal-open");
}

// Close modal and restore logo (if appropriate)
function closeModal(id) {
  document.getElementById(id).style.display = "none";
  document.body.classList.remove("modal-open");
  checkShowLogo();
}

// Close burger, then open modal (for mobile)
function openModalAndCloseBurger(modalId) {
  closeBurgerMenu();
  openModal(modalId);
}

// Hide/show logo helpers
function hideLogo() {
  const logo = document.querySelector(".logo-overhang");
  if (logo) logo.classList.add("logo-hide");
}
function showLogo() {
  const logo = document.querySelector(".logo-overhang");
  if (logo) logo.classList.remove("logo-hide");
}

// Show logo only if no modals/burger are open
function checkShowLogo() {
  const anyModalOpen = Array.from(document.querySelectorAll('.modal')).some(
    m => m.style.display === "block"
  );
  const burgerOpen = document.getElementById("burgerDropdown")?.style.display === "flex";
  if (!anyModalOpen && !burgerOpen) showLogo();
}

// Burger menu logic
function toggleBurgerMenu() {
  const burgerDropdown = document.getElementById("burgerDropdown");
  if (!burgerDropdown) return;
  const isOpen = burgerDropdown.style.display === "flex";
  burgerDropdown.style.display = isOpen ? "none" : "flex";
  isOpen ? checkShowLogo() : hideLogo();
}
function closeBurgerMenu() {
  const burgerDropdown = document.getElementById("burgerDropdown");
  if (burgerDropdown) burgerDropdown.style.display = "none";
  checkShowLogo();
}

// ESC closes all modals and burger menu
window.addEventListener("keydown", function(e) {
  if (e.key === "Escape") {
    document.querySelectorAll(".modal").forEach(modal => {
      if (modal.style.display === "block") closeModal(modal.id);
    });
    closeBurgerMenu();
  }
});

// Click-outside closes open modals and/or burger menu
window.addEventListener("click", function(event) {
  // Modals
  document.querySelectorAll(".modal").forEach(modal => {
    if (modal.style.display === "block" && event.target === modal) {
      closeModal(modal.id);
    }
  });
  // Burger
  const menu = document.getElementById("burgerDropdown");
  const btn = document.getElementById("burgerMenuBtn");
  if (
    window.innerWidth <= 750 &&
    menu?.style.display === "flex" &&
    !menu.contains(event.target) &&
    !btn.contains(event.target)
  ) {
    closeBurgerMenu();
  }
});
</script>

<!-- ======= ALL YOUR OTHER SCRIPTS HERE (player, widgets, clock, etc) ======= -->
<script>
/* === AUDIO PLAYER LOGIC === */

// Elements
const audio = document.getElementById("stream");
const playBtn = document.getElementById("play-toggle");
const volumeSlider = document.getElementById("volume-slider");
const volumeDisplay = document.getElementById("volume-display");
const muteBtn = document.getElementById("mute-toggle");
const nowPlaying = document.getElementById("now-playing");
const artworkImg = document.getElementById("artwork");

// Play/Pause Toggle
let playing = false;
playBtn.onclick = function() {
  if (!playing) {
    audio.play();
    playBtn.textContent = "⏸ Pause Essential Radio";
    playing = true;
  } else {
    audio.pause();
    playBtn.textContent = "▶️ Play Essential Radio";
    playing = false;
  }
};

// Update volume
volumeSlider.oninput = function() {
  const vol = +this.value;
  audio.volume = vol / 100;
  volumeDisplay.textContent = vol + "%";
  if (vol === 0) {
    audio.muted = true;
    muteBtn.textContent = "🔇";
  } else {
    audio.muted = false;
    muteBtn.textContent = "🔊";
  }
};
muteBtn.onclick = function() {
  audio.muted = !audio.muted;
  muteBtn.textContent = audio.muted ? "🔇" : "🔊";
  volumeSlider.value = audio.muted ? 0 : Math.round(audio.volume * 100);
  volumeDisplay.textContent = volumeSlider.value + "%";
};

// On stream end/error
audio.onerror = function() {
  nowPlaying.textContent = "Stream unavailable";
  artworkImg.src = "Essential Radio Logo.png";
  artworkImg.classList.remove("loaded");
  playing = false;
  playBtn.textContent = "▶️ Play Essential Radio";
};

// === NOW PLAYING + ARTWORK FETCH (Autopo.st + iTunes Fallback) ===

function fetchNowPlaying() {
  fetch("nowplaying.json") // Your backend endpoint, e.g., update this path
    .then(r => r.json())
    .then(data => {
      if (data && data.artist && data.title) {
        nowPlaying.textContent = data.artist + " – " + data.title;
        // Try to get artwork from Autopo.st
        fetch(`https://api.autopo.st/v1/cover?artist=${encodeURIComponent(data.artist)}&title=${encodeURIComponent(data.title)}&size=large`)
          .then(r2 => r2.json())
          .then(res => {
            if (res && res.image) {
              artworkImg.src = res.image;
              artworkImg.classList.add("loaded");
            } else {
              // Try iTunes fallback
              fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(data.artist + " " + data.title)}&entity=song&limit=1`)
                .then(r3 => r3.json())
                .then(it => {
                  if (it.results && it.results[0] && it.results[0].artworkUrl100) {
                    artworkImg.src = it.results[0].artworkUrl100.replace("100x100", "400x400");
                  } else {
                    artworkImg.src = "Essential Radio Logo.png";
                  }
                  artworkImg.classList.add("loaded");
                });
            }
          });
      } else {
        nowPlaying.textContent = "Loading current track…";
        artworkImg.src = "Essential Radio Logo.png";
        artworkImg.classList.remove("loaded");
      }
    }).catch(() => {
      nowPlaying.textContent = "Loading current track…";
      artworkImg.src = "Essential Radio Logo.png";
      artworkImg.classList.remove("loaded");
    });
}
fetchNowPlaying();
setInterval(fetchNowPlaying, 15000); // Update every 15s

</script>

<script>
/* === LIVE STUDIO CLOCK === */
function updateClock() {
  const now = new Date();
  // Always display in HH:MM:SS format, UK local
  const time = now.toLocaleTimeString("en-GB", { hour12: false });
  const date = now.toLocaleDateString("en-GB", { weekday: 'long', day: 'numeric', month: 'long' });
  document.getElementById("clockTime").textContent = time;
  document.getElementById("clockDate").textContent = date;
}
updateClock();
setInterval(updateClock, 1000);
</script>

<script>
/* === RECENTLY PLAYED TRACKS === */
// Expects your playout_log_rolling.json to be present and formatted correctly.
function updateRecentlyPlayed() {
  fetch("playout_log_rolling.json")
    .then(res => res.json())
    .then(data => {
      const list = document.getElementById("recent-list");
      if (!list) return;
      list.innerHTML = "";
      let count = 0;
      for (let i = data.length - 1; i >= 0 && count < 8; i--) {
        const item = data[i];
        if (!item["Artist"] || !item["Title"]) continue;
        const li = document.createElement("li");
        // Format time as HH:MM
        const time = new Date(item["Hour"]).toLocaleTimeString("en-GB", { hour: '2-digit', minute: '2-digit', hour12: false });
        li.innerHTML = `
          <span class="time">${time}</span>
          <span class="info">${item["Artist"]} – ${item["Title"]}</span>
          <img src="Essential Radio Logo.png" alt="Artwork" />
        `;
        // Fetch artwork just like above
        const img = li.querySelector("img");
        fetch(`https://api.autopo.st/v1/cover?artist=${encodeURIComponent(item["Artist"])}&title=${encodeURIComponent(item["Title"])}&size=small`)
          .then(r => r.json())
          .then(res => {
            if (res && res.image) {
              img.src = res.image;
              img.classList.add("loaded");
            } else {
              // Try iTunes fallback
              fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(item["Artist"] + " " + item["Title"])}&entity=song&limit=1`)
                .then(r2 => r2.json())
                .then(it => {
                  if (it.results && it.results[0] && it.results[0].artworkUrl100) {
                    img.src = it.results[0].artworkUrl100;
                  }
                  img.classList.add("loaded");
                });
            }
          }).catch(() => {
            img.classList.remove("loaded");
          });
        list.appendChild(li);
        count++;
      }
    });
}
updateRecentlyPlayed();
setInterval(updateRecentlyPlayed, 25000); // Update every 25s
</script>

</body>
</html>
