<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Essential Radio Player – streamlined</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />

  <!-- =================== STYLES =================== -->
  <style>
    /* === RESET === */
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;scroll-behavior:smooth}
    body{font-family:'Inter',sans-serif;background:linear-gradient(135deg,#00818a,#7e1974);color:#fff}

    /* === HELPERS === */
    .flex{display:flex}.center{justify-content:center;align-items:center}.hidden{display:none!important}

    /* === NAV === */
    nav.navbar{position:fixed;top:0;left:0;width:100%;padding:9px 0;background:#222;
      box-shadow:0 2px 12px #111a;display:flex;flex-wrap:wrap;gap:8px;justify-content:center;z-index:1001}
    nav.navbar a{background:#fed351;color:#222;font-weight:700;font-size:16px;
      padding:8px 18px;border-radius:16px;transition:.2s}
    nav.navbar a:hover{background:#00818a;color:#fff}

    /* === PANELS === */
    .player-wrapper{max-width:1100px;margin:92px auto 0;position:relative}
    .strip-container{display:flex;background:#111;border-radius:15px;overflow:hidden;box-shadow:0 0 25px #0008}
    .left-panel,.right-panel{width:50%;padding:24px;display:flex;flex-direction:column}
    .left-panel{align-items:center;border-right:1px solid #333;text-align:center}
    .right-panel{background:#222}
    @media(max-width:768px){.strip-container{flex-direction:column}.left-panel,.right-panel{width:100%;padding:16px;border:none}}

    /* === SMALL COMPONENTS === */
    #liveClock{display:inline-flex;gap:16px;padding:8px 16px;margin:0 auto 14px;
      background:#151516;border-radius:14px;font-family:monospace}
    #clockTime{color:#e53935;font-weight:700}
    #clockDate{color:#fed351}

    #now-playing-card{margin-top:25px;background:#1a1a1a;border-radius:10px;padding:20px;
      box-shadow:0 0 15px rgba(0,131,138,.7)}
    .btn{background:#fed351;color:#111;padding:12px 24px;font-weight:600;border-radius:8px;transition:.3s}
    .btn:hover{background:#e5c73f;box-shadow:0 0 10px #fed351cc}

    /* Pulse */
    .pulsing-label{color:#ff4d4d;font-weight:700;animation:pulse 5s infinite}
    @keyframes pulse{0%,100%{opacity:.6}50%{opacity:1}}


/* ——— RECENTLY‑PLAYED ——— */
.recent-title{
  font-size:1.05rem;
  letter-spacing:.2px;
  text-transform:uppercase;
}

/* Recently‑played list: no internal scrolling */
#recent-list{
  list-style:none;
  padding:0;
  margin:0;
  /* overflow-y:auto;   ← delete or comment‑out this line */
}


#recent-list::-webkit-scrollbar{width:6px}
#recent-list::-webkit-scrollbar-thumb{
  background:#444;border-radius:3px
}

#recent-list li{
  display:flex;
  align-items:center;
  gap:10px;
  padding:6px 2px;
  border-bottom:1px solid #2b2b2b;
  font-size:.95rem;
}

#recent-list .time{
  width:52px;
  flex:none;
  text-align:right;
  font-family:monospace;
  color:#fed351;
  font-size:.9rem;
}

#recent-list img{
  width:46px;
  height:46px;
  flex:none;
  border-radius:4px;
  object-fit:cover;
  background:#000;
  opacity:.85;
  transition:opacity .2s,transform .25s;
}
#recent-list img.loaded{opacity:1}
#recent-list li:hover img{transform:scale(1.07)}

#recent-list .info{
  flex:1;
  line-height:1.25;
  word-break:break-word;
}

@media(max-width:500px){
  #recent-list .time{display:none}   /* hide times on very narrow phones */
}
/* ——— LIVE CLOCK BAR ——— */
#liveClock{
  font-size:1.15rem;
  font-weight:600;
  letter-spacing:.3px;
  background:#151516;
  border:2px solid #2d2d2d;
  box-shadow:0 2px 10px #0006;
}

/* time – bright red digits */
#clockTime{
  color:#ff5555;            /* same hue as original */
  font-family:'Roboto Mono',monospace;
}

/* date – soft yellow */
#clockDate{
  color:#fed351;
  font-family:'Inter',sans-serif;
  font-weight:500;
}

#liveClock::after{
  margin:0 4px;
  opacity:.55;
  color:#888;
  font-weight:400;
}

/* ——— ON AIR NOW STRIP ——— */
.pulsing-label{
  font-size:.9rem;
  letter-spacing:.4px;
  text-transform:uppercase;
  color:#ff4d4d;
  animation:pulse 1.4s infinite;
}

#currentShow{
  font-weight:600;
  font-size:1rem;
  color:#fff;
}

@media(max-width:500px){
  /* shrink on very small screens */
  #liveClock{font-size:.95rem}
  .pulsing-label{font-size:.8rem}
  #currentShow{font-size:.9rem}
}

/* put this with your other small‑component rules */
#currentShow .show-title,
#currentShow .show-presenter{
  display:block;        /* forces its own line */
}

#currentShow .show-presenter{
  font-style:italic;    /* optional styling – matches original */
  font-weight:400;
}
/* === LIVE TAG === */
.live-indicator{
  color:#ff4d4d;          /* bright red text */
  font-weight:700;
  margin-left:6px;        /* gap after “Now Playing:” */
  display:inline-flex;
  align-items:center;
  gap:4px;
}

.live-indicator .dot{
  display:inline-block;
  width:8px;              /* tiny circle */
  height:8px;
  border-radius:50%;
  background:#ff4d4d;
  animation:blink 1.2s ease-in-out infinite alternate;
}

/* simple opacity blink */
@keyframes blink{
  0%  { opacity:.25 }
  100%{ opacity:1 }
}

.pulsing-label{
  animation:none!important;
}

/* === RECENTLY‑PLAYED time – match clock date font === */
#recent-list .time{
  font-family: Inter;   /* same as #liveClock / #clockDate */
  color:#fed351;            /* same yellow you already use */
  font-weight:600;          /* feels balanced next to titles */
  letter-spacing:.25px;     /* optional: tiny spacing like the clock */
  width:58px;               /* keeps “23:59” tidy */
  text-align:right;
  margin-right:10px;        /* gap before song title */
  display:inline-block;
}

/* === DESKTOP / TABLET MODAL CENTRING === */
@media (min-width: 769px){           /* keep mobile behaviour untouched */
  .modal-content{
    position:fixed;                 /* pull it out of normal flow */
    top:50%; left:50%;
    transform:translate(-50%,-50%); /* true centred overlay */
    max-height:90vh;                /* never exceed viewport */
    overflow-y:auto;                /* scroll inside if it does */
    margin:0;                       /* prevent browser defaults */
    border-radius:14px;
    box-shadow:0 20px 60px #000c;   /* deep shadow like before */
    background:#fff;                /* or whatever your card colour is */
  }
}

/* OPTIONAL – give backdrop subtle fade again for desktop */
@media (min-width: 769px){
  .modal{
    background:rgba(0,0,0,.68);     /* darker but still see‑through */
  }
}

/* ——— PLAYLIST MODAL ——— */
.modal-content.playlist{
  max-width:650px;  /* same as before */
  width:95vw;
  background:#111;
  border:1px solid #333;
  border-radius:14px;
  padding:28px 22px 32px;
  box-shadow:0 0 22px rgba(0,0,0,.35);
  color:#eee;
  text-align:center;
}

.playlist-heading{
  margin:0 0 20px;
  font-size:1.55em;
  color:#00818a;
}

.playlist-frame{
  display:inline-block;
  background:#000;
  border:2px solid #fed351;
  border-radius:12px;
  box-shadow:0 4px 18px #000a;
  overflow:hidden;
  max-width:100%;
}

.playlist-frame img{
  display:block;
  width:100%;
  height:auto;
}

/* —— tiny tweaks for phones —— */
@media(max-width:550px){
  .playlist-heading{font-size:1.35em}
  .modal-content.playlist{
    padding:22px 14px 26px;
  }
}
/* ——— universal CLOSE button for all modals ——— */
.modal-content {               /* make sure “close” can sit inside */
  position: relative;
}

.close{
  position: absolute;
  top: 10px;                   /* adjust to taste */
  right: 16px;
  font-size: 32px;             /* nice big × */
  line-height: 1;
  color: #aaa;                 /* muted until hover */
  cursor: pointer;
  transition: color .15s ease, transform .15s ease;
}
.close:hover{
  color: #e53935;              /* bright red on hover */
  transform: scale(1.15);
}
/* =====‑‑ spacing inside every modal ‑‑===== */
.modal-content{
  margin-top: 70px;    /* pushes the card down a little */
  padding-left: 32px;          /* desktop / tablet “gutter” */
  padding-right: 32px;
  box-sizing: border-box;      /* so it never bloats the width */
}

/* phones: keep the edge‑to‑edge look but add a slim gutter */
@media (max-width: 600px){
  .modal-content{
    margin-top: 0;     /* unchanged for mobile slide‑up */
    padding-left: 5vw;         /* ≈20 px on a 400 px screen */
    padding-right: 5vw;
  }
}
  /* Centre every modal box horizontally (desktop/tablet only) */
  @media (min-width: 769px){
    .modal{                       /* the dark overlay */
      display:flex;               /* create a flex container         */
      justify-content:center;     /* centre the child left‑to‑right  */
    }
    .modal-content{               /* the white box itself            */
      margin:100px 0;              /* 60 px gap top + bottom           */
    }
  }
<style>
  /* top padding for ALL modal boxes */
  .modal-content{
    padding-top:32px !important;   /* adjust the value to taste */
  }
</style>
</head>
<body>

  <!-- ======= DESKTOP NAV ======= -->
  <nav class="navbar"></nav>

  <!-- ======= PLAYER WRAPPER ======= -->
  <div class="player-wrapper">
    <!-- Logo overhang -->
    <img src="ERLogo2.png" alt="Essential Radio Logo" style="position:absolute;top:0;left:0;width:220px;transform:translate(-36%,-36%);filter:drop-shadow(0 4px 6px rgba(0,0,0,.35));pointer-events:none">

    <div class="strip-container">
      <!-- ==== LEFT === -->
      <div class="left-panel">
        <div style="width:100%;text-align:right;margin-bottom:10px">
          <span class="pulsing-label">ON AIR NOW&nbsp;</span>
          <span id="currentShow">Loading…</span>
        </div>

        <div id="player-box">
          <audio id="stream" preload="none">
            <source src="https://streaming06.liveboxstream.uk/proxy/ayrshire/stream" type="audio/mpeg" />
          </audio>
          <button id="play-toggle" class="btn" style="width:100%">▶️ Play Essential Radio</button>

          <div style="margin-top:15px;display:flex;gap:10px;justify-content:center;align-items:center">
            <label for="volume-slider">Volume:</label>
            <input type="range" id="volume-slider" min="0" max="100" value="100" />
            <span id="volume-display">100%</span>
            <button id="mute-toggle" class="btn" style="padding:6px 12px">🔊</button>
          </div>

          <div id="now-playing-card">
            <div id="now-playing">Loading current track…</div>
          </div>

          <img id="artwork" src="Essential Radio Logo.png" alt="Artwork" style="margin-top:25px;width:280px;height:280px;border-radius:8px;border:2px solid #fed351;object-fit:cover">
        </div>
      </div>

      <!-- ==== RIGHT === -->
      <div class="right-panel">
        <!-- Clock -->
        <div id="liveClock" class="center">
          <span id="clockTime">--:--:--</span>
          <span id="clockDate">Date</span>
        </div>

        <!-- Weather -->
        <!-- === ESSENTIAL WEATHER WIDGET (Always Shows Hourly Strip) === -->
<div id="wxWrap"
     style="font-family:Inter,sans-serif;background:linear-gradient(135deg,#24243e 0%,#191c29 100%);
            color:#f5f5f5;border-radius:18px;padding:16px;box-shadow:0 6px 32px #0007;
            border:1px solid #252e42;max-width:100%;text-align:center;margin-bottom:18px;
            transition:background 0.3s,box-shadow 0.3s;">

  <!-- Heading (desktop = one line, mobile = two lines) -->
  <h3 class="wxHeading">
    Ayrshire Weather
    <span class="mobBreak"><br></span>
    <span class="sub">– select a location</span>
  </h3>

  <!-- ♻︎ LOCAL HEADING STYLES – stay inside the widget -->
  <style>
    /* desktop / tablet */
    #wxWrap .wxHeading{
      font-size:1.15em;font-weight:600;margin:0 0 10px 0;color:#fed351;letter-spacing:.3px}
    #wxWrap .wxHeading .sub{font-weight:400;font-style:italic;color:#bbb}
    #wxWrap .mobBreak{display:none}

    /* mobile ≤500 px */
    @media(max-width:500px){
      #wxWrap .wxHeading{font-size:1.05em}
      #wxWrap .wxHeading .sub{font-size:.9em}
      #wxWrap .mobBreak{display:inline}
    }
  </style>

  <!-- Location selector -->
  <div style="margin-bottom:7px;">
    <select id="locSel"
            style="background:#222;color:#fed351;border:1px solid #444;
                   border-radius:6px;padding:4px 10px;font-weight:bold;">
      <option value="Kilmarnock,55.6118,-4.4955">Kilmarnock</option>
      <option value="Kilwinning,55.6558,-4.7057">Kilwinning</option>
      <option value="Ayr,55.4586,-4.6292">Ayr</option>
    </select>
  </div>
  <!-- …rest of the widget remains unchanged… -->

  <div style="display:flex;justify-content:space-between;align-items:center;
              border-bottom:1px solid #2224;margin-bottom:10px;padding-bottom:7px;">
    <div id="wxNow" style="text-align:left;font-size:1em;"></div>
    <button id="toggleBtn"
            style="background:#fed351;color:#191c29;font-weight:600;border:none;
                   border-radius:6px;padding:3px 10px;font-size:0.8em;cursor:pointer;
                   box-shadow:0 1px 4px rgba(0,0,0,0.3);transition:all 0.18s;">
      5-day ▸
    </button>
  </div>

  <!-- Hourly (2-row layout) -->
  <div id="hrWrap" style="display:grid;grid-template-rows:auto auto;gap:4px;
                          white-space:nowrap;font-size:0.82em;
                          padding:6px 0;transition:opacity 0.35s, transform 0.3s;opacity:1;"></div>

  <!-- Daily (2-row layout) -->
  <div id="dyWrap" style="display:none;grid-template-rows:auto auto;gap:4px;
                          white-space:nowrap;font-size:0.82em;
                          padding:6px 0;transition:opacity 0.35s, transform 0.3s;opacity:1;"></div>

  <div id="wxAlert" style="color:#ff6969;font-size:0.85em;margin-top:5px;"></div>
</div>

<hr class="weather-divider">

<style>
  .weather-divider {
    border: 0;
    border-top: 1.5px solid #28304c;
    margin: 14px 0 0 0;
    opacity: 0.6;
  }

  #wxNow span {
    text-shadow: 0 2px 10px #000c, 0 1px 0 #fed351;
    font-size: 1.06em;
  }

  /* ========= WEATHER WIDGET SCROLL SMOOTHNESS ========= */

  /* Default: no horizontal scroll = no vertical stall */
  #hrWrap, #dyWrap {
    overflow-x: hidden;      /* nothing to drag */
    touch-action: pan-y;     /* vertical only   */
    overscroll-behavior: auto;
  }

  /* Phones (≤500 px) get sideways strips */
  @media (max-width: 500px) {
    #hrWrap, #dyWrap {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      touch-action: pan-x;           /* claim horizontal drags */
      overscroll-behavior-x: contain;
      overscroll-behavior-y: auto;   /* let vertical bubble out */
    }
  }

  /* Ensure the whole widget never traps vertical scroll */
  #wxWrap {
    overscroll-behavior: auto !important;
    -webkit-overflow-scrolling: touch;
  }

  /* ========== OTHER EXISTING STYLES (unchanged) ========== */

  #toggleBtn:hover {
    background: #ffe67c !important;
    color: #222 !important;
    transform: scale(1.08);
    box-shadow: 0 2px 8px #fed35180;
    transition: all 0.18s;
  }

  #hrWrap, #dyWrap {
    transition: opacity 0.35s, transform 0.3s;
    opacity: 1;
    scroll-snap-type: x mandatory;   /* keep snap if you like */
  }

  #hrWrap[style*="display: none"],
  #dyWrap[style*="display: none"] {
    opacity: 0 !important;
    transform: translateY(-8px);
  }

  .forecast-icon {
    transition: transform 0.2s ease-in-out, filter 0.2s;
  }
  .forecast-icon:hover {
    filter: brightness(1.15) drop-shadow(0 2px 8px #fed35188);
    transform: scale(1.16) rotate(-8deg);
  }

  @media (max-width: 500px) {
    #toggleBtn {
      font-size: 0.72em !important;
      padding: 2px 6px !important;
      border-radius: 5px !important;
    }
    #wxWrap h3 { font-size: 1em !important; }
  }

  #dyWrap > div > div {
    width: 20% !important;
    min-width: 0 !important;
    max-width: none !important;
    box-sizing: border-box;
  }

  /* “chance of rain” sub-line */
  .wxRainNote {
    font-size: 90%;
    font-style: italic;
    display: inline-block;
  }
  @media (max-width: 500px) {
    .wxRainNote { text-align: right; width: 100%; }
  }
</style>

<!-- === ESSENTIAL WEATHER WIDGET SCRIPT (FULL) === -->
<script>
(() => {
  const KEY = 'e4a309c7e76f09b85a2ff7d34305505f';

  const q = s => document.querySelector(s),
        locSel = q('#locSel'),
        wxNow  = q('#wxNow'),
        tBtn   = q('#toggleBtn'),
        hrWrap = q('#hrWrap'),
        dyWrap = q('#dyWrap'),
        alertBox = q('#wxAlert');

  let show5 = localStorage.wxView === '5';
  if (show5) swapView();
  if (localStorage.wxChoice) locSel.value = localStorage.wxChoice;

  function phrase(desc, isDay, temp = null, pop = null) {
    desc = desc.toLowerCase();
    if (desc.includes('thunder')) return 'Thunderstorm';
    if (desc.includes('snow') && (!temp || temp < 5)) return 'Snow';
    if (desc.includes('snow') && temp && temp >= 5) return 'Showers';
    if (desc.includes('rain') || desc.includes('drizzle')) {
      if (pop !== null && pop < 30) return isDay ? 'Chance of showers' : 'Possible showers';
      return 'Rain';
    }
    if (desc.includes('fog'))   return 'Foggy';
    if (desc.includes('mist'))  return 'Misty';
    if (desc.includes('haze'))  return 'Hazy';
    if (desc.includes('smoke')) return 'Smoky';
    if (desc === 'clear sky')   return isDay ? 'Sunny' : 'Clear';
    if (desc.includes('few clouds'))       return isDay ? 'Mostly sunny' : 'Mainly clear';
    if (desc.includes('scattered clouds')) return isDay ? 'Partly cloudy' : 'Some cloud';
    if (desc.includes('broken clouds'))    return isDay ? 'Sunny intervals' : 'Cloudy';
    if (desc.includes('overcast'))         return 'Overcast';
    if (!isDay && (desc.includes('sun') || desc.includes('bright'))) return 'Clear';
    return isDay ? 'Fair' : 'Calm';
  }

  async function update() {
    const [label, lat, lon] = locSel.value.split(',');
    localStorage.wxChoice = locSel.value;

    try {
      const d = await fetch(`https://api.openweathermap.org/data/3.0/onecall?lat=${lat}&lon=${lon}&units=metric&appid=${KEY}`)
                       .then(r => r.json());

      // ==== CURRENT CONDITIONS ====
const cur  = d.current,
      nxt  = d.hourly[1],
      day  = cur.dt >= cur.sunrise + 3600 && cur.dt < cur.sunset - 3600,
      pop  = nxt && typeof nxt.pop === 'number' ? Math.round(nxt.pop * 100) : null,
      desc = phrase(cur.weather[0].description, day, cur.temp, pop),
      tmp  = Math.round(cur.temp);

// Only show % if desc doesn’t already include “rain / showers”
const showPop = pop !== null && pop >= 30 && !/rain|showers/i.test(desc);

// Build the summary line (keeps “• 80 % rain” on one line)
wxNow.innerHTML =
  `<span style="color:#fed351;font-weight:bold">${desc}</span>, ${tmp}°C` +
  (showPop
     ? `<br><span class="wxRainNote">☔&nbsp;${pop}% chance of rain</span>`
     : '');
    
      // HOURLY STRIP
      hrWrap.innerHTML = '';
      let times = '', details = '';
      d.hourly.slice(1, 6).forEach(h => {
        const t = new Date(h.dt * 1e3).getHours().toString().padStart(2,'0') + ':00';
        const icon = `https://openweathermap.org/img/wn/${h.weather[0].icon}.png`;
        times   += `<div style="width:52px;text-align:center;">${t}</div>`;
        details += `<div style="width:52px;text-align:center;">
                      <img src="${icon}" width="20" class="forecast-icon"><br>${Math.round(h.temp)}°
                    </div>`;
      });
      hrWrap.innerHTML = `<div style="display:flex;">${times}</div><div style="display:flex;">${details}</div>`;
      hrWrap.style.display = show5 ? 'none' : 'grid';

      // DAILY STRIP
      dyWrap.innerHTML = '';
      let days = '', temps = '';
      d.daily.slice(1, 6).forEach(dd => {
        const wd   = new Date(dd.dt * 1e3).toLocaleDateString('en-GB', {weekday:'short'});
        const icon = `https://openweathermap.org/img/wn/${dd.weather[0].icon}.png`;
        days  += `<div style="text-align:center;">${wd}</div>`;
        temps += `<div style="text-align:center;">
                    <img src="${icon}" width="20" class="forecast-icon"><br>
                    ${Math.round(dd.temp.max)}°/${Math.round(dd.temp.min)}°
                  </div>`;
      });
      dyWrap.innerHTML = `<div style="display:flex;">${days}</div><div style="display:flex;">${temps}</div>`;
      dyWrap.style.display = show5 ? 'grid' : 'none';

      // ALERTS
      if (d.alerts && d.alerts.length) {
        const now = Math.floor(Date.now()/1000);
        const valid = d.alerts.find(a => !a.end || a.end > now);
        alertBox.textContent = valid ? `⚠ ${valid.event}` : '';
      } else {
        alertBox.textContent = '';
      }

    } catch(e) {
      console.error('Weather fetch error', e);
      wxNow.textContent = 'Weather unavailable';
    }
  }

  function swapView() {
    hrWrap.style.opacity = '0';
    dyWrap.style.opacity = '0';
    setTimeout(() => {
      show5 = !show5;
      localStorage.wxView = show5 ? '5' : 'hr';
      hrWrap.style.display = show5 ? 'none':'grid';
      dyWrap.style.display = show5 ? 'grid':'none';
      tBtn.textContent = show5 ? 'Hourly ▶' : '5-day ▸';
      setTimeout(() => {
        hrWrap.style.opacity = show5 ? '0':'1';
        dyWrap.style.opacity = show5 ? '1':'0';
      },20);
    },180);
  }

  tBtn  .addEventListener('click', swapView);
  locSel.addEventListener('change', update);
  update();
  setInterval(update, 900000);
})();
</script>

        <!-- Recently played -->
        <div style="flex:1;display:flex;flex-direction:column;min-height:0">
          <div class="recent-title" style="color:#fed351;font-weight:600;margin-bottom:14px">Recently Played</div>
          <ul id="recent-list" style="flex:1;list-style:none;overflow-y:auto"></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- ======= MODALS ======= -->
  <!-- Example modal skeleton. Duplicate for each needed section. -->
     <div id="aboutModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('aboutModal')">&times;</span>
    <div style="display:flex;align-items:center;gap:20px;margin-bottom:24px;">
      <h2 style="margin:0;color:#00818a;font-size:1.55em;">About Us</h2>
    </div>
    <div style="background:#111;border:1px solid #333;border-radius:12px;padding:22px 18px 12px 18px;box-shadow:0 0 20px rgba(0,0,0,0.21);margin-bottom:0; color:#fff;">
      <p style="margin-bottom:18px;">
        Essential Radio is Ayrshire College’s very own 24/7 station, broadcasting music, student content and campus updates from our Kilwinning base. The station launched in June 2022 with initial funding from the Ayrshire College Foundation, and brings a fresh and dynamic voice to the college community.
      </p>
      <p style="margin-bottom:18px;">
        We’re more than just great music. Essential Radio is a creative platform for students across all departments. Whether as part of a class project or an extra-curricular activity, learners can contribute shows, features and ideas that reflect their interests and studies.
      </p>
      <p style="margin-bottom:18px;">
        Any student with a passion for broadcasting is welcome to get involved. From presenting to production, advert scripting to playlist curation – we offer hands-on experience and skill-building opportunities with real impact.
      </p>
      <p style="margin-bottom:24px;">
        The station enhances college life with music, event coverage and a direct link between students, staff and local employers. It’s a modern, flexible way to keep our community connected, supported and inspired – on all of our campuses and beyond.
      </p>
      <hr style="border:0;border-top:1px solid #444;margin:28px 0 18px 0;">
      <h3 style="color:#fed351;font-size:1.08em;margin:0 0 13px 0;">Our Aims</h3>
      <ul style="color:#ddd;font-size:1em;line-height:1.6;padding-left:20px;margin:0 0 14px 0;">
        <li>To provide a positive, inclusive broadcast platform for the college community.</li>
        <li>To support learning, creativity and employability through media skills.</li>
        <li>To share news, opportunities and achievements across all campuses.</li>
        <li>To promote student and staff voices, with original content and music.</li>
      </ul>
      <hr style="border:0;border-top:1px solid #444;margin:28px 0 18px 0;">
      <h3 style="color:#fed351;font-size:1.08em;margin:0 0 13px 0;">Contact Us</h3>
      <p>
        You can email the team at <a href="mailto:essentialradio@ayrshire.ac.uk" style="color:#fed351;">essentialradio@ayrshire.ac.uk</a> or use the Contact form on this site.
      </p>
      <p style="font-size:0.97em;color:#bbb;margin:20px 0 0 0;">
        Essential Radio is fully licensed for music broadcast in the UK by PPL and PRS for Music.
      </p>
      <div style="text-align:center;margin-top:18px;">
        <img src="PPL_PRSLogo.png" alt="PPL_PRSLogo" style="width:120px;max-width:100%;filter:brightness(1.08);" />
      </div>
    </div>
    <div style="margin-top:20px;text-align:center;color:#888;font-size:14px;opacity:0.8;">
      Essential Radio &copy; 2025
    </div>
    </div>
  </div>

<div id="playlistModal" class="modal">
<div class="modal-content playlist">
  <span class="close" onclick="closeModal('playlistModal')">&times;</span>

  <h2 class="playlist‑heading">Essential Radio Playlist</h2>

  <!-- image wrapper keeps a tidy max‑width on desktop and scales on phones -->
  <div class="playlist-frame">
    <img src="ERPlaylist.png"
         alt="Essential Radio Playlist artwork"
         loading="lazy">
  </div>
</div>

<!-- ===== SCHEDULE MODAL (drop-in, bulletproof) ===== -->
<div id="scheduleModal" class="modal">
  <div class="modal-content" style="max-width:920px;width:95vw;">
    <span class="close" onclick="closeModal('scheduleModal')">&times;</span>
    <h2 style="margin:0 0 18px 0;color:#00818a;">Programme Schedule</h2>
    <!-- DAY PILLS -->
    <div id="dayNav" class="day-nav" style="margin-bottom:16px;"></div>
    <!-- SCHEDULE CARD -->
    <div id="modalScheduleContainer">
      <div id="modalDaySchedule" class="day-card">
        <h3>Loading…</h3>
      </div>
    </div>
  </div>
</div>
<!-- === SCHEDULE MODAL CSS === -->
<style>
.day-nav{
  display:flex;
  gap:6px;
  justify-content:center;
  flex-wrap:wrap;
  margin-bottom:18px;
}
.day-nav button{
  background:#fed351;
  color:#111;
  border:none;
  border-radius:18px;
  padding:6px 14px;
  font-weight:600;
  cursor:pointer;
  transition:.18s;
  font-size:1.08em;
  margin:0 2px 4px 2px;
  outline: none;
}
.day-nav button:hover{
  background:#ffe67c;
}
.day-nav .active{
  background:#00818a;
  color:#fff;
}
.day-card{
  background:#151921ea;
  border:1px solid #343648;
  border-radius:16px;
  padding:24px 18px 14px;
  max-width:860px;
  margin:0 auto;
  box-shadow:0 0 18px #0008;
  color:#eee;line-height:1.55;
}
.day-card h3{
  margin-top:0;
  margin-bottom:12px;
  color:#fed351;
  font-size:1.15em;
}
.show-row{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  border-bottom:1px solid #3335;
  padding:6px 0 4px;
  align-items: flex-start;
}
.show-row:last-child{border:none}
.show-time{
  font-weight:600;
  color:#fed351;
  white-space:nowrap;
  min-width:92px;
}
.show-title{
  flex:1;
  min-width:160px;
  font-weight: 600;
  color: #fff;
}
.show-presenter{
  flex-basis:100%;
  font-style:italic;
  color:#bbb;
  font-size:.97em;
  margin-left: 102px; /* aligns under title/time */
  margin-top: -4px;
}
@media (max-width: 600px) {
  .show-title{min-width:110px;}
  .show-presenter{margin-left:0;}
}
</style>
<!-- === SCHEDULE MODAL JS === -->
<script>
// Minimal test data: Replace this fetch with your real fetch in production!
let data = {};
fetch("https://essentialradio.github.io/player/schedule.json")
  .then(r => r.json())
  .then(json => { data = json; renderSchedule(todayName()); });

const days = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
function todayName() {
  return new Date().toLocaleString("en-GB",{weekday:"long"});
}
const dayNav = document.getElementById("dayNav");
const dayCard = document.getElementById("modalDaySchedule");
dayNav.innerHTML = days.map(d =>
  `<button data-day="${d}"${d===todayName()?" class=\"active\"":""}>${d.slice(0,3)}</button>`
).join("");
dayNav.addEventListener("click", e => {
  const btn = e.target.closest("button[data-day]");
  if(!btn) return;
  dayNav.querySelector(".active")?.classList.remove("active");
  btn.classList.add("active");
  renderSchedule(btn.dataset.day);
});

function renderSchedule(day) {
  const shows = data[day] || [];
  if(!shows.length){
    dayCard.innerHTML = "<h3>"+day+"</h3><p>No shows scheduled.</p>";
    return;
  }
  dayCard.innerHTML = `<h3>${day}</h3>` + shows.map(s => {
    let showTitle = s.title || "";
    let presenter = s.presenter || "";
    // Auto-split "with ..." if needed
    const m = showTitle.match(/^(.+?)\s+with\s+(.+)$/i);
    if (m) {
      showTitle = m[1];
      presenter = m[2];
    }
    return `
      <div class="show-row">
        <span class="show-time">${fmtTime(s.start)} – ${fmtTime(s.end)}</span>
        <span class="show-title">${showTitle}</span>
        ${presenter ? `<span class="show-presenter">with&nbsp;${presenter}</span>` : ""}
      </div>`;
  }).join("");
}
function fmtTime(t) {
  if (t==="00:00") return "24:00";
  if (t==="23:59") return "23:59";
  return t;
}
</script>








 <div id="listenModal" class="modal">
  <div class="modal-content" style="max-width:700px;width:97vw;">
    <span class="close" onclick="closeModal('listenModal')">&times;</span>
    <div style="display:flex;align-items:center;gap:20px;margin-bottom:24px;">
      <h2 style="margin:0;color:#00818a;font-size:1.5em;">Listen Again</h2>
    </div>
    <div style="background:#111;border:1px solid #333;border-radius:12px;padding:24px 18px;box-shadow:0 0 20px rgba(0,0,0,0.28); color:#eee;">
      <p style="font-size:17px;line-height:1.6;margin-bottom:18px;">
        Missed a show? No problem! Catch up on your favourite Essential Radio programmes here.<br>
        Browse recent shows, select your favourites, and listen again anytime.
      </p>
      <div id="mixcloud-embeds"></div>
    </div>
    <div style="margin-top:18px;text-align:center;color:#888;font-size:14px;opacity:0.8;">
      Essential Radio &copy; 2025
    </div>

    <script>
      fetch('https://api.mixcloud.com/essentialradio/cloudcasts/')
        .then(response => response.json())
        .then(data => {
          const container = document.getElementById('mixcloud-embeds');
          const shows = data.data.slice(0, 6); // Only show 6
          shows.forEach(show => {
            const block = document.createElement('div');
            block.className = 'show-block';

            const title = document.createElement('div');
            title.className = 'show-title';
            title.textContent = show.name || show.slug || 'Previous Show';

            const iframe = document.createElement('iframe');
            iframe.className = 'mixcloud-player';
            iframe.src = `https://www.mixcloud.com/widget/iframe/?feed=${encodeURIComponent(show.url)}&hide_cover=1&light=0`;
            iframe.allow = 'autoplay';

            block.appendChild(title);
            block.appendChild(iframe);
            container.appendChild(block);
          });
        })
        .catch(error => {
          document.getElementById('mixcloud-embeds').innerHTML =
            '<div style="color:#fed351;font-size:1.1em;margin-top:12px;">Unable to load previous shows at the moment.</div>';
        });
    </script>
    <style>
      .show-block {
        margin-bottom: 30px;
      }
      .show-title {
        font-size: 18px;
        margin-bottom: 8px;
        color: #fff;
        word-break: break-word;
        line-height: 1.2;
        font-weight: 500;
      }
      .mixcloud-player {
        width: 100%;
        min-width: 0;
        height: 120px;
        border: 0;
        display: block;
        border-radius: 8px;
        background: #222;
      }
      @media (max-width: 600px) {
        .show-title {
          font-size: 16px;
        }
        .mixcloud-player {
          height: 150px;
        }
      }
      @media (max-width: 400px) {
        .mixcloud-player {
          height: 165px;
        }
      }
    </style>
  </div>
</div>

    </script>
    <style>
      .show-block {
        margin-bottom: 30px;
      }
      .show-title {
        font-size: 18px;
        margin-bottom: 8px;
        color: #fff;
        word-break: break-word;
        line-height: 1.2;
        font-weight: 500;
      }
      .mixcloud-player {
        width: 100%;
        min-width: 0;
        height: 120px;
        border: 0;
        display: block;
        border-radius: 8px;
        background: #222;
      }
      @media (max-width: 600px) {
        .show-title {
          font-size: 16px;
        }
        .mixcloud-player {
          height: 150px;
        }
      }
      @media (max-width: 400px) {
        .mixcloud-player {
          height: 165px;
        }
      }

/* === MOBILE WEATHER SUMMARY SIZE === */
@media (max-width: 500px) {
  #wxNow {
    font-size: 0.9em !important;   /* tweak value to taste */
    line-height: 1.25;
  }
}
@media (max-width: 768px) {
  .left-panel {
    width: 100% !important;
    padding-left: 4px !important;
    padding-right: 4px !important;
    box-sizing: border-box !important;
  }
  #player-box, #now-playing-card {
    width: 100% !important;
    max-width: 100% !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
    box-sizing: border-box !important;
  }
}

/* === MODALS DROP BELOW LOGO/BURGER (Desktop + Mobile) === */
.modal {
  display: none;
  position: fixed;
  z-index: 2000;
  left: 0;
  top: 5px;   /* Desktop: below logo/burger; adjust if your top area is taller/shorter */
  width: 100vw;
  height: calc(100vh - 5px); /* Prevents modal covering logo/burger */
  overflow: auto;
  background: rgba(0,0,0,0.78);
  transition: background 0.2s;
}

@media (max-width: 750px) {
  .modal {
    top: 56px;   /* Mobile: slightly less space */
    height: calc(100vh - 56px);
  }
  .modal-content {
    border-radius: 14px 14px 0 0 !important;
    margin-top: 0 !important;
  }
}

@media (max-width: 768px) {
  .modal {
    top: 0 !important;
    height: 100vh !important;
    min-height: 100vh !important;
    left: 0 !important;
    width: 100vw !important;
    overflow: hidden !important;
    background: rgba(0,0,0,0.78) !important;
  }
  .modal-content {
    margin: 0 !important;
    height: 100vh !important;
    max-height: 100vh !important;
    min-height: 100vh !important;
    width: 100vw !important;
    max-width: 100vw !important;
    padding-top: 46px !important;
    padding-bottom: 16px !important;
    border-radius: 0 !important;
    box-sizing: border-box !important;
    overflow-y: auto !important;
    overscroll-behavior: contain !important;
    background: #fff !important;
    font-size: 15px !important;
  }
}
  <!-- existing styles and scripts here … -->

  <!-- 👇 Paste the snippet right here, still inside <head> -->
  <style>
    /* Extra breathing room for every modal */
    .modal-content{
      margin:60px auto !important;   /* 60 px gap top & bottom, centred left/right */
      max-width:900px;               /* keep a sensible max width on big screens  */
    }
  </style>

</head>
<body>


    </style>
  </div>
</div>

 <div id="searchModal" class="modal">
  <div class="modal-content" style="max-width:950px;width:97vw;">
    <span class="close" onclick="closeModal('searchModal')">&times;</span>
    <div style="display:flex;align-items:center;gap:20px;margin-bottom:24px;">
      <h2 style="margin:0;color:#00818a;font-size:1.45em;">Song Search</h2>
    </div>
    <div style="background:#111;border:1px solid #333;border-radius:12px;padding:0 0 20px 0;box-shadow:0 0 20px rgba(0,0,0,0.23);margin-bottom:0; color:#eee;">
      <!-- Original intro wording -->
      <div class="content-card" style="background:#151921ea;border:1px solid #343648;border-radius:16px;padding:24px 18px 12px 18px;max-width:850px;margin:24px auto 16px auto;box-shadow:0 0 18px #0008;">
        <p style="font-size:17px;line-height:1.6;margin-bottom:0;">
          Trying to remember that amazing track we just played?<br>
          Use our Song Search to find recent songs and discover more about what’s been on Essential Radio.
        </p>
      </div>
      <!-- Playout Log Viewer Embed Starts -->
      <div class="container" style="background:#191b24f2;border-radius:18px;box-shadow:0 0 18px #0008;max-width:850px;margin:0 auto 36px auto;padding:20px 18px 32px 18px;">
        <div class="filters" style="margin-bottom:1.5rem;display:flex;flex-wrap:wrap;align-items:center;gap:0.7rem 1.2rem;">
          <label for="dateSelect">Date:</label>
          <select id="dateSelect"></select>
          <label for="hourSelect">Hour:</label>
          <select id="hourSelect"></select>
          <button id="prevHour">⭠ Previous Hour</button>
          <button id="nextHour">Next Hour ➡</button>
          <label for="searchInput">Filter:</label>
          <input type="text" id="searchInput" placeholder="Search by Artist or Title...">
          <button id="resetFilters">Reset</button>
        </div>
        <table style="width:100%;border-collapse:collapse;margin-top:0.7rem;background:transparent;color:#fff;font-size:17px;border-radius:8px;overflow:hidden;">
          <thead style="background:#fed351;color:#7e1974;font-size:17.5px;">
            <tr>
              <th>Time</th>
              <th>Artist – Title</th>
            </tr>
          </thead>
          <tbody id="logTableBody"></tbody>
        </table>
        <div id="noResultsMessage" class="no-results" style="display: none;text-align:center;font-style:italic;color:#fed351;padding:1.4rem 0 0.7rem 0;font-size:18px;letter-spacing:0.1px;">No tracks found for this time period.</div>
      </div>
      <!-- End Playout Log Viewer Embed -->
    </div>
    <div style="margin-top:18px;text-align:center;color:#888;font-size:14px;opacity:0.8;">
      Essential Radio &copy; 2025
    </div>
    <style>
      /* Extra modal-specific responsive tweaks for Song Search */
      @media (max-width: 950px) {
        #searchModal .content-card, #searchModal .container { max-width: 98vw; }
        #searchModal .content-card, #searchModal .container { padding: 2vw 3vw; }
      }
      @media (max-width: 700px) {
        #searchModal .content-card { padding: 13px 3vw 10px 3vw; font-size: 16px; }
        #searchModal .container { padding: 8px 1vw 10px 1vw; }
        #searchModal table, #searchModal th, #searchModal td { font-size: 15px; }
        #searchModal .filters { gap: 0.5rem 0.7rem; }
        #searchModal select, #searchModal input[type="text"], #searchModal button { font-size: 14px; }
      }
      @media (max-width: 540px) {
        #searchModal .content-card { padding: 7px 1vw 4px 1vw; }
        #searchModal .container { padding: 5px 0vw 5px 0vw; }
        #searchModal .filters { flex-direction: column; gap: 0.6rem 0; }
      }
    </style>
    <script>
      let fullData = [];
      const dateMap = new Map();
      let latestDate = null;
      let latestHour = null;

      function populateDropdowns(data) {
        dateMap.clear();
        latestDate = null;
        latestHour = null;
        let latestDateTime = new Date(0);
        const now = new Date();

        data.forEach(item => {
          const dt = new Date(item["Hour"]);
          const dtLocal = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate(), dt.getHours());
          const localDate = dt.toLocaleDateString("en-GB");
          const localHour = dt.getHours().toString().padStart(2, '0') + ":00";

          if (dtLocal <= now) {
            if (!dateMap.has(localDate)) dateMap.set(localDate, new Set());
            dateMap.get(localDate).add(localHour);

            if (dtLocal > latestDateTime) {
              latestDateTime = dtLocal;
              latestDate = localDate;
              latestHour = localHour;
            }
          }
        });

        const dateDropdown = document.getElementById("dateSelect");
        const dates = Array.from(dateMap.keys()).sort();
        dateDropdown.innerHTML = dates.map(d => `<option value="${d}">${d}</option>`).join('');
        dateDropdown.value = latestDate;
        updateHourDropdown(latestDate, latestHour);
      }

      function updateHourDropdown(selectedDate, selectedHour = null) {
        const hourDropdown = document.getElementById("hourSelect");
        const hours = Array.from(dateMap.get(selectedDate) || []).sort();
        hourDropdown.innerHTML = hours.map(h => `<option value="${h}">${h}</option>`).join('');
        hourDropdown.value = selectedHour || hours[hours.length - 1];
      }

      function renderTable(data) {
        const tbody = document.getElementById("logTableBody");
        const searchText = document.getElementById("searchInput").value.toLowerCase();
        const selectedDate = document.getElementById("dateSelect").value;
        const selectedHour = document.getElementById("hourSelect").value;
        const noResultsMessage = document.getElementById("noResultsMessage");
        tbody.innerHTML = "";
        const seen = new Set();

        const filtered = data.filter(item => {
          const dt = new Date(item["Hour"]);
          const localDate = dt.toLocaleDateString("en-GB");
          const localHour = dt.getHours().toString().padStart(2, '0') + ":00";
          const key = `${item["Artist"]} - ${item["Title"]}`;

          const durationMinutes = item["Duration (mins)"] || 0;
          const isMatch = localDate === selectedDate && localHour === selectedHour && key.toLowerCase().includes(searchText) && durationMinutes <= 10;

          if (isMatch && !seen.has(key)) {
            seen.add(key);
            return true;
          }
          return false;
        });

        if (filtered.length === 0) {
          noResultsMessage.style.display = "block";
        } else {
          noResultsMessage.style.display = "none";
          filtered.forEach(item => {
            const time = item["Displayed Time"] || item["Scheduled Time"]?.substring(0, 5) || "";
            const row = `<tr><td>${time}</td><td>${item["Artist"]} – ${item["Title"]}</td></tr>`;
            tbody.innerHTML += row;
          });
        }
      }

      document.getElementById("searchInput").addEventListener("input", () => renderTable(fullData));
      document.getElementById("dateSelect").addEventListener("change", () => {
        updateHourDropdown(document.getElementById("dateSelect").value);
        renderTable(fullData);
      });
      document.getElementById("hourSelect").addEventListener("change", () => renderTable(fullData));

      document.getElementById("prevHour").addEventListener("click", () => {
        const hourDropdown = document.getElementById("hourSelect");
        const options = Array.from(hourDropdown.options);
        const idx = options.findIndex(opt => opt.selected);
        if (idx > 0) {
          hourDropdown.selectedIndex = idx - 1;
          renderTable(fullData);
        }
      });

      document.getElementById("nextHour").addEventListener("click", () => {
        const hourDropdown = document.getElementById("hourSelect");
        const options = Array.from(hourDropdown.options);
        const idx = options.findIndex(opt => opt.selected);
        if (idx < options.length - 1) {
          hourDropdown.selectedIndex = idx + 1;
          renderTable(fullData);
        }
      });

      document.getElementById("resetFilters").addEventListener("click", () => {
        document.getElementById("searchInput").value = "";

        let latestDate = null;
        let latestHour = null;
        let latestDateTime = new Date(0);
        const now = new Date();

        fullData.forEach(item => {
          const dt = new Date(item["Hour"]);
          const dtLocal = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate(), dt.getHours());
          const localDate = dt.toLocaleDateString("en-GB");
          const localHour = dt.getHours().toString().padStart(2, '0') + ":00";

          if (dtLocal <= now && dtLocal > latestDateTime) {
            latestDateTime = dtLocal;
            latestDate = localDate;
            latestHour = localHour;
          }
        });

        if (latestDate && latestHour) {
          document.getElementById("dateSelect").value = latestDate;
          updateHourDropdown(latestDate, latestHour);
          renderTable(fullData);
        }
      });

      fetch("playout_log_rolling.json")
        .then(res => res.json())
        .then(data => {
          fullData = data;
          populateDropdowns(data);
          renderTable(data);
        });
    </script>
  </div>
</div>
<div id="requestsModal" class="modal">
  <div class="modal-content" style="max-width:700px;width:97vw;">
    <span class="close" onclick="closeModal('requestsModal')">&times;</span>
    <div style="display:flex;align-items:center;gap:20px;margin-bottom:24px;">
      <h2 style="margin:0;color:#00818a;font-size:1.5em;">Request a Song</h2>
    </div>
    <div style="background:#111;border:1px solid #333;border-radius:12px;padding:28px 18px 32px 18px;box-shadow:0 0 20px rgba(0,0,0,0.28);margin-bottom:0; color:#eee;">
      <p style="font-size:17px;line-height:1.6;margin-bottom:22px;">
        Got a favourite track or a shout-out for someone special?<br>
        Send us your song requests and messages – and we might play them live on air!<br>
        <span style="color:#aaa;font-size:15px;">
          (Note: Many of our shows are pre-recorded, so requests may not always be instant.)
        </span>
      </p>
      <div style="width:100%;min-height:340px;">
        <!-- Elfsight Contact Form | Request a song -->
        <script src="https://static.elfsight.com/platform/platform.js" async></script>
        <div class="elfsight-app-69585003-61ea-407e-a005-4861876e1a5b" data-elfsight-app-lazy></div>
      </div>
      <div id="thank-you-message" class="thank-you" style="font-size:18px;margin-top:18px;min-height:36px;"></div>
    </div>
    <div style="margin-top:18px;text-align:center;color:#888;font-size:14px;opacity:0.8;">
      Essential Radio &copy; 2025
    </div>
  </div>
</div>
  <div id="contactModal" class="modal">
  <div class="modal-content" style="max-width:620px;width:97vw;">
    <span class="close" onclick="closeModal('contactModal')">&times;</span>
    <div style="display:flex;align-items:center;gap:18px;margin-bottom:24px;">
      <h2 style="margin:0;color:#00818a;font-size:1.35em;">Contact</h2>
    </div>
    <div style="background:#111;border:1px solid #333;border-radius:12px;padding:24px 18px 18px 18px;box-shadow:0 0 20px rgba(0,0,0,0.23);margin-bottom:0; color:#eee;">
      <p style="font-size:17px;line-height:1.6;">
        We’d love to hear from you! Whether it’s feedback, a shout-out, or just to say hello, drop us a message and we’ll get back to you as soon as we can. Essential Radio – always here, always listening.
      </p>
      <div style="margin-top:22px;margin-bottom:22px;">
        <!-- Elfsight Contact Form | Contact Us -->
        <script src="https://static.elfsight.com/platform/platform.js" async></script>
        <div class="elfsight-app-974fdef7-6e84-49a1-8384-9604e1f7be5c" data-elfsight-app-lazy></div>
      </div>
      <div class="contact-details" style="margin-top:8px;">
        <p style="margin-bottom:12px;"><strong>Email:</strong>
          <a href="mailto:essentialradio@ayrshire.ac.uk" style="color:#00e0ff;text-decoration:none;font-weight:600;">essentialradio@ayrshire.ac.uk</a>
        </p>
        <p style="margin-bottom:8px;"><strong>Follow us:</strong> @ERadioAyrshire on</p>
        <ul style="list-style:none;padding-left:0;margin:0 0 0 6px;">
          <li style="margin-bottom:7px;font-size:17px;">🐦 <a href="https://x.com/eradioayrshire" target="_blank" style="color:#00e0ff;text-decoration:none;font-weight:600;">X</a></li>
          <li style="margin-bottom:7px;font-size:17px;">📸 <a href="https://instagram.com/eradioayrshire" target="_blank" style="color:#00e0ff;text-decoration:none;font-weight:600;">Instagram</a></li>
          <li style="margin-bottom:7px;font-size:17px;">☁️ <a href="https://bsky.app/profile/eradioayrshire" target="_blank" style="color:#00e0ff;text-decoration:none;font-weight:600;">Bluesky</a></li>
          <li style="margin-bottom:7px;font-size:17px;">📘 <a href="https://facebook.com/eradioayrshire" target="_blank" style="color:#00e0ff;text-decoration:none;font-weight:600;">Facebook</a></li>
        </ul>
      </div>
    </div>
    <div style="margin-top:16px;text-align:center;color:#888;font-size:14px;opacity:0.8;">
      Essential Radio &copy; 2025
    </div>
  </div>
</div>

<div id="newsModal" class="modal">
  <div class="modal-content" style="max-width:700px;width:97vw;">
    <span class="close" onclick="closeModal('newsModal')">&times;</span>
    <div style="display:flex;align-items:center;gap:18px;margin-bottom:24px;">
      <h2 style="margin:0;color:#00818a;font-size:1.3em;">News & Weather</h2>
    </div>
    <div style="background:#111;border:1px solid #333;border-radius:12px;padding:28px 18px 32px 18px;box-shadow:0 0 20px rgba(0,0,0,0.28);margin-bottom:0; color:#eee;">
      <h3 style="color:#00e0ff;margin-top:0;font-size:1.15em;">📰 Latest Headlines</h3>
      <!-- Elfsight RSS Feed | News Feed from RNH -->
      <script src="https://static.elfsight.com/platform/platform.js" async></script>
      <div class="elfsight-app-9b4542e0-7fb9-4bfb-a258-38a84ee937a7" data-elfsight-app-lazy></div>
    </div>
    <div style="margin-top:18px;text-align:center;color:#888;font-size:14px;opacity:0.8;">
      Essential Radio &copy; 2025
    </div>
  </div>
</div>
  <div id="travelModal" class="modal">
  <div class="modal-content" style="max-width:900px;width:97vw;">
    <span class="close" onclick="closeModal('travelModal')">&times;</span>
    <div style="display:flex;align-items:center;gap:18px;margin-bottom:20px;">
      <h2 style="margin:0;color:#00818a;font-size:1.3em;">Travel & Transport</h2>
    </div>
    <div style="background:#111;border:1px solid #333;border-radius:12px;padding:24px 18px 24px 18px;box-shadow:0 0 20px rgba(0,0,0,0.20);margin-bottom:0; color:#eee;">
      <p style="font-size:17px;line-height:1.65;margin-bottom:18px;">
        Stay up-to-date with live road, rail, and travel news across Ayrshire and the West of Scotland. This page brings you <b>real-time delays, incidents, roadworks and ScotRail disruption</b> - all updated automatically for Essential Radio listeners.<br>
        <span style="color:#fed351;">Tip:</span> Click or tap the sections below to browse maps, incidents and more.
      </p>
      <details style="margin-bottom:20px;">
        <summary style="font-size:18px;font-weight:600;color:#fed351;cursor:pointer;outline:none;">🗺️ Combined Travel Report (All Modes)</summary>
        <div style="margin:10px 0 0 0;">
          <iframe src="https://travel-ac.vercel.app/Current_Combined_Travel_Report.html" width="100%" height="650" style="border-radius:10px;border:none;box-shadow:0 2px 14px #0004;background:#fff;" title="Combined Travel Report" loading="lazy"></iframe>
        </div>
      </details>
      <details style="margin-bottom:20px;">
        <summary style="font-size:18px;font-weight:600;color:#fed351;cursor:pointer;outline:none;">🚦 Current Road Delays & Hotspots</summary>
        <div style="margin:10px 0 0 0;">
          <iframe src="https://travel-ac.vercel.app/Current_Hotspots_Traffic_Scotland.html" width="100%" height="420" style="border-radius:10px;border:none;box-shadow:0 2px 14px #0004;background:#fff;" title="Current Road Delays & Hotspots" loading="lazy"></iframe>
        </div>
      </details>
      <details style="margin-bottom:20px;">
        <summary style="font-size:18px;font-weight:600;color:#fed351;cursor:pointer;outline:none;">🚧 Current Roadworks & Closures</summary>
        <div style="margin:10px 0 0 0;">
          <iframe src="https://travel-ac.vercel.app/Current_Roadworks_Traffic_Scotland.html" width="100%" height="340" style="border-radius:10px;border:none;box-shadow:0 2px 14px #0004;background:#fff;" title="Current Roadworks" loading="lazy"></iframe>
        </div>
      </details>
      <details style="margin-bottom:20px;">
        <summary style="font-size:18px;font-weight:600;color:#fed351;cursor:pointer;outline:none;">🚨 Current Incidents & Queues</summary>
        <div style="margin:10px 0 0 0;">
          <iframe src="https://travel-ac.vercel.app/Current_Incidents_Traffic_Scotland.html" width="100%" height="340" style="border-radius:10px;border:none;box-shadow:0 2px 14px #0004;background:#fff;" title="Current Incidents" loading="lazy"></iframe>
        </div>
      </details>
      <details>
        <summary style="font-size:18px;font-weight:600;color:#fed351;cursor:pointer;outline:none;">🚆 ScotRail Live Service Updates</summary>
        <div style="margin:10px 0 0 0;">
          <iframe src="https://travel-ac.vercel.app/Scotrail_Incidents.html" width="100%" height="360" style="border-radius:10px;border:none;box-shadow:0 2px 14px #0004;background:#fff;" title="ScotRail Live Updates" loading="lazy"></iframe>
        </div>
      </details>
    </div>
    <div style="margin-top:18px;text-align:center;color:#888;font-size:14px;opacity:0.8;">
      Essential Radio &copy; 2025
    </div>
  </div>
</div>

 
  

  <!-- ======= SCRIPTS ======= -->
  <script>
    /* ===== UTIL ===== */
    const $ = (sel, ctx = document) => ctx.querySelector(sel);
    const $$ = (sel, ctx = document) => [...ctx.querySelectorAll(sel)];

    /* ===== NAV / BURGER ===== */
    const nav = $('nav.navbar');
    const burgerBtn = null; // burger hidden on desktop after streamlining
    const links = [
      ['About Us','aboutModal'],
      ['Schedule','scheduleModal'],
      ['Playlist','playlistModal'],
      ['Listen Again','listenModal'],
      ['Song Search','searchModal'],
      ['Requests','requestsModal'],
      ['Contact Us','contactModal'],
      ['News','newsModal'],
      ['Travel','travelModal']
    ];
    links.forEach(([label,id])=>{
      const a = document.createElement('a');
      a.textContent = label;
      a.href = '#';
      a.onclick = e => (e.preventDefault(), openModal(id));
      nav.appendChild(a);
    });

    /* ===== MODALS ===== */
    function openModal(id){ $('#'+id).style.display='block'; document.body.classList.add('modal-open'); }
    function closeModal(id){ $('#'+id).style.display='none'; document.body.classList.remove('modal-open'); }
    $$('.modal').forEach(m => m.addEventListener('click', e => { if(e.target===m) closeModal(m.id) }));

    /* ===== CLOCK ===== */
    const updateClock=()=>{
      const d=new Date();
      $('#clockTime').textContent=d.toLocaleTimeString('en-GB',{hour12:false});
      $('#clockDate').textContent=d.toLocaleDateString('en-GB',{weekday:'short',day:'numeric',month:'short'});
    };
    setInterval(updateClock,1000); updateClock();
    </script>
   

   <script>
    const audio = document.getElementById('stream');
    const playBtn = document.getElementById('play-toggle');
    const muteBtn = document.getElementById('mute-toggle');
    const volumeSlider = document.getElementById('volume-slider');
    if (window.innerWidth <= 768) {
      volumeSlider.disabled = true;
      muteBtn.disabled = true;
    }
    const volumeDisplay = document.getElementById('volume-display');
    const nowPlaying = document.getElementById('now-playing');
    const artworkImg = document.getElementById('artwork');
    const observer = new IntersectionObserver(entries => {
      for (const e of entries) {
        if (e.isIntersecting) {
          e.target.classList.add('loaded');
          observer.unobserve(e.target);
        }
      }
    }, { threshold: 0.1 });
    let isPlaying = false, lastVolume = 1;
    playBtn.addEventListener('click', () => {
      if (!isPlaying) {
        audio.load();
        audio.play().catch(() => {});
        playBtn.textContent = '⏸ Pause';
        isPlaying = true;
      } else {
        audio.pause();
        playBtn.textContent = '▶️ Play Essential Radio';
        isPlaying = false;
      }
    });
    volumeSlider.addEventListener('input', () => {
      const vol = volumeSlider.value / 100;
      audio.volume = vol;
      volumeDisplay.textContent = `${volumeSlider.value}%`;
      muteBtn.textContent = vol === 0 ? '🔇' : vol < 0.5 ? '🔈' : '🔊';
    });
    muteBtn.addEventListener('click', () => {
      if (!audio.muted) {
        audio.muted = true;
        muteBtn.textContent = '🔇';
        volumeDisplay.textContent = 'Muted';
      } else {
        audio.muted = false;
        muteBtn.textContent = audio.volume < 0.5 ? '🔈' : '🔊';
        volumeDisplay.textContent = `${volumeSlider.value}%`;
      }
    });
    async function fetchDurationAndStartTime(artist, title) {
      try {
        const logUrl = 'https://essentialradio.github.io/player/playout_log_rolling.json';
        const res = await fetch(`${logUrl}?_=${Date.now()}`, { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        const match = data.reverse().find(item =>
          item.Artist?.toLowerCase() === artist.toLowerCase() &&
          item.Title?.toLowerCase() === title.toLowerCase()
        );
        if (match && match["Scheduled Time"] && match["Duration (s)"] && match["Hour"]) {
          const hourDate = new Date(match["Hour"]);
          const [sh, sm] = match["Scheduled Time"].split(":").map(Number);
          const start = new Date(
            hourDate.getFullYear(),
            hourDate.getMonth(),
            hourDate.getDate(),
            sh,
            sm,
            0
          );
          return {
            duration: parseInt(match["Duration (s)"], 10),
            startTime: start
          };
        }
      } catch (e) {
        console.warn("Duration/start time fetch failed:", e);
      }
      return null;
    }
    function showMoreMusicSoon() {
      nowPlaying.innerHTML = `
        <span style="color:#fed351;">Now Playing:</span>
        <span class="live-indicator"><span class="dot"></span>LIVE</span><br/>
        <span style="color:white;font-weight:600;font-size:1.2em;">More music soon</span><br/>
        <span style="color:white;">on Essential Radio</span>`;
      document.title = `Essential Radio: More music soon`;
      applyFallbackImmediate();
    }
    let currentTrackID = null;
    let songHasEnded = false;
    let trackEndTimeout = null;
    async function fetchNowPlaying() {
      try {
        const res = await fetch('https://player-green.vercel.app/api/metadata', { cache: 'no-store' });
        const data = await res.json();
        const decode = str => {
          const t = document.createElement('textarea');
          t.innerHTML = str;
          return t.value;
        };
        const raw = decode(data.nowPlaying || '').trim();
        let artist = '', title = '';
        const sep = raw.includes(' – ') ? ' – ' : raw.includes(' - ') ? ' - ' : null;
        if (sep) {
          [artist, title] = raw.split(sep).map(s => s.trim());
        } else {
          showMoreMusicSoon();
          return;
        }
        currentTrackID = `${artist} – ${title}`;
        songHasEnded = false;
        nowPlaying.innerHTML = `
          <span style="color:#fed351;">Now Playing:</span>
          <span class="live-indicator"><span class="dot"></span>LIVE</span><br/>
          <span style="color:white;font-weight:600;font-size:1.2em;">${title}</span><br/>
          <span style="color:white;">by ${artist}</span>`;
        document.title = `Essential Radio: ${artist} – ${title}`;
        fetchArtwork(`${artist} - ${title}`);
        const latestRes = await fetch('https://essentialradio.github.io/player/latestTrack.json?_=' + Date.now());
        const latest = await latestRes.json();
        if (!latest || !latest.artist || !latest.title || !latest.duration || !latest.startTime) {
          console.warn("latestTrack.json missing fields");
          return;
        }
        if (
          latest.artist.toLowerCase() !== artist.toLowerCase() ||
          latest.title.toLowerCase() !== title.toLowerCase()
        ) {
          console.log("latestTrack.json does not match metadata track");
          return;
        }
        const startTime = new Date(latest.startTime);
        const durationMs = latest.duration * 1000;
        const endTime = new Date(startTime.getTime() + durationMs);
        const now = new Date();
        const timeRemaining = endTime - now;
        if (trackEndTimeout) clearTimeout(trackEndTimeout);
        if (timeRemaining <= 0) {
          showMoreMusicSoon();
          songHasEnded = true;
          currentTrackID = null;
        } else {
          trackEndTimeout = setTimeout(() => {
            showMoreMusicSoon();
            songHasEnded = true;
            currentTrackID = null;
          }, timeRemaining);
        }
      } catch (e) {
        console.error("Now playing error:", e);
        showMoreMusicSoon();
        currentTrackID = null;
        songHasEnded = false;
      }
    }
</script>

<script>
    async function fetchSchedule() {
      try {
        const res = await fetch("https://essentialradio.github.io/player/schedule.json");
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        return await res.json();
      } catch (e) {
        console.error("Schedule fetch error:", e);
        return null;
      }
    }
    function getCurrentShow(schedule) {
      const now = new Date();
      const day = now.toLocaleString("en-GB", { weekday: "long" });
      const shows = schedule && schedule[day];
      if (!shows) return "No schedule available";
      const nowMins = now.getHours() * 60 + now.getMinutes();
      for (const show of shows) {
        const [sh, sm] = show.start.split(":").map(Number);
        const [eh, em] = show.end.split(":").map(Number);
        let start = sh * 60 + sm;
        let end = eh * 60 + em;
        if (end === 0 && start > 0) end = 1440;
        if (nowMins >= start && nowMins < end) {
          return show.title;
        }
      }
      return "Off Air";
    }
    async function updateOnAirNow() {
      const schedule = await fetchSchedule();
      const fullShow = schedule ? getCurrentShow(schedule) : "Schedule unavailable";
      const el = document.getElementById("currentShow");
      if (fullShow.includes(" with ")) {
        const [title, presenter] = fullShow.split(" with ");
        el.innerHTML = `
          <span class="show-title">${title.trim()}</span>
          <span class="show-presenter">with ${presenter.trim()}</span>`;
      } else {
        el.textContent = fullShow;
      }
    }
    updateOnAirNow();
    setInterval(updateOnAirNow, 60_000);
 </script>

<script>
    async function fetchRecentFromGitHub() {
      try {
        const baseUrl = 'https://essentialradio.github.io/player/playout_log_rolling.json';
        const res = await fetch(`${baseUrl}?_=${Date.now()}`, { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        const recentItems = data
          .filter(item => {
            const name = `${item.Artist} – ${item.Title}`;
            return item.Artist && item.Title && (songHasEnded || name !== currentTrackID);
          })
          .slice(-5)
          .reverse();
        const entries = await Promise.all(recentItems.map(async item => {
          const time = item['Scheduled Time'] || item.time || '';
          const name = `${item.Artist} – ${item.Title}`;
          const art = await getTrackArtwork(name) || 'Essential Radio Logo.png';
          return `
            <li>
              <span class="time">${time}</span>
              <img src="${art}"
                   alt="Cover for ${name}"
                   loading="lazy" />
              <span class="info">${name}</span>
            </li>`;
        }));
        const list = document.getElementById('recent-list');
        list.innerHTML = entries.join('');
        document.querySelectorAll('#recent-list img').forEach(img => observer.observe(img));
      } catch (e) {
        console.error('Recent fetch failed:', e);
      }
    }
    async function fetchArtwork(trackName) {
      artworkImg.src = 'Essential Radio Logo.png';
      artworkImg.classList.remove('loaded', 'fallback');
      try {
        const res = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(trackName)}&limit=1`);
        const js = await res.json();
        if (js.results[0]?.artworkUrl100) {
          const url = js.results[0].artworkUrl100.replace('100x100', '300x300');
          artworkImg.onload = () => artworkImg.classList.add('loaded');
          artworkImg.onerror = applyFallbackImmediate;
          artworkCache[trackName] = url;
          artworkImg.src = url;
          return;
        }
      } catch {}
      const safe = trackName
        .replace(/\s*\(.*?\)/g, '')
        .replace(/[^a-zA-Z0-9\s-]/g, '')
        .trim()
        .replace(/\s+/g, '_');
      const [artist, title] = safe.split('_-_');
      const autoUrl = `https://cdn.autopo.st/images/coverart/${artist?.[0]?.toLowerCase()||'a'}/${artist}_${title}.jpg`;
      try {
        const head = await fetch(autoUrl, { method: 'HEAD' });
        if (head.ok) {
          artworkImg.onload = () => artworkImg.classList.add('loaded');
          artworkImg.onerror = applyFallbackImmediate;
          artworkImg.src = autoUrl;
          return;
        }
      } catch {}
      applyFallbackImmediate();
    }
    function applyFallbackImmediate() {
      artworkImg.src = 'Essential Radio Logo.png';
      artworkImg.classList.remove('loaded');
      artworkImg.classList.add('fallback');
    }
    const artworkCache = {};
    async function getTrackArtwork(query) {
      if (artworkCache[query]) return artworkCache[query];
      try {
        const res = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(query)}&limit=1`);
        const d = await res.json();
        if (d.results[0]?.artworkUrl100) {
          return d.results[0].artworkUrl100.replace('100x100', '300x300');
        }
      } catch {}
      return '';
    }
    fetchNowPlaying();
    fetchRecentFromGitHub();
    setInterval(fetchNowPlaying, 15000);
    setInterval(fetchRecentFromGitHub, 15000);
  </script>

</body>
</html>
