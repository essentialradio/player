
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Essential Radio - Playlist</title>
  <meta name="description" content="Essential Radio A/B/C lists">
  <meta name="theme-color" content="#00818a">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand:#fed351; --accent:#00818a; --up:#00a56a; --down:#b53c00; --new:#7e1974;
      --bg1:#ffffff; --bg2:#f7fafc; --text:#0b1220; --muted:#6a778a;
      --panel:#ffffff; --panel-2:#f4f7fb; --border:#e6ecf3;
    }
    @media(prefers-color-scheme: dark){
      :root{--bg1:#0e1116;--bg2:#0b0e12;--text:#f7f8fb;--muted:#c8d1dc;--panel:#101215;--panel-2:#171a1f;--border:#262b33}
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--text);
      background:linear-gradient(135deg,var(--bg1),var(--bg2)) fixed}
    .page{max-width:900px;margin:0 auto;padding:20px 14px 40px}
    header.hero{display:flex;align-items:center;gap:12px;margin:4px 0 12px}
    .logo{width:44px;height:44px;border-radius:10px;background:var(--panel-2);display:flex;align-items:center;justify-content:center;
      border:1px solid var(--border);font-weight:800;color:var(--accent)}
    h1{font-size:1.5rem;line-height:1.15;margin:0}
    .sub{color:var(--muted);margin-top:2px;font-size:.95rem}

    .toolbar{display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:space-between;background:var(--panel);
      border:1px solid var(--border);border-radius:12px;padding:8px 10px;margin:8px 0 12px;box-shadow:0 4px 12px rgba(0,0,0,.06)}
    .search{display:flex;align-items:center;gap:8px;flex:1 1 260px;background:var(--panel-2);border:1px solid var(--border);
      padding:6px 8px;border-radius:10px}
    .search input{background:transparent;border:0;outline:0;color:var(--text);width:100%;font-size:.96rem}
    .btn{appearance:none;border:1px solid rgba(0,0,0,.06);background:var(--brand);color:#111;font-weight:700;padding:8px 10px;border-radius:9px;cursor:pointer}
    .btn.secondary{background:var(--accent);color:#fff}
    .tabs{display:flex;gap:6px;flex-wrap:wrap;margin:6px 0 0}
    .tab{background:var(--panel);border:1px solid var(--border);color:var(--text);padding:6px 10px;border-radius:9px;cursor:pointer;font-weight:700;font-size:.95rem}
    .tab[aria-selected="true"]{background:var(--accent);color:#fff}
    .helper{color:var(--muted);font-size:.9rem}

    .panel{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:12px 12px}
    .panel h2{margin:0 0 4px;color:var(--accent);font-size:1.05rem}
    .meta{color:var(--muted);font-size:.88rem;margin-bottom:6px}
    .state{padding:10px;border:1px dashed var(--border);border-radius:9px;color:var(--muted);text-align:center}

    /* List style: one line per track */
    .list{list-style:none;margin:0;padding:0}
    .row{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:8px 10px;border:1px solid var(--border);
      border-radius:10px;background:var(--panel-2);margin-bottom:6px}
    .main{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .title{font-weight:700}
    .artist{color:var(--muted)}
    .right{display:flex;gap:6px;flex-wrap:wrap}
    .tag{background:var(--brand);color:#111;border:1px solid rgba(0,0,0,.08);padding:2px 8px;border-radius:999px;font-weight:700;font-size:.72rem}
    .tag-new{background:var(--new);color:#fff}
    .tag-up{background:var(--up);color:#fff}
    .tag-down{background:var(--down);color:#fff}
    .note{color:var(--muted);font-size:.85rem;margin-top:4px}

    footer{margin-top:18px;color:var(--muted);font-size:.9rem;text-align:center}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,Monaco,monospace;background:var(--panel-2);border:1px solid var(--border);color:var(--text);
      padding:1px 6px;border-radius:6px;font-size:.84rem}
  </style>
</head>
<body>
  <div class="page">
    <header class="hero">
      <div class="logo">ER</div>
      <div>
        <h1>Essential Radio Playlist</h1>
        <div class="sub">A, B and C Lists</div>
      </div>
    </header>

    <section class="toolbar">
      <div class="search" role="search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
        <input id="q" type="search" placeholder="Search artist or title">
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn" id="copyBtn">Copy visible</button>
        <button class="btn secondary" id="refreshBtn">Refresh</button>
      </div>
      <div class="helper">Tabs: <span class="kbd">#A</span> <span class="kbd">#B</span> <span class="kbd">#C</span></div>
      <nav class="tabs" role="tablist" aria-label="Playlist tabs">
        <button class="tab" role="tab" data-tab="A" aria-selected="true">A-List</button>
        <button class="tab" role="tab" data-tab="B" aria-selected="false">B-List</button>
        <button class="tab" role="tab" data-tab="C" aria-selected="false">C-List</button>
      </nav>
    </section>

    <section class="panel">
      <h2 id="panelTitle">A-List</h2>
      <div class="meta" id="panelMeta"></div>
      <div class="state" id="state">Loading playlist…</div>
      <ul class="list" id="list" hidden></ul>
    </section>

    <footer>Essential Radio • essential.radio/playlist</footer>
  </div>

<script>
(function(){
  const PLAYLIST_URL = 'playlist.txt';
  const CACHE_BUSTER = () => 't=' + Math.floor(Date.now()/60000);

  const $ = (sel) => document.querySelector(sel);
  const $$ = (sel) => Array.from(document.querySelectorAll(sel));

  const list = $('#list');
  const state = $('#state');
  const panelTitle = $('#panelTitle');
  const panelMeta = $('#panelMeta');
  const search = $('#q');

  let playlist = null;
  let activeTab = 'A';

  function pickHash(){
    const h = (location.hash||'').replace('#','').toUpperCase();
    return ['A','B','C'].includes(h) ? h : 'A';
  }

  function extractMarkersAndClean(str){
    const markers = [];
    let s = (str||'').trim();
    const rx = /^\*(\w{2,10})\*\s*/i;
    while(true){
      const m = s.match(rx);
      if(!m) break;
      const word = m[1].toUpperCase();
      if(['NEW','UP','DOWN'].includes(word)) markers.push(word);
      s = s.slice(m[0].length);
    }
    return {clean: s, markers};
  }

  function parsePlaylistTxt(txt){
    const lines = (txt||'').replace(/\uFEFF/g,'').split(/\r?\n/);
    let current = null;
    const out = {A:[],B:[],C:[]};
    let seen = false;
    for(const raw of lines){
      const l = (raw||'').trim();
      if(!l || l.startsWith('#') || l.startsWith('//') || l.startsWith(';')) continue;
      const sec = l.match(/^(A\s*-\s*List|B\s*-\s*List|C\s*-\s*List)$/i) || l.match(/^\[(A|B|C)\]$/i);
      if(sec){
        current = (sec[1] ? sec[1][0] : l[1]).toUpperCase();
        seen = true;
        continue;
      }
      if(!current) continue;
      const {clean, markers} = extractMarkersAndClean(l);
      const parts = clean.split('|').map(s => s.trim());
      const first = parts[0]||'';
      let artist='', title='';
      const dash = first.split(/\s[-–—]\s/);
      if(dash.length >= 2){ artist = dash[0]; title = dash.slice(1).join(' - '); }
      else {
        const comma = first.split(',');
        if(comma.length>=2){ artist = comma[0]; title = comma.slice(1).join(','); }
        else { title = first; }
      }
      const year = parts[1]||'';
      const notes = parts[2]||'';
      if(!artist && !title) continue;
      out[current].push({
        artist: artist.trim(),
        title: title.trim(),
        year: year.trim(),
        notes: notes.trim(),
        tags: markers.map(m => ({k:m}))
      });
    }
    return seen ? out : null;
  }

  function render(){
    const q = (search.value||'').trim().toLowerCase();
    const listData = (playlist?.[activeTab] || [])
      .filter(t => !q || (t.artist + ' ' + t.title + ' ' + (t.notes||'')).toLowerCase().includes(q));

    panelTitle.textContent = activeTab + '-List';
    panelMeta.textContent = listData.length ? (listData.length + ' tracks') : '';
    list.innerHTML = '';

    if(listData.length === 0){
      list.hidden = true;
      state.textContent = q ? 'No results for your search.' : 'No tracks found in this list.';
      state.hidden = false;
      return;
    }
    state.hidden = true;
    list.hidden = false;

    const frag = document.createDocumentFragment();
    for(const t of listData){
      const li = document.createElement('li');
      li.className = 'row';

      const left = document.createElement('div');
      left.className = 'main';
      const title = document.createElement('span');
      title.className = 'title';
      title.textContent = t.title;
      const sep = document.createElement('span');
      sep.textContent = ' - ';
      const artist = document.createElement('span');
      artist.className = 'artist';
      artist.textContent = t.artist;

      left.appendChild(title);
      left.appendChild(sep);
      left.appendChild(artist);

      const right = document.createElement('div');
      right.className = 'right';

      const markers = (t.tags||[]).map(x => x.k).filter(Boolean);
      for(const m of markers){
        const s = document.createElement('span');
        s.className = 'tag ' + (m==='NEW' ? 'tag-new' : m==='UP' ? 'tag-up' : m==='DOWN' ? 'tag-down' : '');
        s.textContent = m;
        right.appendChild(s);
      }
      if(t.year){
        const y = document.createElement('span');
        y.className = 'tag';
        y.textContent = t.year;
        right.appendChild(y);
      }

      li.appendChild(left);
      li.appendChild(right);

      if(t.notes){
        const note = document.createElement('div');
        note.className = 'note';
        note.textContent = t.notes;
        li.appendChild(note);
      }

      frag.appendChild(li);
    }
    list.appendChild(frag);
  }

  function switchTab(tab, pushHash=true){
    activeTab = tab;
    $$('.tab').forEach(b => b.setAttribute('aria-selected', String(b.dataset.tab===tab)));
    if(pushHash) location.hash = tab;
    render();
  }

  function copyVisible(){
    const q = (search.value||'').trim().toLowerCase();
    const arr = (playlist?.[activeTab] || [])
      .filter(t => !q || (t.artist + ' ' + t.title + ' ' + (t.notes||'')).toLowerCase().includes(q));
    const lines = [activeTab + '-List (' + arr.length + ')','']
      .concat(arr.map(t => {
        const markers = (t.tags||[]).map(x => x.k).filter(Boolean);
        const prefix = markers.length ? ('*' + markers.join('*') + '* ') : '';
        return '- ' + prefix + t.artist + ' - ' + t.title;
      }));
    navigator.clipboard.writeText(lines.join('\n')).catch(()=>{});
  }

  // Events
  $$('.tab').forEach(b => b.addEventListener('click', () => switchTab(b.dataset.tab)));
  $('#copyBtn').addEventListener('click', copyVisible);
  $('#refreshBtn').addEventListener('click', init);
  search.addEventListener('input', render);
  window.addEventListener('hashchange', () => switchTab(pickHash(), false));

  async function init(){
    state.hidden = false; list.hidden = true; state.textContent = 'Loading playlist…';
    try{
      const url = PLAYLIST_URL + '?' + CACHE_BUSTER();
      const res = await fetch(url, {cache:'no-store'});
      if(!res.ok) throw new Error('HTTP ' + res.status);
      const txt = await res.text();
      const parsed = parsePlaylistTxt(txt);
      if(!parsed) throw new Error('Could not parse playlist.txt');
      playlist = parsed;
    }catch(e){
      playlist = {A:[],B:[],C:[]};
      state.textContent = 'Could not load playlist (' + e.message + ')';
    }
    switchTab(pickHash(), false);
  }

  init();
})();
</script>
</body>
</html>
