<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>College Info</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="/manifest.json" rel="manifest"/>
  <link href="/icon-180-yellow.png" rel="apple-touch-icon"/>
  <style>
  /* Site theme variables (copied from player for standalone use) */
  :root {
    /* Core brand */
    --brand: #fed351;     /* Essential yellow */
    --accent: #00818a;    /* Teal accent */
    --danger: #e0322f;

    /* Dark (default) */
    --bg-grad-1: #00818a;
    --bg-grad-2: #7e1974;
    --text: #f7f8fb;
    --panel: #101215;
    --panel-2: #171a1f;
    --border: #272c33;
    --muted: #c8d1dc;
  }

  /* Page scaffolding — uses variables but does not redefine them */
  *{{box-sizing:border-box}}
  html, body{{height:100%}}
  body{{
    margin:0;
    font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, "Apple Color Emoji","Segoe UI Emoji";
    background:
      radial-gradient(1200px 600px at 80% -10%, rgba(0,161,170,0.15), transparent 60%),
      linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0));
    background-color: var(--panel);
    color: var(--text);
  }}
  .wrap{{min-height:100dvh; max-width: 1200px; margin: 0 auto; padding: clamp(12px, 2vw, 28px); display:flex; flex-direction:column; gap:10px;}}
  header.top{{display:flex; align-items:center; justify-content:space-between; gap:12px;}}
  h1{{margin:0; color: var(--accent); font-size: clamp(20px, 2.8vw, 32px); letter-spacing:.2px;}}
  a.navlink{{ color: var(--text); text-decoration:none; border:1px solid var(--border); padding:6px 10px; border-radius:10px; opacity:.9; }}
  a.navlink:hover{{ opacity:1; background: rgba(255,255,255,0.06); }}

  .college-toolbar{{ display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center; padding: 8px 0 12px; border-bottom:1px solid var(--border); margin-bottom:10px; }}
  .segmented{{ background: rgba(255,255,255,0.06); border: 1px solid var(--border); padding:4px; border-radius:12px; display:inline-flex; gap:4px; }}
  .segmented .seg{{ background:transparent; color: var(--text); border:0; border-radius:10px; padding:8px 12px; cursor:pointer; font-weight:700; opacity:0.85; }}
  .segmented .seg.active{{ background: linear-gradient(180deg, rgba(0,160,170,0.25), rgba(0,160,170,0.18)); border:1px solid rgba(0,160,170,0.45); opacity:1; }}

  label.sr-only{{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}}
  #collegeSelect{{ appearance:none; border-radius:10px; border:1px solid var(--border); background: rgba(255,255,255,0.05); color: var(--text); padding:10px 12px; min-width:min(64vw, 520px); outline:none; }}

  main#collegePage{{ flex:1; min-height:0; display:flex; flex-direction:column; }}
  .college-detail{{ flex:1; min-height:0; overflow:auto; padding: 12px 2px 16px; display:flex; flex-direction:column; gap:12px; }}
  .placeholder{{ color: rgba(233,241,243,0.7); font-style: italic; }}

  .detail-head{{display:flex; flex-wrap:wrap; gap:12px; align-items:baseline;}}
  .detail-title{{font-size: clamp(18px, 2.4vw, 28px); margin:0; color: var(--text);}}
  .date-pill{{display:inline-flex; gap:8px; align-items:center; padding:6px 10px; border-radius:999px; font-weight:800; letter-spacing:.3px; border:1px solid rgba(0,160,170,0.45); background:linear-gradient(180deg, rgba(0,160,170,0.25), rgba(0,160,170,0.18));}}
  .badge{{ display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; font-weight:800; letter-spacing:.3px; border:1px solid transparent; }}
  .badge.internal{{ background: rgba(89,210,255,0.18); border-color: rgba(89,210,255,0.35); color:#bfefff; }}
  .badge.external{{ background: rgba(255,209,102,0.20); border-color: rgba(255,209,102,0.45); color:#ffe6a6; }}

  .detail-body p{{ margin:0 0 10px 0; white-space:pre-wrap; }}
  footer{{ opacity:.7; font-size:12px; padding-top:8px; border-top:1px solid var(--border); }}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="top">
      <h1>College Info</h1>
      <a class="navlink" href="/" aria-label="Back to site">← Back</a>
    </header>

    <div class="college-toolbar">
      <div class="segmented" role="tablist" aria-label="Filter section">
        <button type="button" class="seg active" data-filter="ALL" aria-selected="true">All</button>
        <button type="button" class="seg" data-filter="INTERNAL" aria-selected="false">Internal</button>
        <button type="button" class="seg" data-filter="EXTERNAL" aria-selected="false">External</button>
      </div>
      <div class="toolbar-right">
        <label for="collegeSelect" class="sr-only">Choose item</label>
        <select id="collegeSelect" aria-label="Choose item"></select>
      </div>
    </div>

    <main id="collegePage">
      <article id="collegeDetail" class="college-detail" aria-live="polite">
        <div class="placeholder">Choose an item from the dropdown to view full details.</div>
      </article>
    </main>

    <footer>
      Reads from <code>reads.txt</code> in this folder. You can change the path inside the script if you store it elsewhere.
    </footer>
  </div>

  <script>
    (function(){
      const MASTER_URL = 'reads.txt'; // adjust if needed
      const selectEl = document.getElementById('collegeSelect');
      const detailEl = document.getElementById('collegeDetail');
      const segs = document.querySelectorAll('.segmented .seg');

      function escapeHtml(s){return String(s).replace(/[&<>\"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',"'":'&#39;'}[c]));}

      function parseMaster(text){
        const lines = text.split(/\r?\n/);
        let section = 'INTERNAL';
        const items = [];
        let i = 0;
        const reSection = /^\s*\[(internal|external)\]\s*$/i;
        const reFromTo = /^\s*From\s*-\s*(\d{1,2}\/\d{1,2}\/\d{2,4})\s*To\s*-\s*(\d{1,2}\/\d{1,2}\/\d{2,4})\s*$/i;

        function consumeUntilNonBlank(){ while(i < lines.length && /^\s*$/.test(lines[i])) i++; }

        while(i < lines.length){
          while(i < lines.length && reSection.test(lines[i])){ section = lines[i].match(reSection)[1].toUpperCase(); i++; }
          consumeUntilNonBlank(); if (i >= lines.length) break;
          const mFT = lines[i].match(reFromTo);
          if (!mFT){ i++; continue; }
          const from = mFT[1]; const to = mFT[2]; i++;
          consumeUntilNonBlank();
          const title = (lines[i] || '').trim(); i++;
          const bodyLines = [];
          while(i < lines.length && !/^\s*$/.test(lines[i]) && !reFromTo.test(lines[i]) && !reSection.test(lines[i])){ bodyLines.push(lines[i]); i++; }
          items.push({ section, from, to, title, body: bodyLines.join('\n').trim() });
          while(i < lines.length && /^\s*$/.test(lines[i])) i++;
        }
        return items;
      }

      function fmtRange(it){ return `${it.from} – ${it.to}`; }

      let ALL_ITEMS = [];
      function populateSelect(mode){
        const filtered = ALL_ITEMS.filter(it => mode === 'ALL' || it.section === mode);
        const groups = { INTERNAL: [], EXTERNAL: [] };
        filtered.forEach(it => groups[it.section||'INTERNAL'].push(it));

        function optionHTML(it, idx){
          const label = `${fmtRange(it)} · ${it.title}`;
          return `<option value="${idx}">${escapeHtml(label)}</option>`;
        }

        let html = '<option value="" selected disabled>Choose an item…</option>';
        if (mode === 'ALL'){
          if (groups.INTERNAL.length){ html += `<optgroup label="Internal">` + groups.INTERNAL.map(it=>optionHTML(it, it._i)).join('') + `</optgroup>`; }
          if (groups.EXTERNAL.length){ html += `<optgroup label="External">` + groups.EXTERNAL.map(it=>optionHTML(it, it._i)).join('') + `</optgroup>`; }
        } else {
          html += filtered.map(it => optionHTML(it, it._i)).join('');
        }
        selectEl.innerHTML = html;
      }

      function renderDetail(it){
        if (!it){
          detailEl.innerHTML = '<div class="placeholder">Choose an item from the dropdown to view full details.</div>';
          return;
        }
        const sectBadge = `<span class="badge ${it.section==='INTERNAL'?'internal':'external'}">${it.section.toLowerCase()}</span>`;
        detailEl.innerHTML = `
          <div class="detail-head">
            <h2 class="detail-title">${escapeHtml(it.title)}</h2>
            <span class="date-pill">${escapeHtml(fmtRange(it))}</span>
            ${sectBadge}
          </div>
          <div class="detail-body">
            ${it.body ? it.body.split(/\n/).map(p => `<p>${escapeHtml(p)}</p>`).join('') : '<p class="placeholder">No extra details.</p>'}
          </div>
        `;
        detailEl.scrollTop = 0;
      }

      function applyMode(mode){
        populateSelect(mode);
        renderDetail(null);
      }

      function initControls(){
        segs.forEach(btn => btn.addEventListener('click', ()=>{
          segs.forEach(b => { b.classList.toggle('active', b===btn); b.setAttribute('aria-selected', b===btn ? 'true':'false'); });
          const mode = (btn.dataset.filter || 'ALL').toUpperCase();
          applyMode(mode);
          const url = new URL(location.href);
          url.searchParams.set('mode', mode);
          history.replaceState(null, '', url.toString());
        }));
        selectEl.addEventListener('change', () => {
          const idx = selectEl.value ? parseInt(selectEl.value,10) : NaN;
          const item = Number.isInteger(idx) ? ALL_ITEMS.find(x => x._i === idx) : null;
          renderDetail(item || null);
          const url = new URL(location.href);
          if (Number.isInteger(idx)) url.searchParams.set('pick', String(idx));
          history.replaceState(null, '', url.toString());
        });
      }

      function initFromURL(){
        const url = new URL(location.href);
        const mode = (url.searchParams.get('mode') || 'ALL').toUpperCase();
        const pick = parseInt(url.searchParams.get('pick') || '', 10);
        const segsArr = Array.from(segs);
        const target = segsArr.find(b => (b.dataset.filter || '') === mode) || segsArr[0];
        segsArr.forEach(b => { const on = (b === target); b.classList.toggle('active', on); b.setAttribute('aria-selected', on ? 'true':'false'); });
        applyMode(target.dataset.filter || 'ALL');
        return Number.isInteger(pick) ? pick : null;
      }

      function refreshCollege(){
        const url = MASTER_URL + (MASTER_URL.includes('?') ? '&' : '?') + 'v=' + Date.now();
        return fetch(url)
          .then(r => { if(!r.ok) throw new Error('HTTP ' + r.status); return r.text(); })
          .then(txt => {
            const items = parseMaster(txt);
            items.forEach((it, i)=> it._i = i);
            ALL_ITEMS = items;
          });
      }

      document.addEventListener('DOMContentLoaded', async () => {
        initControls();
        const wantPick = initFromURL();
        try{
          await refreshCollege();
          const active = document.querySelector('.segmented .seg.active');
          applyMode((active?.dataset.filter || 'ALL').toUpperCase());
          if (wantPick !== null){
            const opt = Array.from(selectEl.options).find(o => o.value === String(wantPick));
            if (opt){ selectEl.value = String(wantPick); selectEl.dispatchEvent(new Event('change')); }
          }
        }catch(e){
          detailEl.innerHTML = '<p style="color:#ff7d7d">Could not load reads.txt (' + (e && e.message ? e.message : e) + ')</p>';
        }
      });
    })();
  </script>
</body>
</html>
