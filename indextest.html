<!DOCTYPE html><html data-theme="light" lang="en"><head><meta charset="utf-8"/><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Essential Radio</title><meta name="description" content="Listen live to Essential Radio — the feelgood sound of Ayrshire College. Live player, now playing, schedule, and ways to listen."><meta property="og:type" content="website"><meta property="og:title" content="Essential Radio Player"><meta property="og:description" content="Stream Essential Radio live. See what's playing now and explore the schedule."><meta property="og:image" content="/assets/share/essential-radio-card.jpg"><meta property="og:url" content="https://essential.radio/player"><meta name="twitter:card" content="summary_large_image"><meta name="theme-color" content="#00818a"><meta content="strict-origin-when-cross-origin" name="referrer"/><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet"/><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><style>
    /* --- NAVBAR & MODALS ONLY --- */
    @media (max-width: 750px) {
  .navbar { display: none !important; }
  #burgerMenuBtn { display: block !important; }
}
@media (min-width: 751px) {
  #burgerMenuBtn, #burgerDropdown { display: none !important; }
}
.menu-link {
  display: block;
  background: #fed351;   /* <-- This line adds the yellow background */
  color: #191c29;
  font-size: 1.07em;
  font-weight: 600;
  border-radius: 8px;
  padding: 10px 0;
  text-align: center;
  text-decoration: none;
  margin-bottom: 0;
  box-shadow: 0 2px 10px #0001;
  transition: background 0.2s, color 0.2s;
}
.menu-link:active,
.menu-link:hover {
  background: #ffe67c;
  color: #191c29;
}

.navbar {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      background: #222;
      z-index: 1001;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      padding: 9px 0 8px 0;
      box-shadow: 0 2px 12px #111a;
    }
    .navbar a {
      color: #222;
      background: #fed351;
      padding: 8px 18px;
      border-radius: 16px;
      font-weight: bold;
      text-decoration: none;
      font-size: 16px;
      margin: 0 2px;
      transition: background 0.2s, color 0.2s;
      border: none;
      cursor: pointer;
      outline: none;
      display: inline-block;
    }
    .navbar a:hover, .navbar a:focus {
      background: #00818a;
      color: #fff;
    }
    @media (max-width: 750px) {
      .navbar {
        flex-direction: column;
        gap: 2px;
        padding: 5px 0 5px 0;
      }
      .navbar a {
        margin: 2px 0;
        font-size: 15px;
        padding: 8px 12px;
        border-radius: 10px;
      }
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0; top: 0;
      width: 100vw; height: 100vh;
      overflow: auto;
      background: rgba(0,0,0,0.78);
      transition: background 0.2s;
    }
    .modal-content {
      background: #fff;
      color: #222;
      margin: 8% auto;
      padding: 30px 20px 20px 20px;
      border-radius: 16px;
      width: 94vw;
      max-width: 920px;
      min-height: 80px;
      box-shadow: 0 0 34px #00818a99;
      position: relative;
      text-align: left;
      animation: modalpop 0.2s;
    }
    @keyframes modalpop {
      0% { transform: scale(0.85); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    .close {
      position: absolute;
      right: 16px; top: 14px;
      font-size: 32px;
      font-weight: bold;
      color: #00818a;
      cursor: pointer;
      transition: color 0.2s;
    }
    .close:hover { color: #ff4d4d; }
    .modal-content h2 {
      margin-top: 0;
      color: #00818a;
      font-size: 1.25em;
      margin-bottom: 6px;
    }
    .modal-content p {
      margin: 0 0 5px 0;
    }
    /* --- END NAVBAR & MODALS ONLY --- */

    /* --- PLAYER AND PANEL STYLES --- */

#liveClock {
  background: #151516;
  border: 2px solid #500;
  border-radius: 14px;
  padding: 8px 16px;
  margin: 0 auto 14px auto;
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: 'Consolas', 'Courier New', monospace;
  white-space: nowrap;
  overflow: hidden;
  box-shadow: 0 1px 10px #111a;
  max-width: 95vw;
  text-align: center;
}

#clockCombined {
  display: inline-flex;
  flex-direction: row;
  align-items: center;
  gap: 16px;
  line-height: 1.2;
  word-spacing: 0.1em;
}

#clockTime {
  color: #e53935;
  font-size: 1.4em;
  font-weight: 700;
  letter-spacing: 0.04em;
}

#clockDate {
  font-size: 1.05em;
  color: #fed351;
  font-family: 'Montserrat', sans-serif;
  text-shadow: 0 1px 2px #111;
}

/* ✅ MOBILE TWEAKS */
@media (max-width: 480px) {
  #clockTime {
    font-size: 1.2em;
  }

  #clockDate {
    font-size: 0.95em;
  }

  #clockCombined {
    gap: 10px;
  }

  #liveClock {
    padding: 6px 12px;
  }
}
body {
  font-family: 'Inter', sans-serif;
  margin: 0;
  padding: 0;
  background: linear-gradient(135deg, #00818a, #7e1974);
  color: white;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  /* display: flex; justify-content: center;  <== REMOVE THIS LINE */
}
.header-spacer {
  height: 92px;
}
@media (max-width: 750px) {
  .header-spacer { height: 8px; }
}

    @media (max-width: 750px) {
      body {
        padding: 0 !important;
      }
    }
    .strip-container {
      display: flex;
      flex-direction: row;
      width: 100%;
      max-width: 1100px;
      min-height: 280px;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 0 25px rgba(0, 0, 0, 0.5);
      background-color: #111;
      position: relative;
      z-index: 1;
    }
    .left-panel, .right-panel {
      width: 50%;
      padding: 20px 30px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .left-panel {
      background: #111;
      align-items: center;
      text-align: center;
      border-right: 1px solid #333;
      justify-content: flex-start;
      padding-top: 30px;
    }
    .right-panel {
  background: #222;
  border-left: 1px solid #333;
}

/* And let wheel / swipe bubble out when you hit the end */
.right-panel { overscroll-behavior: contain; }
    #player-box {
      max-width: 420px;
      width: 100%;
    }
    button {
      background-color: #fed351;
      color: #111;
      border-radius: 8px;
      padding: 12px 24px;
      font-weight: 600;
      font-size: 18px;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      user-select: none;
    }
    button:hover,
    button:focus {
      background-color: #e5c73f;
      box-shadow: 0 0 10px #fed351cc;
      outline: none;
    }
    #mute-toggle {
      font-size: 16px;
      padding: 6px 12px;
      vertical-align: middle;
      margin-left: 10px;
    }
    #volume-container {
      margin-top: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    #volume-container label {
      font-size: 16px;
      margin: 0;
      user-select: none;
    }
    #volume-slider {
      width: 180px;
      cursor: pointer;
    }
    #volume-display {
      font-size: 16px;
      color: #ccc;
      min-width: 40px;
      text-align: left;
      user-select: none;
    }
    #onAirNow {
      margin-top: 10px;
      margin-bottom: 10px;
      text-align: center;
      padding-right: 0;
      max-width: 95%;
      margin-left: auto;
      margin-right: auto;
    }
    .pulsing-label {
      color: #ff4d4d;
      font-weight: 700;
    }

    @media (max-width: 768px) {
      button#play-toggle {
        font-size: 16px;
        padding: 12px 16px;
        width: 100%;
        margin-top: 10px;
      }
      #volume-container {
        display: none !important;
      }
      #volume-slider {
        width: 100%;
      }
      #volume-display, #mute-toggle {
        align-self: flex-end;
      }
      #nowPlaying {
        margin-top: 18px;
      }
      .artwork-container img {
        width: 100%;
        height: auto;
        border-radius: 10px;
      }
    }
    #now-playing-card {
      margin-top: 25px;
      background: #1a1a1a;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 15px rgba(0, 131, 138, 0.7);
      max-width: 420px;
      text-align: left;
      font-size: 17px;
      line-height: 1.7;
      color: white;
    }
    #artwork {
      margin-top: 25px;
      border-radius: 8px;
      width: 280px;
      height: 280px;
      object-fit: cover;
      border: 2px solid #fed351;
      box-shadow: 0 0 15px #fed351aa;
      user-select: none;
      opacity: 0;
      filter: blur(10px) brightness(0.8);
      transition: opacity 0.4s ease-in-out, filter 0.4s ease-in-out;
    }
    #artwork.loaded {
      opacity: 1;
      filter: blur(0) brightness(1);
    }
    #artwork.fallback {
      filter: blur(5px) brightness(0.8);
      opacity: 0.7;
      box-shadow: 0 0 10px rgba(254, 211, 81, 0.4);
    }
    .recent-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 20px;
      color: #fed351;
      user-select: none;
    }
    ul#recent-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    ul#recent-list li {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px 0;
      border-bottom: 1px solid #444;
      transition: background 0.2s ease;
    }
    ul#recent-list li:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    ul#recent-list img {
      width: 50px;
      height: 50px;
      border-radius: 6px;
      object-fit: cover;
      border: 1px solid #fed351;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.4);
      user-select: none;
      opacity: 0;
      transition: opacity 0.4s ease-in-out;
    }
    ul#recent-list img.loaded {
      opacity: 1;
    }
    ul#recent-list span.time {
      color: #fed351;
      font-weight: 600;
      width: 50px;
      text-align: right;
      flex-shrink: 0;
      user-select: none;
    }
    ul#recent-list span.info {
      flex: 1;
      color: white;
      font-size: 16px;
      user-select: none;
    }
    .refresh-indicator {
      display: inline-block;
      margin-left: 8px;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #fed351;
      animation: pulse 1.2s infinite;
      vertical-align: middle;
    }
    .strip-container { position: relative; z-index: 1; }
    .player-wrapper {
  position: relative;
}

.logo-overhang {
  position: absolute;
  top: 0;
  left: 0;
  width: 220px;
  max-width: 320px;
  z-index: 3000;
  opacity: 0.98;
  pointer-events: none;
  user-select: none;
  filter: drop-shadow(0 4px 10px rgba(0,0,0,0.32));
  /* New: Only overhang a bit on big screens */
  transform: translate(-24%, -32%);
  transition: width 0.2s, transform 0.2s;
}

/* Medium screens: pull the logo in a bit */
@media (max-width: 1000px) {
  .logo-overhang {
    width: 140px;
    transform: translate(-10%, -22%);
  }
}

/* Mobile screens: shrink and drop overhang */
@media (max-width: 600px) {
  .logo-overhang {
    width: 130px;
    transform: translate(0, 0);
    left: 4px;
    top: 2px;
  }
}

    .live-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: bold;
      color: #ff4d4d;
      font-size: 0.95em;
      margin-left: 10px;
      user-select: none;
    }
    .live-indicator .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #ff4d4d;
      animation: pulse 1.2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 0.2; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.4); }
    }
    @media (max-width: 768px) {
      .strip-container { flex-direction: column; }
      .left-panel, .right-panel { width: 100%; padding: 20px; }
      #artwork { width: 100%; max-width: 280px; height: auto; }
      #onAirNow { text-align: center; }
    }
    #onAirNow { margin-top: 10px; margin-bottom: 10px; text-align: center; padding-right: 16px; max-width: 95%; margin-left: auto; margin-right: 0; }
    #onAirNow br { display: none; }
    #play-toggle { margin-bottom: 12px; }
    #onAirNow span { display: block; line-height: 1.2; }
    .show-title { font-weight: 600; }
    .show-presenter {
  font-weight: 400;
  font-size: 0.95em;
  opacity: 0.9;
  font-style: italic;
  padding-bottom: 6px !important;
  padding-right: 4px !important;   /* extra gap from the rounded corner   */
  line-height: 1.45em !important;
  display: block;
  overflow: visible !important;
}
.show-presenter .presenter-link {
  font-style: italic;
  color: #fff;
  text-decoration: none;
}
.show-presenter .presenter-link:hover { color: #ffd866; }

    .left-panel { padding-top: 4px; }
    #player-box { margin-top: -4px; }
    #nowPlaying { margin-top: 8px; margin-bottom: 8px; }
    @media (max-width: 768px) {
      .recent-title { font-size: 16px; margin-bottom: 14px; }
      ul#recent-list li { gap: 10px; padding: 10px 0; }
      ul#recent-list img { width: 38px; height: 38px; }
      ul#recent-list span.info { font-size: 12px; }
      ul#recent-list span.time { font-size: 12px; width: 40px; }
    }
    
    /* Modal Schedule Styling */
    #modalScheduleContainer .day-card {
      background: #111;
      border: 1px solid #333;
      border-radius: 12px;
      padding: 20px;
      width: 100%;
      max-width: 860px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      margin-bottom: 10px;
    }
    #modalScheduleContainer .day-card h2,
    #modalScheduleContainer .day-card h3 {
      font-size: 21px;
      margin: 0 0 18px;
      color: #fed351;
      text-align: center;
    }
    #modalScheduleContainer .split-columns {
      display: flex;
      gap: 24px;
    }
    #modalScheduleContainer .column {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    #modalScheduleContainer .show-entry {
      position: relative;
      display: flex;
      align-items: flex-start;
      gap: 14px;
      margin-bottom: 18px;
    }
    #modalScheduleContainer .show-entry img {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #fed351;
      flex-shrink: 0;
    }
    #modalScheduleContainer .show-info {
      display: flex;
      flex-direction: column;
    }
    #modalScheduleContainer .show-info time {
      font-weight: 600;
      color: #fed351;
      font-size: 14px;
    }
    #modalScheduleContainer .show-title-presenter {
      margin-top: 2px;
      margin-bottom: 2px;
    }
    #modalScheduleContainer .show-title-presenter .show-title {
      font-weight: 600;
      color: #fff;
      display: block;
      font-size: 1.04em;
      line-height: 1.2;
      margin-bottom: 2px;
    }
    #modalScheduleContainer .show-title-presenter .show-presenter {
      font-size: 0.96em;
      color: #fed351;
      font-style: italic;
      text-decoration: none;
      line-height: 1.2;
      display: inline-block;
    }
    #modalScheduleContainer .show-title-presenter .show-presenter:hover {
      color: #ffd866;
    }
    #modalScheduleContainer .show-details {
      font-size: 13px;
      color: #ccc;
      margin-top: 4px;
      line-height: 1.5;
    }
    @media (max-width: 900px) {
      #modalScheduleContainer .split-columns { flex-direction: column; gap:0; }
    }
    /* Playlist Modal Styling */
    .playlist-image {
  width: 100%;
  max-width: 600px; /* or 650px */
  border-radius: 18px;
  display: block;
  margin: 0 auto 18px auto;
}
  /* --- IMPROVED RESPONSIVE CSS FOR MOBILE (≤ 768px) --- */
@media (max-width: 768px) {

  body {
    padding: 12px 2vw 8vw 2vw !important;
  }

  .strip-container {
    flex-direction: column !important;
    border-radius: 10px !important;
    max-width: 100vw !important;
    min-height: 0 !important;
    box-shadow: 0 0 14px rgba(0,0,0,0.22) !important;
  }

  .left-panel, .right-panel {
    width: 100% !important;
    padding: 10px 4px 12px 4px !important;
    border: none !important;
    min-height: unset !important;
  }

  .left-panel {
    padding-top: 8px !important;
    align-items: stretch !important;
  }

  #player-box, #now-playing-card {
    max-width: 98vw !important;
    width: 100% !important;
    padding: 0 !important;
    margin: 0 auto !important;
    box-shadow: none !important;
  }

/* Fix mobile font styling */
.presenter-line {
  font-size: 0.96em;
  color: #fed351;
  font-style: italic;
  display: inline-block;
  margin-top: 0.5px;
  line-height: 1.4;
  padding-bottom: 3px;
}

.show-title-presenter .show-title {
  font-weight: 600;
  color: #fff;
  font-style: normal; /* ✅ Ensure show title is NOT italic */
  font-size: 1.04em;
  display: block;
  line-height: 1.2;
  margin-bottom: 2px;
}

  #now-playing-card {
    font-size: 15px !important;
    padding: 10px 4px !important;
    border-radius: 7px !important;
    margin-top: 12px !important;
  }

  #artwork {
    width: 94vw !important;
    max-width: 140px !important;
    height: auto !important;
    margin-top: 8px !important;
    margin-bottom: 8px !important;
    border-radius: 7px !important;
  }

  
  .recent-title {
    font-size: 13px !important;
    margin-bottom: 5px !important;
    padding-top: 3px !important;
  }

  ul#recent-list li {
    gap: 6px !important;
    padding: 8px 0 !important;
  }

  ul#recent-list img {
    width: 26px !important;
    height: 26px !important;
    border-radius: 4px !important;
  }

  ul#recent-list span.info, ul#recent-list span.time {
    font-size: 11px !important;
  }

  button, #mute-toggle {
    font-size: 14px !important;
    padding: 8px 14px !important;
    border-radius: 7px !important;
  }

  #volume-container label, #volume-display {
    font-size: 11px !important;
  }

  #volume-slider {
    width: 84px !important;
  }

  /* ON AIR NOW & SHOW */
  #onAirNow {
    font-size: 15px !important;
    margin-top: 4px !important;
    margin-bottom: 4px !important;
    padding-right: 0 !important;
    max-width: 100vw !important;
  }
  .show-title { font-size: 0.9em !important; }
  .show-presenter { font-size: 0.8em !important; }

 
  .close {
    font-size: 24px !important;
    top: 8px !important;
    right: 8px !important;
  }

  .playlist-image {
    max-width: 97vw !important;
    border-radius: 9px !important;
    margin-bottom: 10px !important;
  }

 
  /* Right column separators — similar feel to the left */
.side-banner-panel > :is(.side-social, .side-listen, #rnh-news-hub, #ayrshire-college)
  + :is(.side-social, .side-listen, #rnh-news-hub, #ayrshire-college){
  margin-top:12px;              /* space before the next section */
  padding-top:12px;             /* space after the rule */
  border-top:1px solid #2b2b2b; /* the line */
  box-shadow:0 -1px 0 rgba(255,255,255,.05) inset; /* subtle highlight */
}

/* MOBILE TWEAKS */

@media (max-width: 768px) {
  .right-panel {
    overscroll-behavior: auto !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
  }
}
@media (max-width: 768px) {
  .strip-container {
    display: block !important;
    height: auto !important;
    min-height: 0 !important;
    overflow: visible !important;
  }

  .left-panel,
  .right-panel {
    display: block !important;
    height: auto !important;
    overflow: visible !important;
  }

  .recently-played-container {
    flex: none !important;
    height: auto !important;
    overflow: visible !important;
  }

  ul#recent-list {
    max-height: none !important;
    overflow: visible !important;
    -webkit-overflow-scrolling: auto !important;
  }
}

/* === FINAL MOBILE SMOOTH-SCROLL TWEAKS === */
@media (max-width: 768px) {
  /* Let right column release momentum smoothly */
  .right-panel {
    -webkit-overflow-scrolling: touch !important;
  }

  /* Let recent list claim only vertical drags */
  ul#recent-list {
    touch-action: pan-y !important;
  }
}

@media (max-width: 768px) {
  .right-panel {
    overscroll-behavior: auto !important;   /* let scroll bubble out */
    overflow-y: auto !important;            /* its own scroll, momentum OK */
    -webkit-overflow-scrolling: touch !important;
  }
}
.logo-hide {
  display: none !important;
}
@media (max-width: 750px) {
  #burgerMenuBtn {
    position: fixed;
    top: 20px;
    left: 8px;
    width: 32px;          /* Smaller width */
    height: 32px;         /* Smaller height */
    background: #fed351;
    border-radius: 7px;
    z-index: 2001;
    display: flex !important;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px #0002;
    padding: 0;
    transition: box-shadow 0.18s;
  }
  #burgerMenuBtn .burger-bar {
    display: block;
    width: 17px;         /* Shorter lines */
    height: 2.7px;       /* Thinner lines */
    background: #191c29;
    border-radius: 2px;
    margin: 2.8px 0;
    transition: all 0.2s;
  }
}

/* Prevent body scroll when modal is open */
body.modal-open {
  overflow: hidden !important;
  position: fixed !important;
  width: 100vw;
}

/* Ensure the modal itself doesn't scroll the background */
.modal {
  overflow: hidden !important;
  overscroll-behavior: contain;
}

/* Modal content scrolls inside, not the page */
.modal-content {
  max-height: 85vh;
  overflow-y: auto !important;
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
}
@media (max-width: 750px) {
  #burgerDropdown {
    top: 56px !important;
    height: calc(100vh - 56px) !important;
  }
}
@media (max-width: 768px) {
  .modal-content {
    width: 96vw !important;
    max-width: 96vw !important;
    margin: 0 auto !important;
    border-radius: 14px !important;
    /* Your other styles here, such as: */
    margin-top: 0 !important;
    padding-top: 18px !important;
    padding-bottom: 12px !important;
    box-sizing: border-box !important;
    overflow-y: auto !important;
    overscroll-behavior: contain !important;
    background: #fff !important;
    font-size: 15px !important;
    scrollbar-width: thin;
    scrollbar-color: #fed351 #ececec;
  }
  .modal-content::-webkit-scrollbar {
    width: 14px;
    background: #ececec;
    border-radius: 10px;
  }
  .modal-content::-webkit-scrollbar-thumb {
    background: #fed351;
    border-radius: 10px;
    border: 3px solid #ececec;
  }
  .modal-content::-webkit-scrollbar-thumb:active {
    background: #ffe67c;
  }
  .modal-content::-webkit-scrollbar-track {
    background: #ececec;
    border-radius: 10px;
  }
/* Make 3-column layout */
.strip-container.three-panel {
  display: flex;
  flex-direction: row;
  align-items: flex-start;
  justify-content: space-between;
  gap: 12px; /* Optional spacing between panels */
}

.strip-container.three-panel {
  display: flex;
  flex-direction: row;
  align-items: flex-start;
  justify-content: space-between;
  max-width: 1200px; /* or adjust to your preference */
  width: 100%;
  margin: 0 auto;
  box-sizing: border-box;
  gap: 12px;
}

/* Banner image */
.side-banner-img {
  width: 160px;
  height: auto;
  max-height: 1000px;
  object-fit: contain;
}

/* Responsive stacking on mobile */
@media (max-width: 768px) {
  .strip-container.three-panel {
    flex-direction: column;
  }

  .side-banner-panel {
    width: 100%;
    padding: 20px 0;
    justify-content: center;
  }

  .side-banner-img {
    width: 100%;
    max-width: 240px;
    height: auto;
  }
}

@media (max-width: 768px) {
  .modal,
  .modal-content {
    max-width: 100vw !important;
    min-width: 0 !important;
    overflow-x: hidden !important;
    left: 0 !important;
    right: 0 !important;
  }
  #modalScheduleContainer,
  #modalScheduleContainer .day-card,
  #modalScheduleContainer .split-columns,
  #modalScheduleContainer .column,
  #modalScheduleContainer .show-entry {
      position: relative;
    max-width: 100vw !important;
    min-width: 0 !important;
    overflow-x: hidden !important;
    box-sizing: border-box !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
  #modalScheduleContainer .split-columns,
  #modalScheduleContainer .column,
  #modalScheduleContainer .show-entry {
      position: relative;
    flex-wrap: wrap !important;
  }
#modalScheduleContainer .show-entry img {
    width: 38px !important;
    height: 38px !important;
    border-radius: 50% !important;
    object-fit: cover !important;
  }
}
.show-time {
  font-weight: 600;
  font-size: 0.9em;
  color: #222;
  margin-bottom: 4px;
  display: block;
}

@media (max-width: 768px) {
  .modal {
    top: 56px !important;
    left: 0 !important;
    width: 100vw !important;
    height: calc(100vh - 56px) !important;
    overflow-y: auto !important;
  }
  .modal-content {
    max-height: calc(100vh - 56px) !important;
    overflow-y: auto !important;
  }
}

/* === Play Essential Radio button styling === */
#play-toggle {
  background-color: #fed351 !important; /* Essential yellow */
  color: #111 !important;               /* Dark text for contrast */
  border: 2px solid #e6c13c !important;  /* Slightly darker yellow border */
  font-weight: bold;
  font-size: 20px;                       /* Larger text size */
  padding: 16px 28px;                    /* Bigger click/tap area */
  border-radius: 10px;                   /* Slightly rounder corners */
  box-shadow: 0 3px 12px rgba(0,0,0,0.25);
  transition: background-color 0.2s, transform 0.2s;
}

#play-toggle:hover,
#play-toggle:focus {
  background-color: #ffe67c !important;  /* Lighter yellow on hover */
  transform: scale(1.05);                /* Slight zoom on hover */
}

/* === Mobile adjustments === */
@media (max-width: 768px) {
  #play-toggle {
    font-size: 18px !important;
    padding: 14px 24px !important;
    width: 100%;                         /* Full width on mobile */
    margin-top: 12px !important;
  }
}

</style><style>.no-scroll{overflow:hidden;}</style><style id="stacking-overrides">
  /* Keep desktop navbar clickable even when a base modal is open */
  .navbar { z-index: 3001 !important; }

  /* Ensure the mobile dropdown sits above any modal when opened */
  #burgerDropdown { z-index: 3100 !important; }

  /* Presenter modals sit above base modals (like the presenters list) */
  .modal.presenter-modal { z-index: 2050 !important; }

  /* Hide the overhang logo whenever any modal is open */
  body.modal-open .logo-overhang { display: none !important; }

  /* Allow clicking nav through the modal backdrop edge on desktop if needed */
  @media (min-width: 751px) {
    /* Keep a small gap for the top navbar to remain visible/clickable */
    .modal { top: 0px !important; height: calc(100vh - 0px) !important; }
  }
</style><style id="theme-mode">
  :root {
    /* Core brand */
    --brand: #fed351;     /* Essential yellow */
    --accent: #00818a;    /* Teal accent */
    --danger: #e0322f;

    /* Dark (default) */
    --bg-grad-1: #00818a;
    --bg-grad-2: #7e1974;
    --text: #f7f8fb;
    --panel: #101215;
    --panel-2: #171a1f;
    --border: #272c33;
    --muted: #c8d1dc;
  }

  /* Light theme overrides – tuned for print-friendliness & contrast */
  
  [data-theme="light"] {
    --bg-grad-1: #ffffff;
    --bg-grad-2: #f4f7fb;
    --text: #0b1220;
    --panel: #ffffff;
    --panel-2: #f7f9fc;
    --border: #e6ecf3;
    --muted: #6a778a;
    --accent: #0b6b73;   /* deep teal for contrast */
    --danger: #b42318;
    --brand: #c89d00;    /* darkened yellow for accents only */
  }
    

  /* Base */
  html, body { color: var(--text) !important; }
  body {
    background: linear-gradient(135deg, var(--bg-grad-1), var(--bg-grad-2)) !important;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  a { color: var(--accent) !important; }

  /* Containers */
  .strip-container { background-color: var(--panel) !important; }
  .left-panel { background: var(--panel) !important; border-right: 1px solid var(--border) !important; }
  .right-panel { background: var(--panel-2) !important; border-left: 1px solid var(--border) !important; }

  /* Now Playing */
  #now-playing-card { background: var(--panel-2) !important; color: var(--text) !important; box-shadow: 0 6px 18px rgba(0,0,0,0.12) !important; border: 1px solid var(--border) !important; }
  #artwork { border: 2px solid var(--brand) !important; }

  /* Recent list */
  .recent-title { color: var(--brand) !important; }
  ul#recent-list li { border-bottom: 1px solid var(--border) !important; }
  ul#recent-list span.info { color: var(--text) !important; }
  ul#recent-list span.time { color: var(--muted) !important; }

  /* Live indicator */
  .live-indicator, .pulsing-label { color: var(--danger) !important; }

  /* Navbar & buttons */
  .navbar { background: var(--panel) !important; box-shadow: 0 2px 12px rgba(0,0,0,0.10) !important; border-bottom: 1px solid var(--border) !important; }
  .navbar a { background: var(--brand) !important; color: #1a1a1a !important; }
  .navbar a:hover, .navbar a:focus { background: var(--accent) !important; color: #ffffff !important; }
  button, #mute-toggle { background: var(--brand) !important; color: #1a1a1a !important; border: 1px solid rgba(0,0,0,0.05) !important; }
  button:hover, button:focus, #mute-toggle:hover, #mute-toggle:focus { filter: brightness(0.97); box-shadow: 0 0 0 3px rgba(0,0,0,0.06) inset !important; }

  /* Modals */
  .modal { background: rgba(0,0,0,0.78) !important; }
  .modal-content { background: var(--panel) !important; color: var(--text) !important; border: 1px solid var(--border) !important; }
  .modal-content h2 { color: var(--accent) !important; }
  .modal-content a { color: var(--accent) !important; }

  /* Weather */
  #wxWrap { background: linear-gradient(135deg, var(--panel-2), var(--panel)) !important; color: var(--text) !important; border: 1px solid var(--border) !important; }
  #wxWrap .wxHeading { color: var(--brand) !important; }
  #wxNow span { text-shadow: none !important; }
  .weather-divider { border-top-color: var(--border) !important; }

  /* Right column & tiles */
  .side-social-title, .side-listen-title { color: var(--brand) !important; }
  .side-social-btn { background: var(--brand) !important; color:#111 !important; border: 1px solid rgba(0,0,0,0.05) !important; }
  .tile { border: 1px solid var(--border) !important; background: var(--panel) !important; }
  .tile-icon { background: var(--brand) !important; color:#111 !important; }
  .tile:hover .tile-icon, .tile:focus .tile-icon { background: var(--accent) !important; color:#fff !important; }

  /* Clock (tune light mode to avoid red-on-yellow clashes) */
  #liveClock { background: var(--panel-2) !important; border: 1px solid var(--border) !important; }
  #clockTime { color: #f0f3f8 !important; }
  #clockDate { color: var(--brand) !important; }
  [data-theme="light"] #clockTime { color: #111827 !important; } /* deep grey */
  [data-theme="light"] #clockDate { color: #e0b12b !important; text-shadow: none !important; }

  /* Forms & inputs */
  input, select, textarea { background: var(--panel-2) !important; color: var(--text) !important; border: 1px solid var(--border) !important; }
  [data-theme="light"] input, [data-theme="light"] select, [data-theme="light"] textarea { background: #ffffff !important; color: #0b1220 !important; }
</style><style id="theme-contrast-patch">
  /* Global light-mode contrast fixes */
  [data-theme="light"] * { text-shadow: none !important; }
  [data-theme="light"] .menu-link { color: #0b1220 !important; background: transparent !important; }
  [data-theme="light"] .menu-link:hover, 
  [data-theme="light"] .menu-link:focus { background: #eef2f7 !important; }

  /* Any leftover white-on-light from legacy inline styles */
  [data-theme="light"] .text-light, 
  [data-theme="light"] .white, 
  [data-theme="light"] .label, 
  [data-theme="light"] .tag,
  [data-theme="light"] .chip,
  [data-theme="light"] .badge { color: #0b1220 !important; background: #f2f5fb !important; border-color: #e6ecf3 !important; }

  /* Links inside light panels */
  [data-theme="light"] .modal-content a,
  [data-theme="light"] .left-panel a,
  [data-theme="light"] .right-panel a { color: #0b6b73 !important; }

  /* Tables */
  [data-theme="light"] table { background: #ffffff !important; color: #0b1220 !important; border: 1px solid #e6ecf3 !important; }
  [data-theme="light"] th, [data-theme="light"] td { border-color: #e6ecf3 !important; }
  [data-theme="light"] th { background: #f4f7fb !important; }

  /* Forms */
  [data-theme="light"] input, 
  [data-theme="light"] select, 
  [data-theme="light"] textarea { background: #ffffff !important; color: #0b1220 !important; border: 1px solid #d9e2ec !important; }
  [data-theme="light"] ::placeholder { color: #6a778a !important; }

  /* Buttons on light backgrounds */
  [data-theme="light"] button, 
  [data-theme="light"] #mute-toggle { color: #1a1a1a !important; border: 1px solid rgba(0,0,0,0.06) !important; }

  /* Timestamps, small/meta text */
  [data-theme="light"] .time, 
  [data-theme="light"] .meta, 
  [data-theme="light"] .note, 
  [data-theme="light"] small { color: #334155 !important; }

  /* Live badges / alerts */
  [data-theme="light"] .live-indicator, 
  [data-theme="light"] .pulsing-label { color: #b42318 !important; }

  /* SVG icons that were hard-coded white */
  [data-theme="light"] svg [fill="#fff"],
  [data-theme="light"] svg [fill="#FFFFFF"] { fill: #111111 !important; }
  [data-theme="light"] svg,
  [data-theme="light"] .icon { color: #0b1220 !important; }

  /* Cards/tiles inside right column */
  [data-theme="light"] .tile { background: #ffffff !important; color: #0b1220 !important; border: 1px solid #e6ecf3 !important; }
  [data-theme="light"] .tile .tile-icon { background: #fed351 !important; color:#111 !important; }

  /* News modal iframe wrapper (if any) */
  [data-theme="light"] .news-iframe-wrap { background: #ffffff !important; }

  /* Ensure headings don't fade */
  [data-theme="light"] h1, [data-theme="light"] h2, [data-theme="light"] h3, 
  [data-theme="light"] h4, [data-theme="light"] h5, [data-theme="light"] h6 { color: #0b1220 !important; }
</style><style id="theme-contrast-hardpatch">
  /* Global: make sure UA picks light palette for forms etc. */
  [data-theme="light"] { color-scheme: light; }

  /* 1) Kill lingering white text set inline */
  [data-theme="light"] [style*="color:#fff"],
  [data-theme="light"] [style*="color: #fff"],
  [data-theme="light"] [style*="color:#FFF"],
  [data-theme="light"] [style*="color: #FFF"],
  [data-theme="light"] [style*="color:#ffffff"],
  [data-theme="light"] [style*="color: #ffffff"],
  [data-theme="light"] [style*="color:#FFFFFF"],
  [data-theme="light"] [style*="color: #FFFFFF"] { color: #0b1220 !important; }

  /* 2) Labels/badges that may be white-on-yellow or white-on-light */
  [data-theme="light"] .badge, 
  [data-theme="light"] .label, 
  [data-theme="light"] .tag, 
  [data-theme="light"] .chip, 
  [data-theme="light"] .pill {
    background: #f6f8fc !important; 
    color: #0b1220 !important; 
    border: 1px solid #e6ecf3 !important;
  }

  /* 3) Any title elements that used brand-yellow as text */
  [data-theme="light"] .recent-title,
  [data-theme="light"] .side-social-title,
  [data-theme="light"] .side-listen-title {
    color: #0b1220 !important;
  }

  /* 4) Links on light panels */
  [data-theme="light"] .left-panel a,
  [data-theme="light"] .right-panel a,
  [data-theme="light"] .modal-content a,
  [data-theme="light"] .tile a { color: #0b6b73 !important; }

  /* 5) Buttons that might be transparent/ghost */
  [data-theme="light"] .btn, 
  [data-theme="light"] .button, 
  [data-theme="light"] button,
  [data-theme="light"] #mute-toggle,
  [data-theme="light"] .side-social-btn {
    background: #fed351 !important;
    color: #1a1a1a !important;
    border: 1px solid rgba(0,0,0,0.08) !important;
    text-shadow: none !important;
  }

  /* 6) Tables, list dividers */
  [data-theme="light"] table { background: #ffffff !important; color: #0b1220 !important; }
  [data-theme="light"] th, 
  [data-theme="light"] td, 
  [data-theme="light"] ul#recent-list li { border-color: #e6ecf3 !important; }

  /* 7) Clock & small text */
  [data-theme="light"] #clockTime { color: #111827 !important; }
  [data-theme="light"] #clockDate { color: #ad7e00 !important; } /* deeper yellow for contrast */
  [data-theme="light"] .time, 
  [data-theme="light"] small, 
  [data-theme="light"] .meta, 
  [data-theme="light"] .note { color: #334155 !important; }

  /* 8) Hard-coded white SVGs/icons */
  [data-theme="light"] svg [fill="#fff"],
  [data-theme="light"] svg [fill="#FFF"],
  [data-theme="light"] svg [fill="#ffffff"],
  [data-theme="light"] svg [fill="#FFFFFF"] { fill: #0b1220 !important; }
  [data-theme="light"] .icon, [data-theme="light"] svg { color: #0b1220 !important; }

  /* 9) Card/tiles backgrounds */
  [data-theme="light"] .tile, 
  [data-theme="light"] #now-playing-card, 
  [data-theme="light"] .card { 
    background: #ffffff !important; 
    color: #0b1220 !important; 
    border: 1px solid #e6ecf3 !important; 
    box-shadow: 0 3px 14px rgba(0,0,0,0.06) !important;
  }

  /* 10) Navbar links that were white text */
  [data-theme="light"] .navbar a { color: #1a1a1a !important; }

  /* 11) Force transparent panels that were using white text */
  [data-theme="light"] .panel, 
  [data-theme="light"] .panel-ghost, 
  [data-theme="light"] .section,
  [data-theme="light"] .strip-container { color: #0b1220 !important; }

  /* 12) Focus visibility for keyboard nav in light mode */
  [data-theme="light"] a:focus, 
  [data-theme="light"] button:focus, 
  [data-theme="light"] input:focus, 
  [data-theme="light"] select:focus, 
  [data-theme="light"] textarea:focus {
    outline: 2px solid #0b6b73 !important;
    outline-offset: 2px !important;
    box-shadow: none !important;
  }
</style><style id="light-mode-contrast-tune">
  /* Headings, titles in light mode: use dark ink */
  [data-theme="light"] h1, 
  [data-theme="light"] h2, 
  [data-theme="light"] h3, 
  [data-theme="light"] h4, 
  [data-theme="light"] h5, 
  [data-theme="light"] h6,
  [data-theme="light"] .recent-title,
  [data-theme="light"] .side-social-title,
  [data-theme="light"] .side-listen-title {
    color: #0b1220 !important;
  }

  /* Buttons/nav in light mode: teal background */
  [data-theme="light"] button, 
  [data-theme="light"] .navbar a,
  [data-theme="light"] .side-social-btn,
  [data-theme="light"] #mute-toggle {
    background: var(--accent) !important;
    color: #fff !important;
    border-color: rgba(0,0,0,0.08) !important;
  }

  /* Borders/dividers in light mode */
  [data-theme="light"] hr, 
  [data-theme="light"] .divider, 
  [data-theme="light"] ul#recent-list li, 
  [data-theme="light"] table, 
  [data-theme="light"] th, 
  [data-theme="light"] td {
    border-color: var(--border) !important;
  }

  /* Keep yellow for icons, small accents */
  [data-theme="light"] .icon,
  [data-theme="light"] svg .accent,
  [data-theme="light"] .accent {
    color: var(--brand) !important;
    fill: var(--brand) !important;
  }

  /* Remove yellow from clock date text, use dark teal instead */
  [data-theme="light"] #clockDate {
    color: var(--accent) !important;
  }
</style><style id="lightmode-hardpatch-yellow">
  /* In light mode, force replace all yellow text with dark ink, except icons/accents */
  [data-theme="light"] *:not(.icon):not(.accent):not(svg):not(path):not(use):not(.mode-emoji) {
    /* If it's yellow, make it dark ink */
  }
  /* Target yellow text color inline or in CSS */
  [data-theme="light"] [style*="color:#fed351"],
  [data-theme="light"] [style*="color: #fed351"],
  [data-theme="light"] [style*="color:#e5b930"],
  [data-theme="light"] [style*="color: #e5b930"],
  [data-theme="light"] [style*="color:#c89d00"],
  [data-theme="light"] [style*="color: #c89d00"],
  [data-theme="light"] .text-yellow,
  [data-theme="light"] .recent-title,
  [data-theme="light"] .side-social-title,
  [data-theme="light"] .side-listen-title,
  [data-theme="light"] .label-yellow {
    color: #0b1220 !important;
  }
  /* Target yellow SVG fills/strokes for text shapes */
  [data-theme="light"] svg [fill="#fed351"],
  [data-theme="light"] svg [fill="#e5b930"],
  [data-theme="light"] svg [fill="#c89d00"],
  [data-theme="light"] svg [stroke="#fed351"],
  [data-theme="light"] svg [stroke="#e5b930"],
  [data-theme="light"] svg [stroke="#c89d00"] {
    fill: #0b1220 !important;
    stroke: #0b1220 !important;
  }
  /* Keep yellow for icons or explicit accent class */
  [data-theme="light"] .icon,
  [data-theme="light"] .accent,
  [data-theme="light"] svg.icon,
  [data-theme="light"] svg .accent {
    color: #c89d00 !important;
    fill: #c89d00 !important;
    stroke: #c89d00 !important;
  }
</style><style id="socials-yellow-style">
  /* === SOCIAL BUTTONS: yellow background, high contrast text/icons === */
  .side-social-btn,
  .follow-icons .social-btn,
  .side-social .social-btn {
    background: var(--brand) !important; /* yellow background */
    color: #111 !important;              /* dark ink text */
    border: 1px solid rgba(0,0,0,0.12) !important;
  }
  /* Icons on yellow should be dark for contrast */
  .side-social-btn .icon, .side-social-btn svg,
  .follow-icons .social-btn .icon, .follow-icons .social-btn svg,
  .side-social .social-btn .icon, .side-social .social-btn svg {
    color: #111 !important;
    fill: #111 !important;
    stroke: #111 !important;
  }
  .side-social-btn:hover, .side-social-btn:focus,
  .follow-icons .social-btn:hover, .follow-icons .social-btn:focus,
  .side-social .social-btn:hover, .side-social .social-btn:focus {
    filter: brightness(0.97);
    box-shadow: 0 2px 10px rgba(0,0,0,0.12);
  }

  /* Keep the 'Follow' section heading readable in light mode */
  [data-theme="light"] .side-social-title { color: #0b1220 !important; }

  /* === EXTRA LEGIBILITY SWEEPS (light mode) === */
  /* Kill any leftover white-on-white in common areas */
  [data-theme="light"] .modal-content [style*="color:#fff"],
  [data-theme="light"] .modal-content [style*="color: #fff"],
  [data-theme="light"] .left-panel [style*="color:#fff"],
  [data-theme="light"] .left-panel [style*="color: #fff"],
  [data-theme="light"] .right-panel [style*="color:#fff"],
  [data-theme="light"] .right-panel [style*="color: #fff"] {
    color: #0b1220 !important;
  }

  /* Presenter names, show titles, schedule times */
  [data-theme="light"] .presenter-name,
  [data-theme="light"] .show-title,
  [data-theme="light"] .schedule time,
  [data-theme="light"] .badge,
  [data-theme="light"] .tag,
  [data-theme="light"] .chip {
    color: #0b1220 !important;
    background: #f7f9fc !important;
    border: 1px solid #e6ecf3 !important;
  }

  /* Links in content areas should use teal for clarity */
  [data-theme="light"] .left-panel a,
  [data-theme="light"] .right-panel a,
  [data-theme="light"] .modal-content a {
    color: var(--accent) !important;
  }

  /* Now Playing headings/labels */
  [data-theme="light"] #now-playing-card h3,
  [data-theme="light"] #now-playing-card h4,
  [data-theme="light"] #now-playing-card .label {
    color: #0b1220 !important;
  }

  /* Ensure recent list artist/title are readable */
  [data-theme="light"] ul#recent-list span.info { color: #0b1220 !important; }
  [data-theme="light"] ul#recent-list span.time { color: #6a778a !important; }

  /* If any remaining yellow text sneaks in, force it dark */
  [data-theme="light"] [style*="color:#fed351"],
  [data-theme="light"] [style*="color: #fed351"],
  [data-theme="light"] [style*="color:#e5b930"],
  [data-theme="light"] [style*="color: #e5b930"],
  [data-theme="light"] [style*="color:#c89d00"],
  [data-theme="light"] [style*="color: #c89d00"] {
    color: #0b1220 !important;
  }
</style><style id="np-social-rnh-specifics">
  /* === 1) NOW PLAYING: ensure song text is dark in light mode === */
  [data-theme="light"] #now-playing-card,
  [data-theme="light"] #now-playing-card * {
    text-shadow: none !important;
  }
  /* Common class/id guesses for title/artist; adjust as needed to your markup */
  [data-theme="light"] #now-playing-card .song,
  [data-theme="light"] #now-playing-card .title,
  [data-theme="light"] #now-playing-card .track-title,
  [data-theme="light"] #now-playing-card .artist,
  [data-theme="light"] #now-playing-card .np-title,
  [data-theme="light"] #now-playing-card .np-artist,
  [data-theme="light"] #now-playing-card h2,
  [data-theme="light"] #now-playing-card h3,
  [data-theme="light"] #now-playing-card p,
  [data-theme="light"] #now-playing-card span.info {
    color: #0b1220 !important;
  }
  /* Kill any inline white in Now Playing block */
  [data-theme="light"] #now-playing-card [style*="color:#fff"],
  [data-theme="light"] #now-playing-card [style*="color: #fff"] {
    color: #0b1220 !important;
  }
  /* Links inside Now Playing use teal for clarity */
  [data-theme="light"] #now-playing-card a {
    color: var(--accent) !important;
  }

  /* === 2) SOCIAL BUTTONS: keep yellow backgrounds with dark text/icons === */
  .side-social-btn,
  .follow-icons .social-btn,
  .side-social .social-btn {
    background: var(--brand) !important;
    color: #111 !important;
    border: 1px solid rgba(0,0,0,0.12) !important;
  }
  .side-social-btn .icon, .side-social-btn svg,
  .follow-icons .social-btn .icon, .follow-icons .social-btn svg,
  .side-social .social-btn .icon, .side-social .social-btn svg {
    color: #111 !important;
    fill: #111 !important;
    stroke: #111 !important;
  }

  /* === 3) RADIO NEWS HUB: make text/links teal in light mode === */
  [data-theme="light"] #rnh-news-list,
  [data-theme="light"] #rnh-news-list * {
    color: var(--accent) !important;
  }
  /* Headlines bold in dark ink; links teal */
  [data-theme="light"] #rnh-news-list .headline,
  [data-theme="light"] #rnh-news-list h3,
  [data-theme="light"] #rnh-news-list h4 {
    color: #0b1220 !important;
  }
  [data-theme="light"] #rnh-news-list a {
    color: var(--accent) !important;
  }
</style><style id="socials-follow-lastfm-yellow">
  /* Apply to both Follow Essential Radio and Last.fm sections */
  .follow-icons .social-btn,
  .follow-icons a,
  .follow-icons button,
  .lastfm-icons .social-btn,
  .lastfm-icons a,
  .lastfm-icons button {
    background: var(--brand) !important;   /* yellow background */
    color: #111 !important;                /* dark text for contrast */
    border: 1px solid rgba(0,0,0,0.12) !important;
  }
  /* Icons/glyphs inside those buttons */
  .follow-icons .social-btn .icon, .follow-icons .social-btn svg,
  .follow-icons a .icon, .follow-icons a svg,
  .follow-icons button .icon, .follow-icons button svg,
  .lastfm-icons .social-btn .icon, .lastfm-icons .social-btn svg,
  .lastfm-icons a .icon, .lastfm-icons a svg,
  .lastfm-icons button .icon, .lastfm-icons button svg {
    color: #111 !important;
    fill: #111 !important;
    stroke: #111 !important;
  }
  /* Hover/focus feedback */
  .follow-icons .social-btn:hover, .follow-icons .social-btn:focus,
  .follow-icons a:hover, .follow-icons a:focus,
  .follow-icons button:hover, .follow-icons button:focus,
  .lastfm-icons .social-btn:hover, .lastfm-icons .social-btn:focus,
  .lastfm-icons a:hover, .lastfm-icons a:focus,
  .lastfm-icons button:hover, .lastfm-icons button:focus {
    filter: brightness(0.97);
    box-shadow: 0 2px 10px rgba(0,0,0,0.12);
    outline: none;
  }
</style><style id="socials-follow-lastfm-yellow-strong">
  /* Force yellow backgrounds in LIGHT MODE for Follow + Last.fm buttons/links */
  [data-theme="light"] :is(.follow-icons, .side-social, .lastfm-icons) :is(a, button, .social-btn) {
    background-color: var(--brand) !important;
    border-color: rgba(0,0,0,0.14) !important;
    color: #111 !important;
  }
  [data-theme="light"] :is(.follow-icons, .side-social, .lastfm-icons) :is(a, button, .social-btn) :is(svg, .icon) {
    color: #111 !important;
    fill: #111 !important;
    stroke: #111 !important;
  }
  /* If something earlier forces teal on all buttons in light mode, outrank it here */
  [data-theme="light"] .navbar :is(a, button).theme-navbtn {
    /* Keep the nav theme toggle teal — unaffected */
  }
  /* Counter any inline yellow/white text overrides inside these buttons */
  [data-theme="light"] :is(.follow-icons, .side-social, .lastfm-icons) :is(a, button, .social-btn) [style*="color:#fff"],
  [data-theme="light"] :is(.follow-icons, .side-social, .lastfm-icons) :is(a, button, .social-btn) [style*="color: #fff"],
  [data-theme="light"] :is(.follow-icons, .side-social, .lastfm-icons) :is(a, button, .social-btn) [style*="color:#ffffff"],
  [data-theme="light"] :is(.follow-icons, .side-social, .lastfm-icons) :is(a, button, .social-btn) [style*="color: #ffffff"] {
    color: #111 !important;
  }
  /* Compact padding so they don't dominate */
  [data-theme="light"] :is(.follow-icons, .side-social, .lastfm-icons) :is(a, button, .social-btn) {
    padding: 6px 10px !important;
  }
</style><style id="lastfm-keep-yellow">
  /* Keep the Last.fm circle yellow even in light mode overrides */
  /* Targets the inline icon injected in Recent list: <a href="...last.fm..." class="hour-nav prev-hour hour-nav next-hour"><svg><circle fill="#fed351"> */
  a[href*="last.fm"] svg circle[fill="#fed351"],
  a[href*="last.fm"] svg circle[fill="#e5b930"],
  a[href*="last.fm"] svg circle[fill="#c89d00"] {
    fill: var(--brand) !important;
  }
  /* Ensure the glyph path remains visible */
  a[href*="last.fm"] svg path { fill: #111 !important; stroke: none !important; }
</style><style id="nowplaying-inline-white-fix">
  /* In light mode, convert inline 'color:white' in Now Playing to dark ink */
  [data-theme="light"] #now-playing-card [style*="color:white"],
  [data-theme="light"] #now-playing-card [style*="color: white"] {
    color: #0b1220 !important;
  }
</style><style id="navbar-gap-fix">
  /* Trim right padding now that the toggle is absolutely positioned */
  .navbar {
    padding-right: 16px !important;
    margin-bottom: 0 !important; /* no extra gap below navbar */
  }
  /* Ensure main block starts immediately after navbar */
  .strip-container,
  .main,
  .content,
  .wrapper {
    margin-top: 0 !important;
    padding-top: 0 !important;
  }
  /* Kill any spacer divs used previously for top bars */
  .nav-spacer,
  .top-spacer {
    display: none !important;
    height: 0 !important;
  }
</style><style id="navbar-compact">
  /* Base navbar compaction */
  .navbar {
    display: flex;
    align-items: center;
    justify-content: center;     /* center nav items */
    gap: 10px;
    flex-wrap: wrap;             /* allow wrapping instead of horizontal scroll */
    overflow-x: hidden;          /* belt-and-braces */
  }
  /* Compact nav links/buttons (not the theme toggle which is absolute) */
  .navbar a:not(.theme-navbtn),
  .navbar button:not(.theme-navbtn) {
    padding: 6px 10px;
    font-size: 13px;
    line-height: 1.2;
    border-radius: 8px;
    white-space: nowrap;         /* keep each item on one line */
    max-width: 100%;
  }

  /* Theme toggle stays absolute (defined earlier), but shrink its text a touch */
  .navbar .theme-navbtn {
    font-size: 12px;
    padding: 3px 7px;
  }

  /* Medium screens: tighten further */
  @media (max-width: 900px) {
    .navbar { gap: 8px; }
    .navbar a:not(.theme-navbtn),
    .navbar button:not(.theme-navbtn) {
      padding: 5px 8px;
      font-size: 12px;
    }
  }
  /* Small screens: tighter again; hide long labels if needed */
  @media (max-width: 600px) {
    .navbar { gap: 6px; }
    .navbar a:not(.theme-navbtn),
    .navbar button:not(.theme-navbtn) {
      padding: 4px 7px;
      font-size: 11px;
    }
    /* Optional: hide text on very long items, show ellipsis */
    .navbar a:not(.theme-navbtn),
    .navbar button:not(.theme-navbtn) {
      overflow: hidden;
      text-overflow: ellipsis;
    }
  }
  /* Very narrow: icon-first UX; hide labels inside nav items if they have .label spans */
  @media (max-width: 420px) {
    .navbar .label { display: none; }
  }
</style><style id="theme-toggle-nav-style">
  .navbar .theme-navbtn {
    position: static;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    background: var(--accent) !important;
    color: #fff !important;
    border: 1px solid rgba(255,255,255,0.18) !important;
    font-size: 12px;
    padding: 4px 10px;
    border-radius: 8px;
    cursor: pointer;
  }
  [data-theme="light"] .navbar .theme-navbtn {
    background: #0b6b73 !important;
    color: #fff !important;
    border-color: rgba(0,0,0,0.10) !important;
  }
  @media (max-width: 480px) {
    .navbar .theme-navbtn .mode-label { display: none; }
    .navbar .theme-navbtn { padding: 0 8px; }
  }
    </style><style id="wx-icon-light-fix">
  /* OpenWeather PNGs were being inverted by generic light-mode rules.
     Restore them to normal in LIGHT mode so clouds etc. render correctly. */
  [data-theme="light"] #wxWrap img.forecast-icon,
  [data-theme="light"] #wxWrap img[src*="openweathermap.org/img/wn/"] {
    filter: none !important;
    mix-blend-mode: normal !important;
    opacity: 1 !important;
  }
  /* Ensure no unintended colorization of PNG icons */
  [data-theme="light"] #wxWrap .forecast-icon {
    background: transparent !important;
  }
</style><style>
/* === Quick tweak: force white text for RNH heading and 'Additional Ways to Listen' captions === */
#rnh, #rnh *,
#rnh-widget, #rnh-widget *,
#rnh-news, #rnh-news *,
#rnh-news-container, #rnh-news-container *,
#newsModal .rnh-title, #newsModal .modal-title.rnh-title,
.rnh-title, .rnh-heading,
#right-panel h3:has(span[data-source='rnh']),
#right-panel h3[data-section='rnh'] {
  color: #fff !important;
}

/* Captions under 'Additional Ways to Listen' tiles */
#listen-tiles .tile .caption,
#listen-tiles .tile .label,
#listen-tiles .tile small,
#listen-tiles .tile p,
#listen-tiles .tile span.caption,
#additional-ways .tile .caption,
#additional-ways .tile p,
#additional-ways small,
#additional-ways .tile .label,
.addl-ways .tile .caption,
.addl-ways .tile p {
  color: #fff !important;
}

</style><style id="dark-theme-overrides">

/* ===== Essential Radio – Dark theme (aligned with current live site) ===== */
:root {
  --er-bg: #f8fafc;
  --er-panel: #ffffff;
  --er-card: #ffffff;
  --er-border: #e5e7eb;
  --er-text: #111827;
  --er-muted: #4b5563;
  --er-subtle: #6b7280;
  --er-heading: #0b0f19;
  --er-accent: #fed351;
  --er-accent-hover: #e6c13c;
  --er-chip: #f3f4f6;
}
:root[data-theme="dark"] {
  --er-bg: #0b0c0f;
  --er-panel: #12141a;
  --er-card: #0f1116;
  --er-border: #272a33;
  --er-text: #ffffff;
  --er-muted: #cfd3da;
  --er-subtle: #a5acb5;
  --er-heading: #ffffff;
  --er-accent: #fed351;
  --er-accent-hover: #ffe28a;
  --er-chip: #1a1d24;
}

/* Base */
html, body {
  color: var(--er-text) !important;
}

/* Headings */
h1, h2, h3, h4, h5, h6 {
  color: var(--er-heading) !important;
}

/* Links & accents */
a, .link, .accent {
  color: var(--er-accent) !important;
  text-decoration-color: var(--er-accent) !important;
}
a:hover, a:focus {
  color: var(--er-accent-hover) !important;
  text-decoration-color: var(--er-accent-hover) !important;
}

/* Panels / cards / sections */
:root[data-theme="dark"] .panel, .card, .tile, :root[data-theme="dark"] .modal-content, .drawer, .sidebar, .right-panel, #right-panel {
  background: var(--er-panel) !important;
  color: var(--er-text) !important;
  border-color: var(--er-border) !important;
}

/* Buttons */
button, .btn {
  background: var(--er-chip) !important;
  color: var(--er-text) !important;
  border: 1px solid var(--er-border) !important;
}
button.primary, .btn-primary {
  background: var(--er-accent) !important;
  color: #000 !important;
  border-color: var(--er-accent) !important;
}
button.primary:hover, .btn-primary:hover {
  filter: brightness(1.05);
}

/* Inputs */
input, select, textarea {
  background: var(--er-card) !important;
  color: var(--er-text) !important;
  border: 1px solid var(--er-border) !important;
}

/* Dividers */
hr, .divider {
  border-color: var(--er-border) !important;
}

/* Lists and small text */
small, .muted, .subtle { color: var(--er-subtle) !important; }
p, li, dt, dd { color: var(--er-text) !important; }

/* Specific areas mentioned */
.rnh-title,
#right-panel h3:has(span[data-source='rnh']),
#right-panel h3[data-section='rnh'] {
  color: var(--er-heading) !important;
}

/* Social follow caption area */
#follow, .follow, .social, #social {
  color: var(--er-text) !important;
}
#follow small, .follow small, .social small, #social small {
  color: var(--er-text) !important;
}

/* Additional Ways to Listen tile captions */
#listen-tiles .tile .caption,
#listen-tiles .tile .label,
#listen-tiles .tile small,
#listen-tiles .tile p,
#listen-tiles .tile span.caption,
#additional-ways .tile .caption,
#additional-ways .tile p,
#additional-ways small,
#additional-ways .tile .label {
  color: var(--er-text) !important;
}

/* Player area */
#player, .player, #now-playing, .now-playing {
  background: var(--er-card) !important;
  color: var(--er-text) !important;
  border: 1px solid var(--er-border) !important;
}

/* Weather widget wrapper (keep dark but readable) */
#weather, .weather-widget {
  background: var(--er-card) !important;
  color: var(--er-text) !important;
}

/* Footer */
footer, .footer {
  color: var(--er-text) !important;
  border-top: 1px solid var(--er-border) !important;
}

/* === RNH story text to white === */
#rnh-news-list,
#rnh-news-list *,
#rnh .rnh-story,
#rnh .rnh-story *,
#rnh .story,
#rnh .story *,
.rnh-story, .rnh-story *,
#right-panel .rnh-item, #right-panel .rnh-item *,
#newsModal .rnh-item, #newsModal .rnh-item *,
#newsModal #rnh-news-list, #newsModal #rnh-news-list *,
#rnh-news-list a, #rnh-news-list p, #rnh-news-list li, #rnh-news-list small, #rnh-news-list span {
  color: #fff !important;
}

</style><style id="rnh-date-accent">

/* === RNH dates in yellow === */
#rnh, #right-panel, #newsModal {
  --rnh-accent: var(--er-accent, #fed351);
}
/* Target common date/time elements in RNH widgets (panel + modal) */
#rnh-news-list time,
#rnh time,
#rnh .date, #rnh .rnh-date, #rnh .pub-date, #rnh .posted-on, #rnh .meta .date,
#rnh-news-list .date, #rnh-news-list .rnh-date, #rnh-news-list .pub-date, #rnh-news-list .posted-on,
#right-panel .rnh-item time, #right-panel .rnh-item .date, #right-panel .rnh-item .rnh-date, #right-panel .rnh-item .pub-date,
#newsModal .rnh-item time, #newsModal .rnh-item .date, #newsModal .rnh-item .rnh-date, #newsModal .rnh-item .pub-date,
#newsModal #rnh-news-list time,
#newsModal #rnh-news-list .date,
#rnh-news-list small.time, #rnh-news-list small.date,
#rnh-news-list .meta time, #rnh-news-list .meta .date {
  color: var(--rnh-accent) !important;
}

</style><style id="rnh-date-fix">
/* === Force RNH dates to yellow === */
#rnh-news-list .rnh-date, #rnh-news-list #rnh-news-list .rnh-date, #right-panel .rnh-item #rnh-news-list .rnh-date, #newsModal .rnh-item #rnh-news-list .rnh-date {
  color: var(--er-accent, #fed351) !important;
}
</style><style id="rnh-date-final">
/* === FINAL: Force RNH dates to yellow (override white rules) === */
#rnh-news-list #rnh-news-list .rnh-date,
#right-panel .rnh-item #rnh-news-list .rnh-date,
#newsModal .rnh-item #rnh-news-list .rnh-date,
#rnh-news-list .rnh-date { color: var(--er-accent, #fed351) !important; }
</style><style id="rnh-date-structural">
/* === Structural target: make the date (2nd child div) yellow === */
#rnh-news-list > div > div,
#newsModal #rnh-news-list > div > div {
  color: var(--er-accent, #fed351) !important;
}
</style><style id="gradient-restore">
/* Let the page gradient show through */
main, .main, .content, .wrapper, #page, #app {
  background: transparent !important;
}
</style><style id="gradient-assert">
/* Ensure the site gradient is visible */
html { background: transparent !important; }
body { background: linear-gradient(135deg, #00818a, #7e1974) !important; }
</style><style id="clock-red-fix">
/* === Enforce original red clock time === */
#clockTime { color: #e53935 !important; }
</style><style id="light-mode-readability">
/* ===== Light Mode Readability Fixes (Now Playing & Recently Played) ===== */
:root[data-theme="light"] #now-playing,
:root[data-theme="light"] #now-playing *,
:root[data-theme="light"] #now-playing-card,
:root[data-theme="light"] #nowplaying-inline-white-fix {
  color: #111 !important;
}

:root[data-theme="light"] #now-playing-card {
  background: #ffffff !important;
  border: 1px solid #e5e7eb !important; /* Tailwind slate-200-ish */
  box-shadow: 0 1px 8px rgba(0,0,0,0.06);
}

:root[data-theme="light"] .recently-played-container,
:root[data-theme="light"] .recent-title {
  color: #111 !important;
}

:root[data-theme="light"] ul#recent-list,
:root[data-theme="light"] ul#recent-list * {
  color: #111 !important;
}

:root[data-theme="light"] ul#recent-list span.time {
  color: #555 !important;
}

/* Links inside recent list in light mode */
:root[data-theme="light"] ul#recent-list a {
  color: #111 !important;
  text-decoration: none;
}

/* Optional: subtle separators in light mode */
:root[data-theme="light"] ul#recent-list li {
  border-bottom: 1px solid #eee !important;
}
</style><style id="light-mode-components">
:root[data-theme="light"] #player,
:root[data-theme="light"] .player,
:root[data-theme="light"] #now-playing,
:root[data-theme="light"] #now-playing-card {
  background: var(--er-card) !important;
  color: var(--er-text) !important;
  border: 1px solid var(--er-border) !important;
}
:root[data-theme="light"] ul#recent-list,
:root[data-theme="light"] ul#recent-list * {
  color: var(--er-text) !important;
}
:root[data-theme="light"] .recent-title { color: var(--er-heading) !important; }
</style><style id="bigger-icons-in-circles">
/* === Enlarge icons within yellow circles (social + tiles) === */
/* Social buttons: keep circle size, scale SVG up inside */
.side-social-btn svg {
  width: 78% !important;
  height: 78% !important;
}

/* 'Additional Ways to Listen' tile icons */
.tile-icon svg {
  width: 82% !important;
  height: 82% !important;
}

/* If any tile icons use <img>, scale them too */
.tile-icon img {
  width: 82% !important;
  height: 82% !important;
  object-fit: contain !important;
}

/* Ensure the circle remains perfectly centered */
.side-social-btn, .tile-icon {
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
}
</style><style id="bigger-icons-tweak">
/* === Tweak: slightly reduce icon scale inside circles === */
.side-social-btn svg { width: 70% !important; height: 70% !important; }
.tile-icon svg { width: 76% !important; height: 76% !important; }
.tile-icon img { width: 76% !important; height: 76% !important; }
</style><style id="light-modal-fixes">
/* ===== Light Mode: modal readability fixes ===== */
:root[data-theme="light"] .modal-content,
:root[data-theme="light"] .modal .modal-content {
  background: #ffffff !important;
  color: #111827 !important;
  border: 1px solid #e5e7eb !important;
  box-shadow: 0 10px 30px rgba(0,0,0,0.12) !important;
}

/* Ensure all text inside modals is readable in light mode */
:root[data-theme="light"] .modal-content h1,
:root[data-theme="light"] .modal-content h2,
:root[data-theme="light"] .modal-content h3,
:root[data-theme="light"] .modal-content h4,
:root[data-theme="light"] .modal-content h5,
:root[data-theme="light"] .modal-content h6,
:root[data-theme="light"] .modal-content p,
:root[data-theme="light"] .modal-content li,
:root[data-theme="light"] .modal-content dt,
:root[data-theme="light"] .modal-content dd,
:root[data-theme="light"] .modal-content span,
:root[data-theme="light"] .modal-content a {
  color: #111827 !important;
}

/* RNH in modal: dark text for stories in light mode; keep dates yellow */
:root[data-theme="light"] #newsModal #rnh-news-list,
:root[data-theme="light"] #newsModal #rnh-news-list * {
  color: #111827 !important;
}
:root[data-theme="light"] #newsModal #rnh-news-list .rnh-date,
:root[data-theme="light"] #newsModal #rnh-news-list time {
  color: var(--er-accent, #fed351) !important;
}

/* Scope previous RNH white text to dark mode only */
:root[data-theme="dark"] #rnh-news-list,
:root[data-theme="dark"] #rnh-news-list *,
:root[data-theme="dark"] #newsModal #rnh-news-list,
:root[data-theme="dark"] #newsModal #rnh-news-list * {
  color: #fff !important;
}
</style><style id="light-mode-modal-force">
/* === Force light backgrounds for all modal contents in light mode === */
:root[data-theme="light"] #aboutModal .modal-content { background:#ffffff !important; color:#111827 !important; border:1px solid #e5e7eb !important; }
:root[data-theme="light"] #presentersModal .modal-content { background:#ffffff !important; color:#111827 !important; border:1px solid #e5e7eb !important; }
:root[data-theme="light"] #scheduleModal .modal-content { background:#ffffff !important; color:#111827 !important; border:1px solid #e5e7eb !important; }
:root[data-theme="light"] #requestsModal .modal-content { background:#ffffff !important; color:#111827 !important; border:1px solid #e5e7eb !important; }
:root[data-theme="light"] #newsModal .modal-content { background:#ffffff !important; color:#111827 !important; border:1px solid #e5e7eb !important; }
:root[data-theme="light"] #travelModal .modal-content { background:#ffffff !important; color:#111827 !important; border:1px solid #e5e7eb !important; }
:root[data-theme="light"] #localModal .modal-content { background:#ffffff !important; color:#111827 !important; border:1px solid #e5e7eb !important; }
:root[data-theme="light"] #playlistModal .modal-content { background:#ffffff !important; color:#111827 !important; border:1px solid #e5e7eb !important; }
:root[data-theme="light"] #listenModal .modal-content { background:#ffffff !important; color:#111827 !important; border:1px solid #e5e7eb !important; }
:root[data-theme="light"] #searchModal .modal-content { background:#ffffff !important; color:#111827 !important; border:1px solid #e5e7eb !important; }
:root[data-theme="light"] #contactModal .modal-content { background:#ffffff !important; color:#111827 !important; border:1px solid #e5e7eb !important; }
</style><style id="light-modal-hard-override">
/* ---- FINAL OVERRIDE: Light mode modals must be white ---- */
:root[data-theme="light"] .modal-content,
:root[data-theme="light"] .modal .modal-content,
:root[data-theme="light"] #aboutModal .modal-content,
:root[data-theme="light"] #presentersModal .modal-content,
:root[data-theme="light"] #scheduleModal .modal-content,
:root[data-theme="light"] #requestsModal .modal-content,
:root[data-theme="light"] #newsModal .modal-content,
:root[data-theme="light"] #travelModal .modal-content,
:root[data-theme="light"] #localModal .modal-content,
:root[data-theme="light"] #playlistModal .modal-content,
:root[data-theme="light"] #listenModal .modal-content,
:root[data-theme="light"] #searchModal .modal-content,
:root[data-theme="light"] #contactModal .modal-content,
:root[data-theme="light"] .presenter-modal .modal-content {
  background: #ffffff !important;
  color: #111827 !important;
  border: 1px solid #e5e7eb !important;
  box-shadow: 0 10px 30px rgba(0,0,0,0.12) !important;
  z-index: 10002 !important;
}

/* Also ensure any nested cards inside modals use light tones */
:root[data-theme="light"] .modal-content .card,
:root[data-theme="light"] .modal-content .panel,
:root[data-theme="light"] .modal-content .tile {
  background: #ffffff !important;
  color: #111827 !important;
  border-color: #e5e7eb !important;
}
</style><style id="light-modal-overlay-fix">
/* === Light mode: make modal overlay light, not black === */
:root[data-theme="light"] .modal {
  background: rgba(255,255,255,0.7) !important; /* light glassy backdrop */
}
/* Ensure scroll blockers don't add dark layers */
:root[data-theme="light"] body.modal-open::before,
:root[data-theme="light"] .modal::before {
  background: transparent !important;
}

:root[data-theme="light"] .modal-overlay,
:root[data-theme="light"] .modal-backdrop,
:root[data-theme="light"] .backdrop {
  background: rgba(255,255,255,0.7) !important;
}
</style><style id="theme-overlay-bg">
/* Theme-scoped modal overlay backgrounds */
:root[data-theme="dark"] .modal { background: rgba(0,0,0,0.6) !important; }
:root[data-theme="light"] .modal { background: rgba(255,255,255,0.75) !important; }
</style><style id="light-modal-theme-sync">
/* Light mode: make modals match the main page */
:root[data-theme="light"] .modal {
  background: rgba(255,255,255,0.78) !important; /* light overlay */
}

/* Modal panel uses light palette */
:root[data-theme="light"] .modal-content {
  background: var(--er-panel, #ffffff) !important;
  color: var(--er-text, #111827) !important;
  border: 1px solid var(--er-border, #e5e7eb) !important;
  box-shadow: 0 10px 30px rgba(0,0,0,0.12) !important;
}

/* Ensure all text inside is readable in light mode */
:root[data-theme="light"] .modal-content h1,
:root[data-theme="light"] .modal-content h2,
:root[data-theme="light"] .modal-content h3,
:root[data-theme="light"] .modal-content h4,
:root[data-theme="light"] .modal-content h5,
:root[data-theme="light"] .modal-content h6,
:root[data-theme="light"] .modal-content p,
:root[data-theme="light"] .modal-content li,
:root[data-theme="light"] .modal-content dt,
:root[data-theme="light"] .modal-content dd,
:root[data-theme="light"] .modal-content span,
:root[data-theme="light"] .modal-content a {
  color: var(--er-text, #111827) !important;
}

/* Any nested cards/panels/tiles inside a modal should also be light */
:root[data-theme="light"] .modal-content .card,
:root[data-theme="light"] .modal-content .panel,
:root[data-theme="light"] .modal-content .tile {
  background: var(--er-card, #ffffff) !important;
  color: var(--er-text, #111827) !important;
  border-color: var(--er-border, #e5e7eb) !important;
}

/* Scope any previous dark panel rule to dark mode only (belt-and-braces) */
:root[data-theme="dark"] .modal-content,
:root[data-theme="dark"] .drawer,
:root[data-theme="dark"] .sidebar,
:root[data-theme="dark"] .right-panel,
:root[data-theme="dark"] #right-panel {
  background: var(--er-panel, #12141a) !important;
  color: var(--er-text, #ffffff) !important;
  border-color: var(--er-border, #272a33) !important;
}
</style><style id="search-hour-nav-white">
/* Make 'Previous hour' / 'Next hour' controls white for better contrast */
#searchModal .hour-nav a,
#searchModal .hour-nav button,
#searchModal .hour-next,
#searchModal .hour-prev,
#searchModal .next-hour,
#searchModal .prev-hour {
  color: #ffffff !important;
}
</style><style id="search-hour-nav-final">
#searchModal .hour-nav { color: #ffffff !important; font-weight: 600; }
#searchModal .hour-nav:hover { opacity: 0.9; }
</style><style id="search-hour-nav-id-override">
/* Force white text on specific hour nav buttons */
#searchModal #prevHour,
#searchModal #nextHour { color: #ffffff !important; font-weight: 600; }
</style><style id="search-reset-white">
#searchModal #prevHour,
#searchModal #nextHour { color: #ffffff !important; font-weight: 600; }
#searchModal #reset, 
#searchModal #resetBtn, 
#searchModal #resetButton, 
#searchModal #resetSearch, 
#searchModal #searchReset { color: #ffffff !important; font-weight: 600; }
</style><style id="rnh-dates-dark-restore">
:root[data-theme="dark"] #rnh-news-list .rnh-date,
:root[data-theme="dark"] #rnh-news-list time,
:root[data-theme="dark"] #right-panel .rnh-item .rnh-date,
:root[data-theme="dark"] #right-panel .rnh-item time {
  color: var(--er-accent, #fed351) !important;
}
</style><style id="nav-gap-reduce">
/* Pull content up slightly below the nav */
main, .main, .content, #content, .page, #page, .wrapper {
  margin-top: 0.75rem !important; /* reduce top gap */
}
/* If a hero banner exists, keep a bit more breathing room */
.hero, .banner { margin-top: 1rem !important; }
</style><style id="search-news-targeted-light-fixes">
:root[data-theme="light"] #newsModal,
:root[data-theme="light"] #newsModal * { color: #111827 !important; }
:root[data-theme="light"] #newsModal #rnh-news-list .rnh-date,
:root[data-theme="light"] #newsModal #rnh-news-list time { color: var(--er-accent, #fed351) !important; }
:root[data-theme="light"] #newsModal .card,
:root[data-theme="light"] #newsModal .panel,
:root[data-theme="light"] #newsModal .tile,
:root[data-theme="light"] #newsModal .rnh-item,
:root[data-theme="light"] #newsModal .rnh-story,
:root[data-theme="light"] #newsModal .inner,
:root[data-theme="light"] #newsModal .content { background: #ffffff !important; border-color: #e5e7eb !important; }
</style><style id="nav-gap-reduce-stronger">
header + *, header + section, header + div, header + main { margin-top: 0.5rem !important; }
</style><style id="reset-controls-white">
#searchModal #resetFilters,
#localModal #localReset {
  color: #ffffff !important;
  font-weight: 600;
}
</style><style id="nav-gap-fix">
/* Kill the big spacer after the nav and tighten the gap */
.header-spacer { height: 0 !important; margin: 0 !important; padding: 0 !important; }
/* Nudge immediate content up */
nav + .header-spacer + *, 
nav + * { margin-top: 1rem !important; }
/* Keep hero/banner comfortable if present */
.hero, .banner { margin-top: .75rem !important; }
</style><style id="darklight-toggle-navbar">
nav {
  position: relative;
}
nav #theme-toggle {
  position: absolute;
  right: 1rem;
  top: 50%;
  transform: translateY(-50%);
  margin: 0;
}
</style><style id="navbar-scroll-fix">
@media (max-width: 767px) {
  .navbar-fixed-top,
  .navbar-fixed-bottom,
  .navbar-static-top {
    margin-left: 0 !important;
    margin-right: 0 !important;
  }
}
</style><style id="burger-align-toggle-fix">
@media (max-width: 991px) {
  #theme-toggle {
    float: right;
    margin-right: 1rem;
    margin-top: 0.3rem;
  }
}
.navbar-collapse {
  color: #000 !important;
}
.navbar-collapse a {
  color: #000 !important;
}
</style><style id="desktop-toggle-realign">
@media (min-width: 992px) {
  #theme-toggle {
    position: absolute;
    left: max(1rem, 5vw);
    top: 50%;
    transform: translateY(-50%);
    margin: 0;
    z-index: 9999;
  }
}
</style><style>
/* === Fix: Mobile burger menu text visibility === */
#burgerDropdown a, #burgerDropdown .menu-link, .burger-dropdown a, .burger-dropdown .menu-link {
  color: #0b1220 !important;          /* dark text */
  background: #fed351 !important;     /* brand yellow */
}
#burgerDropdown a:hover, #burgerDropdown a:focus,
#burgerDropdown .menu-link:hover, #burgerDropdown .menu-link:focus,
.burger-dropdown a:hover, .burger-dropdown a:focus,
.burger-dropdown .menu-link:hover, .burger-dropdown .menu-link:focus {
  background: #ffe67c !important;
  color: #0b1220 !important;
}
/* In case a parent sets color to yellow (e.g., .rnh-date), neutralize it within dropdown */
#burgerDropdown, .burger-dropdown {
  color: inherit !important;
}
</style><style>
/* === Place theme toggle beside burger on mobile === */
@media (max-width: 768px) {
  /* Make navbar a flex row if not already */
  header .navbar, nav.navbar, .navbar, header nav, .site-header, .topbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: .5rem;
  }
  /* Treat burger and toggle as a cluster on the right */
  .burger, .burger-button, #burgerButton, #burger, .hamburger, .menu-toggle {
    order: 2;
  }
  /* Theme toggle */
  #themeToggle, #theme-toggle, .theme-toggle, .dark-light-toggle, .mode-toggle, #modeToggle {
    order: 2;
    margin-left: .5rem;
  }
  /* Keep logo to the left */
  .logo, #logo, .brand, .site-logo {
    order: 1;
  }
  /* Put the right-side controls (burger+toggle) in a wrap if container supports it */
  .navbar, header .navbar, header nav, .topbar {
    flex-wrap: nowrap;
  }
  /* If toggle was hidden on mobile, reveal it */
  #themeToggle, #theme-toggle, .theme-toggle, .dark-light-toggle, .mode-toggle, #modeToggle {
    display: inline-flex !important;
  }
  /* Fine-tune vertical alignment */
  #themeToggle button, #theme-toggle button, .theme-toggle button {
    height: 36px;
  }
}
</style><style>

  #burgerMenuBtn { order: 2; }
  #themeToggle { order: 2; }
}
</style><style id="ultimate-light-modal-overlay-override">
/* FINAL OVERRIDE: ensure light-mode modal overlays are light, even if later !important rules exist */
html[data-theme="light"] .modal,
html[data-theme="light"] .modal-overlay,
html[data-theme="light"] .modal-backdrop,
html[data-theme="light"] .backdrop {
  background: rgba(255,255,255,0.78) !important;
}
html[data-theme="light"] body.modal-open::before,
html[data-theme="light"] .modal::before {
  background: rgba(255,255,255,0.78) !important;
}
</style><style id="final-light-overlays-presenters-schedule">
/* Force light overlay for presenters and schedule in light mode */
html[data-theme="light"] .modal.presenter-modal,
html[data-theme="light"] #scheduleModal {
  background: rgba(255,255,255,0.78) !important;
}
html[data-theme="light"] .modal.presenter-modal::before,
html[data-theme="light"] #scheduleModal::before {
  background: rgba(255,255,255,0.78) !important;
}
</style><style id="final-presenters-schedule-news-light-fix">
/* Light overlay for ALL modals in light mode */
html[data-theme="light"] .modal,
html[data-theme="light"] .modal.presenter-modal,
html[data-theme="light"] .modal.presenter-detail,
html[data-theme="light"] #scheduleModal,
html[data-theme="light"] #presentersModal,
html[data-theme="light"] #newsModal {
  background: rgba(255,255,255,0.78) !important;
}

/* Ensure no pseudo-element re-darkens the overlay */
html[data-theme="light"] .modal::before,
html[data-theme="light"] .modal.presenter-modal::before,
html[data-theme="light"] .modal.presenter-detail::before,
html[data-theme="light"] #scheduleModal::before,
html[data-theme="light"] #presentersModal::before,
html[data-theme="light"] #newsModal::before {
  background: rgba(255,255,255,0.78) !important;
}

/* Panels inside modals use light palette */
html[data-theme="light"] .modal-content,
html[data-theme="light"] .modal .modal-content,
html[data-theme="light"] .presenter-modal .modal-content {
  background: #ffffff !important;
  color: #111827 !important;
  border: 1px solid #e5e7eb !important;
  box-shadow: 0 10px 30px rgba(0,0,0,0.12) !important;
}

/* Any inner cards/panels/tiles inside these modals also light */
html[data-theme="light"] .modal-content .card,
html[data-theme="light"] .modal-content .panel,
html[data-theme="light"] .modal-content .tile,
html[data-theme="light"] .modal-content .presenter-card {
  background: #ffffff !important;
  color: #111827 !important;
  border-color: #e5e7eb !important;
}

/* Presenters: kill any residual dark background declarations */
html[data-theme="light"] .presenter-modal { background: rgba(255,255,255,0.78) !important; }
html[data-theme="light"] .modal.presenter-modal { background: rgba(255,255,255,0.78) !important; }

/* Schedule: enforce light */
html[data-theme="light"] #scheduleModal .modal-content { background: #ffffff !important; color: #111827 !important; }
html[data-theme="light"] #scheduleModal { background: rgba(255,255,255,0.78) !important; }

/* NEWS modal: readable story text & yellow dates in light mode */
html[data-theme="light"] #newsModal #rnh-news-list,
html[data-theme="light"] #newsModal #rnh-news-list * {
  color: #111827 !important;
}
html[data-theme="light"] #newsModal #rnh-news-list .rnh-date,
html[data-theme="light"] #newsModal #rnh-news-list time {
  color: var(--er-accent, #fed351) !important;
}
html[data-theme="light"] #newsModal a { color: #111827 !important; }
</style><style id="final-schedule-news-only">
/* Light overlays for schedule & news modals */
html[data-theme="light"] #scheduleModal,
html[data-theme="light"] #scheduleModal::before,
html[data-theme="light"] #newsModal,
html[data-theme="light"] #newsModal::before {
  background: rgba(255,255,255,0.78) !important;
}

/* Modal panels */
html[data-theme="light"] #scheduleModal .modal-content,
html[data-theme="light"] #newsModal .modal-content {
  background: #ffffff !important;
  color: #111827 !important;
  border: 1px solid #e5e7eb !important;
  box-shadow: 0 10px 30px rgba(0,0,0,0.12) !important;
}

/* Ensure any nested cards/panels/tiles are light */
html[data-theme="light"] #scheduleModal .modal-content .card,
html[data-theme="light"] #scheduleModal .modal-content .panel,
html[data-theme="light"] #scheduleModal .modal-content .tile,
html[data-theme="light"] #newsModal .modal-content .card,
html[data-theme="light"] #newsModal .modal-content .panel,
html[data-theme="light"] #newsModal .modal-content .tile {
  background: #ffffff !important;
  color: #111827 !important;
  border-color: #e5e7eb !important;
}

/* News list readability (light mode) */
html[data-theme="light"] #newsModal #rnh-news-list,
html[data-theme="light"] #newsModal #rnh-news-list * { color: #111827 !important; }
html[data-theme="light"] #newsModal #rnh-news-list .rnh-date,
html[data-theme="light"] #newsModal #rnh-news-list time { color: var(--er-accent, #fed351) !important; }
html[data-theme="light"] #newsModal a { color: #111827 !important; }

/* Schedule-specific inner sections often use dark chips; neutralize them in light mode */
html[data-theme="light"] #scheduleModal .chip,
html[data-theme="light"] #scheduleModal .badge,
html[data-theme="light"] #scheduleModal .show-block,
html[data-theme="light"] #scheduleModal .slot-block {
  background: #ffffff !important;
  color: #111827 !important;
  border: 1px solid #e5e7eb !important;
}

/* Force any lingering dark backgrounds inside schedule/news to inherit light */
html[data-theme="light"] #scheduleModal *,
html[data-theme="light"] #newsModal * {
  --panel-bg: #ffffff;
}
</style><style id="light-mode-schedule-news-inner-fixes">
/* Schedule: inner block (day-card) should be light in light mode */
html[data-theme="light"] #scheduleModal .day-card {
  background: #ffffff !important;
  color: #111827 !important;
  border: 1px solid #e5e7eb !important;
  box-shadow: 0 1px 8px rgba(0,0,0,0.06) !important;
}
html[data-theme="light"] #scheduleModal .day-card * { color: #111827 !important; }

/* News modal: force readable text in light mode */
html[data-theme="light"] #newsModal * { color: #111827 !important; }
html[data-theme="light"] #newsModal h2,
html[data-theme="light"] #newsModal h3,
html[data-theme="light"] #newsModal h4 { color: #111827 !important; }

/* Keep RNH dates yellow in news modal */
html[data-theme="light"] #newsModal #rnh-news-list .rnh-date,
html[data-theme="light"] #newsModal #rnh-news-list time { color: var(--er-accent, #fed351) !important; }

/* Soften dark borders/shadows inside news modal */
html[data-theme="light"] #newsModal [style*="border:1px solid #333"] { border: 1px solid #e5e7eb !important; }
html[data-theme="light"] #newsModal [style*="box-shadow:0 0 20px"] { box-shadow: 0 2px 12px rgba(0,0,0,0.12) !important; }
</style><style id="light-mode-search-news-fixes">
/* === Song Search (light mode): make menus legible === */
:root[data-theme="light"] #searchModal input,
:root[data-theme="light"] #searchModal select,
:root[data-theme="light"] #searchModal textarea {
  background: #ffffff !important;
  color: #111827 !important;
  border: 1px solid #e5e7eb !important;
}

/* Common menu/dropdown containers in search modal */
:root[data-theme="light"] #searchModal .dropdown-menu,
:root[data-theme="light"] #searchModal .menu,
:root[data-theme="light"] #searchModal .listbox,
:root[data-theme="light"] #searchModal .options,
:root[data-theme="light"] #searchModal .select-menu,
:root[data-theme="light"] #searchModal ul,
:root[data-theme="light"] #searchModal li {
  background: #ffffff !important;
  color: #111827 !important;
  border-color: #e5e7eb !important;
}

/* Placeholder contrast */
:root[data-theme="light"] #searchModal ::placeholder { color: #6b7280 !important; }

/* === Radio News Hub modal (light mode): kill dark inner blocks === */
:root[data-theme="light"] #newsModal [style*="background"],
:root[data-theme="light"] #newsModal [style*="background-color"] {
  background: #ffffff !important;
}

/* Ensure all common inner containers are light */
:root[data-theme="light"] #newsModal .card,
:root[data-theme="light"] #newsModal .panel,
:root[data-theme="light"] #newsModal .tile,
:root[data-theme="light"] #newsModal .rnh-item,
:root[data-theme="light"] #newsModal .rnh-story,
:root[data-theme="light"] #newsModal .inner,
:root[data-theme="light"] #newsModal .content {
  background: #ffffff !important;
  color: #111827 !important;
  border-color: #e5e7eb !important;
}

/* Text readability + keep dates yellow */
:root[data-theme="light"] #newsModal,
:root[data-theme="light"] #newsModal * {
  color: #111827 !important;
}
:root[data-theme="light"] #newsModal #rnh-news-list .rnh-date,
:root[data-theme="light"] #newsModal #rnh-news-list time {
  color: var(--er-accent, #fed351) !important;
}
</style><style id="targeted-fixes-rnh-card-and-search">
/* Radio News Hub modal: card blocks should be light in light mode */
:root[data-theme="light"] #newsModal .rnh-card {
  background: #ffffff !important;
  border: 1px solid #e5e7eb !important;
}
:root[data-theme="light"] #newsModal .rnh-cards { background: transparent !important; }

/* Song Search: ensure everything is legible in light mode */
:root[data-theme="light"] #searchModal,
:root[data-theme="light"] #searchModal * {
  color: #111827 !important;
}
:root[data-theme="light"] #searchModal select,
:root[data-theme="light"] #searchModal input,
:root[data-theme="light"] #searchModal textarea {
  background: #ffffff !important;
  border: 1px solid #e5e7eb !important;
}
:root[data-theme="light"] #searchModal option {
  background: #ffffff !important;
  color: #111827 !important;
}
</style><style id="songsearch-light-override-final">
/* Keep these controls WHITE in light mode, even if a global light text rule exists */
:root[data-theme="light"] #searchModal #prevHour,
:root[data-theme="light"] #searchModal #nextHour,
:root[data-theme="light"] #searchModal #resetFilters {
  color: #ffffff !important;
  font-weight: 600;
  text-shadow: 0 1px 2px rgba(0,0,0,0.25);
}
</style><style id="rnh-dark-dates-frontpage">
/* Dark mode: front page RNH dates back to yellow (override any white text rules) */
:root[data-theme="dark"] body #right-panel #rnh-news-list time,
:root[data-theme="dark"] body #right-panel #rnh-news-list #rnh-news-list .rnh-date,
:root[data-theme="dark"] body #rnh-news-list time,
:root[data-theme="dark"] body #rnh-news-list #rnh-news-list .rnh-date {
  color: var(--er-accent, #fed351) !important;
}
</style><style id="rnh-rightpanel-dates-structural">
/* Dark mode: force the right-panel RNH date (the last child div in each item) back to yellow */
:root[data-theme="dark"] #right-panel #rnh-news-list > div > div:last-child,
:root[data-theme="dark"] #rnh-news-list > div > div:last-child {
  color: var(--er-accent, #fed351) !important;
}
</style><style id="dark-modal-headings-white">
:root[data-theme="dark"] .modal-content h1,
:root[data-theme="dark"] .modal-content h2,
:root[data-theme="dark"] .modal-content h3,
:root[data-theme="dark"] .modal-content h4,
:root[data-theme="dark"] .modal-content h5,
:root[data-theme="dark"] .modal-content h6 {
  color: #ffffff !important;
}
</style><style id="schedule-links-and-dropdowns-fixed">
/* Programme Schedule: kill teal/underlines in dark mode */
:root[data-theme="dark"] #scheduleModal a,
:root[data-theme="dark"] .programme-schedule a,
:root[data-theme="dark"] .program-schedule a,
:root[data-theme="dark"] .schedule a {
  color: #ffffff !important;
  text-decoration: none !important;
}
:root[data-theme="dark"] #scheduleModal a:hover,
:root[data-theme="dark"] .programme-schedule a:hover,
:root[data-theme="dark"] .program-schedule a:hover,
:root[data-theme="dark"] .schedule a:hover {
  text-decoration: underline !important; /* optional hover */
}

/* Schedule dropdown legibility */
/* Light mode */
:root[data-theme="light"] #scheduleModal label { color: #111827 !important; }
:root[data-theme="light"] #scheduleModal select {
  background: #ffffff !important;
  color: #111827 !important;
  border: 1px solid #e5e7eb !important;
  border-radius: 8px;
  padding: 8px 12px;
}
:root[data-theme="light"] #scheduleModal option {
  background: #ffffff !important;
  color: #111827 !important;
}

/* Dark mode */
:root[data-theme="dark"] #scheduleModal label { color: #ffffff !important; }
:root[data-theme="dark"] #scheduleModal select {
  background: var(--er-panel, #12141a) !important;
  color: #ffffff !important;
  border: 1px solid var(--er-border, #272a33) !important;
  border-radius: 8px;
  padding: 8px 12px;
}
:root[data-theme="dark"] #scheduleModal option {
  background: var(--er-panel, #12141a) !important;
  color: #ffffff !important;
}

/* If a custom dropdown/menu is used */
:root[data-theme="light"] #scheduleModal .dropdown-menu,
:root[data-theme="light"] #scheduleModal .menu,
:root[data-theme="light"] #scheduleModal .listbox,
:root[data-theme="light"] #scheduleModal .options {
  background: #ffffff !important; color: #111827 !important; border: 1px solid #e5e7eb !important;
}
:root[data-theme="dark"] #scheduleModal .dropdown-menu,
:root[data-theme="dark"] #scheduleModal .menu,
:root[data-theme="dark"] #scheduleModal .listbox,
:root[data-theme="dark"] #scheduleModal .options {
  background: var(--er-panel, #12141a) !important; color: #ffffff !important; border: 1px solid var(--er-border, #272a33) !important;
}
</style><style id="about-email-dark-fix">
/* About Us: make email link white in dark mode (no underline), with underline on hover */
:root[data-theme="dark"] #aboutModal a[href^="mailto:"] {
  color: #ffffff !important;
  text-decoration: none !important;
}
:root[data-theme="dark"] #aboutModal a[href^="mailto:"]:hover {
  text-decoration: underline !important;
}
</style><style id="songsearch-artist-title-yellow">
/* Song Search: make 'Artist - Title' text yellow */
#searchModal .result-title,
#searchModal .song-title,
#searchModal .track-title,
#searchModal .track,
#searchModal .result .title,
#searchModal .song-result .title {
  color: var(--er-accent, #fed351) !important;
}
</style><style id="songsearch-thead-yellow">
/* Song Search: make the table header (including "Artist – Title") yellow in both themes */
#searchModal thead,
#searchModal thead th {
  color: var(--er-accent, #fed351) !important;
}
</style><style id="about-email-yellow">
/* About Us: email link in accent yellow, both themes (wins over earlier dark-mode white) */
:root[data-theme="dark"] #aboutModal a[href^="mailto:"],
:root[data-theme="light"] #aboutModal a[href^="mailto:"],
#aboutModal a[href^="mailto:"] {
  color: var(--er-accent, #fed351) !important;
  text-decoration: none !important;
}
#aboutModal a[href^="mailto:"]:hover {
  text-decoration: underline !important;
}
</style><style id="about-email-light-readable">
/* About Us email: readable teal in light mode, yellow in dark mode */
:root[data-theme="light"] #aboutModal a[href^="mailto:"] { color: #00818a !important; }
:root[data-theme="dark"]  #aboutModal a[href^="mailto:"] { color: var(--er-accent, #fed351) !important; }
#aboutModal a[href^="mailto:"]:hover { text-decoration: underline !important; }
</style><style id="nav-gap-visible">
/* Push page content lower under the nav bar */
nav + .header-spacer + main,
nav + .header-spacer + section,
nav + .header-spacer + div,
nav + main,
nav + section,
nav + div {
  margin-top: 1.5rem !important;
}
</style><style>
/* === Mobile-only cloned theme toggle beside burger === */
#themeToggle {
  display: none; /* hide on desktop */
}
@media (max-width: 768px) {
  #themeToggle { display: inline-flex; order: 2; margin-left: .5rem; }
  #burgerMenuBtn { order: 2; }
  nav.navbar { display:flex; align-items:center; justify-content:space-between; }
}
</style><style id="additional-ways-side-listen-fix">
  /* Light mode: force black text in Additional Ways to Listen (.side-listen) */
  [data-theme="light"] .side-listen,
  [data-theme="light"] .side-listen * {
    color: #000000 !important;
    -webkit-text-fill-color: #000000 !important;
  }
</style><style id="mobile-text-toggle-near-burger">
  @media (max-width: 750px) {
    #themeToggleBtn {
      position: fixed !important;
      top: 20px !important;
      left: 48px !important;
      height: 32px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      padding: 0 10px !important;
      border-radius: 7px !important;
      background: var(--accent) !important;
      color: #fff !important;
      border: none !important;
      font-size: 14px !important;
      line-height: 1 !important;
      z-index: 3201 !important;
    }
  }
  
  }
</style><style id="show-desktop-theme-toggle">
  @media (min-width: 751px){
    #themeToggleBtn.theme-navbtn { display: inline-flex !important; }
  }
</style><style id="hide-contact-request-headings">
  /* Hide blue H2 headers inside Contact and Requests modals */
  #contactModal .modal-content h2,
  #requestsModal .modal-content h2 {
    display: none !important;
  }
</style><style id="navbar-offset-fix">body { padding-top: var(--nav-h, 60px); }</style><script>
const P251019-0944';
</script><script>
(function() {
  function setNavOffset(){
    const nav = document.querySelector('.navbar');
    let h = nav ? nav.offsetHeight : 60;
    if (h < 40 && window.matchMedia('(max-width: 750px)').matches) { h = 56; }
    document.documentElement.style.setProperty('--nav-h', h + 'px');
  }
  window.addEventListener('load', setNavOffset, {once:true});
  window.addEventListener('resize', setNavOffset);
  setTimeout(setNavOffset, 250);
})();
</script><style id="mobile-toggle-fixed">
@media (max-width: 750px){
  /* Show the same toggle button on mobile, positioned beside the burger */
  #themeToggleBtn.theme-navbtn {
    position: fixed !important;
    top: 20px !important;
    right: 8px !important;
    height: 32px !important;
    line-height: 32px !important;
    padding: 0 10px !important;
    display: inline-flex !important;
    align-items: center !important;
    gap: 4px !important;
    z-index: 2002 !important; /* above the burger overlay */
    border-radius: 7px !important;
  }
  /* Hide long text label on narrow screens, keep the icon */
  #themeToggleBtn .mode-label { display: none !important; }
}
</style><style id="mobile-theme-toggle-style">
/* Mobile: pin the same button beside the burger */
.theme-navbtn.mobile-fixed{
  position: fixed;
  top: 20px;
  right: 8px;
  height: 32px;
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 0 10px;
  z-index: 2002; /* above burger; below dropdown */
}
@media (max-width: 480px){
  .theme-navbtn.mobile-fixed .mode-label{ display:none; }
}
</style><style id="theme-toggle-compact">
/* Compact icon-only theme toggle, like the burger */
#themeToggleBtn.theme-navbtn {
  width: 32px !important;
  height: 32px !important;
  padding: 0 !important;
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  border-radius: 7px !important;
  line-height: 1 !important;
  gap: 0 !important;
}
#themeToggleBtn .mode-label { display: none !important; } /* icon-only everywhere */

/* Mobile: keep the same button beside the burger (fixed) */
@media (max-width: 750px){
  #themeToggleBtn.theme-navbtn.mobile-fixed {
    position: fixed !important;
    top: 20px !important;
    right: 8px !important;
    z-index: 2002 !important;
  }
}
</style><style id="mute-toggle-override">
/* Mute button styling – Essential yellow theme */
#mute-toggle {
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  width: 42px !important;
  height: 42px !important;
  border-radius: 50% !important;
  background-color: #fed351 !important;  /* Essential yellow */
  color: #111 !important;                /* Dark icon for contrast */
  border: 2px solid #e6c13c !important;   /* Slightly darker yellow border */
  font-size: 20px !important;
  transition: background-color 0.2s, transform 0.15s ease;
  padding: 0 !important;
  box-shadow: 0 3px 10px rgba(0,0,0,0.2);
}

/* Icon inside */
#mute-toggle svg,
#mute-toggle i {
  width: 1.5em !important;
  height: 1.5em !important;
}

/* Hover effect */
#mute-toggle:hover {
  background-color: #ffe67c !important;   /* lighter yellow on hover */
  transform: scale(1.05);
}
</style><style id="contact-modal-fullscreen-override">
/* ===== Contact modal: force true fullscreen on DESKTOP, prevent bottom cut ===== */

/* Base: let the modal backdrop fill the viewport and not crop content */
.modal {
  position: fixed !important;
  left: 0 !important;
  top: 0 !important;
  width: 100vw !important;
  height: 100vh !important;
  overflow: hidden !important;           /* background doesn't scroll */
}

/* Generic modal-content rules are already present; raise the cap for desktop */
@media (min-width: 751px) {
  /* Target Contact + Requests if present */
  #contactModal .modal-content,
  #requestsModal .modal-content {
    margin: 0 auto !important;
    width: 96vw !important;
    max-width: 1200px !important;
    height: 94vh !important;             /* nearly fullscreen */
    max-height: 94vh !important;
    padding: 16px !important;
    overflow: hidden !important;         /* inner wrapper/iframe will scroll */
    border-radius: 16px !important;
  }

  /* Inner scrolling area (iframe or wrapper) */
  #contactModal .modal-content .embed-wrap,
  #requestsModal .modal-content .embed-wrap {
    height: 100% !important;
    overflow: hidden !important;
  }

  /* Make the iframe fill the available height */
  #contactModal iframe,
  #requestsModal iframe,
  #contactModal .embed-wrap iframe,
  #requestsModal .embed-wrap iframe {
    display: block !important;
    width: 100% !important;
    height: calc(94vh - 48px) !important; /* subtract padding/close button */
    border: 0 !important;
    overflow: auto !important;
  }
}

/* MOBILE already handles 56px top offset elsewhere; ensure contact/request iframes fill */
@media (max-width: 750px) {
  #contactModal .modal-content,
  #requestsModal .modal-content {
    margin: 0 !important;
    width: 96vw !important;
    max-width: 96vw !important;
    max-height: calc(100vh - 56px) !important;
    height: calc(100vh - 56px) !important;
    overflow: hidden !important;
  }
  #contactModal iframe,
  #requestsModal iframe {
    width: 100% !important;
    height: calc(100vh - 56px - 36px) !important;
    border: 0 !important;
  }
}

/* Keep close button above the iframe and clickable */
#contactModal .close,
#requestsModal .close {
  position: absolute !important;
  z-index: 10 !important;
}
</style><style id="song-search-buttons-override">
/* Song Search: Previous / Next / Reset in Essential Yellow – compact version */
#searchModal #prevHour,
#searchModal #nextHour,
#searchModal #resetFilters {
  background-color: #fed351 !important;
  color: #111 !important;
  border: 1px solid #e6c13c !important;
  font-weight: 600 !important;
  font-size: 14px !important;        /* smaller text */
  border-radius: 6px !important;     /* less rounded */
  padding: 5px 10px !important;      /* smaller padding */
  box-shadow: none !important;       /* remove heavy shadow */
  transition: background-color .2s ease, transform .15s ease !important;
}

/* Hover / focus */
#searchModal #prevHour:hover,
#searchModal #nextHour:hover,
#searchModal #resetFilters:hover {
  background-color: #ffe67c !important;
  transform: none !important; /* no lift effect */
}
</style><style id="play-toggle-override">
/* Base yellow button styling (desktop) */
#play-toggle {
  background-color: #fed351 !important;
  color: #111 !important;
  border: 2px solid #e6c13c !important;
  font-weight: bold !important;
  font-size: 18px !important;
  padding: 14px 24px !important;
  border-radius: 10px !important;
  display: inline-flex !important;
  align-items: center !important;
  gap: 8px !important;
  transition: background-color 0.2s ease, transform 0.15s ease !important;
  margin-top: 8px !important; /* extra space from show name */
}

/* Icon size */
#play-toggle svg,
#play-toggle i {
  width: 1.4em !important;
  height: 1.4em !important;
}

/* Hover effect */
#play-toggle:hover,
#play-toggle:focus {
  background-color: #ffe67c !important;
}

/* Mobile adjustments – scale down further */
@media (max-width: 768px) {
  #play-toggle {
    font-size: 13px !important;
    padding: 8px 14px !important;
    width: auto !important;
    margin: 8px auto 0 auto !important; /* space from show name, center horizontally */
    border-radius: 8px !important;
    gap: 6px !important;
  }
  #play-toggle svg,
  #play-toggle i {
    width: 1.1em !important;
    height: 1.1em !important;
  }
}
</style><style id="enhancements-ui">
/* --- Now Playing marquee --- */
.np-marquee {
  position: relative;
  overflow: hidden;
  white-space: nowrap;
}
.np-track {
  display: inline-block;
  white-space: nowrap;
  will-change: transform;
  animation: np-scroll linear infinite;
  animation-duration: 18s; /* JS recalculates based on text width */
}
.np-track:hover { animation-play-state: paused; }

/* soft gradient fades at the edges */
.np-marquee::before,
.np-marquee::after {
  content:"";
  position:absolute; top:0; bottom:0; width:28px; pointer-events:none;
}
.np-marquee::before { left:0; background:linear-gradient(to right, rgba(0,0,0,.35), transparent); }
.np-marquee::after  { right:0; background:linear-gradient(to left,  rgba(0,0,0,.35), transparent); }
[data-theme="light"] .np-marquee::before { background:linear-gradient(to right, rgba(255,255,255,.75), transparent); }
[data-theme="light"] .np-marquee::after  { background:linear-gradient(to left,  rgba(255,255,255,.75), transparent); }

@keyframes np-scroll { from { transform: translateX(0); } to { transform: translateX(-50%); } }

/* --- Live show highlight in schedule --- */
.live-now {
  border-left: 4px solid var(--brand, #fed351);
  background: linear-gradient(90deg, rgba(254,211,81,.12), transparent 70%);
  box-shadow: 0 0 0 1px rgba(254,211,81,.18) inset, 0 0 22px rgba(254,211,81,.18);
  border-radius: 10px;
  padding-left: 12px;
}
.show--current, .current-show, .show-entry.current, .show.current, .schedule-item.current, .live-now {
border-left: 4px solid var(--brand, #fed351);
  background: linear-gradient(90deg, rgba(254,211,81,.12), transparent 70%);
  box-shadow: 0 0 0 1px rgba(254,211,81,.18) inset, 0 0 22px rgba(254,211,81,.18);
  border-radius: 10px;
  padding-left: 12px;
}

.show--current, .current-show, .show-entry.current, .show.current, .schedule-item.current  {
  border-left: 4px solid var(--brand, #fed351);
  background: linear-gradient(90deg, rgba(254,211,81,.12), transparent 70%);
  box-shadow: 0 0 0 1px rgba(254,211,81,.18) inset, 0 0 22px rgba(254,211,81,.18);
  border-radius: 10px;
  padding-left: 12px;
}
[data-theme="light"] .live-now {
  background: linear-gradient(90deg, rgba(254,211,81,.16), transparent 70%);
}

/* --- Share button --- */
#share-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-weight: 600;
  padding: 10px 16px;
  border-radius: 8px;
  background: var(--brand, #fed351);
  color: #111;
  border: 1px solid rgba(0,0,0,.06);
  cursor: pointer;
}
#share-btn:hover, #share-btn:focus { filter: brightness(.97); }

#share-btn .share-dot {
  width: 6px; height: 6px; border-radius: 50%; background: currentColor;
}

/* mobile layout: keep share under play */
@media (max-width:768px){
  #share-btn { width: 100%; margin-top: 10px; justify-content: center; }
}

/* Share button inside Now Playing card */
#share-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 0.85em;
  padding: 6px 10px;
  border-radius: 6px;
  background: var(--brand, #fed351);
  color: #111;
  border: 1px solid rgba(0,0,0,0.06);
  cursor: pointer;
  margin-top: 8px;
}
#share-btn:hover, #share-btn:focus { filter: brightness(.97); }

/* Share platform popup anchors relative to NP button */
#share-btn { position: relative; }
#share-platforms {
  position: absolute;
  top: 110%;
  left: 50%;
  transform: translateX(-50%);
  background: var(--panel, #222);
  border: 1px solid var(--border, #444);
  border-radius: 6px;
  padding: 4px 6px;
  display: flex;
  gap: 4px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s ease;
  z-index: 5000;
}
#share-btn:hover #share-platforms,
#share-btn:focus-within #share-platforms {
  opacity: 1;
  pointer-events: auto;
}
#share-platforms a {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 22px;
  height: 22px;
  border-radius: 4px;
  background: var(--brand, #fed351);
  color: #111;
  text-decoration: none;
  font-size: 14px;
}
#share-platforms a:hover { filter: brightness(0.95); }

@media (max-width:768px){
  /* On mobile, anchor the popup just under the full-width share button */
  #share-platforms {
    left: 50%;
    transform: translateX(-50%);
  }
}

/* --- Share button inside LIVE box --- */
.live-indicator #share-btn {
  background: var(--brand, #fed351);
  color: #111;
  border: 1px solid rgba(0,0,0,0.06);
  font-size: 0.75em;
  font-weight: 600;
  padding: 4px 8px;
  border-radius: 6px;
  margin-left: 8px;
  cursor: pointer;
}
.live-indicator #share-btn:hover,
.live-indicator #share-btn:focus { filter: brightness(.95); }

.live-indicator #share-btn { position: relative; }
.live-indicator #share-platforms {
  position: absolute;
  top: 120%;
  right: 0;
  background: var(--panel, #222);
  border: 1px solid var(--border, #444);
  border-radius: 6px;
  padding: 4px 6px;
  display: flex;
  gap: 4px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s ease;
  z-index: 5000;
}
.live-indicator #share-btn:hover #share-platforms,
.live-indicator #share-btn:focus-within #share-platforms {
  opacity: 1;
  pointer-events: auto;
}
.live-indicator #share-platforms a {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 20px;
  height: 20px;
  border-radius: 4px;
  background: var(--brand, #fed351);
  color: #111;
  font-size: 13px;
  text-decoration: none;
}
.live-indicator #share-platforms a:hover { filter: brightness(0.95); }

</style><style id="schedule-live-css">
#modalDaySchedule .show-entry.live-now {
  background: rgba(254, 211, 81, 0.12);
  border-left: 4px solid var(--brand, #fed351);
  border-radius: 10px;
  box-shadow: 0 0 0 1px rgba(254, 211, 81, 0.25) inset;
  padding: 10px 12px;
}
#modalDaySchedule .show-entry.live-now time { color: var(--brand, #fed351); }
#modalDaySchedule .show-entry.live-now .show-title { color: #fff; text-shadow: 0 0 8px rgba(254,211,81,0.25); }
</style><style id="np-share-icon-css">
#now-playing-card .np-share-toolbar{
  display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:flex-end; margin:8px 0 6px 0;
}
#now-playing-card .np-share-btn svg { display:block; }
#now-playing-card .np-share-btn { width:30px; height:30px; padding:0; display:inline-flex; align-items:center; justify-content:center; color:#111;
  background: var(--brand, #fed351); color:#111; border:1px solid rgba(0,0,0,.08); border-radius:8px; cursor:pointer; }
#now-playing-card .np-share-btn:focus{ outline:2px solid rgba(0,0,0,.15); outline-offset:2px; }
#now-playing-card .np-share-btn:hover{ filter:brightness(0.97); }
#now-playing-card .np-share-label { margin-right: 4px; font-size:12px; font-weight:700; color: var(--text, #fff); }
[data-theme="light"] #now-playing-card .np-share-label { color:#111; }
@media (max-width: 480px){ #now-playing-card .np-share-toolbar{ justify-content:flex-start; } }
</style><style id="schedule-highlight-style">
/* Highlight for the current show inside the Schedule modal */
.show--current,
.current-show,

/* If the entry already has a highlight class from older CSS, keep it visible */
.show-entry.current, .show.current, .schedule-item.current { 
  outline: 2px solid rgba(254,211,81,.85);
}
</style><style id="modal-expand-fixes">
/* === Modal expansion hardening === */

/* Prefer dynamic viewport units to avoid iOS 100vh issues */
@supports (height: 100dvh) {
  .modal { height: 100dvh !important; }
  /* Desktop */
  .modal-content { max-height: calc(100dvh - 8vh) !important; }
  /* Mobile header offset case */
  @media (max-width: 768px) {
    .modal { top: 56px !important; height: calc(100dvh - 56px) !important; }
    .modal-content { max-height: calc(100dvh - 56px) !important; }
  }
}
/* Safe fallback when dvh unsupported */
@supports not (height: 100dvh) {
  .modal { height: 100svh !important; }
  .modal-content { max-height: calc(100svh - 8vh) !important; }
  @media (max-width: 768px) {
    .modal { top: 56px !important; height: calc(100svh - 56px) !important; }
    .modal-content { max-height: calc(100svh - 56px) !important; }
  }
}

/* Make sure the modal itself isn't clipping content */
.modal { overflow: hidden !important; }
.modal-content {
  display: block !important;
  overflow-y: auto !important;
  -webkit-overflow-scrolling: touch !important;
  contain: content; /* prevent weird overflow painting on iOS */
}

/* Flex children inside modal should be allowed to shrink/grow */
#scheduleModal *, 
#newsModal *, 
.modal-content * {
  min-width: 0;
  min-height: 0;
}

/* Specific to schedule modal columns: prevent overflow clipping */
#modalScheduleContainer .split-columns, 
#modalScheduleContainer .column,
#modalDaySchedule .split-columns,
#modalDaySchedule .column {
  min-width: 0 !important;
  min-height: 0 !important;
}

/* Media inside modals should scale down */
.modal-content img,
.modal-content video,
.modal-content iframe,
.modal-content embed {
  max-width: 100% !important;
  height: auto !important;
  display: block;
}

/* If an iframe needs a reasonable default height */
.modal-content iframe {
  min-height: 240px;
}

/* Make sure sticky headers/footers inside the modal don't steal space */
.modal-content .sticky,
.modal-content [style*="position:sticky"] {
  top: 0;
}

/* Avoid scroll chaining glitches near edges */
.modal, .modal-content { overscroll-behavior: contain; }
</style><style id="presenter-image-uniform">
/* === Uniform Presenter Image Sizing === */
/* Schedule modal presenter avatars */
#modalScheduleContainer .show-entry img,
#modalDaySchedule .show-entry img {
  width: 48px !important;
  height: 48px !important;
  aspect-ratio: 1 / 1 !important;
  object-fit: cover !important;
  border-radius: 50% !important;
  flex-shrink: 0 !important;
}

/* Presenter list / presenter modal cards */
#presentersModal .presenter-card img,
.presenter-modal .presenter-card img,
#presentersModal .presenter img,
.presenter-modal .presenter img,
#presentersModal .presenter-photo,
.presenter-modal .presenter-photo,
#presentersModal .presenter-list img,
.presenter-modal .presenter-list img {
  width: 96px !important;
  height: 96px !important;
  aspect-ratio: 1 / 1 !important;
  object-fit: cover !important;
  border-radius: 12px !important;
  display: block !important;
}

/* Fall-back: any image flagged as presenter via class */
img.presenter, img.presenter-photo, img.host, img.host-photo {
  width: 96px !important;
  height: 96px !important;
  aspect-ratio: 1 / 1 !important;
  object-fit: cover !important;
  border-radius: 12px !important;
}

/* Mobile tweak */
@media (max-width: 768px) {
  #modalScheduleContainer .show-entry img,
  #modalDaySchedule .show-entry img {
    width: 40px !important;
    height: 40px !important;
  }
  #presentersModal .presenter-card img,
  .presenter-modal .presenter-card img,
  #presentersModal .presenter img,
  .presenter-modal .presenter img,
  #presentersModal .presenter-photo,
  .presenter-modal .presenter-photo,
  #presentersModal .presenter-list img,
  .presenter-modal .presenter-list img,
  img.presenter, img.presenter-photo, img.host, img.host-photo {
    width: 80px !important;
    height: 80px !important;
  }
}
</style><style id="presenter-image-centering">
/* === Presenter image centering === */

/* 1) Schedule entries: vertically center avatar relative to text */
#modalScheduleContainer .show-entry,
#modalDaySchedule .show-entry {
      position: relative;
  align-items: center !important; /* override earlier align-items:flex-start */
}

/* 2) Make the actual <img> center itself in any layout (flex, grid, or block) */
#modalScheduleContainer .show-entry img,
#modalDaySchedule .show-entry img,
#presentersModal .presenter-card img,
.presenter-modal .presenter-card img,
#presentersModal .presenter img,
.presenter-modal .presenter img,
#presentersModal .presenter-photo,
.presenter-modal .presenter-photo,
#presentersModal .presenter-list img,
.presenter-modal .presenter-list img,
img.presenter, img.presenter-photo, img.host, img.host-photo {
  display: block !important;
  margin-left: auto !important;
  margin-right: auto !important;
  align-self: center !important;     /* centers along cross-axis in flex/grid */
  object-position: center center !important; /* ensure crop is centered */
  place-self: center !important;     /* grid-friendly centering */
}

/* Optional: if presenter cards have a fixed-height image area, center inside it */
.presenter-card .image, .presenter .image, .presenter-photo-wrap {
  display: grid !important;
  place-items: center !important;
}
</style><style id="schedule-alignment-restore">
/* Restore original schedule row alignment */
#modalScheduleContainer .show-entry,
#modalDaySchedule .show-entry {
      position: relative;
  align-items: flex-start !important;
}
</style><style id="schedule-alignment-hard-restore">
/* === Schedule avatar alignment: restore original === */
#modalScheduleContainer .show-entry,
#modalDaySchedule .show-entry {
      position: relative;
  align-items: flex-start !important;
}

/* Avatars in schedule rows: no auto-centering, sit at the top-left of their slot */
#modalScheduleContainer .show-entry img,
#modalDaySchedule .show-entry img {
  margin: 0 !important;
  align-self: flex-start !important;
  place-self: auto !important;
  object-position: center center !important; /* keep crop centered inside the circle */
  display: block !important;
}
</style><style id="volume-display-contrast-fix">
/* Ensure the volume % label is readable in both themes */
#volume-container #volume-display {
  color: var(--text, #fff) !important;
  font-weight: 600;
  text-shadow: none !important;
}
/* Light mode: dark ink */
[data-theme="light"] #volume-container #volume-display {
  color: #111827 !important;
}
/* Dark mode: bright ink */
[data-theme="dark"] #volume-container #volume-display,
html:not([data-theme="light"]) #volume-container #volume-display {
  color: #f5f7ff !important;
}
</style><style id="np-share-clickable-fix">
#now-playing-card .np-share-toolbar,
#now-playing-card .np-share-btn {
  pointer-events: auto !important;
  z-index: 5;
  position: relative;
}
#now-playing-card *[style*="pointer-events: none"] .np-share-toolbar,
#now-playing-card *[style*="pointer-events:none"] .np-share-toolbar {
  pointer-events: auto !important;
}
</style><style id="np-share-click-path">
/* Put the toolbar above artwork, badges, and decorative layers */
#now-playing-card { position: relative; }
#now-playing-card #np-share-toolbar {
  position: relative !important;
  z-index: 6000 !important;
  pointer-events: auto !important;
}
#now-playing-card #np-share-toolbar * {
  pointer-events: auto !important;
}

/* Ensure common overlapping bits sit lower */
#now-playing-card #artwork,
#now-playing-card .artwork,
#now-playing-card .artwork-container,
#now-playing-card .badge,
#now-playing-card .np-marquee,
#now-playing-card .overlay,
#now-playing-card .glow {
  position: relative;
  z-index: 1 !important;
}

/* Share links should behave like buttons and be obviously clickable */
#now-playing-card #np-share-toolbar .np-share-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  text-decoration: none !important;
  cursor: pointer !important;
}

/* If any ancestor mistakenly disables clicks, re-enable here */
#now-playing-card,
#now-playing-card *:not(#np-share-toolbar):not(#np-share-toolbar *)
{
  /* don't force pointer-events here; just ensure toolbar is clickable */
}
</style><style id="np-share-icon-contrast">
/* Make SVGs inherit button text color */
#np-share-toolbar .np-share-btn svg,
#np-share-toolbar .np-share-btn svg * {
  fill: currentColor !important;
  stroke: none !important;
}

/* Base colors per theme */
[data-theme="dark"] #np-share-toolbar .np-share-btn { color: #fff !important; }   /* white icons in dark mode */
[data-theme="light"] #np-share-toolbar .np-share-btn { color: #000 !important; }  /* black icons in light mode */

/* Platform-specific overrides to guarantee contrast in light mode */
[data-theme="light"] #np-share-toolbar .np-share-btn[data-platform="twitter"]  { color: #fff !important; }  /* black bg -> white icon */
[data-theme="light"] #np-share-toolbar .np-share-btn[data-platform="facebook"] { color: #fff !important; }  /* blue bg -> white icon */
/* WhatsApp on light: keep black icon for max contrast on green */
</style><style id="np-share-neutral-buttons">
/* Neutralize share button background/outline */
#np-share-toolbar .np-share-btn {
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  padding: 6px 8px !important;
  border-radius: 8px !important;
}
#np-share-toolbar .np-share-btn:hover,
#np-share-toolbar .np-share-btn:focus {
  background: rgba(0,0,0,0.06) !important;
}
[data-theme="dark"] #np-share-toolbar .np-share-btn:hover,
[data-theme="dark"] #np-share-toolbar .np-share-btn:focus {
  background: rgba(255,255,255,0.08) !important;
}
</style><style id="np-share-mobile-order-and-modal-stack">
/* --- Keep button order consistent on mobile: Facebook, Twitter, WhatsApp --- */
#np-share-toolbar {
  display: flex;
  align-items: center;
  gap: 8px;
}
#np-share-toolbar .np-share-btn { order: 10; } /* default */
#np-share-toolbar .np-share-btn[data-platform="facebook"],
#np-share-toolbar .np-share-btn[data-platform="fb"] { order: 1; }
#np-share-toolbar .np-share-btn[data-platform="twitter"],
#np-share-toolbar .np-share-btn[data-platform="x"] { order: 2; }
#np-share-toolbar .np-share-btn[data-platform="whatsapp"],
#np-share-toolbar .np-share-btn[data-platform="wa"] { order: 3; }

/* Make sure wrapping keeps the sequence visually on small screens */
@media (max-width: 640px) {
  #np-share-toolbar {
    flex-wrap: wrap;
    row-gap: 6px;
  }
}

/* --- Ensure modals cover share toolbar (share should NOT sit above modals) --- */
#now-playing-card { position: relative; }
#now-playing-card #np-share-toolbar {
  position: relative !important;
  z-index: 1200 !important;  /* below .modal (2000) but above card bits */
  pointer-events: auto !important;
}
/* Keep modal on top (your modals use z-index:2000+) */
.modal { z-index: 2000 !important; }
</style><style id="np-share-order-guard">
#np-share-toolbar{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
#np-share-toolbar .np-share-btn{order:10;text-decoration:none}
#np-share-toolbar .np-share-btn[data-platform="facebook"],
#np-share-toolbar .np-share-btn[data-platform="fb"]{order:1}
#np-share-toolbar .np-share-btn[data-platform="twitter"],
#np-share-toolbar .np-share-btn[data-platform="x"]{order:2}
#np-share-toolbar .np-share-btn[data-platform="whatsapp"],
#np-share-toolbar .np-share-btn[data-platform="wa"]{order:3}
</style><style id="np-share-style-neutral">
#np-share-toolbar{margin-top:8px}
#np-share-toolbar .np-share-btn{
  background: transparent !important;
  border: 1px solid rgba(255,255,255,0.18);
  padding: 6px 10px;
  border-radius: 8px;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  line-height: 1;
}
[data-theme="light"] #np-share-toolbar .np-share-btn{
  border-color: rgba(0,0,0,0.15);
}
#np-share-toolbar .np-share-btn svg{width:16px;height:16px}
#np-share-toolbar .np-share-btn svg [fill="#fed351"],
#np-share-toolbar .np-share-btn svg [fill="#FFF"],
#np-share-toolbar .np-share-btn svg [fill="#ffffff"]{fill:#fff}
[data-theme="light"] #np-share-toolbar .np-share-btn svg [fill="#FFF"],
[data-theme="light"] #np-share-toolbar .np-share-btn svg [fill="#ffffff"]{fill:#111}
</style><style id="np-share-modal-stack">
#now-playing-card{position:relative}
#np-share-toolbar{position:relative;z-index:1200}
.modal{z-index:2000 !important}
</style><style id="mixcloud-compact-css">
  /* Keep Mixcloud players slim in all contexts (modals, lists, etc.) */
  iframe[src*="mixcloud.com/widget/iframe"] {
    width: 100% !important;
    height: 60px !important;
    min-height: 60px !important;
    max-height: 72px !important; /* allow a tiny bit of variation */
    border: 0 !important;
    display: block !important;
    overflow: hidden !important;
  }
</style><style id="events-modal-darkmode-fix">
/* === Dark mode – Events modal link colour override === */
[data-theme="dark"] #eventsModal a,
[data-theme="dark"] #eventsModal a:visited {
  color: var(--text) !important; /* Match normal dark mode text colour */
}
[data-theme="dark"] #eventsModal a:hover,
[data-theme="dark"] #eventsModal a:focus {
  color: var(--er-accent) !important; /* Yellow hover for visibility */
}
</style><style id="hide-livebox-share">
/* Hide the old LIVE-box Share button to avoid duplicates */
.live-indicator #share-btn { display: none !important; }
</style><link href="/manifest.json" rel="manifest"/><link href="/icon-180-yellow.png" rel="apple-touch-icon"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="black" name="apple-mobile-web-app-status-bar-style"/><meta content="#0b0c0f" media="(prefers-color-scheme: dark)" name="theme-color"/><meta content="#0b0c0f" name="theme-color"/><style>
  .install-hint {
    position: fixed;
    bottom: 14px;
    left: 50%;
    transform: translateX(-50%);
    padding: .6rem .8rem;
    background: rgba(0,0,0,.85);
    color: #fff;
    border-radius: .75rem;
    font-size: .9rem;
    line-height: 1.2;
    box-shadow: 0 2px 8px rgba(0,0,0,.4);
    z-index: 9999;
    display: none;
  }
  .install-hint strong { color: #ffd400; }
</style><style id="modal-dimension-overrides">
  /* === Wider, taller modals on desktop; keep mobile behaviour === */
  @media (min-width: 1024px) {
    .modal-content {
      width: auto !important;         /* size to content up to cap */
      max-width: 1200px !important;   /* wider than previous 920px */
      max-height: 95vh !important;    /* taller viewport allowance */
      overflow-y: auto !important;    /* still scroll if truly needed */
      margin: 4% auto !important;     /* tighten top spacing slightly */
    }
  }
</style><style id="schedule-modal-wide">
@media (min-width: 1024px) {
  #scheduleModal .modal-content,
  #scheduleModal #modalScheduleContainer {
    max-width: 1100px !important; /* schedule only */
	margin-top: 60px !important;
    width: 100% !important;
    max-height: 96vh !important;
  }

  /* Ensure Presenters modal keeps the wider default */
  #presentersModal .modal-content {
    max-width: 1200px !important;
    max-height: 95vh !important;
  }
}
</style><style id="schedule-layout-wide">
/* === Schedule modal: make better use of extra width on desktop === */
@media (min-width: 1200px) {
  /* Give the two columns more breathing room */
  #modalScheduleContainer .split-columns {
    display: flex !important;
    gap: 32px !important;
  }
  #modalScheduleContainer .column {
    flex: 1 1 0 !important;
    min-width: 520px !important; /* lets columns widen nicely without squashing */
  }

  /* Enlarge avatars and tighten layout rhythm */
  #modalScheduleContainer .show-entry { 
    gap: 16px !important; 
    margin-bottom: 20px !important;
  }
  #modalScheduleContainer .show-entry img {
    width: 52px !important;
    height: 52px !important;
  }

  /* Improve typographic hierarchy */
  #modalScheduleContainer .show-info time {
    font-size: 15px !important;
  }
  #modalScheduleContainer .show-title-presenter .show-title {
    font-size: 1.12em !important;
    line-height: 1.25 !important;
  }
  #modalScheduleContainer .show-title-presenter .show-presenter {
    font-size: 1.02em !important;
  }
  #modalScheduleContainer .show-details {
    font-size: 14px !important;
    line-height: 1.55 !important;
  }
}

/* Ultra‑wide: if there’s space, allow 3 columns safely when markup permits more than 2 columns */
@media (min-width: 1500px) {
  #modalScheduleContainer .split-columns.three {
    display: grid !important;
    grid-template-columns: 1fr 1fr 1fr !important;
    gap: 28px !important;
  }
  #modalScheduleContainer .split-columns.three .column {
    min-width: 0 !important;
  }
}
</style><style id="presenter-modal-width-fix">
/* Presenter modal width fixes (don’t affect the big presenters list) */
.modal.presenter-modal:not(#presentersModal) .modal-content {
  max-width: 820px !important;   /* tweak this to taste: 760–900 works well */
  width: min(94vw, 820px) !important;
}

/* Ensure the big presenters list stays nice and wide */
#presentersModal .modal-content {
  max-width: 1300px !important;
  width: min(96vw, 1300px) !important;
}
</style><style id="widen-requests-listen-events">
@media (min-width: 1024px) {
  /* Requests & Contact Us wider */
  #requestsModal .modal-content,
  #contactModal .modal-content {
    max-width: 1300px !important;
    width: min(96vw, 1300px) !important;
    max-height: 95vh !important;
  }

  /* Listen Again back to original width */
  #listenModal .modal-content {
    max-width: 920px !important;
    width: min(96vw, 920px) !important;
    max-height: 95vh !important;
  }

  /* Local Events stays at 1300px */
  #localModal .modal-content {
    max-width: 1300px !important;
    width: min(96vw, 1300px) !important;
	margin-top: 60px !important;
    max-height: 95vh !important;
  }
}
</style><style id="modal-scroll-shadows">
.modal-content {
  position: relative;
  overflow-y: auto;
}
.modal-content::before,
.modal-content::after {
  content: "";
  position: sticky;
  left: 0;
  right: 0;
  height: 10px;
  pointer-events: none;
  z-index: 5;
}
.modal-content::before {
  top: 0;
  background: linear-gradient(to bottom, rgba(0,0,0,0.2), transparent);
}
.modal-content::after {
  bottom: 0;
  background: linear-gradient(to top, rgba(0,0,0,0.2), transparent);
}
/* Dark mode adjustment */
body.dark-mode .modal-content::before {
  background: linear-gradient(to bottom, rgba(255,255,255,0.15), transparent);
}
body.dark-mode .modal-content::after {
  background: linear-gradient(to top, rgba(255,255,255,0.15), transparent);
}
</style><script id="modal-scroll-shadows-js">
(function(){
  function updateShadows(el){
    if (!el) return;
    const scrollTop = el.scrollTop;
    const scrollHeight = el.scrollHeight;
    const clientHeight = el.clientHeight;
    el.style.setProperty('--shadow-top-opacity', scrollTop > 0 ? '1' : '0');
    el.style.setProperty('--shadow-bottom-opacity', scrollTop + clientHeight < scrollHeight ? '1' : '0');
  }
  document.addEventListener('DOMContentLoaded', function(){
    document.querySelectorAll('.modal-content').forEach(mc => {
      mc.addEventListener('scroll', () => updateShadows(mc));
      updateShadows(mc);
    });
  });
})();
</script><style id="mobile-now-bar-css">
/* Sticky Now Playing bar (mobile only) */
#mobileNowBar {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  display: none; /* default hidden; enabled on small screens */
  align-items: center;
  gap: 10px;
  padding: 10px 12px;
  background: rgba(16, 18, 21, 0.96);
  color: #fff;
  border-top: 1px solid rgba(255,255,255,0.08);
  box-shadow: 0 -6px 18px rgba(0,0,0,0.25);
  z-index: 3200; /* above modals backdrop */
  -webkit-backdrop-filter: saturate(120%) blur(6px);
  backdrop-filter: saturate(120%) blur(6px);
  line-height: 1.2;
}
#mobileNowBar .np-text {
  flex: 1 1 auto;
  min-width: 0;
  font-size: 14px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
#mobileNowBar .np-text .title {
  font-weight: 700;
}
#mobileNowBar .np-text .artist {
  opacity: 0.9;
}
#mobileNowBar .np-cta {
  flex: 0 0 auto;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 38px;
  height: 38px;
  border-radius: 10px;
  background: var(--brand, #fed351);
  color: #111;
  font-weight: 800;
  border: 1px solid rgba(0,0,0,0.06);
}
#mobileNowBar .np-cta:active { transform: translateY(1px); }

/* Make room for the bar so it doesn't cover content on mobile */
@media (max-width: 768px) {
  #mobileNowBar { display: flex; }
  body { padding-bottom: 64px !important; }
  body.modal-open #mobileNowBar { display: none !important; } /* hide when a modal is open */
}

/* Light theme variant */
html[data-theme="light"] #mobileNowBar {
  background: rgba(255,255,255,0.98);
  color: #0b1220;
  border-top-color: rgba(0,0,0,0.08);
}
</style><style id="mobile-mini-player-style">
  /* Mobile mini-player bar */
  #mobileNowBar {
    position: fixed;
    left: 0; right: 0; bottom: 0;
    z-index: 3002;
    display: none;                 /* shown only on mobile */
    align-items: center;
    gap: 12px;
    padding: 10px 12px;
    background: rgba(16, 18, 21, 0.96);
    backdrop-filter: blur(6px);
    border-top: 1px solid rgba(255,255,255,0.08);
  }
  #mobileNowBar-inner {
    width: 100%;
    max-width: 900px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: auto 1fr;
    align-items: center;
    gap: 12px;
  }
  #mobilePlayBtn {
    -webkit-tap-highlight-color: transparent;
    border: none;
    border-radius: 999px;
    width: 42px; height: 42px;
    display: inline-flex; align-items: center; justify-content: center;
    background: #fed351 !important; color: #111 !important;  /* brand yellow */
    font-weight: 700;
    box-shadow: 0 4px 12px rgba(0,0,0,.25);
    cursor: pointer;
  }
  #mobilePlayBtn:active { transform: scale(.98); }

  /* Single-line text, centered */
  #mobileNowText {
    color: #fff;
    font-size: 14.5px;
    line-height: 1.2;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    text-align: center;
    width: 100%;
  }

  /* Only show the bar on small screens, add bottom padding so it doesn't cover content */
  @media (max-width: 768px) {
    #mobileNowBar { display: flex; }
    body { padding-bottom: 66px; }
  }

  /* Light theme contrast */
  [data-theme="light"] #mobileNowBar { background: rgba(255,255,255,.96); border-top-color: #e6ecf3; }
  [data-theme="light"] #mobileNowText { color: #0b1220; }
</style><style id="presenter-modal-tidy">
  /* === Force tidy for presenter modal images === */
  .modal[id*="presenter"] .modal-content img,
  .modal.presenter .modal-content img {
    display: block !important;
    max-width: 300px !important;
    width: 100% !important;
    height: auto !important;
    margin: 6px auto 14px auto !important;
    border-radius: 14px !important;
    box-shadow: 0 6px 16px rgba(0,0,0,0.25) !important;
    object-fit: cover !important;
  }

  /* Reduce padding for presenter modals */
  .modal[id*="presenter"] .modal-content,
  .modal.presenter .modal-content {
    padding-top: 16px !important;
    padding-bottom: 14px !important;
  }

  /* Adjust on very small screens */
  @media (max-width: 480px) {
    .modal[id*="presenter"] .modal-content img,
    .modal.presenter .modal-content img {
      max-width: 260px !important;
      border-radius: 12px !important;
      margin: 4px auto 12px auto !important;
      box-shadow: 0 4px 12px rgba(0,0,0,0.22) !important;
    }
    .modal[id*="presenter"] .modal-content,
    .modal.presenter .modal-content {
      padding-top: 12px !important;
      padding-bottom: 10px !important;
    }
  }
</style><style>

/* Song Search: make Reset & Refresh yellow (scoped) */
#searchModal #resetFilters,
#searchModal #songsearchRefreshBtn {
  background: #fed351 !important;
  color: #191c29 !important;
  font-weight: 600 !important;
  border: none !important;
  border-radius: 6px !important;
  padding: 6px 12px !important;
  font-size: 0.9em !important;
  cursor: pointer !important;
  box-shadow: 0 1px 4px rgba(0,0,0,0.3) !important;
  transition: all 0.18s !important;
  margin-left: 8px;
}
#searchModal #resetFilters:active,
#searchModal #songsearchRefreshBtn:active {
  transform: translateY(1px);
}

</style><style id="safari-volume-fix">
/* === Cross-browser, theme-aware volume slider (DESKTOP/TABLET ONLY) === */
#volume-slider{
  -webkit-appearance: none;
  appearance: none;
  width: 180px;
  height: 16px;
  background: transparent;
  outline: none;
  cursor: pointer;
}
#volume-slider::-webkit-slider-runnable-track{
  height: 6px;
  background: var(--accent, #00818a);
  border-radius: 4px;
  border: none;
}
#volume-slider::-webkit-slider-thumb{
  -webkit-appearance: none;
  appearance: none;
  width: 14px;
  height: 14px;
  margin-top: -4px;
  border-radius: 50%;
  background: var(--brand, #fed351);
  border: 2px solid #111;
  box-sizing: border-box;
}
#volume-slider::-moz-range-track{
  height: 6px;
  background: var(--accent, #00818a);
  border-radius: 4px;
  border: none;
}
#volume-slider::-moz-range-progress{
  height: 6px;
  background: var(--accent, #00818a);
  border-radius: 4px 0 0 4px;
}
#volume-slider::-moz-range-thumb{
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: var(--brand, #fed351);
  border: 2px solid #111;
  box-sizing: border-box;
}
[data-theme="light"] #volume-slider::-webkit-slider-runnable-track,
[data-theme="light"] #volume-slider::-moz-range-track,
[data-theme="light"] #volume-slider::-moz-range-progress{
  background: var(--accent, #0b6b73);
}
#volume-display { color: var(--text, #f7f8fb); }

/* === Hide volume on small screens === */
@media (max-width: 768px){
  #volume-container { display: none !important; }
}
</style><style id="np-progress-css">
/* === Now Playing progress bar (only visible during tracks) === */
#np-progress{
  display:none;
  width:100%;
  height:8px;
  background: rgba(255,255,255,0.2);
  border-radius:6px;
  overflow:hidden;
  margin-top:10px;
}
#np-progress .bar{
  height:100%;
  width:0%;
  background: var(--er-accent, #fed351);
  transition: width 0.4s linear;
}
:root[data-theme="light"] #np-progress{
  background: rgba(0,0,0,0.15);
}
#np-progress.ending-soon .bar { animation: npPulse 1s infinite; }
@keyframes npPulse { 50% { opacity: .6 } }
</style><style id="requests-contact-placement-fix">
/* Bring Requests & Contact modals fully into view on desktop and above everything */
@media (min-width: 751px){
  #contactModal, #requestsModal {
    z-index: 12000 !important; /* ensure above any presenter/detail modals */
  }
  #contactModal .modal-content,
  #requestsModal .modal-content {
    /* override inline absolute fullscreen that was causing off-screen positioning */
    position: relative !important;
    inset: auto !important;
    width: 96vw !important;
    max-width: 1200px !important;
    height: 94vh !important;
    margin: 3vh auto !important;   /* drop it slightly from very top */
    overflow: hidden !important;
    border-radius: 16px !important;
    padding: 0 !important;
    box-shadow: 0 0 34px #00818a99;
  }
  /* The internal scrolling region & iframe should fill the remaining space under the 48px top bar */
  #contactModal .embed-wrap,
  #requestsModal .embed-wrap {
    height: calc(94vh - 48px) !important;
    max-height: calc(94vh - 48px) !important;
    overflow: hidden !important;
  }
  #contactModal iframe,
  #requestsModal iframe {
    display: block !important;
    width: 100% !important;
    height: calc(94vh - 48px) !important;
    min-height: 0 !important; /* kill any rogue min-height like 300% */
    border: 0 !important;
  }
}
/* Close button must be visible above iframe */
#contactModal .close,
#requestsModal .close {
  position: absolute !important;
  top: 12px !important;
  right: 16px !important;
  font-size: 32px !important;
  font-weight: bold;
  color: #00818a;
  cursor: pointer;
  z-index: 5000 !important;
  background: rgba(255,255,255,0.9);
  border-radius: 50%;
  padding: 4px 10px;
  line-height: 1;
}
#contactModal .close:hover,
#requestsModal .close:hover {
  color: #ff4d4d;
  background: #ffffff;
}
</style><style id="presenters-modal-tune">
@media (min-width: 751px) {
  #presentersModal .modal-content {
    margin: 6% auto !important;   /* was closer to 8%, so this drops it slightly */
    max-width: 1100px !important; /* wider than the default 920px */
    width: 90vw !important;       /* responsive scaling */
  }
}
</style><script>function openPopup(url) {
  window.open(url, "_blank", "width=1000,height=800,scrollbars=yes,resizable=yes");
}</script><style id="travel-links-style">
.travel-links a {
  color: #fed351 !important;
  font-weight: 600;
  text-decoration: none;
}
.travel-links a:hover, .travel-links a:focus {
  text-decoration: underline;
  color: #ffe67c !important;
}
</style><style id="modal-offset-responsive">
/* Base: ensure relative positioning so 'top' works */
#presentersModal .modal-content,
#listenAgainModal .modal-content {
  position: relative !important;
  margin-top: 0 !important;
}

/* Mobile default (≤ 599px) */
@media (max-width: 599px) {
  #presentersModal .modal-content,
  #listenAgainModal .modal-content {
    top: 36px !important;
  }
}

/* Tablets / small laptops */
@media (min-width: 600px) and (max-width: 899px) {
  #presentersModal .modal-content,
  #listenAgainModal .modal-content {
    top: 48px !important;
  }
}

/* Desktop (≥ 900px) */
@media (min-width: 900px) {
  #presentersModal .modal-content,
  #listenAgainModal .modal-content {
    top: 64px !important;
  }
}

/* Extra: nudge down a bit more on very tall screens */
@media (min-height: 900px) and (min-width: 900px) {
  #presentersModal .modal-content,
  #listenAgainModal .modal-content {
    top: 72px !important;
  }
}

/* iOS notch/safe area: add a little extra if present */
@supports (padding: max(0px)) {
  @media (max-width: 599px) {
    #presentersModal .modal-content,
    #listenAgainModal .modal-content {
      top: calc(36px + env(safe-area-inset-top)) !important;
    }
  }
}
</style><style id="listen-modal-offset-fix">
/* Responsive fix for Listen Again modal */
#listenModal .modal-content {
  position: relative !important;
  margin-top: 0 !important;
  top: 60px !important; /* Desktop offset */
}
@media (max-width: 599px) {
  #listenModal .modal-content {
    top: 36px !important; /* Smaller bump for phones */
  }
}
</style><style id="forms-embed-fix">
  /* Ensure embedded Microsoft Forms show inside the modals */
  /* Desktop/tablet */
  @media (min-width: 751px){
    #requestsModal .embed-wrap,
    #contactModal .embed-wrap {
      height: calc(94vh - 48px) !important;
      max-height: calc(94vh - 48px) !important;
      overflow: hidden !important;
    }
    #requestsModal iframe,
    #contactModal iframe {
      display:block !important;
      width:100% !important;
      height: calc(94vh - 48px) !important;
      min-height:0 !important;
      border:0 !important;
    }
  }
  /* Mobile */
  @media (max-width: 750px){
    #requestsModal .embed-wrap,
    #contactModal .embed-wrap {
      height: calc(100vh - 56px) !important;
      max-height: calc(100vh - 56px) !important;
    }
    #requestsModal iframe,
    #contactModal iframe {
      display:block !important;
      width:100% !important;
      height: calc(100vh - 56px - 36px) !important;
      min-height:0 !important;
      border:0 !important;
    }
  }
  /* If there is no embed-wrap in Requests modal, make sure any iframe still fills */
  #requestsModal iframe { width:100% !important; border:0 !important; }
</style><style>

/* === Mobile: place clock above Play button by moving the element === */
@media (max-width: 768px) {
  #liveClock {
    margin-bottom: 10px;
  }
}

</style><style>

/* === Mobile logo/clock spacing fix === */
@media (max-width: 600px) {
  /* The logo sits absolutely in .player-wrapper; add top padding so content clears it */
  .player-wrapper { padding-top: 24px !important; }

  /* Nudge/scale the overhang logo slightly smaller for tight screens */
  .logo-overhang {
    width: 120px !important;
    left: 6px !important;
    top: 6px !important;
    transform: translate(0, 0) !important;
  }

  /* Keep the clock comfortably below the logo */
  #liveClock { margin-top: 4px !important; }
}

</style><style id="alt-hide-ui">
  body.alt-mode #np-progress,
  body.alt-mode #countdown { display: none !important; }
</style><style id="playlist-text-style">
  #playlistModal .modal-content{
    width: 100vw; max-width: 100vw; height: 100dvh; max-height: 100dvh;
    border-radius: 0; padding: clamp(12px, 2vw, 28px);
    display:flex; flex-direction:column;
    background: radial-gradient(1200px 600px at 80% -10%, rgba(0,161,170,0.15), transparent 60%),
                linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0));
    background-color: var(--panel, #0f1316);
    color: var(--text, #e9f1f3);
  }
  #playlistModal h2{margin:0 0 8px 0; color:#00818a;}
  #playlistModal .close{position:absolute; top:10px; right:12px; font-size:28px; line-height:1; color:var(--text,#e9f1f3); opacity:0.85; cursor:pointer; padding:4px 10px; border-radius:10px;}
  #playlistModal .close:hover{opacity:1; background:rgba(255,255,255,0.06);}

  #playlistWrap{flex:1; overflow:auto; padding:8px 2px 16px;}
  .playlist-toolbar{display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center; padding:8px 0 12px; border-bottom:1px solid var(--border, rgba(255,255,255,0.12)); margin-bottom:10px;}
  .segmented{ background: rgba(255,255,255,0.06); border: 1px solid var(--border, rgba(255,255,255,0.12)); padding:4px; border-radius:12px; display:inline-flex; gap:4px; }
  .segmented .seg{ background:transparent; color: var(--text, #e9f1f3); border:0; border-radius:10px; padding:6px 10px; cursor:pointer; font-weight:700; opacity:0.85; }
  .segmented .seg.active{ background: linear-gradient(180deg, rgba(0,160,170,0.25), rgba(0,160,170,0.18)); border:1px solid rgba(0,160,170,0.45); opacity:1; }

  .playlist-note{ font-size:13px; color:rgba(233,241,243,0.75); margin-top:6px; }
  .playlist-grid{ display:grid; grid-template-columns: repeat(3, minmax(280px, 1fr)); gap: clamp(10px, 2vw, 16px); }
  @media (max-width: 1100px){ .playlist-grid{ grid-template-columns: repeat(2, minmax(260px, 1fr)); } }
  @media (max-width: 680px){ .playlist-grid{ grid-template-columns: 1fr; } }
  #playlistWrap.single-list .playlist-grid { grid-template-columns: 1fr !important; }

  .playlist-section{ border:1px solid var(--border, rgba(255,255,255,0.12)); border-radius:14px; padding:12px; background: rgba(255,255,255,0.03); }
  .playlist-section h3{ margin:0 0 10px 0; font-size:16px; letter-spacing:.3px; color:#7bdff2; }
  .track{ display:grid; grid-template-columns: 56px 1fr auto; gap:10px; align-items:center; padding:8px; border-radius:10px; }
  .track + .track{ margin-top:6px; }
  .track:hover{ background: rgba(255,255,255,0.05); }
  .cover{ width:56px; height:56px; border-radius:8px; object-fit:cover; border:1px solid var(--border, rgba(255,255,255,0.12)); }
  .meta{ display:flex; flex-direction:column; gap:2px; }
  .artist{ font-weight:700; }
  .title{ opacity:0.9; }
  .badge{ font-size:11px; border:1px solid rgba(0,160,170,0.45); border-radius:999px; padding:2px 8px; margin-left:8px; background: linear-gradient(180deg, rgba(0,160,170,0.25), rgba(0,160,170,0.18)); font-weight:800; letter-spacing:.2px; }
  .arrow{ font-size:18px; opacity:0.9; }
  .muted{ opacity:0.7; }

  /* Movement tags */
  .move{ display:flex; align-items:center; justify-content:flex-end; gap:6px; }
  .move-tag{ font-size:12px; font-weight:800; letter-spacing:.2px; padding:4px 10px; border-radius:999px; border:1px solid transparent; }
  .move-tag.up{ 
    background: linear-gradient(180deg, rgba(46, 204, 113, 0.25), rgba(46, 204, 113, 0.18));
    border-color: rgba(39, 174, 96, 0.55);
    color: #c5f7d5;
  }
  .move-tag.down{ 
    background: linear-gradient(180deg, rgba(231, 76, 60, 0.25), rgba(231, 76, 60, 0.18));
    border-color: rgba(192, 57, 43, 0.55);
    color: #ffd3d0;
  }

  /* NEW pill in house yellow */
  .badge.new{
    background: linear-gradient(180deg, rgba(255, 209, 102, 0.35), rgba(255, 209, 102, 0.24));
    border-color: rgba(255, 209, 102, 0.75);
    color: #1a1a1a;
  }

  :root {
    --success: #1fa97a;
    /* keep existing --danger from site if present */
  }
  .move{ display:flex; align-items:center; justify-content:flex-end; gap:6px; }
  .move-tag{
    font-size:14px; font-weight:900; letter-spacing:.2px;
    padding:2px 10px; border-radius:10px; border:1px solid transparent; line-height:1.2;
    min-width: 40px; text-align:center;
  }
  .move-tag.up{
    background: var(--success, #1fa97a);
    border-color: color-mix(in oklab, var(--success, #1fa97a) 85%, black);
    color: #041b11;
  }
  .move-tag.down{
    background: var(--danger, #b42318);
    border-color: color-mix(in oklab, var(--danger, #b42318) 85%, black);
    color: #fff5f4;
  }
  /* NEW pill in house yellow */
  .badge.new{
    background: var(--er-accent, #fed351) !important;
    border-color: var(--er-accent, #fed351) !important;
    color: #000 !important;
  }

/* === PATCH: Multi-column layout for single-list (A/B/C) on desktop === */
@media (min-width: 900px) {
  #playlistWrap.single-list .playlist-section {
    display: grid;
    grid-template-columns: repeat(2, minmax(320px, 1fr));
    gap: 12px;
  }
  #playlistWrap.single-list .playlist-section > h3 {
    grid-column: 1 / -1;
    margin-bottom: 6px;
  }
  #playlistWrap.single-list .playlist-section .track + .track {
    margin-top: 0;
  }
}
@media (min-width: 1400px) {
  #playlistWrap.single-list .playlist-section {
    grid-template-columns: repeat(3, minmax(300px, 1fr));
  }
}
/* === END PATCH === */

/* === PATCH: Playlist key layout (inline desktop, stacked mobile) === */
#playlistModal .playlist-note { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
#playlistModal .playlist-note .key-item { display: inline-flex; align-items: center; gap: 6px; }
@media (max-width: 640px){
  #playlistModal .playlist-note { flex-direction: column; align-items: flex-start; gap: 6px; }
}
/* === END PATCH === */
</style><style id="college-style-min">
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}
  #collegeModal .modal-content{
    width: 100vw; max-width: 100vw; height: 100dvh; max-height: 100dvh;
    border-radius: 0; padding: clamp(12px, 2vw, 28px);
    display: flex; flex-direction: column;
    background: radial-gradient(1200px 600px at 80% -10%, rgba(0,161,170,0.15), transparent 60%),
                linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0));
    background-color: var(--panel, #0f1316);
    color: var(--text, #e9f1f3);
    box-sizing: border-box;
  }
  #collegeModal h2{ margin:0 0 8px 0; color:#00818a; }
  #collegeModal .close{ position:absolute; top:10px; right:12px; font-size:28px; line-height:1; color:var(--text,#e9f1f3); opacity:0.85; cursor:pointer; padding:4px 10px; border-radius:10px; }
  #collegeModal .close:hover{ opacity:1; background:rgba(255,255,255,0.06); }

  .college-toolbar{ display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center; padding: 8px 0 12px; border-bottom:1px solid var(--border, rgba(255,255,255,0.12)); margin-bottom:10px; }
  .segmented{ background: rgba(255,255,255,0.06); border: 1px solid var(--border, rgba(255,255,255,0.12)); padding:4px; border-radius:12px; display:inline-flex; gap:4px; }
  .segmented .seg{ background:transparent; color: var(--text, #e9f1f3); border:0; border-radius:10px; padding:6px 10px; cursor:pointer; font-weight:700; opacity:0.85; }
  .segmented .seg.active{ background: linear-gradient(180deg, rgba(0,160,170,0.25), rgba(0,160,170,0.18)); border:1px solid rgba(0,160,170,0.45); opacity:1; }
  #collegeSelect{ appearance:none; border-radius:10px; border:1px solid var(--border, rgba(255,255,255,0.14)); background: rgba(255,255,255,0.05); color: var(--text, #e9f1f3); padding:8px 12px; min-width:min(48vw, 420px); outline:none; }

  #collegeWrap{ flex:1; overflow:auto; padding:12px 2px 16px; }
  .college-detail{ min-height:100%; display:flex; flex-direction:column; gap:12px; }
  .college-detail .placeholder{ color: rgba(233,241,243,0.7); font-style: italic; }
  .detail-head{display:flex; flex-wrap:wrap; gap:12px; align-items:baseline;}
  .detail-title{font-size: clamp(18px, 2.4vw, 28px); margin:0; color: var(--text, #e9f1f3);}
  .date-pill{display:inline-flex; gap:8px; align-items:center; padding:6px 10px; border-radius:999px; font-weight:800; letter-spacing:.3px; border:1px solid rgba(0,160,170,0.45); background:linear-gradient(180deg, rgba(0,160,170,0.25), rgba(0,160,170,0.18));}
  .badge{ display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; font-weight:800; letter-spacing:.3px; border:1px solid transparent; }
  .badge.internal{ background: rgba(89,210,255,0.18); border-color: rgba(89,210,255,0.35); color:#bfefff; }
  .badge.external{ background: rgba(255,209,102,0.20); border-color: rgba(255,209,102,0.45); color:#ffe6a6; }
  .detail-body p{ margin:0 0 10px 0; white-space:pre-wrap; }
</style></head><body><div id="burgerMenuBtn" onclick="toggleBurgerMenu()" style="display:none;"><span class="burger-bar"></span><span class="burger-bar"></span><span class="burger-bar"></span></div><div id="burgerDropdown" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.92);z-index:2000;flex-direction:column;align-items:center;justify-content:flex-start; padding-top:28px;"><div class="rnh-date" style="width:92vw;max-width:430px;margin:0 auto;display:flex;flex-direction:column;gap:10px;"><a class="menu-link" href="#" onclick="openModalAndCloseBurger('aboutModal');return false;">About Us</a><a class="menu-link hour-nav prev-hour hour-nav next-hour" href="#" onclick="openModalAndCloseBurger('presentersModal');return false;">Presenters</a><a class="menu-link" href="#" onclick="openModalAndCloseBurger('scheduleModal');return false;">Schedule</a><a class="menu-link" href="#" onclick="openModalAndCloseBurger('requestsModal');return false;">Requests</a><a class="menu-link" href="#" onclick="openModalAndCloseBurger('newsModal');return false;">News</a><a class="menu-link" href="#" onclick="openModalAndCloseBurger('travelModal');return false;">Travel</a><a class="menu-link" href="#" onclick="openModalAndCloseBurger('localModal');return false;">Local</a><a class="menu-link" href="#" onclick="openModalAndCloseBurger('playlistModal');return false;">Playlist</a><a class="menu-link" href="#" onclick="openModalAndCloseBurger('listenModal');return false;">Listen Again</a><a class="menu-link" href="#" onclick="openModalAndCloseBurger('searchModal');return false;">Song Search</a><a class="menu-link" href="#" onclick="openModalAndCloseBurger('contactModal');return false;">Contact Us</a></div></div><nav class="navbar" role="navigation"><a href="#" onclick="openModal('aboutModal');return false;">About Us</a><a href="#" onclick="openModal('presentersModal');return false;">Presenters</a><a href="#" onclick="openModal('scheduleModal');return false;">Schedule</a><a href="#" onclick="openModal('requestsModal');return false;">Requests</a><a href="#" onclick="openModal('newsModal');return false;">News</a><a href="#" onclick="openModal('travelModal');return false;">Travel</a><a href="#" onclick="openModal('localModal');return false;">Local</a><a href="#list=ALL" onclick="location.hash='list=ALL'; openModal('playlistModal'); return false;">Playlist</a><a href="#" onclick="openModal('listenModal');return false;">Listen Again</a><a href="#" onclick="openModal('searchModal');return false;">Song Search</a><a href="#" onclick="openModal('contactModal');return false;">Contact Us</a><button class="theme-navbtn" id="themeToggleBtn"><span class="mode-emoji">☀️</span><span class="mode-label">Light</span></button></nav><div class="header-spacer"></div><div style="width:100%;display:flex;justify-content:center;"><div class="player-wrapper"><img alt="Essential Radio Logo" class="logo-overhang" src="ERLogo2.png"/><div class="strip-container three-panel"><div class="strip-topbar"></div><div class="left-panel"><div id="onAirNow" style="text-align:right"><span class="pulsing-label">ON AIR NOW</span><span id="currentShow" style="font-weight:600">Loading…</span></div><div id="player-box"><audio id="stream" preload="none"><source src="https://streaming06.liveboxstream.uk/proxy/ayrshire/stream" type="audio/mpeg"/></audio><button id="play-toggle">▶️ Play Essential Radio</button><div id="volume-container"><label for="volume-slider">Volume:</label><input id="volume-slider" max="100" min="0" type="range" value="100"/><span id="volume-display">100%</span><button id="mute-toggle">🔊</button></div><div id="now-playing-card" style="position: relative;"><div id="now-playing"><span class="label">Now Playing:</span><strong id="np-title">—</strong><span>by</span><strong id="np-artist">—</strong></div><div aria-hidden="true" aria-valuemax="100" aria-valuemin="0" aria-valuenow="100" id="np-progress" role="progressbar"><div class="bar"></div></div><div id="countdown" style="margin-top:6px;font-size:0.95em;color:#ccc;text-align:right;">--:--</div>
<div id="next-up" style="margin-top:6px;font-size:0.9em;color:#ccc;text-align:left;display:none;">
  <span style="color:#fed351;">Coming up:</span>
  <span id="next-up-text">Even more great music!</span>
</div>
<div aria-label="Share options" class="np-share-toolbar" id="np-share-toolbar"><span class="np-share-label">Share:</span><a aria-label="Share on Facebook" class="np-share-btn" data-platform="facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fessential.radio" rel="noopener" role="button" target="_blank" title="Facebook" type="button"><svg aria-hidden="true" focusable="false" height="18" viewbox="0 0 16 16" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951" fill="currentColor"></path></svg></a><a aria-label="Share on X (Twitter)" class="np-share-btn" data-platform="twitter" href="https://twitter.com/intent/tweet?text=I%27m%20listening%20to%20Essential%20Radio%20https%3A%2F%2Fessential.radio" rel="noopener" role="button" target="_blank" title="X (Twitter)" type="button"><svg aria-hidden="true" focusable="false" height="18" viewbox="0 0 16 16" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M12.6.75h2.454l-5.36 6.142L16 15.25h-4.937l-3.867-5.07-4.425 5.07H.316l5.733-6.57L0 .75h5.063l3.495 4.633L12.601.75Zm-.86 13.028h1.36L4.323 2.145H2.865z" fill="currentColor"></path></svg></a><a aria-label="Share on WhatsApp" class="np-share-btn" data-platform="whatsapp" href="https://api.whatsapp.com/send?text=I%27m%20listening%20to%20Essential%20Radio%20https%3A%2F%2Fessential.radio" rel="noopener" role="button" target="_blank" title="WhatsApp" type="button"><svg aria-hidden="true" focusable="false" height="18" viewbox="0 0 16 16" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M13.601 2.326A7.85 7.85 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.9 7.9 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.9 7.9 0 0 0 13.6 2.326zM7.994 14.521a6.6 6.6 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.56 6.56 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592m3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.73.73 0 0 0-.529.247c-.182.198-.691.677-.691 1.654s.71 1.916.81 2.049c.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232" fill="currentColor"></path></svg></a></div></div><img alt="Artwork" class="loaded" id="artwork" src="Essential Radio Logo.png"/></div></div><div class="right-panel" style="display:flex;flex-direction:column"><div id="liveClock"><div id="clockCombined"><span id="clockTime">--:--:--</span><span id="clockDate">Date</span></div></div><div id="wxWrap" style="font-family:Inter,sans-serif;background:linear-gradient(135deg,#24243e 0%,#191c29 100%); color:#f5f5f5;border-radius:18px;padding:16px;box-shadow:0 6px 32px #0007; border:1px solid #252e42;max-width:100%;text-align:center;margin-bottom:18px; transition:background 0.3s,box-shadow 0.3s;"><h3 class="wxHeading"> Ayrshire Weather <span class="mobBreak"><br/></span><span class="sub">- select a location</span></h3><style>
    /* desktop / tablet */
    #wxWrap .wxHeading{
      font-size:1.15em;font-weight:600;margin:0 0 10px 0;color:#fed351;letter-spacing:.3px;
    }
    #wxWrap .wxHeading .sub{
      font-weight:400;font-style:italic;color:#bbb;
    }
    #wxWrap .mobBreak{display:none;}

    /* mobile <=500 px */
    @media(max-width:500px){
      #wxWrap .wxHeading{font-size:1.05em;}
      #wxWrap .wxHeading .sub{font-size:.9em;}
      #wxWrap .mobBreak{display:inline;}
    }
  </style><div style="margin-bottom:7px;"><select id="locSel" style="background:#222;color:#fed351;border:1px solid #444; border-radius:6px;padding:4px 10px;font-weight:bold;"><option value="Kilmarnock,55.6118,-4.4955">Kilmarnock</option><option value="Kilwinning,55.6558,-4.7057">Kilwinning</option><option value="Ayr,55.4586,-4.6292">Ayr</option></select></div><div style="display:flex;justify-content:space-between;align-items:center; border-bottom:1px solid #2224;margin-bottom:10px;padding-bottom:7px;"><div id="wxNow" style="text-align:left;font-size:1em;" aria-live="polite"></div><button id="toggleBtn" style="background:#fed351;color:#191c29;font-weight:600;border:none; border-radius:6px;padding:3px 10px;font-size:0.8em;cursor:pointer; box-shadow:0 1px 4px rgba(0,0,0,0.3);transition:all 0.18s;"> 5-day ▸ </button></div><div id="hrWrap" style="display:grid;grid-template-rows:auto auto;gap:4px; white-space:nowrap;font-size:0.82em; padding:6px 0;transition:opacity 0.35s, transform 0.3s;opacity:1;"></div><div id="dyWrap" style="display:none;grid-template-rows:auto auto;gap:4px; white-space:nowrap;font-size:0.82em; padding:6px 0;transition:opacity 0.35s, transform 0.3s;opacity:1;"></div><div id="wxAlert" style="color:#ff6969;font-size:0.85em;margin-top:5px;"></div></div><hr class="weather-divider"/><style>
  .weather-divider {
    border: 0;
    border-top: 1.5px solid #28304c;
    margin: 14px 0 0 0;
    opacity: 0.6;
  }

  #wxNow span {
    text-shadow: 0 2px 10px #000c, 0 1px 0 #fed351;
    font-size: 1.06em;
  }

  /* ========= WEATHER WIDGET SCROLL SMOOTHNESS ========= */

  /* Default: no horizontal scroll = no vertical stall */
  #hrWrap, #dyWrap {
    overflow-x: hidden;
    touch-action: pan-y;
    overscroll-behavior: auto;
  }

  /* Phones (<=500 px) get sideways strips */
  @media (max-width: 500px) {
    #hrWrap, #dyWrap {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      touch-action: pan-x;
      overscroll-behavior-x: contain;
      overscroll-behavior-y: auto;
    }
  }

  /* Ensure the whole widget never traps vertical scroll */
  #wxWrap {
    overscroll-behavior: auto !important;
    -webkit-overflow-scrolling: touch;
  }

  #toggleBtn:hover {
    background: #ffe67c !important;
    color: #222 !important;
    transform: scale(1.08);
    box-shadow: 0 2px 8px #fed35180;
    transition: all 0.18s;
  }

  #hrWrap, #dyWrap {
    transition: opacity 0.35s, transform 0.3s;
    opacity: 1;
    scroll-snap-type: x mandatory;
  }

  #hrWrap[style*="display: none"],
  #dyWrap[style*="display: none"] {
    opacity: 0 !important;
    transform: translateY(-8px);
  }

  .forecast-icon {
    transition: transform 0.2s ease-in-out, filter 0.2s;
  }
  .forecast-icon:hover {
    filter: brightness(1.15) drop-shadow(0 2px 8px #fed35188);
    transform: scale(1.16) rotate(-8deg);
  }

  #dyWrap > div > div {
    width: 20% !important;
    min-width: 0 !important;
    max-width: none !important;
    box-sizing: border-box;
  }

  .wxRainNote {
    font-size: 90%;
    font-style: italic;
    display: inline-block;
  }
  @media (max-width: 500px) {
    .wxRainNote { text-align: right; width: 100%; }
    #wxNow {
      font-size: 0.9em !important;
      line-height: 1.25;
    }
  }
</style><script>
(() => {
  const KEY = 'e4a309c7e76f09b85a2ff7d34305505f';

  const q = s => document.querySelector(s),
        locSel = q('#locSel'),
        wxNow  = q('#wxNow'),
        tBtn   = q('#toggleBtn'),
        hrWrap = q('#hrWrap'),
        dyWrap = q('#dyWrap'),
        alertBox = q('#wxAlert');

  let show5 = localStorage.wxView === '5';
  if (show5) swapView();
  if (localStorage.wxChoice) locSel.value = localStorage.wxChoice;

  function phrase(desc, isDay, temp = null, pop = null) {
    desc = (desc || '').toLowerCase();

    // Suppress bright/sunny wording at night
    if (!isDay && /(sun|sunshine|mostly sunny|sunny intervals|bright)/.test(desc)) {
      return 'Clear';
    }

    if (desc.includes('thunder')) return 'Thunderstorm';
    if (desc.includes('snow') && (!temp || temp < 5)) return 'Snow';
    if (desc.includes('snow') && temp && temp >= 5) return 'Showers';

    if (desc.includes('rain') || desc.includes('drizzle')) {
      if (pop !== null && pop < 30) {
        return isDay ? 'Chance of showers' : 'Possible showers';
      }
      return 'Rain';
    }

    if (desc.includes('fog'))   return 'Foggy';
    if (desc.includes('mist'))  return 'Misty';
    if (desc.includes('haze'))  return 'Hazy';
    if (desc.includes('smoke')) return 'Smoky';

    // Sunshine / cloud logic
    if (desc === 'clear sky')              return isDay ? 'Sunny' : 'Clear';
    if (desc.includes('few clouds'))       return isDay ? 'Bright with sun' : 'Mainly clear';
    if (desc.includes('scattered clouds')) return isDay ? 'Bright spells' : 'Some cloud';
    if (desc.includes('broken clouds'))    return isDay ? 'Bright intervals' : 'Cloudy';
    if (desc.includes('overcast'))         return 'Overcast';

    // Any other "bright" at night becomes clear
    if (!isDay && (desc.includes('sun') || desc.includes('bright'))) return 'Clear';

    // Fallbacks
    return isDay ? 'Bright' : 'Calm';
  }

  async function update() {
    const value = locSel.value || '';
    const [label, lat, lon] = value.split(',');
    localStorage.wxChoice = value;

    try {
      const res = await fetch(
        `https://api.openweathermap.org/data/3.0/onecall?lat=${lat}&lon=${lon}&units=metric&appid=${KEY}`
      );
      const d = await res.json();

      // Basic guards for missing data
      if (!d || !d.current || !Array.isArray(d.hourly) || d.hourly.length < 2 ||
          !Array.isArray(d.daily) || d.daily.length < 2) {
        wxNow.textContent = 'Weather unavailable';
        hrWrap.innerHTML = '';
        dyWrap.innerHTML = '';
        alertBox.textContent = '';
        return;
      }

      // ==== CURRENT CONDITIONS ====
      const cur = d.current;
      const nxt = d.hourly[1];

      // Day or night: use sunrise/sunset, with 09-21 fallback
      const day = (() => {
        const { sunrise, sunset, dt } = cur;
        if (typeof sunrise !== 'number' || typeof sunset !== 'number') {
          const hourLocal = new Date(dt * 1000).getHours();
          return hourLocal >= 9 && hourLocal < 21;
        }
        return dt >= sunrise && dt < sunset;
      })();

      const pop  = nxt && typeof nxt.pop === 'number' ? Math.round(nxt.pop * 100) : null;
      const desc = phrase(cur.weather && cur.weather[0] && cur.weather[0].description,
                          day,
                          cur.temp,
                          pop);
      const tmp  = Math.round(cur.temp);

      // Only show % if desc does not already include "rain / showers"
      const showPop = pop !== null && pop >= 30 && !/rain|showers/i.test(desc);

      // Summary line
      wxNow.innerHTML =
        `<span style="color:#fed351;font-weight:bold">${desc}</span>, ${tmp}°C` +
        (showPop
          ? `<br><span class="wxRainNote">☔&nbsp;${pop}% chance of rain</span>`
          : '');

      // ==== HOURLY STRIP ====
      hrWrap.innerHTML = '';
      let times = '', details = '';

      d.hourly.slice(1, 6).forEach(h => {
        const t = new Date(h.dt * 1000).getHours().toString().padStart(2, '0') + ':00';
        const icon = `https://openweathermap.org/img/wn/${h.weather[0].icon}.png`;

        times += `<div style="flex:1;text-align:center;min-width:60px;">${t}</div>`;
        details += `<div style="flex:1;text-align:center;min-width:60px;">
                      <img src="${icon}" width="20" class="forecast-icon" alt="">
                      <br>${Math.round(h.temp)}°
                    </div>`;
      });

      hrWrap.innerHTML =
        `<div style="display:flex;">${times}</div>` +
        `<div style="display:flex;">${details}</div>`;
      hrWrap.style.display = show5 ? 'none' : 'grid';

      // ==== DAILY STRIP ====
      dyWrap.innerHTML = '';
      let days = '', temps = '';

      d.daily.slice(1, 6).forEach(dd => {
        const wd   = new Date(dd.dt * 1000)
          .toLocaleDateString('en-GB', { weekday:'short' });
        const icon = `https://openweathermap.org/img/wn/${dd.weather[0].icon}.png`;

        days  += `<div style="text-align:center;">${wd}</div>`;
        temps += `<div style="text-align:center;">
                    <img src="${icon}" width="20" class="forecast-icon" alt="">
                    <br>${Math.round(dd.temp.max)}°/${Math.round(dd.temp.min)}°
                  </div>`;
      });

      dyWrap.innerHTML =
        `<div style="display:flex;">${days}</div>` +
        `<div style="display:flex;">${temps}</div>`;
      dyWrap.style.display = show5 ? 'grid' : 'none';

      // ==== ALERTS ====
      if (d.alerts && d.alerts.length) {
        const now = Math.floor(Date.now() / 1000);
        const valid = d.alerts.find(a => !a.end || a.end > now);
        alertBox.textContent = valid ? `⚠ ${valid.event}` : '';
      } else {
        alertBox.textContent = '';
      }

    } catch (e) {
      console.error('Weather fetch error', e);
      wxNow.textContent = 'Weather unavailable';
      hrWrap.innerHTML = '';
      dyWrap.innerHTML = '';
      alertBox.textContent = '';
    }
  }

  function swapView() {
    hrWrap.style.opacity = '0';
    dyWrap.style.opacity = '0';

    setTimeout(() => {
      show5 = !show5;
      localStorage.wxView = show5 ? '5' : 'hr';

      hrWrap.style.display = show5 ? 'none' : 'grid';
      dyWrap.style.display = show5 ? 'grid' : 'none';
      tBtn.textContent = show5 ? 'Hourly ▶' : '5-day ▸';

      setTimeout(() => {
        hrWrap.style.opacity = show5 ? '0' : '1';
        dyWrap.style.opacity = show5 ? '1' : '0';
      }, 20);
    }, 180);
  }

  tBtn.addEventListener('click', swapView);
  locSel.addEventListener('change', update);
  update();
  setInterval(update, 900000);
})();
</script><div class="recently-played-container" style="flex:1;display:flex;flex-direction:column;min-height:0;"><div class="recent-title" style="color:#fed351;font-size:1.1em;margin-bottom:7px;">Recently Played</div><ul id="recent-list" style="list-style:none;padding:0;margin:0;flex:1;overflow-y:auto;"></ul></div></div><div class="side-banner-panel"><div class="side-social"><div class="side-social-title">Follow Essential Radio</div><div class="side-social-row"><a aria-label="Facebook" class="side-social-btn" href="https://facebook.com/ERadioAyrshire" rel="noopener" target="_blank" title="Facebook"><svg aria-hidden="true" viewbox="0 0 24 24"><path d="M24 12A12 12 0 1 0 10.9 23.9v-8.4H8V12h2.9V9.6c0-2.9 1.8-4.5 4.4-4.5 1.2 0 2.4.1 2.7.1v3h-1.9c-1.5 0-1.8.7-1.8 1.7V12H18l-.4 3.5h-2.6v8.4A12 12 0 0 0 24 12z"></path></svg></a><a aria-label="X (Twitter)" class="side-social-btn" href="https://x.com/ERadioAyrshire" rel="noopener" target="_blank" title="X (Twitter)"><svg aria-hidden="true" viewbox="0 0 24 24"><path d="M18.24 2h3.36l-7.51 8.74L22 22h-6.86l-4.73-6.83L4.88 22H1.52l7.51-8.74L2 2h6.98l4.38 6.3L18.24 2z"></path></svg></a><a aria-label="Instagram" class="side-social-btn" href="https://instagram.com/ERadioAyrshire" rel="noopener" target="_blank" title="Instagram"><svg aria-hidden="true" viewbox="0 0 24 24"><rect height="18" rx="5" ry="5" width="18" x="3" y="3"></rect><circle cx="12" cy="12" r="4.6"></circle><circle cx="17.5" cy="6.5" r="1.3"></circle></svg></a></div></div><div class="side-listen"><div class="side-listen-title">Additional Ways to Listen</div><div class="listen-group"><div class="listen-group-title">On your smart speaker</div><div class="tile-row"><a aria-label="Open Essential Radio Alexa Skill" class="tile" href="https://www.amazon.co.uk/REL-MEDIA-Essential-Radio/dp/B0BZPTK8ZF" rel="noopener" target="_blank"><span class="tile-icon"><svg aria-hidden="true" viewbox="0 0 24 24"><path d="M12 2a8 8 0 0 0-8 8c0 4.4 3.6 8 8 8h.2c.3 2.2 1.3 3.7 3.4 4-1.1-.9-1.8-2.2-1.8-3.7 3.8-1 6.2-4.5 6.2-8.3a8 8 0 0 0-8-8z"></path></svg></span><span class="tile-caption">Alexa</span></a></div></div><div class="listen-group"><div class="listen-group-title">Download the official apps for Apple and Android</div><div class="tile-row"><a aria-label="Open Essential Radio on the Apple App Store" class="tile" href="https://apps.apple.com/gb/app/essential-radio/id6478086650" rel="noopener" target="_blank"><span class="tile-icon"><svg aria-hidden="true" viewbox="0 0 24 24"><path d="M16.3 13.2c0-2 1.8-3 1.8-3-.9-1.3-2.3-1.5-2.8-1.5-1.2 0-2.1.8-2.7.8-.6 0-1.4-.8-2.4-.8-1.2 0-2.4.7-3.1 1.9-1.4 2.3-.4 5.7 1 7.7.7 1 1.6 2.1 2.7 2.1 1-.1 1.4-.6 2.5-.6 1 0 1.4.6 2.5.6 1.1 0 1.9-1 2.6-2 0 0-.9-.4-1.4-1.4-.4-.9-.7-2-.7-2.8zM14 5.2c.5-.7.8-1.6.7-2.4-.8.1-1.6.6-2.1 1.3-.4.6-.8 1.5-.7 2.3.9.1 1.7-.4 2.1-1.2z"></path></svg></span><span class="tile-caption">Apple</span></a><a aria-label="Open Essential Radio on Google Play" class="tile" href="https://play.google.com/store/apps/details?id=com.codewai.radios.uk.essential&amp;hl=en-US" rel="noopener" target="_blank"><span class="tile-icon"><svg aria-hidden="true" viewbox="0 0 24 24"><path d="M3 2.8v18.4c0 .5.5.8.9.6l12-6.8c.5-.3.5-1 0-1.2L3.9 2.2c-.4-.2-.9.1-.9.6z"></path></svg></span><span class="tile-caption">Android</span></a></div></div><div class="listen-group"><div class="listen-group-title">Get the My Ayrshire College app</div><div class="tile-row"><a aria-label="Open My Ayrshire College on the Apple App Store" class="tile" href="https://apps.apple.com/gb/app/my-ayrshire-college/id1521950988" rel="noopener" target="_blank"><span class="tile-icon"><svg aria-hidden="true" viewbox="0 0 24 24"><path d="M12 3 2 8l10 5 10-5-10-5zM6 11v4.5c0 1.7 3 3.5 6 3.5s6-1.8 6-3.5V11l-6 3-6-3z"></path></svg></span><span class="tile-caption">Apple</span></a><a aria-label="Open My Ayrshire College on Google Play" class="tile" href="https://play.google.com/store/apps/details?id=cloud.myday.ayrshire" rel="noopener" target="_blank"><span class="tile-icon"><svg aria-hidden="true" viewbox="0 0 24 24"><path d="M12 3 2 8l10 5 10-5-10-5zM6 11v4.5c0 1.7 3.5 3.5 6 3.5s6-1.8 6-3.5V11l-6 3-6-3z"></path></svg></span><span class="tile-caption">Android</span></a></div></div></div><div id="rnh-news-hub" style="margin-top:14px;"><div style="color:#fed351;font-weight:700;font-size:1.1em;margin-bottom:14px;">Latest News from Radio News Hub</div><div id="rnh-news-list"><div style="color:#bbb;font-size:1em;">Loading headlines…</div></div></div><div id="ayrshire-college-logo" style="margin-top:20px;text-align:center;"><a href="https://www1.ayrshire.ac.uk" rel="noopener" style="text-decoration:none;" target="_blank"><img alt="Ayrshire College Logo" src="AC_Logo.png" style="width:130px;max-width:100%;display:block;margin:0 auto 6px auto;"/><span style="color:#fed351;font-weight:700;font-size:1.05em;display:block;"> Ayrshire College Website </span></a></div><style>
  .strip-container {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 20px;
    padding: 20px;
    flex-wrap: nowrap;
  }

  .left-panel, .right-panel {
    flex: 1 1 0;
  }

  .side-banner-panel {
    width: 190px;
    min-width: 190px;
    flex-shrink: 0;
  }

  .side-banner-img {
    width: 190px;
    height: auto;
    max-height: 1000px;
    display: block;
  }
/* Section title */
.side-listen { margin-top: 14px; }
.side-listen-title {
  color:#fed351; font-weight:700; font-size:1.1em; margin-bottom:8px;
}

/* Groups */
.listen-group { margin-bottom: 12px; }
.listen-group-title {
  color:#bbb; font-weight:600; font-size:.95em; margin:4px 0 8px 0; text-align:center;
}

/* Icon tiles */
.tile-row { display:flex; justify-content:center; gap:12px; flex-wrap:wrap; }

.tile{
  width:72px; text-align:center; text-decoration:none; color:#ddd;
  transition: transform .15s ease, color .2s ease;
}
.tile-icon{
  width:54px; height:54px; border-radius:50%;
  background:#fed351; color:#111;
  display:inline-flex; align-items:center; justify-content:center;
  box-shadow:0 2px 10px rgba(0,0,0,.25);
  margin:0 auto 6px auto;
}
.tile-icon svg{ width:24px; height:24px; display:block; }
.tile-icon svg *{ fill: currentColor; }

.tile-caption{ font-size:.85em; line-height:1.1; display:block; }

.tile:hover .tile-icon,
.tile:focus .tile-icon{ background:#00818a; color:#fff; }
.tile:hover, .tile:focus{ transform: translateY(-2px); outline:none; }

/* Slightly tighter on narrow screens */
@media (max-width: 768px){
  .tile{ width:64px; }
  .tile-icon{ width:50px; height:50px; }
  .tile-icon svg{ width:22px; height:22px; }
}

/* Right column social strip */
.side-social {
  text-align: center;
  margin: 8px 0 10px 0;
}
.side-social-title {
  color: #fed351;
  font-weight: 700;
  font-size: 1.02em;
  margin-bottom: 8px;
}
.side-social-row {
  display: flex;
  justify-content: center;
  gap: 10px;
}
.side-social-btn {
  width: 34px; height: 34px;
  border-radius: 50%;
  display: inline-flex; align-items: center; justify-content: center;
  background: #fed351; color: #111; text-decoration: none;
  box-shadow: 0 2px 8px rgba(0,0,0,.25);
  transition: transform .15s, background .2s, color .2s;
}
.side-social-btn:hover, .side-social-btn:focus {
  background: #00818a; color: #fff; transform: translateY(-2px); outline: none;
}
.side-social-btn svg { width: 18px; height: 18px; display: block; }
.side-social-btn svg * { fill: currentColor; }

/* Keep things neat on very narrow screens */
@media (max-width: 768px){
  .side-social { margin-top: 6px; }
  .side-social-btn { width: 32px; height: 32px; }
  .side-social-btn svg { width: 16px; height: 16px; }
}

/* Right column separators — similar feel to the left */
.side-banner-panel > :is(.side-social, .side-listen, #rnh-news-hub, #ayrshire-college)
  + :is(.side-social, .side-listen, #rnh-news-hub, #ayrshire-college){
  margin-top:12px;              /* space before the next section */
  padding-top:12px;             /* space after the rule */
  border-top:1px solid #2b2b2b; /* the line */
  box-shadow:0 -1px 0 rgba(255,255,255,.05) inset; /* subtle highlight */
}

  @media (max-width: 768px) {
    .strip-container {
      flex-direction: column;
      align-items: center;
    }

    .left-panel, .right-panel {
      width: 100%;
    }

    .side-banner-panel {
      width: 100%;
      text-align: center;
      order: 3;
    }

    .side-banner-img {
      width: 100%;
      max-width: 220px;
      height: auto;
    }
  }
/* Compact tiles */
.side-listen .tile-row { gap: 6px; }
.side-listen .tile { width: 42px; }
.side-listen .tile-icon { width: 32px; height: 32px; margin-bottom: 3px; }
.side-listen .tile-icon svg { width: 14px; height: 14px; }
.side-listen .tile-caption { font-size: 0.70em; line-height: 1.05; }

/* Match Follow icons to Compact tile size */
.side-social .side-social-btn { width:32px; height:32px; }
.side-social .side-social-btn svg { width:14px; height:14px; }

/* Optional: tighten spacing to match tiles */
.side-social .side-social-row { gap: 6px; }

</style><div tabindex="-1" aria-modal="true" role="dialog" class="modal" id="aboutModal"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content"><span class="close" onclick="closeModal('aboutModal')">×</span><div style="display:flex;align-items:center;gap:20px;margin-bottom:24px"><h2 style="margin:0;color:#00818a;font-size:1.55em">About Us</h2></div><div style="border:1px solid #333;border-radius:12px;padding:22px 18px 12px 18px;box-shadow:0 0 20px rgba(0,0,0,0.21);margin-bottom:0; color:#fff"><p style="margin-bottom:18px"> Essential Radio is Ayrshire College’s very own 24/7 station, broadcasting music, student content and campus updates from our Kilwinning base. The station launched in June 2022 with initial funding from the Ayrshire College Foundation and brings a fresh and dynamic voice to the college community. </p><p style="margin-bottom:18px"> We’re more than just great music. Essential Radio is a creative platform for students across all departments. Whether as part of a class project or an extra-curricular activity, learners can contribute shows, features and ideas that reflect their interests and studies. </p><p style="margin-bottom:18px"> Any student with a passion for broadcasting is welcome to get involved. From presenting to production, advert scripting to playlist curation – we offer hands-on experience and skill-building opportunities with real impact. </p><p style="margin-bottom:24px"> The station enhances college life with music, event coverage and a direct link between students, staff and local employers. It’s a modern, flexible way to keep our community connected, supported and inspired – on all of our campuses and beyond. </p><hr style="border:0;border-top:1px solid #444;margin:28px 0 18px 0"/><h3 style="color:#fed351;font-size:1.08em;margin:0 0 13px 0">Our Aims</h3><ul style="color:#ddd;font-size:1em;line-height:1.6;padding-left:20px;margin:0 0 14px 0"><li>To provide a positive, inclusive broadcast platform for the college community.</li><li>To support learning, creativity and employability through media skills.</li><li>To share news, opportunities and achievements across all campuses.</li><li>To promote student and staff voices, with original content and music.</li></ul><hr style="border:0;border-top:1px solid #444;margin:28px 0 18px 0"/><h3 style="color:#fed351;font-size:1.08em;margin:0 0 13px 0">Contact Us</h3><p> You can email the team at <a href="mailto:essentialradio@ayrshire.ac.uk" style="color:#fed351">essentialradio@ayrshire.ac.uk</a> or use the Contact form on this site. </p><p style="font-size:0.97em;color:#bbb;margin:20px 0 0 0"> Essential Radio is fully licensed for music broadcast in the UK by PPL and PRS for Music. </p><div style="text-align:center;margin-top:18px"><img alt="PPL_PRSLogo" src="PPL_PRSLogo.png" style="width:120px;max-width:100%;filter:brightness(1.08)"/></div></div><div style="margin-top:20px;text-align:center;color:#888;font-size:14px;opacity:0.8;"> Essential Radio © 2025 </div></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal" id="requestsModal"
     style="position:fixed;inset:0;display:none;z-index:9999">

  <div class="modal-content"
       style="margin:0; padding:0; border-radius:0;
              width:100vw; height:100vh; max-width:none;
              background:var(--panel-2); color:var(--text);
              display:flex; flex-direction:column;">

    <!-- Close X in top-right -->
    <span class="close" onclick="closeModal('requestsModal')" style="color:var(--accent);">×</span>

    <!-- Header bar -->
    <div style="height:56px; display:flex; align-items:center;
                justify-content:space-between; padding:0 18px;
                border-bottom:1px solid var(--border);
                background:var(--panel);">
      <div>
        <h2 style="margin:0; font-size:1.2em; color:var(--brand); font-weight:700;">
          Request a Song
        </h2>
        <p style="margin:2px 0 0; font-size:0.8em; color:var(--muted);">
          Powered by Essential Radio · Live listener requests
        </p>
      </div>

      <button aria-label="Close" onclick="closeModal('requestsModal')"
              style="border:0; font-size:26px; background:none;
                     color:var(--text); cursor:pointer; line-height:1;">
        ×
      </button>
    </div>

    <!-- Full-height iframe area -->
    <div style="flex:1; overflow-y:auto; -webkit-overflow-scrolling:touch;">
      <iframe
        id="requestsIframe"
        src="/request"
        loading="lazy"
        style="width:100%; height:100%; border:0;">
      </iframe>
    </div>

  </div>
</div>
<div tabindex="-1" aria-modal="true" role="dialog" class="modal" id="scheduleModal"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:920px;width:95vw"><span class="close" onclick="closeModal('scheduleModal')">×</span><h2 style="margin-top:0">Programme Schedule</h2><div style="margin-bottom:18px"><label for="modalDaySelect" style="color:#222;font-weight:600">Choose a day: </label><select id="modalDaySelect" style="padding:8px 12px;border-radius:7px;border:none;color:#111;font-weight:600"></select></div><div id="modalScheduleContainer"><div class="day-card" id="modalDaySchedule"><h3>Loading…</h3></div></div></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal" data-refresh-fn="refreshPlaylist" id="playlistModal"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" data-title="Playlist"><span class="close" onclick="closeModal('playlistModal')">×</span><h2>Playlist</h2><div id="playlistWrap" class="single-list"><div class="playlist-toolbar"><div class="segmented" role="tablist" aria-label="Filter list"><button type="button" class="seg active" data-filter="A" aria-selected="true">A-List</button><button type="button" class="seg" data-filter="B" aria-selected="false">B-List</button><button type="button" class="seg" data-filter="C" aria-selected="false">C-List</button><button type="button" class="seg" data-filter="ALL" aria-selected="false">All</button></div></div><div class="playlist-note"> Key: <span class="key-item"><span class="badge new">NEW</span> = new addition</span><span class="key-item"><span class="move-tag up" aria-hidden="true">▲</span> = promoted</span><span class="key-item"><span class="move-tag down" aria-hidden="true">▼</span> = down</span></div><div class="playlist-grid" id="playlistGrid"></div></div></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal" data-refresh-fn="refreshListenAgain" id="listenModal"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:900px;width:97vw"><span class="close" onclick="closeModal('listenModal')">×</span><div style="display:flex;align-items:center;gap:20px;margin-bottom:24px"><h2 style="margin:0;color:#00818a;font-size:1.5em">Listen Again</h2></div><div style="border:1px solid #333;border-radius:12px;padding:24px 18px;box-shadow:0 0 20px rgba(0,0,0,0.28); color:#eee"><p style="font-size:17px;line-height:1.6;margin-bottom:18px"> Missed a show? No problem! Catch up on your favourite Essential Radio programmes here.<br/> Browse recent shows, select your favourites and listen again anytime. </p><div id="mixcloud-embeds"></div></div><div style="margin-top:18px;text-align:center;color:#888;font-size:14px;opacity:0.8;"> Essential Radio © 2025 </div><script>
      fetch('https://api.mixcloud.com/essentialradio/cloudcasts/')
        .then(response => response.json())
        .then(data => {
          const container = document.getElementById('mixcloud-embeds');
          const shows = data.data.slice(0, 6); // Only show 6
          shows.forEach(show => {
            const block = document.createElement('div');
            block.className = 'show-block';

            const title = document.createElement('div');
            title.className = 'show-title';
            title.textContent = show.name || show.slug || 'Previous Show';

            const iframe = document.createElement('iframe');
            iframe.className = 'mixcloud-player';
            iframe.src = `https://www.mixcloud.com/widget/iframe/?feed=${encodeURIComponent(show.url)}&hide_cover=1&light=0`;
            iframe.allow = 'autoplay';

            block.appendChild(title);
            block.appendChild(iframe);
            container.appendChild(block);
          });
        })
        .catch(error => {
          document.getElementById('mixcloud-embeds').innerHTML =
            '<div style="color:#fed351;font-size:1.1em;margin-top:12px;">Unable to load previous shows at the moment.</div>';
        });
    </script><style>
      .show-block {
        margin-bottom: 30px;
      }
      .show-title {
        font-size: 18px;
        margin-bottom: 8px;
        color: #fff;
        word-break: break-word;
        line-height: 1.2;
        font-weight: 500;
      }
      .mixcloud-player {
        width: 100%;
        min-width: 0;
        height: 120px;
        border: 0;
        display: block;
        border-radius: 8px;
        background: #222;
      }
      @media (max-width: 600px) {
        .show-title {
          font-size: 16px;
        }
        .mixcloud-player {
          height: 150px;
        }
      }
      @media (max-width: 400px) {
        .mixcloud-player {
          height: 165px;
        }
      }
    </style></div></div><style>
      .show-block {
        margin-bottom: 30px;
      }
      .show-title {
        font-size: 18px;
        margin-bottom: 8px;
        color: #fff;
        word-break: break-word;
        line-height: 1.2;
        font-weight: 500;
      }
      .mixcloud-player {
        width: 100%;
        min-width: 0;
        height: 120px;
        border: 0;
        display: block;
        border-radius: 8px;
        background: #222;
      }
      @media (max-width: 600px) {
        .show-title {
          font-size: 16px;
        }
        .mixcloud-player {
          height: 150px;
        }
      }
      @media (max-width: 400px) {
        .mixcloud-player {
          height: 165px;
        }
      }

/* === MOBILE WEATHER SUMMARY SIZE === */
@media (max-width: 500px) {
  #wxNow {
    font-size: 0.9em !important;   /* tweak value to taste */
    line-height: 1.25;
  }
}
@media (max-width: 768px) {
  .left-panel {
    width: 100% !important;
    padding-left: 4px !important;
    padding-right: 4px !important;
    box-sizing: border-box !important;
  }
  #player-box, #now-playing-card {
    width: 100% !important;
    max-width: 100% !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
    box-sizing: border-box !important;
  }
}

/* === MODALS DROP BELOW LOGO/BURGER (Desktop + Mobile) === */
.modal {
  display: none;
  position: fixed;
  z-index: 2000;
  left: 0;
  top: 5px;   /* Desktop: below logo/burger; adjust if your top area is taller/shorter */
  width: 100vw;
  height: calc(100vh - 5px); /* Prevents modal covering logo/burger */
  overflow: auto;
  background: rgba(0,0,0,0.78);
  transition: background 0.2s;
}
@media (max-width: 768px) {
  .modal {
    top: 56px !important;  /* Push modal below burger/nav */
    left: 0 !important;
    width: 100vw !important;
    height: calc(100vh - 56px) !important;
    min-height: 0 !important;
    overflow: hidden !important;
    background: rgba(0,0,0,0.78) !important;
    z-index: 2000;
  }
  .modal-content {
    margin: 0 !important;
    max-height: calc(100vh - 56px) !important;
    min-height: 0 !important;
    width: 100vw !important;
    max-width: 100vw !important;
    padding-top: 18px !important;
    padding-bottom: 12px !important;
    border-radius: 14px 14px 0 0 !important;
    box-sizing: border-box !important;
    overflow-y: auto !important;
    overscroll-behavior: contain !important;
    background: #fff !important;
    font-size: 15px !important;
    scrollbar-width: thin;
    scrollbar-color: #fed351 #ececec;
  }
  .modal-content::-webkit-scrollbar {
    width: 14px;
    background: #ececec;
    border-radius: 10px;
  }
  .modal-content::-webkit-scrollbar-thumb {
    background: #fed351;
    border-radius: 10px;
    border: 3px solid #ececec;
  }
  .modal-content::-webkit-scrollbar-thumb:active {
    background: #ffe67c;
  }
  .modal-content::-webkit-scrollbar-track {
    background: #ececec;
    border-radius: 10px;
  }
}
#burgerMenuBtn {
  z-index: 3000 !important; /* Higher than .modal (z-index: 2000) */
}
@media (max-width: 500px) {
  #hrWrap > div > div {
    min-width: 0 !important;
    padding: 0 1px !important;
    font-size: 11px !important;
  }
  #hrWrap img.forecast-icon {
    width: 15px !important;
    height: 15px !important;
  }
  #hrWrap {
    gap: 1px !important;
  }
}
    </style></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal" id="searchModal"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:950px;width:97vw"><span class="close" onclick="closeModal('searchModal')">×</span><div style="display:flex;align-items:center;gap:20px;margin-bottom:24px"><h2 style="margin:0;color:#00818a;font-size:1.45em">Song Search</h2></div><div style="border:1px solid #333;border-radius:12px;padding:0 0 20px 0;box-shadow:0 0 20px rgba(0,0,0,0.23);margin-bottom:0; color:#eee"><div class="content-card" style="border:1px solid #343648;border-radius:16px;padding:24px 18px 12px 18px;max-width:850px;margin:24px auto 16px auto;box-shadow:0 0 18px #0008"><p style="font-size:17px;line-height:1.6;margin-bottom:0"> Trying to remember that amazing track we just played?<br/> Use our Song Search to find recent songs and discover more about what’s been on Essential Radio. </p></div><div class="container" style="border-radius:18px;box-shadow:0 0 18px #0008;max-width:850px;margin:0 auto 36px auto;padding:20px 18px 32px 18px"><div class="filters" style="margin-bottom:1.5rem;display:flex;flex-wrap:wrap;align-items:center;gap:0.7rem 1.2rem"><label for="dateSelect">Date:</label><select id="dateSelect"></select><label for="hourSelect">Hour:</label><select id="hourSelect"></select><button id="prevHour">⭠ Previous Hour</button><button id="nextHour">Next Hour ➡</button><label for="searchInput">Filter:</label><input id="searchInput" placeholder="Search by Artist or Title..." type="text"/><button id="resetFilters">Reset</button><button id="songsearchRefreshBtn">Refresh</button></div><table style="width:100%;border-collapse:collapse;margin-top:0.7rem;color:#fff;font-size:17px;border-radius:8px;overflow:hidden"><thead style="color:#7e1974;font-size:17.5px"><tr><th>Time</th><th>Artist – Title</th></tr></thead><tbody id="logTableBody"></tbody></table><div class="no-results" id="noResultsMessage" style="display: none;text-align:center;font-style:italic;color:#fed351;padding:1.4rem 0 0.7rem 0;font-size:18px;letter-spacing:0.1px">No tracks found for this time period.</div></div></div><div style="margin-top:18px;text-align:center;color:#888;font-size:14px;opacity:0.8;"> Essential Radio © 2025 </div><style>
      /* Extra modal-specific responsive tweaks for Song Search */
      @media (max-width: 950px) {
        #searchModal .content-card, #searchModal .container { max-width: 98vw; }
        #searchModal .content-card, #searchModal .container { padding: 2vw 3vw; }
      }
      @media (max-width: 700px) {
        #searchModal .content-card { padding: 13px 3vw 10px 3vw; font-size: 16px; }
        #searchModal .container { padding: 8px 1vw 10px 1vw; }
        #searchModal table, #searchModal th, #searchModal td { font-size: 15px; }
        #searchModal .filters { gap: 0.5rem 0.7rem; }
        #searchModal select, #searchModal input[type="text"], #searchModal button { font-size: 14px; }
      }
      @media (max-width: 540px) {
        #searchModal .content-card { padding: 7px 1vw 4px 1vw; }
        #searchModal .container { padding: 5px 0vw 5px 0vw; }
        #searchModal .filters { flex-direction: column; gap: 0.6rem 0; }
      }
    </style><script>
      let fullData = [];
      const dateMap = new Map();
      let latestDate = null;
      let latestHour = null;

      function populateDropdowns(data) {
        dateMap.clear();
        latestDate = null;
        latestHour = null;
        let latestDateTime = new Date(0);
        const now = new Date();

        data.forEach(item => {
          const dt = new Date(item["Hour"]);
          const dtLocal = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate(), dt.getHours());
          const localDate = dt.toLocaleDateString("en-GB");
          const localHour = dt.getHours().toString().padStart(2, '0') + ":00";

          if (dtLocal <= now) {
            if (!dateMap.has(localDate)) dateMap.set(localDate, new Set());
            dateMap.get(localDate).add(localHour);

            if (dtLocal > latestDateTime) {
              latestDateTime = dtLocal;
              latestDate = localDate;
              latestHour = localHour;
            }
          }
        });

        const dateDropdown = document.getElementById("dateSelect");
        const dates = Array.from(dateMap.keys()).sort();
        dateDropdown.innerHTML = dates.map(d => `<option value="${d}">${d}</option>`).join('');
        dateDropdown.value = latestDate;
        updateHourDropdown(latestDate, latestHour);
      }

      function updateHourDropdown(selectedDate, selectedHour = null) {
        const hourDropdown = document.getElementById("hourSelect");
        const hours = Array.from(dateMap.get(selectedDate) || []).sort();
        hourDropdown.innerHTML = hours.map(h => `<option value="${h}">${h}</option>`).join('');
        hourDropdown.value = selectedHour || hours[hours.length - 1];
      }

      function renderTable(data) {
        const tbody = document.getElementById("logTableBody");
        const searchText = document.getElementById("searchInput").value.toLowerCase();
        const selectedDate = document.getElementById("dateSelect").value;
        const selectedHour = document.getElementById("hourSelect").value;
        const noResultsMessage = document.getElementById("noResultsMessage");
        tbody.innerHTML = "";
        const seen = new Set();

        const filtered = data.filter(item => {
          const dt = new Date(item["Hour"]);
          const localDate = dt.toLocaleDateString("en-GB");
          const localHour = dt.getHours().toString().padStart(2, '0') + ":00";
          const key = `${item["Artist"]} - ${item["Title"]}`;

          const durationMinutes = item["Duration (mins)"] || 0;
          const isMatch = localDate === selectedDate && localHour === selectedHour && key.toLowerCase().includes(searchText) && durationMinutes <= 10;

          if (isMatch && !seen.has(key)) {
            seen.add(key);
            return true;
          }
          return false;
        });

        if (filtered.length === 0) {
          noResultsMessage.style.display = "block";
        } else {
          noResultsMessage.style.display = "none";
          filtered.forEach(item => {
            const time = item["Displayed Time"] || item["Scheduled Time"]?.substring(0, 5) || "";
            const row = `<tr><td>${time}</td><td>${item["Artist"]} – ${item["Title"]}</td></tr>`;
            tbody.innerHTML += row;
          });
        }
      }

      document.getElementById("searchInput").addEventListener("input", () => renderTable(fullData));
      document.getElementById("dateSelect").addEventListener("change", () => {
        updateHourDropdown(document.getElementById("dateSelect").value);
        renderTable(fullData);
      });
      document.getElementById("hourSelect").addEventListener("change", () => renderTable(fullData));

      document.getElementById("prevHour").addEventListener("click", () => {
        const hourDropdown = document.getElementById("hourSelect");
        const options = Array.from(hourDropdown.options);
        const idx = options.findIndex(opt => opt.selected);
        if (idx > 0) {
          hourDropdown.selectedIndex = idx - 1;
          renderTable(fullData);
        }
      });

      document.getElementById("nextHour").addEventListener("click", () => {
        const hourDropdown = document.getElementById("hourSelect");
        const options = Array.from(hourDropdown.options);
        const idx = options.findIndex(opt => opt.selected);
        if (idx < options.length - 1) {
          hourDropdown.selectedIndex = idx + 1;
          renderTable(fullData);
        }
      });

      document.getElementById("resetFilters").addEventListener("click", () => {
        document.getElementById("searchInput").value = "";

        let latestDate = null;
        let latestHour = null;
        let latestDateTime = new Date(0);
        const now = new Date();

        fullData.forEach(item => {
          const dt = new Date(item["Hour"]);
          const dtLocal = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate(), dt.getHours());
          const localDate = dt.toLocaleDateString("en-GB");
          const localHour = dt.getHours().toString().padStart(2, '0') + ":00";

          if (dtLocal <= now && dtLocal > latestDateTime) {
            latestDateTime = dtLocal;
            latestDate = localDate;
            latestHour = localHour;
          }
        });

        if (latestDate && latestHour) {
          document.getElementById("dateSelect").value = latestDate;
          updateHourDropdown(latestDate, latestHour);
          renderTable(fullData);
        }
      });

      fetch("playout_log_rolling.json")
        .then(res => res.json())
        .then(data => {
          fullData = data;
          populateDropdowns(data);
          renderTable(data);
        });
    </script></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal" id="contactModal" style="position:fixed;inset:0;display:none; z-index:9999"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="margin:0;padding:0;border-radius:0; position:absolute;inset:0;width:100vw;height:100vh;max-width:none;overflow:hidden"><span class="close" onclick="closeModal('contactModal')">×</span><div style="height:48px;display:flex;align-items:center; justify-content:space-between;padding:0 12px; border-bottom:1px solid #e5e7eb"><div style="font-weight:600;color:#00818a"></div><button aria-label="Close" onclick="closeModal('contactModal')" style="border:0;font-size:24px; line-height:1;cursor:pointer">× </button></div><div style="position:absolute;top:48px;left:0;right:0;bottom:0"><div class="embed-wrap" style="min-height:80vh;height:80vh; width:100%;overflow:hidden"><iframe allowfullscreen="" id="contactIframe" loading="lazy" mozallowfullscreen="" msallowfullscreen="" src="https://forms.office.com/Pages/ResponsePage.aspx?id=CWFOersEtkWIfvFCzEk3ZoQ5eCgoNHZNotQcUOD47KRUQ1A2NUlNMkpFTDY2RkJBU0tUMFdJR0YyVC4u&amp;embed=true" style="width:100%;height:100%;border:none" title="Essential Radio Contact"></iframe></div></div><a href="https://forms.office.com/Pages/ResponsePage.aspx?id=CWFOersEtkWIfvFCzEk3ZoQ5eCgoNHZNotQcUOD47KRUQ1A2NUlNMkpFTDY2RkJBU0tUMFdJR0YyVC4u" rel="noopener" style="position:absolute;left:12px;bottom:10px; font-size:12px;color:#6b7280;text-decoration:underline;" target="_blank"> Open in a new tab </a></div></div><div aria-labelledby="localModalTitle" aria-modal="true" class="modal" id="localModal" role="dialog"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:1000px;width:97vw;"><span aria-label="Close" class="close" onclick="closeModal('localModal')">×</span><h2 id="localModalTitle" style="margin-top:18px;color:#00818a;">Local Events</h2><div style="display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin:8px 0 16px 0;"><label><strong>Council:</strong></label><select id="localAreaSel"><option value="north">North Ayrshire</option><option value="south">South Ayrshire</option><option value="east">East Ayrshire</option><option value="all">All</option></select><label><strong>From:</strong></label><input id="localFromDate" type="date"/><label><strong>To:</strong></label><input id="localToDate" type="date"/><input id="localSearch" placeholder="Search title, venue, town…" style="flex:1;min-width:160px;" type="text"/><button id="localReset">Reset</button></div><div id="localEventsWrap"></div><div style="margin-top:10px;color:#666;font-size:0.92em;"> Tip: use the Council dropdown to switch between North, South and East Ayrshire. </div></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal" id="travelModal"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:900px;width:97vw"><span class="close" onclick="closeModal('travelModal')">×</span><div style="display:flex;align-items:center;gap:18px;margin-bottom:20px"><h2 style="margin:0;color:#00818a;font-size:1.3em">Travel &amp; Transport</h2></div><div style="border:1px solid #333;border-radius:12px;padding:24px 18px;box-shadow:0 0 20px rgba(0,0,0,0.20);margin-bottom:0;color:#eee"><p style="font-size:17px;line-height:1.65;margin-bottom:18px"> Stay up-to-date with live road, rail and travel news across Ayrshire and the West of Scotland. This page brings you <b>real-time delays, incidents, roadworks and ScotRail disruption</b> - all updated automatically for Essential Radio listeners.<br/><span style="color:#fed351">Tip:</span> Click or tap the links below to open travel pages in a popup window. </p><ul class="travel-links" style="margin:0;padding-left:18px;list-style:disc"><ul style="margin:0 0 16px 0; padding:0; list-style:none;"><li><a href="#" onclick="openPopup('https://travel-ac.vercel.app/Current_Combined_Travel_Report.html')">🗺️ Latest Travel Report for Ayrshire</a></li></ul><ul class="travel-list"><li><a href="#" onclick="openPopup('https://travel-ac.vercel.app/Scotrail_Incidents.html')">🚆 ScotRail Live Service Updates</a></li><li><a href="#" onclick="openPopup('https://www.stagecoachbus.com/service-updates')">🚌 Stagecoach West Service Updates</a></li></ul><style>
  .travel-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  .travel-list li + li {
    margin-top: 8px;
  }
  .travel-list a {
    display: inline-block;
    text-decoration: none;
  }
  .travel-list a:hover,
  .travel-list a:focus {
    text-decoration: underline;
  }
</style></ul></div><div style="margin-top:18px;text-align:center;color:#888;font-size:14px;opacity:0.8"> Essential Radio © 2025 </div></div></div><script>
  (function() {
    const daysOfWeek = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
    const todayIndex = new Date().getDay() === 0 ? 6 : new Date().getDay() - 1;

    const modalScheduleContainer = document.getElementById("modalScheduleContainer");
    const modalDaySelect = document.getElementById("modalDaySelect");
    let modalFullSchedule = null;

    // Populate dropdown
    daysOfWeek.forEach((day, idx) => {
      const opt = document.createElement("option");
      opt.value = day;
      opt.textContent = day;
      if (idx === todayIndex) opt.selected = true;
      modalDaySelect.appendChild(opt);
    });

    async function fetchScheduleModal() {
      try {
        const res = await fetch("https://travel-ac.vercel.app/schedule.json");
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        return await res.json();
      } catch (e) {
        modalScheduleContainer.innerHTML = `<h3>Schedule Unavailable</h3>`;
        console.error("Schedule fetch failed:", e);
        return null;
      }
    }

    function getFullDate(dayName) {
  // Get date for the next occurrence of 'dayName'
  const daysOfWeek = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
  const now = new Date();
  const todayIdx = now.getDay() === 0 ? 6 : now.getDay() - 1;
  const targetIdx = daysOfWeek.indexOf(dayName);
  let diff = (targetIdx - todayIdx + 7) % 7;
  const showDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() + diff);
  const day = showDate.getDate();
  const month = showDate.toLocaleString('en-GB', { month: 'long' });
  return `${dayName} ${day} ${month}`;
}

function renderDayScheduleModal(day, shows) {
  modalScheduleContainer.innerHTML = `<div class="day-card" id="modalDaySchedule">
    <h3>${getFullDate(day)}</h3>
    <div class="split-columns">
      <div class="column left-column" id="modalLeftCol"></div>
      <div class="column right-column" id="modalRightCol"></div>
    </div>
  </div></div>`;

  const mid = Math.ceil(shows.length / 2);
  const leftShows = shows.slice(0, mid);
  const rightShows = shows.slice(mid);

  [leftShows, rightShows].forEach((group, i) => {
  const col = document.getElementById(i === 0 ? "modalLeftCol" : "modalRightCol");

group.forEach(show => {
  const presenter = show.presenter || {};
  let presenterName = presenter.name || "";
  let mainTitle = show.title || '';
  let presenterLine = '';
  let presenterIdForModal = null;

  // If the show title includes "with", split it and use the presenter part for the modal
  if (mainTitle && mainTitle.toLowerCase().includes(' with ')) {
    const idx = mainTitle.toLowerCase().indexOf(' with ');
    const showTitlePart = mainTitle.slice(0, idx);
    const presenterNameRaw = mainTitle.slice(idx + 6).trim();
    presenterName = presenterNameRaw;  // ✅ override presenterName
    presenterIdForModal = 'presenter-' + normaliseName(presenterNameRaw);
    mainTitle = showTitlePart.trim();
    presenterLine = `<span class="show-presenter" style="font-style: italic;">${presenterNameRaw}</span>`;
  } else if (presenterName) {
    presenterIdForModal = 'presenter-' + normaliseName(presenterName);
    presenterLine = `<span class="show-presenter" style="font-style: italic;">${presenterName}</span>`;
  }

  // 🔁 Image filename override map
  const imageOverrides = {
    "Scott O'Hare": "Scott-OHare.jpg",
"Tim Graham": "Tim-Graham.jpeg",
    "Bex McNamee": "Bex-Mcnamee.jpg",
	"Kevin McCallum": "Kevin-Mccallum.jpg",
"Connor Strachan": "Connor-Strachan.JPG",
"Keelin McKenna": "Keelin-Mckenna.jpg"
  };

  // ✅ Use override if available, else fall back to slug
  const presenterImg = imageOverrides[presenterName] ||
    `${presenterName.replace(/[\s']/g, '-').replace(/[^a-zA-Z0-9\-]/g, '')}.jpg`;

  const presenterLink = presenter.bio || "#";
  const description = show.info || "";

  const entry = document.createElement('div');
  entry.className = 'show-entry';
  entry.innerHTML = `
    <img src="${presenterImg}" alt="${presenterName}" onerror="this.src='default.png'">
    <div class="show-info">
      <time>${show.start}–${show.end}</time>
      <div class="show-title-presenter">
        ${presenterIdForModal ? `<a href="#" onclick="openModal('${presenterIdForModal}');return false;" class="show-title">${mainTitle}</a>` : `<span class="show-title">${mainTitle}</span>`}
        ${presenterLine}
      </div>
      <div class="show-details">${description || ''}</div>
    </div>
  `;
  col.appendChild(entry);
});
  setTimeout(() => { try { highlightLiveShows(); } catch(e) {} }, 0);

});
  try { if (typeof highlightLiveShows === "function") highlightLiveShows(); } catch(e) {}

}

    modalDaySelect.addEventListener("change", () => {
      const selectedDay = modalDaySelect.value;
      if (modalFullSchedule && modalFullSchedule[selectedDay]) {
        renderDayScheduleModal(selectedDay, modalFullSchedule[selectedDay]);
      }
    });

    fetchScheduleModal().then(data => {
      if (data) {
        modalFullSchedule = data;
        const todayName = daysOfWeek[todayIndex];
        renderDayScheduleModal(todayName, data[todayName]);
      }
    });
  })();
  </script><script>
    async function fetchSchedule() {
      try {
        const res = await fetch("https://travel-ac.vercel.app/schedule.json");
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        return await res.json();
      } catch (e) {
        console.error("Schedule fetch error:", e);
        return null;
      }
    }
    function getCurrentShow(schedule) {
      const now = new Date();
      const day = now.toLocaleString("en-GB", { weekday: "long" });
      const shows = schedule && schedule[day];
      if (!shows) return "No schedule available";
      const nowMins = now.getHours() * 60 + now.getMinutes();
      for (const show of shows) {
        const [sh, sm] = show.start.split(":").map(Number);
        const [eh, em] = show.end.split(":").map(Number);
        let start = sh * 60 + sm;
        let end = eh * 60 + em;
        if (end === 0 && start > 0) end = 1440;
        if (nowMins >= start && nowMins < end) {
          return show.title;
        }
      }
      return "Off Air";
    }
    async function updateOnAirNow() {
  const schedule = await fetchSchedule();
  const fullShow = schedule ? getCurrentShow(schedule) : "Schedule unavailable";
  const el = document.getElementById("currentShow");

  if (fullShow.includes(" with ")) {
    const [rawTitle, rawPresenter] = fullShow.split(" with ");
    const title = rawTitle.trim();
    const presenter = rawPresenter.trim();
    const slug = typeof normaliseName === 'function'
      ? normaliseName(presenter)
      : presenter.toLowerCase().replace(/[’']/g, '').replace(/\s+/g, '-').replace(/[^a-z0-9\-]/g, '');

    el.innerHTML = `
      <span class="show-title">${title}</span>
      <span class="show-presenter">
        with <a href="#"
                class="presenter-link"
                onclick="openPresenterModal('presenter-${slug}'); return false;"
                aria-label="Open profile for ${presenter}">
              ${presenter}
            </a>
      </span>`;
  } else {
    el.textContent = fullShow;
  }
}

    updateOnAirNow();
    setInterval(updateOnAirNow, 60_000);
  </script><script>
    const audio = document.getElementById('stream');
    const playBtn = document.getElementById('play-toggle');
    const muteBtn = document.getElementById('mute-toggle');
    const volumeSlider = document.getElementById('volume-slider');
    if (window.innerWidth <= 768) {
      volumeSlider.disabled = true;
      muteBtn.disabled = true;
    }
    const volumeDisplay = document.getElementById('volume-display');
    const nowPlaying = document.getElementById('now-playing');
    const artworkImg = document.getElementById('artwork');
    const observer = new IntersectionObserver(entries => {
  for (const e of entries) {
    if (!e.isIntersecting) continue;
    const img = e.target;
    const reveal = () => img.classList.add('loaded');
    const fail   = () => { img.src = 'Essential Radio Logo.png'; img.classList.add('loaded'); };
    if (img.complete) { if (img.naturalWidth > 0) reveal(); else fail(); }
    else { img.addEventListener('load', reveal, { once: true }); img.addEventListener('error', fail, { once: true }); }
    observer.unobserve(img);
  }
}, { threshold: 0.1 });
    let isPlaying = false, lastVolume = 1;
    playBtn.addEventListener('click', () => {
      if (!isPlaying) {
        audio.load();
        audio.play().catch(() => {});
        playBtn.textContent = '⏸ Pause';
        isPlaying = true;
      } else {
        audio.pause();
        playBtn.textContent = '▶️ Play Essential Radio';
        isPlaying = false;
      }
    });
    volumeSlider.addEventListener('input', () => {
      const vol = volumeSlider.value / 100;
      audio.volume = vol;
      volumeDisplay.textContent = `${volumeSlider.value}%`;
      muteBtn.textContent = vol === 0 ? '🔇' : vol < 0.5 ? '🔈' : '🔊';
    });
    muteBtn.addEventListener('click', () => {
      if (!audio.muted) {
        audio.muted = true;
        muteBtn.textContent = '🔇';
        volumeDisplay.textContent = 'Muted';
      } else {
        audio.muted = false;
        muteBtn.textContent = audio.volume < 0.5 ? '🔈' : '🔊';
        volumeDisplay.textContent = `${volumeSlider.value}%`;
      }
    });
    async function fetchDurationAndStartTime(artist, title) {
      try {
        const logUrl = 'https://essentialradio.github.io/player/playout_log_rolling.json';
        const res = await fetch(`${logUrl}?_=${Date.now()}`, { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        const match = data.reverse().find(item =>
          item.Artist?.toLowerCase() === artist.toLowerCase() &&
          item.Title?.toLowerCase() === title.toLowerCase()
        );
        if (match && match["Scheduled Time"] && match["Duration (s)"] && match["Hour"]) {
          const hourDate = new Date(match["Hour"]);
          const [sh, sm] = match["Scheduled Time"].split(":").map(Number);
          const start = new Date(
            hourDate.getFullYear(),
            hourDate.getMonth(),
            hourDate.getDate(),
            sh,
            sm,
            0
          );
          return {
            duration: parseInt(match["Duration (s)"], 10),
            startTime: start
          };
        }
      } catch (e) {
        console.warn("Duration/start time fetch failed:", e);
      }
      return null;
    }
    function showMoreMusicSoon() {
      nowPlaying.innerHTML = `
        <span style="color:#fed351;">Now Playing:</span>
        <span class="live-indicator"><span class="dot"></span>LIVE</span><br/>
        <span style="color:white;font-weight:600;font-size:1.2em;">More music soon</span><br/>
        <span style="color:white;">on Essential Radio</span>`;
      document.title = `Essential Radio: Essential listening for Ayrshire College`;
      applyFallbackImmediate();
    
      try {
        if (window._npTimer) { clearInterval(window._npTimer); window._npTimer = null; }
        const prog = document.getElementById('np-progress');
        if (prog) { prog.style.display = 'none'; const bar = prog.querySelector('.bar'); if (bar) bar.style.width = '0%'; prog.classList.remove('ending-soon'); } cancelAnimationFrame(_npRafId);
      } catch(e) {}

      try {
        // Start/Reset a short poll while we're in the break state.
        if (window._npBreakPoll) { clearInterval(window._npBreakPoll); window._npBreakPoll = null; }
        if (window._npBreakForce) { clearTimeout(window._npBreakForce); window._npBreakForce = null; }
        window._npBreakSince = Date.now();

        // Poll every 2s for a valid track and force-refresh NP when one is seen.
        window._npBreakPoll = setInterval(async () => {
          try {
            const r = await fetch('/api/latestTrack?_=' + Date.now(), { cache: 'no-store' });
            const j = await r.json();
            if (j && j.artist && j.title && j.duration && j.startTime) {
              clearInterval(window._npBreakPoll); window._npBreakPoll = null;
              // Force a refresh regardless of last key to break out of a stuck state
              try { await fetchNowPlaying(); } catch(e){}
            }
          } catch(e){ /* keep polling */ }
        }, 2000);

        // Failsafe: after 20s, force a refresh anyway in case the key never changes
        window._npBreakForce = setTimeout(() => {
          try { fetchNowPlaying(); } catch(e){}
        }, 20000);
      } catch(e) {}
    }
    let currentTrackID = null;
let songHasEnded = false;
let trackEndTimeout = null;
let trackEndTime = null; // NEW

async function fetchNowPlaying() {
  try {
    let api = null;
    let payload = null;
    let apiIsALT = false;

    // 1) Hit the PlayIt API first so we can detect ALT mode
    try {
      const latestRes = await fetch('/api/latestTrack?_=' + Date.now(), { cache: 'no-store' });
      if (latestRes.ok) {
        api = await latestRes.json();
      }
    } catch (e) {}

    const apiLooksValid = api && api.artist && api.title && api.duration && api.startTime;
    if (apiLooksValid) {
      const srcRawApi = String(
        (api.source ?? api.Source ?? api.mode ?? api.Mode ?? api.Src) || ''
      ).toUpperCase();
      apiIsALT = (api.indeterminate === true) || srcRawApi === 'ALT';
    }

    if (apiIsALT) {
      // ===== ALT MODE =====
      // For ALT, latestTrack.json (written by Update_Playout_Log.py) is the
      // ONLY source of truth for the actual track.
      try {
        const staticRes = await fetch('/latestTrack.json?_=' + Date.now(), { cache: 'no-store' });
        if (staticRes.ok) {
          const staticJson = await staticRes.json();
          if (
            staticJson &&
            staticJson.artist &&
            staticJson.title &&
            staticJson.duration &&
            staticJson.startTime
          ) {
            payload = staticJson;
          }
        }
      } catch (e) {}

      // If the file completely fails, fall back to API rather than going blank
      if (!payload && apiLooksValid) {
        payload = api;
      }
    } else {
      // ===== NORMAL (PLAYIT / FIXED) =====
      // API stays as source of truth; file is just a safety net.
      if (apiLooksValid) {
        payload = api;
      } else {
        try {
          const staticRes = await fetch('/latestTrack.json?_=' + Date.now(), { cache: 'no-store' });
          if (staticRes.ok) {
            const staticJson = await staticRes.json();
            if (
              staticJson &&
              staticJson.artist &&
              staticJson.title &&
              staticJson.duration &&
              staticJson.startTime
            ) {
              payload = staticJson;
            }
          }
        } catch (e) {}
      }
    }

    // Validate final payload
    if (!payload || !payload.artist || !payload.title || !payload.duration || !payload.startTime) {
      if (typeof showMoreMusicSoon === 'function') showMoreMusicSoon();
      return;
    }

    const artist = payload.artist;
    const title = payload.title;
    const startMs = new Date(payload.startTime).getTime(); // UTC ms
    const durationMs = payload.duration * 1000;
    const endMs = startMs + durationMs;

    // Work out "is ALT?" based on the payload AND what API told us
    const _srcRaw = String(
      (payload && (payload.source ?? payload.Source ?? payload.mode ?? payload.Mode ?? payload.Src)) || ''
    ).toUpperCase();
    const isALT =
      (payload && payload.indeterminate === true) ||
      _srcRaw === 'ALT' ||
      apiIsALT;

    try { document.body.classList.toggle('alt-mode', !!isALT); } catch (e) {}

    // Clear any 'break' polling now that we have a valid, current track.
    try {
      if (window._npBreakPoll) { clearInterval(window._npBreakPoll); window._npBreakPoll = null; }
      if (window._npBreakForce) { clearTimeout(window._npBreakForce); window._npBreakForce = null; }
    } catch (e) {}

    // If this track has already ended, treat as a break and show fallback immediately
    if (Date.now() > endMs) {
      if (typeof showMoreMusicSoon === 'function') showMoreMusicSoon();
      return;
    }

    // Progress bar: show only for non-ALT
    try {
      const prog = document.getElementById('np-progress');
      if (prog) {
        if (!isALT) {
          prog.style.display = 'block';
        } else {
          prog.style.display = 'none';
          const bar = prog.querySelector('.bar');
          if (bar) bar.style.width = '0%';
          prog.classList.remove('ending-soon');
        }
      }
    } catch (e) {}

    // Track identity (to detect when a NEW track arrives)
    const trackKey = `${artist}||${title}||${startMs}`;
    const simpleKey = `${artist}||${title}`;
    window._npLastKey = trackKey;
    window._npCurrentSongKey = simpleKey;

    // Only (re)start the bar if this is a NEW track.
    if (window._npActiveKey !== trackKey) {
      window._npActiveKey = trackKey;
      try { hardResetBar(); } catch (e) {}
      window._npLastTiming = { startMs, endMs };
      try { sessionStorage.setItem('npLast', JSON.stringify({ key: window._npLastKey, startMs, endMs })); } catch (e) {}
      try { startBarAnimation(startMs, endMs); } catch (e) {}
      try { notifyNowTrackChanged(); } catch (e) {}
    } else {
      // Same track; keep existing animation but refresh timing
      window._npLastTiming = { startMs, endMs };
    }

    // Update main Now Playing block
    const nowPlaying = document.getElementById('now-playing');
    if (nowPlaying) {
      nowPlaying.innerHTML = `
        <span style="color:#fed351;">Now Playing:</span>
        <span class="live-indicator"><span class="dot"></span>LIVE</span><br/>
        <span style="color:white;font-weight:600;font-size:1.2em;">${title}</span><br/>
        <span style="color:white;">by ${artist}</span>`;
    }

    // Title & artwork
    try { document.title = `Essential Radio: ${artist} – ${title}`; } catch {}
    try {
      if (window.applyArtwork) {
        window.applyArtwork({ artist, title });
      } else if (typeof fetchArtwork === 'function') {
        fetchArtwork(`${artist} - ${title}`);
      }
    } catch {}

    // Also support alternate title/artist selectors if present
    const titleEl = document.querySelector('#npTitle, #np-title, #np_title, #nowPlayingTitle, #nowPlaying .track-title, #now-playing-card .track-title');
    const artistEl = document.querySelector('#npArtist, #np-artist, #np_artist, #nowPlayingArtist, #nowPlaying .track-artist, #now-playing-card .track-artist');
    if (titleEl) titleEl.textContent = title;
    if (artistEl) artistEl.textContent = artist;

    // Countdown: only for non-ALT (unchanged)
    function updateCountdown() {
      const nowMs = Date.now();
      const remaining = endMs - nowMs;
      const countdownEl = document.getElementById('countdown');
      if (remaining > 0) {
        const mins = Math.floor(remaining / 60000);
        const secs = Math.floor((remaining % 60000) / 1000);
        if (countdownEl) countdownEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
      } else {
        if (countdownEl) countdownEl.textContent = '—/—';
        if (window._npTimer) { clearInterval(window._npTimer); window._npTimer = null; }

        const GRACE_MS = 2500;
        const graceUntil = Date.now() + GRACE_MS;
        const pollDelay = 400;
        let _gracePoll;
        const _pollForNew = async () => {
          try {
            const r = await fetch('/api/latestTrack?_=' + Date.now(), { cache: 'no-store' });
            const j = await r.json();
            const newKey = (j && j.artist && j.title && j.startTime)
              ? `${j.artist}||${j.title}||${new Date(j.startTime).getTime()}`
              : null;
            if (newKey && newKey !== window._npLastKey) { fetchNowPlaying(); return; }
          } catch (e) {}
          if (Date.now() >= graceUntil) {
            if (typeof showMoreMusicSoon === 'function') showMoreMusicSoon();
          } else {
            _gracePoll = setTimeout(_pollForNew, pollDelay);
          }
        };
        _pollForNew();

        if (window._npPollTimer) {
          clearInterval(window._npPollTimer);
          window._npPollTimer = null;
        }
        window._npPollTimer = setInterval(async () => {
          try {
            const r = await fetch('/api/latestTrack?_=' + Date.now(), { cache: 'no-store' });
            const j = await r.json();
            const newKey = (j && j.artist && j.title && j.startTime)
              ? `${j.artist}||${j.title}||${new Date(j.startTime).getTime()}`
              : null;
            if (newKey && newKey !== window._npLastKey) {
              clearInterval(window._npPollTimer);
              window._npPollTimer = null;
              fetchNowPlaying();
            }
          } catch (e) {
            // swallow and keep polling
          }
        }, 5000);
      }
    }

    if (!isALT) {
      updateCountdown();
      if (window._npTimer) { clearInterval(window._npTimer); }
      window._npTimer = setInterval(updateCountdown, 1000);
    } else {
      try { if (window._npTimer) { clearInterval(window._npTimer); } } catch (e) {}
      const c = document.getElementById('countdown');
      if (c) { c.textContent = ''; c.style.display = 'none'; }
    }
  } catch (err) {
    console.error('Error fetching now playing:', err);
    if (typeof showMoreMusicSoon === 'function') showMoreMusicSoon();
  }
}


    async function fetchRecentFromGitHub() {
  try {
    const baseUrl = 'https://essentialradio.github.io/player/playout_log_rolling.json';
    const res = await fetch(`${baseUrl}?_=${Date.now()}`, { cache: 'no-store' });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    const recentItems = data
      .filter(item => {
        const name = `${item.Artist} - ${item.Title}`;
        return item.Artist && item.Title && (songHasEnded || name !== currentTrackID);
      })
      .slice(-5)
      .reverse();
    const entries = await Promise.all(recentItems.map(async item => {
      const time = item['Scheduled Time'] || item.time || '';
      const name = `${item.Artist} - ${item.Title}`;
      const art = await getTrackArtwork(name) || 'Essential Radio Logo.png';
      // --- New: Last.fm icon link ---
      const lastfmUrl = `https://www.last.fm/music/${encodeURIComponent(item.Artist.replace(/\s+/g, '+'))}`;
      const lastfmIcon = `
        <a href="${lastfmUrl}" target="_blank" rel="noopener"
          title="More about ${item.Artist} on Last.fm"
          style="margin-left:7px;vertical-align:middle;display:inline-block;">
          <svg width="19" height="19" viewBox="0 0 32 32" style="display:inline-block;vertical-align:middle;">
            <circle cx="16" cy="16" r="16" fill="#fed351"/>
            <path d="M24.6,19.9c-2.2,1.8-5.1,2.4-7.8,2.1c-2.6-0.3-5.3-1.7-6.7-4c-0.7-1.2-1.1-2.7-1-4.1c0.1-2.6,2.4-4.8,5.2-4.8
              c3.4,0,5,2.4,5.4,4.6c0.2,1-0.5,1.7-1.5,1.7c-1.1,0-1.4-0.8-1.5-1.4c-0.2-1.3-1-2.1-2.3-2.1c-1.2,0-2,0.9-2,2
              c0,0.6,0.2,1.1,0.4,1.5c0.8,1.4,2.4,2.1,4,2.3c2.6,0.3,4.2-0.7,5-1.4c0.8-0.8,1.8-0.6,2.3,0.1C25.1,18.4,25.3,19.2,24.6,19.9z"
              fill="#222"/>
          </svg>
        </a>`;
      const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
      const lazyAttr = isIOS ? '' : 'loading="lazy"';
      return `
        <li>
          <span class="time">${time}</span>
          <img src="${art}"
               alt="Cover for ${name}" ${lazyAttr} />
          <span class="info">
            ${name}
            ${lastfmIcon}
          </span>
        </li>`;
    }));
    const list = document.getElementById('recent-list');
    list.innerHTML = entries.join('');
    document.querySelectorAll('#recent-list img').forEach(img => observer.observe(img));
  } catch (e) {
    console.error('Recent fetch failed:', e);
  }
}

    async function fetchArtwork(trackName) {
      artworkImg.src = 'Essential Radio Logo.png';
      artworkImg.classList.remove('loaded', 'fallback');
      try {
        // Use unified artwork proxy to look up this track
        const res = await fetch(`/api/artwork?q=${encodeURIComponent(trackName)}&_=${Date.now()}`, { cache: 'no-store' });
        if (res.ok) {
          const d = await res.json();
          if (d && d.url) {
            const url = d.url;
            artworkImg.onload = () => artworkImg.classList.add('loaded');
            artworkImg.onerror = applyFallbackImmediate;
            artworkCache[trackName] = url;
            // Cache-bust the URL to ensure browsers repaint new art
            const bust = url.includes('?') ? '&' : '?';
            artworkImg.src = `${url}${bust}ts=${Date.now()}`;
            return;
          }
        }
      } catch {}
      // If proxy fails or returns nothing, fallback to generic logo
      applyFallbackImmediate();
    }
    function applyFallbackImmediate() {
      artworkImg.src = 'Essential Radio Logo.png';
      artworkImg.classList.remove('loaded');
      artworkImg.classList.add('fallback');
    }
    const artworkCache = {};
    async function getTrackArtwork(query) {
  // Normalize query: remove brackets, collapse spaces, strip fancy dashes
  const clean = String(query)
    .replace(/[\u2013\u2014]/g, '-')
    .replace(/\s*-\s*/g, ' ')
    .replace(/\s*\([^\)]*\)/g, ' ')
    .replace(/\s*\[[^\]]*\]/g, ' ')
    .replace(/\s{2,}/g, ' ')
    .trim();
  // Use the server-side proxy to resolve artwork for recent items
  try {
    const res = await fetch(`/api/artwork?q=${encodeURIComponent(clean)}&_=${Date.now()}`, { cache: 'no-store' });
    if (res.ok) {
      const d = await res.json();
      if (d && d.url) return d.url;
    }
  } catch {}
  return '';
}

// === NEXT TRACK ("Coming up") ===
let nextInterval = null;
let nextLockedKey = null;
let nextCanAdvance = true;
let nextLastShownText = '';

async function fetchNextTrack() {
  try {
    const res = await fetch('/nextTrack.json?_=' + Date.now(), { cache: 'no-store' });
    if (!res.ok) throw new Error('HTTP ' + res.status);

    const data = await res.json();
    const wrap = document.getElementById('next-up');
    const textEl = document.getElementById('next-up-text');
    if (!wrap || !textEl) return;

    const artist = (data && data.artist) || '';
    const title  = (data && data.title)  || '';

    // If we don't have something sensible, hide the line
    if (!artist || !title) {
      wrap.style.display = 'none';
      return;
    }

    const candidateKey = `${artist}||${title}`;
    const candidateText = `${title} by ${artist}`;

    // Don't show the same track that's currently playing
    try {
      const nowKey = window._npCurrentSongKey || null;
      if (nowKey && nowKey === candidateKey) {
        wrap.style.display = 'none';
        return;
      }
    } catch (e) {}

    if (!nextLockedKey) {
      // First time this page load: lock immediately
      nextLockedKey = candidateKey;
      nextLastShownText = candidateText;
      nextCanAdvance = false;
    } else if (nextCanAdvance && candidateKey !== nextLockedKey) {
      // Allowed to advance because Now Playing has moved on
      nextLockedKey = candidateKey;
      nextLastShownText = candidateText;
      nextCanAdvance = false;
    }

    const toShow = nextLastShownText || candidateText;
    textEl.textContent = toShow;
    wrap.style.display = 'block';
  } catch (e) {
    const wrap = document.getElementById('next-up');
    if (wrap) wrap.style.display = 'none';
  }
}

function notifyNowTrackChanged() {
  // Called from fetchNowPlaying when a NEW track is detected

  // 1) Allow the next-track pointer to move on
  nextCanAdvance = true;

  // 2) Immediately clear the current "Coming up" so that
  //    when a song jumps into the player it no longer appears
  //    as the next song.
  try {
    const wrap = document.getElementById('next-up');
    if (wrap) wrap.style.display = 'none';
  } catch (e) {}

  // 3) Reset stored next-track state; the next fetchNextTrack()
  //    call will lock in the new upcoming song.
  nextLockedKey = null;
  nextLastShownText = '';

  // 4) Immediately repoll /nextTrack.json so the new "Coming up"
  //    appears as soon as the new song hits the player.
  try {
    fetchNextTrack();
  } catch (e) {}
}

function startNextAuto() {
  if (nextInterval) return;
  nextInterval = setInterval(() => {
    try { fetchNextTrack(); } catch (e) {}
  }, 15000); // poll every 15s to stay in step with Now Playing
}

function stopNextAuto() {
  if (!nextInterval) return;
  clearInterval(nextInterval);
  nextInterval = null;
}

function stopIntervals() {
  clearInterval(nowPlayingInterval); nowPlayingInterval = null;
  clearInterval(recentInterval); recentInterval = null;
  stopNextAuto();
}

// Always fetch once on page load (safe to call early)
try { fetchNowPlaying(); } catch(e){}
try { fetchRecentFromGitHub(); } catch(e){}
try { fetchNextTrack(); } catch(e){}

// Defer interval startup until everything is available
function safeStartIntervals() {
  if (typeof startIntervals === 'function') {
    startIntervals();
    startNextAuto();
  } else {
    setTimeout(safeStartIntervals, 500);
  }
}

// Kick the safe starter once DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', safeStartIntervals, { once: true });
} else {
  safeStartIntervals();
}

// Make visibility handling defensive
document.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'visible') {
    try { fetchNowPlaying(); } catch(e){}
    try { fetchRecentFromGitHub(); } catch(e){}
    try { fetchNextTrack(); } catch(e){}
    if (typeof startIntervals === 'function') startIntervals();
    startNextAuto();
  } else {
    if (typeof stopIntervals === 'function') stopIntervals();
  }
});

// Fallback polling if startIntervals never becomes available
setTimeout(() => {
  if (typeof startIntervals !== 'function' && !window.__recentFallback) {
    window.__recentFallback = setInterval(() => {
      try { fetchRecentFromGitHub(); } catch(e){}
    }, 15000);
  }
}, 3000);

  </script><script>
    function formatShowTitleMobileOnly(title) {
      if (window.innerWidth <= 600) {
        const match = title.match(/(.*)\s+with\s+(.*)/i);
        if (match) {
          return `${match[1]}<br>with ${match[2]}`;
        }
      }
      return title;
    }
    const showSpan2 = document.getElementById("currentShow");
    // MutationObserver ensures that when the schedule updates, we reformat it
    const observer = new MutationObserver(() => {
      const raw = showSpan2?.textContent || "";
      showSpan2.innerHTML = formatShowTitleMobileOnly(raw);
    });
    if (showSpan2) {
      observer.observe(showSpan2, { childList: true });
      // initial format
      showSpan2.innerHTML = formatShowTitleMobileOnly(showSpan2.textContent);
    }
  </script><script>
function refreshCombinedTravel() {
  var iframe = document.getElementById('combined-travel-iframe');
  // Force a reload by resetting the src (with cache-busting)
  iframe.src = "https://travel-ac.vercel.app/Current_Combined_Travel_Report.html?ts=" + Date.now();
}
</script><script>
function updateLiveClock() {
      const now = new Date();
      // 24-hour, 2 digits always
      const pad = n => n.toString().padStart(2, '0');
      const time = `${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;
      const days = ['SUN','MON','TUE','WED','THU','FRI','SAT'];
      const months = [
        'JANUARY','FEBRUARY','MARCH','APRIL','MAY','JUNE',
        'JULY','AUGUST','SEPTEMBER','OCTOBER','NOVEMBER','DECEMBER'
      ];
      const dow = days[now.getDay()];
      const day = now.getDate();
      const month = months[now.getMonth()];
      const year = now.getFullYear();
      const dateStr = `${dow} ${day} ${month} ${year}`;
      document.getElementById('clockTime').textContent = time;
      document.getElementById('clockDate').textContent = dateStr;
    }
    updateLiveClock();
    setInterval(updateLiveClock, 1000);

// ===== LOGO SHOW/HIDE HELPERS =====
function normaliseName(name) {
  return name
    .toLowerCase()
    .replace(/[’']/g, '')      // strip curly and straight apostrophes
    .replace(/\s+/g, '-')      // convert spaces to dashes
    .replace(/[^a-z0-9\-]/g, ''); // remove anything else
}
function showLogo() {
  const logo = document.querySelector('.logo-overhang');
  if (logo) logo.classList.remove('logo-hide');
}
function hideLogo() {
  const logo = document.querySelector('.logo-overhang');
  if (logo) logo.classList.add('logo-hide');
}

// Checks if any overlay (modal or burger) is open, and hides/shows logo accordingly
function checkOverlayLogo() {
  const anyModalOpen = Array.from(document.querySelectorAll('.modal'))
    .some(m => m.style.display === 'block' || m.style.display === 'flex');
  const burgerOpen = document.getElementById('burgerDropdown').style.display === 'flex';
  if (anyModalOpen || burgerOpen) {
    hideLogo();
  } else {
    showLogo();
  }
}

function toggleBurgerMenu() {
  const burgerDropdown = document.getElementById('burgerDropdown');
  const isOpen = burgerDropdown.style.display === 'flex';
  if (isOpen) {
    burgerDropdown.style.display = 'none';
    checkOverlayLogo();
  } else {
    closeAllModals(); // Always close modals first!
    burgerDropdown.style.display = 'flex';
    checkOverlayLogo();
  }
}

function openModalAndCloseBurger(id) {
  closeBurgerMenu();
  openModal(id);
}

function closeBurgerMenu() {
  document.getElementById('burgerDropdown').style.display = 'none';
  checkOverlayLogo();
}

// Close modals when clicking outside of them
document.addEventListener('click', function(event) {
  document.querySelectorAll('.modal').forEach(function(modal) {
    if (event.target === modal) {
      modal.style.display = 'none';
      // Only remove modal-open if no modals left open
      if (![...document.querySelectorAll('.modal')].some(m => m.style.display === 'block')) {
        document.body.classList.remove('modal-open');
      }
      checkOverlayLogo();
    }
  });
});

// Prevent iOS scroll bounce inside modal content
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.modal-content').forEach(function(mc) {
    mc.addEventListener('touchstart', function() {
      var top = mc.scrollTop === 0;
      var bottom = mc.scrollHeight - mc.scrollTop === mc.clientHeight;
      if (top) mc.scrollTop = 1;
      if (bottom) mc.scrollTop -= 1;
    });
  });
});

// ===== EVENT LISTENERS =====

// Close when clicking outside the burger menu
document.addEventListener('click', function(e) {
  const menu = document.getElementById('burgerDropdown');
  const btn = document.getElementById('burgerMenuBtn');
  if (
    window.innerWidth <= 750 &&
    menu.style.display === 'flex' &&
    !menu.contains(e.target) &&
    !btn.contains(e.target)
  ) {
    closeBurgerMenu();
  }
});

// ESC key closes burger menu and all modals
window.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    closeBurgerMenu();
    closeAllModals();
  }
});
// === Now Playing Manual Refresh ===
// Attach click event to refresh button to manually refresh now playing information and the recent track list
document.getElementById('refresh-now-playing')?.addEventListener('click', () => {
  // Immediately fetch the latest now playing info
  fetchNowPlaying();
  // Also refresh the recent songs list
  fetchRecentFromGitHub();
});
</script><script>
(() => {
  const WRAP   = document.getElementById('localEventsWrap');
  const AREA   = document.getElementById('localAreaSel');
  const FROM   = document.getElementById('localFromDate');
  const TO     = document.getElementById('localToDate');
  const SEARCH = document.getElementById('localSearch');

  // --- Formatters (UK) ---
  const tz   = 'Europe/London';
  const dFmt = new Intl.DateTimeFormat('en-GB', { weekday:'short', day:'2-digit', month:'short', year:'numeric', timeZone: tz }); // date label
  const tFmt = new Intl.DateTimeFormat('en-GB', { hour:'2-digit', minute:'2-digit', hour12:false, timeZone: tz });                // time label
  // Tip: prefer Intl over manual string building for language-sensitive formatting. :contentReference[oaicite:1]{index=1}

  // --- Helpers ---
  function toDateObj(dateStr, timeStr) {
    // Build a local Date safely (treat times like local wall-clock for display)
    if (!dateStr) return null;
    const [Y, M, D] = dateStr.split('-').map(Number);
    const [h, m] = (timeStr && timeStr !== 'unknown') ? timeStr.split(':').map(Number) : [0, 0];
    return new Date(Y, (M - 1), D, h || 0, m || 0, 0, 0); // local time
  }
  function dateLabel(d) { return d ? dFmt.format(d) : ''; }
  function timeLabel(t) { return (t && t !== 'unknown') ? tFmt.format(toDateObj('2000-01-01', t)) : ''; } // dummy date for formatting only
  function matchesQuery(ev, q) {
    if (!q) return true;
    q = q.toLowerCase();
    return [ev.title, ev.venue, ev.town, ev.desc].some(v => (v || '').toLowerCase().includes(q));
  }
  function inRange(ev, fromVal, toVal) {
    const start = toDateObj(ev.start_date, ev.start_time);
    const end   = toDateObj(ev.end_date || ev.start_date, ev.end_time || ev.start_time);
    if (!start) return false;
    if (fromVal) {
      const f = new Date(fromVal + 'T00:00:00');
      if (end < f) return false;
    }
    if (toVal) {
      const t = new Date(toVal + 'T23:59:59');
      if (start > t) return false;
    }
    return true;
  }
  function rangeLabel(ev) {
    const sD = toDateObj(ev.start_date, ev.start_time);
    const eD = toDateObj(ev.end_date || ev.start_date, ev.end_time || ev.start_time);
    const sDate = dateLabel(sD);
    const eDate = dateLabel(eD);
    const sTime = timeLabel(ev.start_time);
    const eTime = timeLabel(ev.end_time);

    // Same day
    if (ev.end_date === ev.start_date || !ev.end_date) {
      const timePart = (sTime && eTime) ? ` • ${sTime}–${eTime}` : (sTime ? ` • ${sTime}` : '');
      return `${sDate}${timePart}`;
    }
    // Multi-day
    return `${sDate} – ${eDate}`;
  }

  function makeCard(ev) {
    const when = rangeLabel(ev);
    const where = ev.venue ? `${ev.venue}${ev.town ? ', ' + ev.town : ''}` : (ev.town || '');
    return `
      <article class="event-card" aria-labelledby="${slug(ev.title)}-h">
        <h3 id="${slug(ev.title)}-h">${escapeHTML(ev.title)}</h3>
        <div class="event-meta">
          <span>📅 ${when}</span>
          ${where ? `<span>📍 ${escapeHTML(where)}</span>` : ''}
        </div>
        ${ev.desc ? `<div class="event-desc">${escapeHTML(ev.desc)}</div>` : ''}
        ${ev.link ? `<div class="event-actions"><a href="${ev.link}" target="_blank" rel="noopener">More info →</a></div>` : ''}
      </article>
    `;
  }
  function slug(s) { return (s || '').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); }
  function escapeHTML(s) { return (s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

  // --- Data + render ---
  let data = { north:[], south:[], east:[] };

  function render() {
    const area = AREA?.value || 'north';
    const from = FROM?.value || '';
    const to   = TO?.value || '';
    const q    = (SEARCH?.value || '').trim();

    const pools = (area === 'all') ? [data.north, data.south, data.east] : [data[area] || []];

    let rows = pools.flat().filter(ev => inRange(ev, from, to) && matchesQuery(ev, q));

    // Sort by start_date then start_time
    rows.sort((a, b) => {
      const aStart = toDateObj(a.start_date, a.start_time) || 0;
      const bStart = toDateObj(b.start_date, b.start_time) || 0;
      return aStart - bStart;
    });

    if (!rows.length) {
      WRAP.innerHTML = `<div style="color:#fed351;font-weight:600">No matching events.</div>`;
      return;
    }

    if (area === 'all') {
      const groups = { north:[], south:[], east:[] };
      rows.forEach(ev => groups[ev._area || 'north'].push(ev));
      const title = k => ({north:'North Ayrshire', south:'South Ayrshire', east:'East Ayrshire'})[k];
      WRAP.innerHTML = ['north','south','east'].filter(k => groups[k].length).map(k => `
        <section aria-labelledby="sec-${k}">
          <h3 id="sec-${k}" style="color:#00818a;margin:8px 0;">${title(k)}</h3>
          <ul class="event-col" role="list">
            ${groups[k].map(ev => `<li>${makeCard(ev)}</li>`).join('')}
          </ul>
        </section>
      `).join('');
    } else {
      WRAP.innerHTML = `
        <ul class="event-col" role="list">
          ${rows.map(ev => `<li>${makeCard(ev)}</li>`).join('')}
        </ul>
      `;
    }
  }

  async function load() {
    try {
      const res = await fetch('events-ayrshire.json', { cache: 'no-store' });
      const json = await res.json();
      // Tag area for grouping under "All"
      ['north','south','east'].forEach(k => {
        data[k] = (json[k] || []).map(e => ({ ...e, _area: k }));
      });
      // Default from today
      const today = new Date(); today.setHours(0,0,0,0);
      if (FROM) FROM.value = today.toISOString().slice(0,10);
      render();
    } catch(e) {
      console.error('Local events load failed', e);
      WRAP.innerHTML = `<div style="color:#ff6b6b;">Could not load events.</div>`;
    }
  }

  // Wire controls
  AREA?.addEventListener('change', render);
  FROM?.addEventListener('change', render);
  TO?.addEventListener('change', render);
  SEARCH?.addEventListener('input', render);
  document.addEventListener('DOMContentLoaded', load);
})();
</script></div></div></div><script>

  setTimeout(() => {
    try {
      const doc = iframe.contentWindow?.document;
      const bodyContent = doc?.body?.innerHTML?.trim();
      const isBlank = !bodyContent || bodyContent.length === 0;
      if (isBlank) {
        iframe.parentNode.appendChild(overlay);
      }
    } catch (e) {
      // On access errors (cross-origin), assume iframe failed
      iframe.parentNode.appendChild(overlay);
    }
  }, 1500);
});
</script><script>
function openLivePresenterModal() {
  // Try to get the presenter from the structured element first
  let presenterName = '';
  const presenterSpan = document.querySelector('#currentShow .show-presenter');
  if (presenterSpan) {
    presenterName = presenterSpan.textContent.replace(/^with\s+/i, '').trim();
  } else {
    // Fallback: loose regex against innerText (handles unexpected formatting/newlines)
    const showText = document.querySelector('#currentShow')?.innerText || '';
    const m = showText.match(/with\s+([^\n\r]+)/i);
    if (m) presenterName = m[1].trim();
  }

  if (!presenterName) {
    openModal('presentersModal'); // fallback if nothing parsed
    return;
  }

  // Use the shared normalisation helper so slugs match presenter IDs
  const slug = typeof normaliseName === 'function'
    ? normaliseName(presenterName)
    : presenterName.toLowerCase().replace(/[^\w\s-]/g, '').trim().replace(/\s+/g, '-');

  const modalId = `presenter-${slug}`;
  const modalEl = document.getElementById(modalId);
  if (modalEl) {
    openPresenterModal(modalId);
  } else {
    openModal('presentersModal');
  }
}

</script><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-paul-woodland" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-paul-woodland')">×</span><h2>Paul Woodland</h2><img alt="Paul Woodland" src="Paul-Woodland.jpg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p>Paul is the voice of <strong>Essential Breakfast</strong> every weekday morning – bringing you music, info and morning mayhem to start the day right.</p><p>Paul worked full-time on FM station <strong>90.1 Hope FM</strong> until 2010. Alongside his weekday afternoon show (2–5pm), he managed the production studio, created on-air content, handled advertiser requirements and maintained the music library. In the absence of the station manager, he also stepped into that leadership role.</p><p>After relocating to Scotland in 2011, Paul earned an <strong>HNC in Radio</strong> from Edinburgh College and continued with an <strong>HND in Radio</strong> at City of Glasgow College. He went on to found and run <strong>Scene Radio</strong> – Scotland’s first LGBT+ radio station – until its closure in 2018 following the passing of his partner.</p><p>Since then, Paul has stayed active in radio on a voluntary basis with stations such as <strong>Xpress Radio Scotland</strong>, <strong>The Online Station</strong>, <strong>Irvine Beat</strong> and <strong>UWS Radio</strong>. His passion for broadcasting continues to shine every morning on Essential Radio.</p></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-scott-ohare" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-scott-ohare')">×</span><h2>Scott O’Hare</h2><img alt="Scott O'Hare" src="Scott-OHare.jpg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p>Oh yes! Scott eases you out of the workday on <strong>Essential Hometime</strong>, with upbeat tunes, campus updates and his trademark dry wit. OHH YESSSSS!!!!</p></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-faith-montgomery" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-faith-montgomery')">×</span><h2>Faith Montgomery</h2><img alt="Faith Montgomery" src="Faith-Montgomery.jpg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p>Faith lights up Friday lunchtimes with a positive energy boost on her edition of <strong>Feelgood Lunch</strong>.</p><p>Faith has a background in performing arts and volunteers regularly for causes she cares about. Passionate about music, mental health and equality, she’s as comfortable at a festival as she is at an indie gig.</p><h3>Get to know Faith</h3><ul><li><strong>When do you pack for holiday?</strong> A week in advance – she plans her outfits!</li><li><strong>In the fridge:</strong> Monster and Red Bull (essentials!)</li><li><strong>Movie star alter-ego:</strong> Jenna Ortega</li><li><strong>Biography title:</strong><em>Reputation of a Goth ⚕️</em></li><li><strong>Most bizarre experience:</strong> Standing up in her chair for the first time</li><li><strong>Most embarrassing moment:</strong> Being sick on stage</li><li><strong>Dream app:</strong> A kettle-lifter to make coffee</li><li><strong>Spotify shame:</strong> “No!! Way too much alternative music”</li><li><strong>TV guilty pleasure:</strong><em>Coronation Street</em></li></ul></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-bex-mcnamee" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-bex-mcnamee')">×</span><h2>Bex McNamee</h2><img alt="Bex McNamee" src="Bex-Mcnamee.jpg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p>Bex brings fun, energy and student buzz to <strong>Feelgood Lunch</strong> and <strong>The Midweek Mash-Up</strong>.</p><p>She describes her life as a daily cartoon episode – full of unpredictability and humour. A lover of 2000s pop culture, Bex is big on Buffy, Scooby-Doo, 80s hip-hop and anything with nostalgia and chaos mixed in.</p><h3>Get to know Bex</h3><ul><li><strong>When do you pack for a holiday?</strong> About 2 hours before leaving!</li><li><strong>In the fridge:</strong> Energy drinks and strawberries</li><li><strong>Movie star alter-ego:</strong> Early 2000s Sarah Michelle Gellar (wishful thinking!)</li><li><strong>Biography title:</strong><em>Young Dumb n Broke</em></li><li><strong>Most bizarre experience:</strong> “My whole life feels like one – I live like a cartoon character”</li><li><strong>Most embarrassing moment:</strong> Calling teachers “mum”... too many times</li><li><strong>Dream app:</strong> A competitive subtitle game that could land you work with Netflix</li><li><strong>Spotify shame or pride?</strong> “Sure, but it’s full of 2000s music and 80s hip-hop!”</li><li><strong>TV guilty pleasure:</strong><em>Barbie: Life in the Dreamhouse</em> – her comfort show</li></ul></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-finlay-campbell" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-finlay-campbell')">×</span><h2>Finlay Campbell</h2><img alt="Finlay Campbell" src="Finlay-Campbell.jpg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p>Finlay brings the fun and energy to <strong>Feelgood Lunch</strong> every Sunday and Tuesday. Finlay is passionate about radio, loves The Simpsons and has a knack for picking the perfect tracks to boost your weekend mood.</p><p>Expect a mix of positivity, humour and music that makes you feel great — all delivered with his infectious personality and enthusiasm for broadcasting.</p></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-connor-strachan" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-connor-strachan')">×</span><h2>Connor Strachan</h2><img alt="Connor Strachan" src="Connor-Strachan.JPG" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p>Join Connor every Thursday afternoon from 2-4pm. More info coming soon.</p></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-lee-everest" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-lee-everest')">×</span><h2>Lee Everest</h2><img alt="Lee Everest" src="Lee-Everest.jpg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p>Lee brings the fire every weekend on <strong>Ready for the Weekend</strong> — a high-energy show bursting with bangers, feel-good beats and party-starting tunes to kick off your Saturday night in style.</p><p>Broadcasting from the South Coast, Lee’s all about upbeat vibes, floor-fillers and keeping you dancing from the first song to the last. Whether it’s fresh anthems or old-school floor-shakers, he’s got your weekend soundtrack sorted.</p><h3>Get to know Lee</h3><ul><li><strong>When do you pack for holiday?</strong> The day before – keeps things exciting!</li><li><strong>In the fridge:</strong> Milk, cheese and a stash of yoghurts.</li><li><strong>Movie star alter-ego:</strong> Jim Carrey – unpredictable energy guaranteed.</li><li><strong>Biography title:</strong><em>You Win Some, You Lose Some</em></li><li><strong>Most bizarre experience:</strong> Flying over Las Vegas in a helicopter at night.</li><li><strong>Most embarrassing moment:</strong> Karaoke on stage in Brighton. Enough said.</li><li><strong>Dream app:</strong> One to control your home radio studio from your phone!</li><li><strong>Spotify shame:</strong> No shame – let’s go live!</li><li><strong>TV guilty pleasure:</strong><em>From the Earth to the Moon</em></li><li><strong>When he's not on Essential Radio:</strong> Watching documentaries and tuning in to other dance shows for inspiration.</li></ul></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-ronny-costello" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-ronny-costello')">×</span><h2>Ronny Costello</h2><img alt="Ronny Costello" src="Ronny-Costello.jpg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p>Ronny brings the energy every week on <strong>Club Classics</strong> — a high-octane hour of dance anthems, floor-fillers and old-school bangers from across the decades. Expect non-stop throwbacks, forgotten gems and iconic club tunes mixed with love.</p><p>He caught the DJ bug on a Magaluf holiday in 1999, watching Seb Fontaine work the decks at BCM. A Numark DJ-in-a-box set and a stack of vinyl later, his journey began. Those records? Still in his mum’s loft.</p><p>From hospital radio to commercial stations and now award-winning shows and podcasts, Ronny’s been in the game since 2000 — and still spends most weekends behind the decks somewhere!</p><p>For more, follow <strong>@thisisclubclassics</strong> on Instagram &amp; Facebook or visit <a href="https://clubclassicsradioshow.com" target="_blank">clubclassicsradioshow.com</a>.</p><h3>Get to know Ronny</h3><ul><li><strong>When do you pack for holiday?</strong> Probably while the taxi’s on the way.</li><li><strong>In the fridge:</strong> Energy drinks and leftover pizza. Essentials only.</li><li><strong>Movie star alter-ego:</strong> Martin Compston (with better dance moves).</li><li><strong>Biography title:</strong><em>Beats, Banter &amp; BCM</em></li><li><strong>Most bizarre experience:</strong> DJing in a lift. Yes, an actual working lift.</li><li><strong>Most embarrassing moment:</strong> Pressing stop instead of play mid-set. Club went silent. Mortified.</li><li><strong>Dream app:</strong> One that beams you straight to Ibiza.</li><li><strong>Spotify shame:</strong> Probably that 90s boyband playlist. No further questions.</li><li><strong>TV guilty pleasure:</strong><em>Gladiators</em>. Old and new. He’s obsessed.</li><li><strong>When he's not on Essential Radio:</strong> DJing, podcasting, or trying not to buy more vinyl.</li></ul></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-david-southway" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-david-southway')">×</span><h2>David Southway</h2><img alt="David Southway" src="David-Southway.jpg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p>David is the voice behind <strong>Soul Vaults</strong>, a show that celebrates the rich heritage of soul music — not just playing the classics, but sharing the stories behind them. His background in radio dates back to 1970 as one of the first DJs on BBC Radio Bristol and he’s stayed connected to broadcasting ever since.</p><p>Balancing life in business and radio, David has worked across major commercial stations in the South of England including GWR, Classic Gold, WFM and Star. With a deep knowledge of old soul and a passion for its legacy, Soul Vaults is more than just a playlist — it's a guided journey through a golden genre.</p><h3>Get to know David</h3><ul><li><strong>When do you pack for holiday?</strong> Usually the day before — time-honoured tradition!</li><li><strong>In the fridge:</strong> Sunday? Full. Ask again Friday and it might be a different story.</li><li><strong>Movie star alter-ego:</strong> Himself. “I need the money.”</li><li><strong>Biography title:</strong><em>Yer Tiz</em> – a West Country phrase meaning “Here it is.” (Written and published!)</li><li><strong>Most bizarre experience:</strong> Getting mugged in Las Vegas — and being told he was *lucky* it wasn’t worse.</li><li><strong>Most embarrassing moment:</strong> Using the ladies’ loo in a London hotel… door open… mid-flow… full audience. Say no more.</li><li><strong>Dream app:</strong> Something that helps you *avoid* the wrong toilet.</li><li><strong>Spotify shame:</strong> No shame – it’s a solid mix of old and new soul, always.</li><li><strong>TV guilty pleasure:</strong> Not Love Island... but he's *heard* the scenery’s nice.</li><li><strong>When he's not on Essential Radio:</strong> Researching, scripting and compiling the next visit to the Soul Vaults – a true labour of love.</li></ul></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-davy-sims" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-davy-sims')">×</span><h2>Davy Sims</h2><img alt="Davy Sims" src="Davy-Sims.jpg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p>Davy presents <strong>Around the World</strong>, bringing you global sounds from every corner of the planet. It’s a journey through world music, informed by decades of radio experience and a serious vinyl and digital collection.</p><p>His broadcasting career began in 1979 at Downtown Radio, then the BBC — including Radio 1 and Radio Ulster — before leading BBC NI’s New Media team. Since “retirement,” he’s kept busy producing syndicated radio, contributing to global music charts and jetting off to music conferences across Europe.</p><p>Find out more at <a href="https://www.davysims.com" target="_blank">davysims.com</a>.</p><h3>Get to know Davy</h3><ul><li><strong>When do you pack for holiday?</strong> Starts thinking months in advance, but packs properly 3 days before — with weighing sessions.</li><li><strong>In the fridge:</strong> The basics. In the freezer? Who knows — apart from the missing ice cream.</li><li><strong>Movie star alter-ego:</strong> Brian Cox (because Holywood deserves Hollywood).</li><li><strong>Biography title:</strong><em>Sound</em></li><li><strong>Most bizarre experience:</strong> Peter Gabriel turning up unannounced and sitting at his desk at Radio 1.</li><li><strong>Most embarrassing moment:</strong> Also Peter Gabriel. Same moment. Still recovering.</li><li><strong>Dream app:</strong> Something that gives you proper privacy.</li><li><strong>Spotify shame:</strong> No shame — though he’s more of an iTunes guy. Username: “davysims”.</li><li><strong>TV guilty pleasure:</strong><em>The Young Montalbano</em></li><li><strong>When he's not on Essential Radio:</strong> Listening for the World Music Charts, travelling to music events across Europe and spending time in Slovenia whenever he can.</li></ul></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-big-tommy" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-big-tommy')">×</span><h2>Big Tommy</h2><img alt="Big Tommy" src="Big-Tommy.jpg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p>Big Tommy (Tommy Martin) brings the party every Saturday with his legendary <strong>Saturday Music Marathon</strong> and <strong>Big Fat Party Anthems</strong>. Expect full-on throwbacks, megamixes and a bingo ball or two.</p><p>He’s been behind the mic since the mid-2000s after years of DJing around Glasgow and Lanarkshire in the 80s and 90s. When he’s not playing your favourite 70s and 80s tunes, you’ll probably find him enjoying a well-earned Chinese takeaway or trying to convince the team that <em>Emmerdale</em> is quality telly.</p><h3>Get to know Big Tommy</h3><ul><li><strong>When do you pack for holiday?</strong> A day before – but he swears he’s not disorganised!</li><li><strong>In the fridge:</strong> A chilled bottle of Irn Bru – obviously.</li><li><strong>Movie star alter-ego:</strong> Mel Gibson (brave choice).</li><li><strong>Biography title:</strong><em>Confessions of a Fairground Worker</em></li><li><strong>Most bizarre experience:</strong> Getting 4 numbers up on the lottery – and telling everyone about it since.</li><li><strong>Most embarrassing moment:</strong> None. Not even one. Honest.</li><li><strong>Dream app:</strong> A solar-powered one – eco vibes!</li><li><strong>Spotify shame:</strong> “Let me think about that...”</li><li><strong>TV guilty pleasure:</strong><em>Emmerdale</em> (don’t judge).</li><li><strong>When he's not on Essential Radio:</strong> Chilling out with good music and great food.</li></ul></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-jan-gow" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-jan-gow')">×</span><h2>Jan Gow</h2><img alt="Jan Gow" src="Jan-Gow.jpg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p>Jan presents <strong>The JanCave Jukebox Years</strong> — a one-hour nostalgic celebration of 70s pop culture, music and memories. Each episode takes a trip through a single year of the decade, featuring personal favourites, artist stories and the odd vintage TV clip for good measure.</p><p>Born in 1964 (she insists we include that), Jan brings her cheeky humour, deep affection for 70s music and photographic flair to the show. She’s also a professional photographer and, in her words, “handy with an airbrush” — though it’s mostly just great lighting and even better vibes.</p><p>Broadcast on over a dozen stations — including Saturdays at 5pm on Essential Radio — The JanCave Jukebox Years is where retro reigns supreme.</p><h3>Get to know Jan</h3><ul><li><strong>Favourite musical decade:</strong> The 70s — loud, colourful and full of character.</li><li><strong>Best compliment received:</strong> “You don’t look old enough to remember the 70s!”</li><li><strong>Fun fact:</strong> She still owns every vinyl record she ever bought (and alphabetised them last lockdown).</li><li><strong>Most likely to say:</strong> “You should’ve gone to Specsavers.”</li><li><strong>When she's not on Essential Radio:</strong> Taking photos, digging through retro playlists and wondering why she didn’t keep more 70s flares.</li></ul></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-spencer-james" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-spencer-james')">×</span><h2>Spencer James</h2><img alt="Spencer James" src="Spencer-James.jpg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p>Spencer James is the host of <strong>Airplay40</strong> — the weekly chart show compiled from airplay on over 250 English-speaking radio stations worldwide. It’s the Top 40 countdown that reflects the songs you’re really listening to right now, plus the latest showbiz news from Radio News Hub.</p><p>With nearly 30 years in media and over two decades on air, Spencer has worked across UK and international radio — from breakfast and drive shows in the South East of England, to running stations abroad and even flying above London and Essex as part of AA Roadwatch’s “flying eyes.” In 2008 he created a chart show for expat audiences which grew into today’s <strong>Airplay40</strong>.</p><p>Broadcast every week on Essential Radio, Airplay40 is your connection to what’s hot (and what’s not) in the world of music.</p><h3>Get to know Spencer</h3><ul><li><strong>Started in radio:</strong> While studying Film &amp; TV at the University of Wales, Aberystwyth.</li><li><strong>Previous roles:</strong> Presenter, Programme Manager, Promotions Manager, travel reporter… and briefly a film assistant director.</li><li><strong>Claim to fame:</strong> One of his short films was BAFTA-nominated.</li><li><strong>Biggest idea:</strong> Launching what became Airplay40 — now heard worldwide.</li><li><strong>When he’s not on air:</strong> Supporting England rugby, losing golf balls, or experimenting in the kitchen with mixed results.</li></ul></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-dr-hilary-jones" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-dr-hilary-jones')">×</span><h2>Dr Hilary Jones</h2><img alt="Dr Hilary Jones" src="Dr-Hilary-Jones.jpg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p>Dr Hilary Jones is one of the UK’s most trusted health voices — and now hosts <strong>The Dr Hilary Show</strong>, a weekly podcast and radio series exploring health, hope and happiness through real-life stories, expert advice and candid conversation.</p><p>Whether it’s men’s mental health, chronic illness, fitness, grief, or breaking down medical myths, the show mixes heartfelt interviews with science-backed insight. Guests have included sports surgeons, Strictly contestants, musicians, grief coaches and patients fighting rare diseases — all brought together by Hilary’s calm, compassionate style.</p><p>Listeners are also invited to send in their own questions for his <strong>Ask Dr Hilary</strong> segment, where he shares practical advice on everything from sleep and diet to anxiety and everyday wellbeing. It’s about empowerment, education — and making good health feel achievable.</p><h3>Get to know Dr Hilary</h3><ul><li><strong>Started in TV:</strong> Over 30 years ago — and still going strong.</li><li><strong>Favourite topic:</strong> When medicine meets the human story.</li><li><strong>Signature question:</strong> “How are you, really?”</li><li><strong>When he's not on air:</strong> Writing, walking, or quietly refusing to endorse miracle face creams on Facebook.</li><li><strong>Ask Dr Hilary:</strong> Email <a href="mailto:Ask@drhilaryjones.com">Ask@drhilaryjones.com</a> to have your health questions answered on the show.</li></ul></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-tim-graham" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-tim-graham')">×</span><h2>Tim Graham</h2><img alt="Tim Graham" src="Tim-Graham.jpeg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p>Tim hosts the weekly <strong>LGBTQ Music Chart Radio Show</strong> — a global celebration of LGBTQ music, voices and talent. Syndicated across multiple stations and growing fast, the show champions chart-topping anthems and brand-new discoveries from LGBTQ artists around the world.</p><p>Each Saturday, Tim counts down the top tracks, shares new releases from <em>Outed On Friday</em> and keeps listeners connected to the pulse of the LGBTQ+ music scene. Whether you’re discovering your next queer anthem or reliving a favourite, this show brings community, colour and creativity to the airwaves.</p><p>Catch the show Sundays at 6pm on Essential Radio, or visit <a href="https://lgbtqmusicchart.uk" target="_blank">lgbtqmusicchart.uk</a> to explore the full chart and voting schedule.</p><h3>Get to know Tim</h3><ul><li><strong>What drives the show:</strong> Elevating LGBTQ+ voices through the power of music.</li><li><strong>Favourite part of the job:</strong> Watching queer artists climb the chart and find new fans every week.</li><li><strong>Most played artist lately:</strong> Always changing – but there’s a soft spot for Rhian!, Asbjørn and Robert O’Connor.</li><li><strong>Guilty pleasure:</strong> Tallying the votes like it's Eurovision.</li><li><strong>When he's not on air:</strong> Updating the chart, scouting new releases and supporting LGBTQ music from behind the scenes.</li></ul></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-stephen-howie" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-stephen-howie')">×</span><h2>Stephen Howie</h2><img alt="Stephen Howie" src="Stephen-Howie.jpg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p>Stephen brings the soul with <strong>Grooveline</strong> — a genre-hopping celebration of classic and modern soul, jazz-funk, acid jazz and more. Broadcasting since 1998, his show has reached audiences in the UK, Europe, Africa and beyond.</p><p>With guests like Bluey from Incognito and DJ legend John Morales, Grooveline is recorded at his base in London and packed with groove to move you — every single week.</p><h3>Get to know Stephen</h3><ul><li><strong>When do you pack for holiday?</strong> The night before, no matter what. Half an hour tops.</li><li><strong>In the fridge:</strong> Half-used jars, milk and herbs clinging to life.</li><li><strong>Movie star alter-ego:</strong> Gerard Butler (obviously).</li><li><strong>Biography title:</strong><em>The Soulful Scotsman</em></li><li><strong>Most bizarre experience:</strong> Detained and questioned as a suspected spy in Naxçıvan.</li><li><strong>Most embarrassing moment:</strong> Tripping across the floor at karaoke just before singing “What Is Love?”.</li><li><strong>Dream app:</strong> 24/7 hash brown delivery. Essential.</li><li><strong>Spotify shame:</strong> None – but brace yourself for a perty.</li><li><strong>TV guilty pleasure:</strong><em>EastEnders</em>. Every single episode from 1985 to now (with a couple of gaps).</li><li><strong>When he's not on Essential Radio:</strong> Far, far too much. Probably still not sitting still.</li></ul></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-bill-grainger" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-bill-grainger')">×</span><h2>Bill Grainger</h2><img alt="Bill Grainger" src="Bill-Grainger.jpg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p>Bill Grainger was a legend of the Scottish club scene and the driving force behind <strong>The Hi-NRG Show</strong> on Essential Radio — two hours of classic floorfillers, 12-inch anthems and high-energy club culture, broadcast every Sunday from midnight.</p><p>From his early days DJing at Edinburgh’s legendary <strong>Fire Island</strong> nightclub to guest spots on <strong>Radio Clyde</strong> and running <strong>Clubscene Records</strong>, Bill helped define the Scottish HI-NRG and dance landscape through the 70s, 80s and beyond. He promoted acts, launched magazines and gave a platform to artists long before the mainstream caught on.</p><p>Bill's encyclopaedic knowledge and infectious passion for dance music made every show feel like a trip back to the golden age of clubbing — bold, bright and bursting with energy. His legacy lives on through the music, the memories and every beat he ever dropped.</p><h3>Get to know Bill</h3><ul><li><strong>Favourite genre:</strong> Pure HI-NRG — unapologetically loud, proud and powerful.</li><li><strong>Scene roots:</strong> Fire Island, Princes Street. A dancefloor institution.</li><li><strong>Industry impact:</strong> Founder of Clubscene Records, promoter, tastemaker, radio icon.</li><li><strong>On Essential Radio:</strong> His Hi-NRG Show kept the spirit of the clubs alive every weekend.</li><li><strong>Legacy:</strong> A pioneer who shaped Scotland’s dance culture with passion and pride.</li></ul></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-kevin-mccallum" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-kevin-mccallum')">×</span><h2>Kevin McCallum</h2><img alt="Kevin McCallum" src="Kevin-Mccallum.jpg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p>Kevin is the voice of <strong>The Mr Rocks Show</strong> — a weekly two-hour journey through classic and contemporary heavy rock. From Led Zeppelin to Scarlet Rebels, it’s a personal playlist shaped by over 45 years of gig-going, reviewing and loving loud guitars.</p><p>The show brings together timeless rock anthems and fresh new discoveries, along with artist interviews and gig highlights from Kevin’s extensive experience in the rock scene. His passion is infectious and his knowledge runs deep — from ACDC at the Apollo in 1980 to Dirty Honey in 2022, he's lived it.</p><p>Kevin launched his first show in 2020 and now records from home, sending out the Mr Rocks Show to a growing network of stations — all fuelled by a lifelong obsession with powerful music and the stories behind it.</p><h3>Get to know Kevin</h3><ul><li><strong>When do you pack for holiday?</strong> A week before — organised rocker.</li><li><strong>In the fridge:</strong> Grapes, milk, cheese — and probably more cheese.</li><li><strong>Movie star alter-ego:</strong> Al Pacino (or Jack Nicholson if he’s busy).</li><li><strong>Biography title:</strong><em>Who?</em></li><li><strong>Most bizarre experience:</strong> Wine and cheese with Mick Ralphs, talking through the making of “Feel Like Making Love”.</li><li><strong>Most embarrassing moment:</strong> Helping everyone else get their passports sorted… then realising he’d forgotten his own.</li><li><strong>Dream app:</strong> One that automatically cuts your grass. Please.</li><li><strong>Spotify shame:</strong> Hook it up — no problem!</li><li><strong>TV guilty pleasure:</strong><em>Dickinson’s Real Deal</em></li><li><strong>When he's not on Essential Radio:</strong> Family time, live gigs, reviewing new rock releases and summer cricket.</li></ul></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-emma-scott" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-emma-scott')">×</span><h2>Emma Scott</h2><img alt="Emma Scott" src="Emma-Scott.jpg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p>Emma Scott is the force behind <strong>The Pluggin’ Baby Radio Show</strong> — a two-hour blast of guitar-driven music that celebrates the best in independent rock alongside tracks from icons like Foo Fighters, Green Day, Paramore and Muse (her ultimate fave).</p><p>Launched in 2022, the show features exclusive interviews, acoustic sessions and fresh new talent from around the world. It’s where future festival headliners meet seasoned legends — and Emma’s passion for powerful music shines through every week.</p><p>A true radio veteran, Emma’s voice is already familiar to listeners of Kerrang! Radio, Metro FM, Power FM, Galaxy, Heart and more. Her decades in the industry have been spent championing new music with unmatched energy and heart.</p><p>Don’t miss her weekly feature <strong>Killer Cover</strong>, where rock bands take on pop classics — and you can even suggest your own via <a href="mailto:radioshow@plugginbaby.com">radioshow@plugginbaby.com</a>.</p><h3>Get to know Emma</h3><ul><li><strong>Started in radio:</strong> 1988 – and hasn’t stopped rocking since.</li><li><strong>Show named after:</strong> A Muse song. Of course.</li><li><strong>What to expect:</strong> Guitars, guts, energy and Emma’s unmistakable passion.</li><li><strong>When she’s not on air:</strong> She’s probably discovering your new favourite band.</li><li><strong>Catch the show:</strong> Weekly on Essential Radio and stations across the UK.</li></ul></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-dave-watkins" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-dave-watkins')">×</span><h2>Dave Watkins</h2><img alt="Dave Watkins" src="Dave-Watkins.jpg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p>Dave presents <strong>The Country Mile</strong> — a weekly show packed with real, authentic country music. From honky tonk and bluegrass to outlaw and Ameripolitan, it’s a handpicked selection of brand new tracks from across the genre.</p><p>Broadcast from his home studio in Devon and now syndicated worldwide, the show has grown steadily since launching in 2017. Country fans can catch up via <a href="https://hearthis.at/thecountrymile" target="_blank">hearthis.at/thecountrymile</a> or find more at <a href="https://facebook.com/thecountrymile" target="_blank">facebook.com/thecountrymile</a>.</p><h3>Get to know Dave</h3><ul><li><strong>When do you pack for holiday?</strong> Usually a couple of days before – if he ever gets the chance!</li><li><strong>In the fridge:</strong> Milk, cheese, bacon… and a few cans of cloudy cider.</li><li><strong>Movie star alter-ego:</strong> Someone charming, funny and far too good-looking.</li><li><strong>Biography title:</strong><em>OK At Radio, Bad At Jokes</em></li><li><strong>Most bizarre experience:</strong> Interviewing Bruce Watson… then Jimmy Tarbuck. Very different vibes.</li><li><strong>Most embarrassing moment:</strong> His entire teenage fashion phase.</li><li><strong>Dream app:</strong> One that secretly doubles his wages.</li><li><strong>Spotify shame:</strong> “I’ve got awesome taste — plug it in!”</li><li><strong>TV guilty pleasure:</strong> Accidentally getting into <em>90 Day Fiancé</em>.</li><li><strong>When he's not on Essential Radio:</strong> Working for the NHS, walking on Dartmoor, or spending time with family and music.</li></ul></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-brian-woolfson" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-brian-woolfson')">×</span><h2>Brian Woolfson</h2><img alt="Brian Woolfson" src="Brian-Woolfson.jpg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p>Woolfy is the man behind <strong>Retro Charts</strong> — Essential Radio’s weekly dose of classic UK Top 20s. Whether it’s the glitter of the 70s, synths of the 80s, heartbreak of the 90s or pop chaos of the 00s, Woolfy delivers the facts, the flops, the trivia and the tunes you forgot you loved.</p><p>With over 20 years of radio under his belt (Q96, Real Radio, Clyde 1, Central FM, Nation Radio Scotland and more), he’s a walking chart archive with a habit of remembering peak positions from 1989 better than where he left his keys.</p><p>Woolfy’s countdowns are packed with pop nostalgia, artist stories and masses of chart stats. If you love the UK charts, you’ll love this show — even if you still think “Reef – Place Your Hands” was a Number 1 (spoiler: it wasn’t).</p><h3>Get to know Woolfy</h3><ul><li><strong>When do you pack for holiday?</strong> Either a fortnight early… or during the Uber ride.</li><li><strong>In the fridge:</strong> Out-of-date condiments and a lot of fizzy water pretending to be healthy.</li><li><strong>Movie star alter-ego:</strong> George Clooney. It came up in a quiz once and he’s stuck with it.</li><li><strong>Biography title:</strong><em>Thanks for Listening</em> – he says it after every show, and he means it (mostly).</li><li><strong>Most bizarre experience:</strong> Being forced to drink “venoms” at the Savoy in Glasgow by a radio colleague. Never again.</li><li><strong>Most embarrassing moment:</strong> Saying the wrong station name live on his first show. Ask any Scottish radio presenter.</li><li><strong>Dream app:</strong> One that names obscure celebs on TV shows. Looking at you, Celebrity Mastermind.</li><li><strong>Spotify shame:</strong> “Turtle Power”, “Itsy Bitsy Teeny Weeny...” and Anita Dobson's EastEnders single. All for research. Honest.</li><li><strong>TV guilty pleasure:</strong> Coronation Street. Apparently he’s part Roy, part Brian, part Norris. No further questions.</li><li><strong>When he's not on air:</strong> Teaching, compiling charts, curating his Now That’s What I Call Music collection, or correcting your chart trivia on X.</li></ul></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-keelin-mckenna" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-keelin-mckenna')">×</span><h2>Keelin McKenna</h2><img alt="Keelin McKenna" src="Keelin-Mckenna.jpg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p><em>Presenter</em></p><p>Bio coming soon.</p></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presenter-holly-nelson" style="z-index: 10001"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:600px;"><span class="close" onclick="closePresenterModal('presenter-holly-nelson')">×</span><h2>Holly Nelson</h2><img alt="Holly Nelson" src="Holly-Nelson.jpg" style="width:100%;max-width:220px;margin-bottom:15px;border-radius:12px;"/><p><em>Presenter</em></p><p>Bio coming soon.</p></div></div><div tabindex="-1" aria-modal="true" role="dialog" class="modal presenter-modal" id="presentersModal" style="z-index: 2050"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:1020px;width:95vw;"><span class="close" onclick="closeModal('presentersModal')">×</span><h2 style="color:#00818a;margin-top:0;margin-bottom:20px;text-align:center;">Meet the Essential Radio Presenters</h2><div class="presenters-grid"><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-paul-woodland');return false;"><img alt="Paul Woodland" src="Paul-Woodland.jpg"/><h3>Paul Woodland</h3><p>Essential Breakfast</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-scott-ohare');return false;"><img alt="Scott O'Hare" src="Scott-OHare.jpg"/><h3>Scott O'Hare</h3><p>Essential Hometime</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-bex-mcnamee');return false;"><img alt="Bex McNamee" src="Bex-Mcnamee.jpg"/><h3>Bex McNamee</h3><p>Feelgood Lunch &amp; The Midweek Mash-Up</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-keelin-mckenna');return false;"><img alt="Keelin McKenna" src="Keelin-Mckenna.jpg"/><h3>Keelin McKenna</h3><p>Feelgood Lunch</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-holly-nelson');return false;"><img alt="Holly Nelson" src="Holly-Nelson.jpg"/><h3>Holly Nelson</h3><p>Feelgood Lunch</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-faith-montgomery');return false;"><img alt="Faith Montgomery" src="Faith-Montgomery.jpg"/><h3>Faith Montgomery</h3><p>Feelgood Lunch</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-finlay-campbell');return false;"><img alt="Finlay Campbell" src="Finlay-Campbell.jpg"/><h3>Finlay Campbell</h3><p>Feelgood Lunch</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-connor-strachan');return false;"><img alt="Connor Strachan" src="Connor-Strachan.JPG"/><h3>Connor Strachan</h3><p>Essential Afternoons (Thursday)</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-david-southway');return false;"><img alt="David Southway" src="David-Southway.jpg"/><h3>David Southway</h3><p>Soul Vaults</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-lee-everest');return false;"><img alt="Lee Everest" src="Lee-Everest.jpg"/><h3>Lee Everest</h3><p>Ready for the Weekend</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-ronny-costello');return false;"><img alt="Ronny Costello" src="Ronny-Costello.jpg"/><h3>Ronny Costello</h3><p>Club Classics</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-davy-sims');return false;"><img alt="Davy Sims" src="Davy-Sims.jpg"/><h3>Davy Sims</h3><p>Around the World</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-big-tommy');return false;"><img alt="Big Tommy" src="Big-Tommy.jpg"/><h3>Big Tommy</h3><p>Saturday Music Marathon &amp; Party Anthems</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-jan-gow');return false;"><img alt="Jan Gow" src="Jan-Gow.jpg"/><h3>Jan Gow</h3><p>70s Jukebox</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-tim-graham');return false;"><img alt="Tim Graham" src="Tim-Graham.jpeg"/><h3>Tim Graham</h3><p>LGBTQ Music Chart</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-stephen-howie');return false;"><img alt="Stephen Howie" src="Stephen-Howie.jpg"/><h3>Stephen Howie</h3><p>Grooveline</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-bill-grainger');return false;"><img alt="Bill Grainger" src="Bill-Grainger.jpg"/><h3>Bill Grainger</h3><p>Fire Island Hi-NRG</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-kevin-mccallum');return false;"><img alt="Kevin McCallum" src="Kevin-Mccallum.jpg"/><h3>Kevin McCallum</h3><p>Mr Rocks Show</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-emma-scott');return false;"><img alt="Emma Scott" src="Emma-Scott.jpg"/><h3>Emma Scott</h3><p>Pluggin' Baby Radio Show</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-dave-watkins');return false;"><img alt="Dave Watkins" src="Dave-Watkins.jpg"/><h3>Dave Watkins</h3><p>The Country Mile</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-spencer-james');return false;"><img alt="Spencer James" src="Spencer-James.jpg"/><h3>Spencer James</h3><p>Airplay40</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-dr-hilary-jones');return false;"><img alt="Dr Hilary Jones" src="Dr-Hilary-Jones.jpg"/><h3>Dr Hilary Jones</h3><p>The Dr Hilary Show</p></a><a class="presenter-card" href="#" onclick="openPresenterModal('presenter-brian-woolfson');return false;"><img alt="Brian Woolfson" src="Brian-Woolfson.jpg"/><h3>Brian Woolfson</h3><p>Retro Charts</p></a></div><style>
      .presenters-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 24px;
        justify-content: center;
        padding: 10px 0;
      }
      .presenter-card {
        background: #111;
        border: 1px solid #333;
        border-radius: 12px;
        padding: 16px;
        text-align: center;
        color: #fff;
        cursor: pointer;
        box-shadow: 0 0 10px #0006;
        text-decoration: none;
        transition: transform 0.2s, box-shadow 0.2s;
        position: relative;
        z-index: 1;
      }
      .presenter-card:hover {
        transform: scale(1.05);
        box-shadow: 0 0 16px #fed351aa;
      }
      .presenter-card img {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        margin-bottom: 10px;
        border: 2px solid #fed351;
      }
      .presenter-card h3 {
        font-size: 1em;
        margin: 0 0 4px;
        color: #fed351;
        font-style: italic;
      }
      .presenter-card p {
        font-size: 0.85em;
        color: #ccc;
        margin: 0;
        font-style: normal;
      }
      @media (max-width: 768px) {
        .presenters-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      @media (max-width: 480px) {
        .presenters-grid {
          grid-template-columns: 1fr;
        }
      }
#presentersModal.modal.presenter-modal {
  z-index: 2050 !important;
}
.modal.presenter-detail {
  z-index: 10001 !important;
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  display: none; /* Shown via JS */
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(6px);
  background-color: rgba(0, 0, 0, 0.85);
}
.modal.presenter-detail.show {
      position: relative;
  display: flex !important;
}
    </style></div></div><style>
.modal.presenter-modal {
  display: none;
  position: fixed !important;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background: rgba(0,0,0,0.85);
  z-index: 9999 !important;
}
.modal.presenter-modal .modal-content {
  z-index: 10000 !important;
  position: relative;
}
@media (max-width: 768px) {
  #requestsModal .embed-wrap {
    min-height: 80vh !important;
    height:    80vh !important;
    overflow:  hidden !important;
    /* (no need for -webkit-overflow-scrolling here, since the iframe scrolls itself) */
  }
}

</style><script>
function toggleLogoVisibility() {
  const logo = document.querySelector('.logo-container');
  if (!logo) return;
  const anyModalOpen = [...document.querySelectorAll('.modal')].some(m =>
    m.style.display === 'block' ||
    m.style.display === 'flex' ||
    (m.classList && m.classList.contains('active'))
  );
  logo.style.display = anyModalOpen ? 'none' : 'block';
}
</script><script>
// Fallback observer: if modals’ display/style changes outside openModal/closeModal, keep logo in sync.
(function() {
  const modalEls = Array.from(document.querySelectorAll('.modal'));
  const burger = document.getElementById('burgerDropdown');

  const sync = () => {
    // reuse existing logic
    if (typeof checkOverlayLogo === 'function') {
      checkOverlayLogo();
    }
  };

  // Observe style/class changes on modals
  const observer = new MutationObserver(sync);
  modalEls.forEach(m => observer.observe(m, {
    attributes: true,
    attributeFilter: ['style', 'class']
  }));

  // Observe burger dropdown similarly
  if (burger) {
    observer.observe(burger, {
      attributes: true,
      attributeFilter: ['style', 'class']
    });
  }

  // On history navigation (back/forward), re-evaluate logo visibility
  window.addEventListener('popstate', sync);

  // Initial sync in case page loaded with a modal already open
  document.addEventListener('DOMContentLoaded', sync);
})();
</script><script id="modal-behavior-overrides">
(function(){
  const $ = (sel, ctx=document) => ctx.querySelector(sel);
  const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));

  function anyModalOpen(){
    return !!$('.modal.active');
  }

  function setBodyModalState(){
    if (anyModalOpen()) {
      document.body.classList.add('modal-open');
    } else {
      document.body.classList.remove('modal-open');
    }
  }

  // Close the mobile burger menu if it's open
  function closeBurger(){
    const dd = $('#burgerDropdown');
    if (dd && dd.style.display !== 'none') {
      dd.style.display = 'none';
    }
  }

  // Close all non-presenter modals (base modals)
  function closeAllBaseModals(){
    $$('.modal.active:not(.presenter-modal)').forEach(m => {
      m.style.display = 'none';
      m.classList.remove('active');
    });
  }

  // Close all presenter modals
  function closeAllPresenterModals(){
    $$('.modal.presenter-modal.active').forEach(m => {
      m.style.display = 'none';
      m.classList.remove('active');
    });
  }

  // Public: open a base modal by id (About, Schedule, Requests, News, Travel, Local, Playlist, Listen, Search, Contact, Presenters, etc.)
  function openModal(id){
    const modal = document.getElementById(id);
    if (!modal) return;

    // If we open a base modal, close all other base modals and all presenter modals
    closeAllPresenterModals();
    closeAllBaseModals();

    // Show this one
    modal.style.display = 'block';
    modal.classList.add('active');

    // Close burger if needed
    closeBurger();

    // Track body state
    setBodyModalState();
  }

  // Public: close a base modal by id
  function closeModal(id){
    const modal = document.getElementById(id);
    if (!modal) return;

    // If we're closing the presentersModal, also close any presenter profile modals
    if (id === 'presentersModal') {
      closeAllPresenterModals();
    }
    modal.style.display = 'none';
    modal.classList.remove('active');
    setBodyModalState();
  }

  // Public: open a presenter modal (keeps presentersModal open underneath)
  function openPresenterModal(presenterId){
    const modal = document.getElementById(presenterId);
    if (!modal) return;

    // Ensure the presenters list remains open (if available)
    const presenters = document.getElementById('presentersModal');
    if (presenters && !presenters.classList.contains('active')) {
      presenters.style.display = 'block';
      presenters.classList.add('active');
    }

    // Show the presenter modal on top
    modal.style.display = 'block';
    modal.classList.add('active');

    // Track body state
    setBodyModalState();
  }

  // Public: close a presenter modal only
  function closePresenterModal(presenterId){
    const modal = document.getElementById(presenterId);
    if (!modal) return;
    modal.style.display = 'none';
    modal.classList.remove('active');
    setBodyModalState();
  }

  // Mobile helper used in burger links
  function openModalAndCloseBurger(id){
    openModal(id);
  }

  // Expose on window to override any earlier definitions
  window.openModal = openModal;
  window.closeModal = closeModal;
  window.openPresenterModal = openPresenterModal;
  window.closePresenterModal = closePresenterModal;
  window.openModalAndCloseBurger = openModalAndCloseBurger;
})();
</script><script id="presenter-stack-shim">
(function(){
  const $$ = (s, c=document)=>Array.from(c.querySelectorAll(s));
  function setBodyModalState(){
    const any = $$('.modal').some(m => getComputedStyle(m).display !== 'none');
    document.body.classList.toggle('modal-open', any);
  }
  window.addEventListener('click', function(e){
    // no-op; we only want the function loaded so others can call setBodyModalState if needed
  });
  window._syncModalBodyState = setBodyModalState;
})();
</script><div tabindex="-1" aria-modal="true" role="dialog" class="modal" data-refresh-fn="fetchRNHNews" id="newsModal"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content" style="max-width:900px;width:97vw;"><span class="close" onclick="closeModal('newsModal')">×</span><div style="display:flex;align-items:center;gap:18px;margin-bottom:24px;"><h2 style="margin:0;color:#00818a;font-size:1.35em;">Scottish &amp; National News</h2></div><div style="background:#111;border:1px solid #333;border-radius:12px;padding:24px 18px 18px 18px;box-shadow:0 0 20px rgba(0,0,0,0.23);margin-bottom:0;color:#eee;"><div style="margin-bottom:22px;"><h3 style="color:#62c7fc;margin:0 0 9px 0;font-size:1.12em;display:flex;align-items:center;gap:10px;"><span>🏴 Scottish News Update</span><span id="scotNewsTime" style="font-weight:normal;font-size:0.97em;color:#80dfff;"></span></h3><pre id="scottishNewsText" style="font-family:inherit;white-space:pre-wrap;background:transparent;border:none;padding:0;margin:0;font-size:1.05em;line-height:1.65;color:#d4f2ff;">Loading...</pre></div><div><h3 style="color:#00e0ff;margin:0 0 9px 0;font-size:1.15em;">📰 The Latest from Radio News Hub</h3><style>
  /* Modal news cards */
  .rnh-cards{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:14px;
  }
  .rnh-card{
    background:#0e0e0e;border:1px solid #333;border-radius:12px;overflow:hidden
  }
  .rnh-card a{color:inherit;text-decoration:none;display:block}
  .rnh-card img{width:100%;aspect-ratio:16/9;object-fit:cover;display:block}
  .rnh-title{padding:10px 12px;font-weight:700;line-height:1.25;color:#fff}
  .rnh-meta{padding:0 12px 12px;color:#fed351;font-size:.9em}
  @media (max-width:500px){ .rnh-cards{grid-template-columns:1fr} }

/* Force black text on yellow Song Search modal buttons in all themes */
#songSearchModal button,
#songSearchModal .menu-link {
  background-color: #fed351 !important;
  color: #111 !important;
  border-color: rgba(0,0,0,0.08) !important;
}

/* Force black text for volume percentage in Now Playing */
#volume-display {
  color: #111 !important;
}

</style><div class="rnh-cards" id="rnh-modal-list"><div style="color:#bbb">Loading headlines…</div></div></div></div><div style="margin-top:16px;text-align:center;color:#888;font-size:14px;opacity:0.8;"> Essential Radio © 2025 </div></div></div><script>
async function fetchRNHNews() {
  // Use a public RSS-to-JSON proxy (CORS-safe)
  const feedUrl = "https://www.radionewshub.com/sitemaps/news.php?feed=H2lujdhEZ3";
  const api = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feedUrl)}`;
  try {
    const res = await fetch(api);
    const data = await res.json();
    if (!data.items || !data.items.length) throw new Error("No items found");
    const top2 = data.items.slice(0,2);
    document.getElementById('rnh-news-list').innerHTML = top2.map(item => `
      <div style="margin-bottom:18px;">
        <a href="${item.link}" target="_blank" style="color:#fff;font-size:1em;font-weight:600;text-decoration:none;">
          ${item.title}
        </a>
        <div style="color:#fed351;font-size:0.97em;font-weight:400;margin:2px 0 0 0;">
          ${item.pubDate ? new Date(item.pubDate).toLocaleDateString("en-GB", { day:'numeric', month:'short' }) : ""}
        </div>
      </div>
    `).join('');
  } catch(e) {
    document.getElementById('rnh-news-list').innerHTML =
      '<div style="color:#fed351;">Unable to load news stories at the moment.</div>';
  }
}
fetchRNHNews();
</script><script>
function fetchScottishNews() {
  // Try fetching the text file
  fetch('news_bulletin.txt?' + Date.now()) // cache-busting for updates
    .then(response => {
      if (!response.ok) throw new Error("File not found");
      // Try to get last-modified header if possible
      const lastModified = response.headers.get('last-modified');
      if (lastModified) {
        document.getElementById('scotNewsTime').textContent = "updated on " + new Date(lastModified).toLocaleString();
      }
      return response.text();
    })
    .then(text => {
      document.getElementById('scottishNewsText').textContent = text.trim();
    })
    .catch(err => {
      document.getElementById('scottishNewsText').textContent = "Scottish news bulletin is currently unavailable.";
      document.getElementById('scotNewsTime').textContent = "";
    });
}

// Optionally call this only when modal opens for efficiency
document.addEventListener("DOMContentLoaded", fetchScottishNews);
</script><script>
(async function fetchRNHModalNews(){
  const feedUrl = "https://www.radionewshub.com/sitemaps/news.php?feed=H2lujdhEZ3";
  const api = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feedUrl)}`;
  const wrap = document.getElementById("rnh-modal-list");
  if(!wrap) return;

  try{
    const res = await fetch(api);
    const data = await res.json();
    const items = (data.items || []).slice(0, 8); // show up to 8

    const getImg = it =>
      (it.enclosure && it.enclosure.link) ||
      it.thumbnail ||
      (it.content && (it.content.match(/<img[^>]+src="([^"]+)"/i) || [])[1]) ||
      "";

    wrap.innerHTML = items.map(it => {
      const img = getImg(it);
      const date = it.pubDate ? new Date(it.pubDate).toLocaleDateString("en-GB",
        { day:"numeric", month:"short" }) : "";
      return `
        <article class="rnh-card">
          <a href="${it.link}" target="_blank" rel="noopener">
            ${img ? `<img src="${img}" alt="${it.title}" loading="lazy">` : ""}
            <div class="rnh-title">${it.title}</div>
            ${date ? `<div class="rnh-meta">${date}</div>` : ""}
          </a>
        </article>`;
    }).join("");

    if(!items.length){
      wrap.innerHTML = '<div style="color:#fed351;">No stories found right now.</div>';
    }
  }catch(e){
    wrap.innerHTML = '<div style="color:#fed351;">Unable to load news stories at the moment.</div>';
  }
})();
</script><script id="theme-mode-script">
(function(){
  const root = document.documentElement;
  const saved = localStorage.getItem('theme');
  const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
  const initial = saved || (prefersLight ? 'light' : 'dark');
  root.setAttribute('data-theme', initial);

  function nextLabel(theme){ return theme === 'light' ? 'Dark' : 'Light'; }
  function setLabels(theme){
    const btn = document.getElementById('themeToggleBtn');
    if (!btn) return;
    const lab = btn.querySelector('.mode-label');
    if (lab) lab.textContent = nextLabel(theme);
    const emo = btn.querySelector('.mode-emoji');
    if (emo) emo.textContent = (theme === 'light') ? '🌙' : '☀️';
    btn.title = theme === 'light' ? 'Switch to Dark Mode' : 'Switch to Light Mode';
  }
  function setTheme(t){
    root.setAttribute('data-theme', t);
    localStorage.setItem('theme', t);
    setLabels(t);
  }

  document.addEventListener('DOMContentLoaded', function(){
    const current = root.getAttribute('data-theme') || initial;
    setTheme(current);
    const btn = document.getElementById('themeToggleBtn');
    if (btn) {
      btn.addEventListener('click', function(){
        const next = (root.getAttribute('data-theme') === 'light') ? 'dark' : 'light';
        setTheme(next);
      });
    }
  });
})();
</script><script id="theme-toggle-mover">
(function(){
  function placeThemeBtn(){
    const btn = document.getElementById('themeToggleBtn');
    const nav = document.querySelector('.navbar');
    if(!btn) return;
    if (window.innerWidth > 750) {
      if (nav && btn.parentElement !== nav){
        nav.appendChild(btn);
        btn.classList.remove('mobile-fixed');
      }
    } else {
      if (btn.parentElement !== document.body){
        document.body.appendChild(btn);
      }
      btn.classList.add('mobile-fixed');
    }
  }
  window.addEventListener('resize', placeThemeBtn);
  window.addEventListener('DOMContentLoaded', placeThemeBtn);
})();
</script><script>
(() => {
  const TZ = "Europe/London";

  /* =========  A) NOW PLAYING MARQUEE  ========= */
  function ensureMarquee() {
    const np = document.querySelector("#nowPlaying") || document.querySelector("#now-playing-text") || document.querySelector("#now-playing-card");
    if (!np) return;

    // pick an element that holds the text (if card, use its first text node)
    let textEl = np.querySelector(".np-text") || np.querySelector(".title") || np.querySelector(".song") || np.querySelector(".np-title") || np.querySelector("h3, h4, p, span");
    if (!textEl) textEl = np;

    const containerAlready = np.querySelector(".np-marquee");
    const label = (textEl.innerText || textEl.textContent || "").trim();
    if (!label) return;

    // measure
    const tmp = document.createElement("span");
    tmp.style.visibility = "hidden";
    tmp.style.whiteSpace = "nowrap";
    tmp.textContent = label;
    document.body.appendChild(tmp);
    const textW = tmp.getBoundingClientRect().width;
    document.body.removeChild(tmp);

    const containerW = np.getBoundingClientRect().width || 0;

    // Only build marquee if overflow is meaningful
    if (textW > containerW * 1.1) {
      if (!containerAlready) {
        const wrap = document.createElement("div");
        wrap.className = "np-marquee";
        const track = document.createElement("div");
        track.className = "np-track";

        // duplicate content for seamless loop
        const sep = "   •   ";
        track.textContent = label + sep + label + sep + label;

        // replace original text with marquee (non-destructive: hide old)
        if (!textEl.classList.contains("np-hidden-original")) {
          textEl.style.display = "none";
          textEl.classList.add("np-hidden-original");
        }
        wrap.appendChild(track);
        np.appendChild(wrap);

        // speed based on total width (pixels / 40px per second baseline)
        requestAnimationFrame(() => {
          const total = track.getBoundingClientRect().width / 2; // one cycle width
          const seconds = Math.max(12, Math.min(40, total / 40));
          track.style.animationDuration = seconds + "s";
        });
      }
    } else if (containerAlready) {
      // no longer overflowing: remove marquee, restore text
      containerAlready.remove();
      const hidden = np.querySelector(".np-hidden-original");
      if (hidden) { hidden.style.display = ""; hidden.classList.remove("np-hidden-original"); }
    }
  }

  // Observe Now Playing text changes so marquee updates automatically
  function setNowPlayingObserver() {
    const node = document.querySelector("#nowPlaying") || document.querySelector("#now-playing-card");
    if (!node) return;
    const obs = new MutationObserver(() => ensureMarquee());
    obs.observe(node, { childList: true, subtree: true, characterData: true });
    ensureMarquee();
  }

  /* =========  B) SHARE BUTTON (Web Share API + fallbacks)  ========= */
  function mountShareButton() {
  
  // Prefer the inline 3-link toolbar; if present, remove any LIVE-box share and exit.
  try {
    const toolbar = document.querySelector('#np-share-toolbar');
    if (toolbar) {
      const stray = document.querySelector('.live-indicator #share-btn');
      if (stray) stray.remove();
      return;
    }
  } catch (e) { /* no-op */ }
const liveBox = document.querySelector(".live-indicator");
  if (!liveBox) return;

  // If an older share button exists elsewhere, remove it to avoid duplicates
  const old = document.querySelector("#share-btn");
  if (old && old.parentElement !== liveBox) old.remove();
  if (document.querySelector("#share-btn")) return;

  const btn = document.createElement("button");
  btn.id = "share-btn";
  btn.type = "button";
  btn.textContent = "Share";
  btn.setAttribute("aria-label", "Share the current track");

  liveBox.appendChild(btn);

 const getNowText = () => {
  const npCard = document.querySelector("#now-playing-card") || document.querySelector("#nowPlaying");
  if (!npCard) return "";
  // Prefer explicit title/artist elements if present
  const el = npCard && npCard.querySelector(".np-text,.title,.song,.np-artist,.np-title");
  if (el) return (el.innerText || el.textContent || "").trim();

  // Otherwise clone the card and remove the share toolbar before reading text
  const clone = npCard.cloneNode(true);
  const toolbar = clone.querySelector("#np-share-toolbar");
  if (toolbar) toolbar.remove();

  // Final clean to kill any stray "Share" tokens/colons
  return (clone.textContent || "")
    .replace(/\bShare\b:?/gi, "")
    .replace(/\s{2,}/g, " ")
    .trim();
};

  const buildShareText = () => {
    const t = getNowText();
    return t ? `I'm Listening to ${t} on Essential Radio` : `I'm Listening to Essential Radio`;
  };

  btn.addEventListener("click", async () => {
    const shareData = { title: "Essential Radio", text: buildShareText(), url: location.href };
    try {
      if (navigator.share) {
        await navigator.share(shareData);
      } else {
        const txt = encodeURIComponent(buildShareText());
        const url = encodeURIComponent(location.href);
        window.open(`https://twitter.com/intent/tweet?text=${txt}&url=${url}`, "_blank", "noopener");
      }
    } catch (e) {
      try {
        await navigator.clipboard.writeText(buildShareText() + " " + location.href);
        btn.textContent = "Copied!";
        setTimeout(() => (btn.textContent = "Share"), 1200);
      } catch {}
    }
  });

  // keep label in sync
  const npCard = document.querySelector("#now-playing-card") || document.querySelector("#nowPlaying");
  if (npCard) {
    const obs = new MutationObserver(() => {
      btn.title = buildShareText();
      btn.setAttribute("aria-label", "Share: " + buildShareText());
    });
    obs.observe(npCard, { childList: true, subtree: true, characterData: true });
  }
}

  
  function addPlatformIcons() {
    const btn = document.querySelector("#share-btn");
    if (!btn || document.querySelector("#share-platforms")) return;

    const url = encodeURIComponent(location.href);
    // Try to mirror the text used by the main share button if available:
    const np = document.querySelector("#nowPlaying") || document.querySelector("#now-playing-card");
    const el = np && (np.querySelector(".np-text,.title,.song,.np-artist,.np-title") || np);
    const baseText = el ? (el.innerText || el.textContent || "").trim() : "";
    const text = encodeURIComponent(baseText ? `I'm Listening to ${baseText} on Essential Radio` : `I'm Listening to Essential Radio`);

    const platforms = document.createElement("div");
    platforms.id = "share-platforms";
    platforms.innerHTML = `
      <a href="https://twitter.com/intent/tweet?text=${text}&url=${url}" target="_blank" rel="noopener" title="Share on X/Twitter" aria-label="Share on X/Twitter">🐦</a>
      <a href="https://www.facebook.com/sharer/sharer.php?u=${url}" target="_blank" rel="noopener" title="Share on Facebook" aria-label="Share on Facebook">📘</a>
      <a href="https://api.whatsapp.com/send?text=${text}%20${url}" target="_blank" rel="noopener" title="Share on WhatsApp" aria-label="Share on WhatsApp">💬</a>
    `;
    btn.appendChild(platforms);

    // Keep platform text in sync with NP changes
    if (np) {
      const obs = new MutationObserver(() => {
        const el2 = np && (np.querySelector(".np-text,.title,.song,.np-artist,.np-title") || np);
        const base2 = el2 ? (el2.innerText || el2.textContent || "").trim() : "";
        const t2 = encodeURIComponent(base2 ? `I'm Listening to ${base2} on Essential Radio` : `I'm Listening to Essential Radio`);
        platforms.querySelectorAll("a").forEach(a => {
          const href = a.getAttribute("href");
          if (href.includes("twitter.com/intent/tweet")) {
            a.setAttribute("href", `https://twitter.com/intent/tweet?text=${t2}&url=${url}`);
          } else if (href.includes("api.whatsapp.com")) {
            a.setAttribute("href", `https://api.whatsapp.com/send?text=${t2}%20${url}`);
          }
        });
      });
      obs.observe(np, { childList: true, subtree: true, characterData: true });
    }
  }

  /* =========  C) HIGHLIGHT LIVE SHOWS IN SCHEDULE  ========= */
  function parseRange(str) {
    // accepts "09:00 – 12:00" or "9:00-12:00"
    const m = (str || "").replace(/\s/g, "").match(/(\d{1,2}:\d{2})[–—-](\d{1,2}:\d{2})/);
    if (!m) return null;
    return { start: m[1], end: m[2] };
  }
  function toLondon(dateLike) {
    const d = new Date(dateLike);
    const iso = d.toLocaleString("sv-SE", { timeZone: TZ }).replace(" ", "T");
    return new Date(iso);
  }
  function todayName() {
    return new Intl.DateTimeFormat("en-GB", { weekday: "long", timeZone: TZ }).format(new Date());
  }
  function nextByClock(base, hhmm) {
    const [h, m] = hhmm.split(":").map(Number);
    const d = toLondon(base);
    d.setHours(h, m, 0, 0);
    return d;
  }
  /* removed highlightLiveShows */

  // Recompute highlights periodically while the modal is open
  let liveTimer = null;
  function scheduleLiveTick() {
    if (liveTimer) clearInterval(liveTimer);
    liveTimer = setInterval(highlightLiveShows, 60 * 1000);
  }

  const schedReady = () => {
    highlightLiveShows();
    scheduleLiveTick();
    const cont = document.querySelector("#modalDaySchedule");
    if (cont) {
      const obs = new MutationObserver(() => highlightLiveShows());
      obs.observe(cont, { childList: true, subtree: true });
    }
  };

  // Init after DOM is ready
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", () => {
      setNowPlayingObserver();
      mountShareButton();
      addPlatformIcons();
      schedReady();
    });
  } else {
    setNowPlayingObserver();
    mountShareButton();
    addPlatformIcons();
    schedReady();
  }

  // Re-run marquee on resize (responsive width changes)
  let rAF, lastW = 0;
  window.addEventListener("resize", () => {
    if (rAF) cancelAnimationFrame(rAF);
    rAF = requestAnimationFrame(() => {
      const w = window.innerWidth;
      if (Math.abs(w - lastW) > 12) {
        lastW = w;
        ensureMarquee();
      }
    });
  });
})();
</script><script>
(function () {
  function ensureShareMounted() {
    var liveBox = document.querySelector(".live-indicator");
    if (!liveBox) return;
    var btn = document.querySelector("#share-btn");
    if (!btn || btn.parentElement !== liveBox) {
      try {
        if (typeof mountShareButton === "function") mountShareButton();
        if (typeof addPlatformIcons === "function") addPlatformIcons();
      } catch (e) {
        // no-op
      }
    }
  }

  // Observe Now Playing area for DOM replacements and re-mount Share if needed
  var target = document.querySelector("#nowPlaying") || document.querySelector("#now-playing-card") || document.body;
  try {
    var obs = new MutationObserver(function () { ensureShareMounted(); });
    obs.observe(target, { childList: true, subtree: true, characterData: true });
  } catch (e) {}

  // Initial mount + periodic belt-and-braces
  ensureShareMounted();
  setInterval(ensureShareMounted, 4000);
})();
</script><script id="schedule-highlight-logic">
(function() {
  const LONDON_TZ = 'Europe/London';
  const DASH = '[\-–—]'; // hyphen, en-dash, em-dash
  const TIME_RX = new RegExp(
    String.raw`(\d{1,2}):(\d{2})\s*(am|pm|AM|PM)?\s*${DASH}\s*(\d{1,2}):(\d{2})\s*(am|pm|AM|PM)?`
  );

  function nowMinutesLondon() {
    // Get current time in Europe/London as minutes since midnight
    const parts = new Intl.DateTimeFormat('en-GB', {
      timeZone: LONDON_TZ,
      hour: '2-digit', minute: '2-digit', hour12: false
    }).formatToParts(new Date());
    const hh = parseInt(parts.find(p => p.type === 'hour').value, 10);
    const mm = parseInt(parts.find(p => p.type === 'minute').value, 10);
    return hh*60 + mm;
  }

  function to24h(h, m, ampm) {
    h = parseInt(h, 10);
    m = parseInt(m, 10);
    if (ampm) {
      const a = ampm.toLowerCase();
      if (a === 'pm' && h < 12) h += 12;
      if (a === 'am' && h === 12) h = 0;
    }
    return h*60 + m;
  }

  function parseRangeFromText(txt) {
    const m = txt && txt.match(TIME_RX);
    if (!m) return null;
    const s = to24h(m[1], m[2], m[3]);
    const e = to24h(m[4], m[5], m[6]);
    return [s, e];
    }

  function getText(node) {
    return (node.textContent || '').replace(/\s+/g, ' ').trim();
  }

  function extractRange(el) {
    // Priority 1: data attrs in minutes or HH:MM
    let ds = el.getAttribute('data-start') || el.dataset.start;
    let de = el.getAttribute('data-end') || el.dataset.end;
    if (ds && de) {
      const mm = (v)=>{
        if (/^\d{1,2}:\d{2}(?:\s*[aApP][mM])?$/.test(v)) {
          // HH:MM or HH:MM am/pm
          const ms = v.match(/(\d{1,2}):(\d{2})\s*([aApP][mM])?/);
          return to24h(ms[1], ms[2], ms[3]);
        }
        // assume minutes since midnight
        const n = parseInt(String(v).replace(/\D/g,''),10);
        return isFinite(n) ? n : null;
      };
      const s = mm(ds), e = mm(de);
      if (s!=null && e!=null) return [s,e];
    }

    // Priority 2: two <time> elements inside
    const times = el.querySelectorAll('time');
    if (times.length >= 2) {
      const t1 = getText(times[0]);
      const t2 = getText(times[1]);
      const p1 = t1.match(/(\d{1,2}):(\d{2})\s*([aApP][mM])?/);
      const p2 = t2.match(/(\d{1,2}):(\d{2})\s*([aApP][mM])?/);
      if (p1 && p2) return [ to24h(p1[1],p1[2],p1[3]), to24h(p2[1],p2[2],p2[3]) ];
    }

    // Priority 3: fall back to any text with start–end
    return parseRangeFromText(getText(el));
  }

  function isNowWithin(s, e, now) {
    if (s == null || e == null) return false;
    if (s === e) return false; // zero-length
    if (e > s) return now >= s && now < e;
    // crosses midnight
    return now >= s || now < e;
  }

  function findScheduleContainer() {
    return document.querySelector('#modalScheduleContainer, #modalDaySchedule, .schedule-modal .content, .schedule, .schedule-list');
  }

  function entryNodes(root) {
    return root.querySelectorAll('.show-entry, .show, .schedule-item, li');
  }

  function clearHighlights(root) {
    root.querySelectorAll('.show--current, .current-show, .schedule-current, .show-entry.current, .show.current, .schedule-item.current')
      .forEach(n => {
        n.classList.remove('show--current','current-show','schedule-current','current');
        n.style.removeProperty('--now-flag');
      });
  }

  let lastScrollId = null;
  /* removed highlightCurrentShow */

  // Run when modal opens
  function onModalToggle(e) {
    const tgt = e.target;
    if (!(tgt instanceof HTMLElement)) return;
    const isScheduleOpen = tgt.matches('#scheduleModal.show, .modal.show') && (tgt.id?.toLowerCase().includes('schedule'));
    if (isScheduleOpen) {
      setTimeout(highlightCurrentShow, 120);
    }
  }

  // Observe mutations in the modal content
  const obs = new MutationObserver(()=> {
    // debounce
    clearTimeout(window.__hlDebounce);
    window.__hlDebounce = setTimeout(highlightCurrentShow, 80);
  });

  // Boot
  document.addEventListener('readystatechange', () => {
    if (document.readyState === 'complete' || document.readyState === 'interactive') {
      setTimeout(highlightCurrentShow, 150);
      const container = findScheduleContainer();
      if (container) obs.observe(container, {childList:true, subtree:true});
    }
  });

  // Periodic refresh (handles minute rollover)
  setInterval(highlightCurrentShow, 30 * 1000);

  // Heuristics: clicks that likely opened the schedule
  document.addEventListener('click', (e)=>{
    const t = e.target.closest('a,button,[data-open="schedule"],[data-target*="schedule"],[href*="schedule"]');
    if (t) setTimeout(highlightCurrentShow, 180);
  });

  // If pages use custom events
  window.addEventListener('essential:schedule:rendered', highlightCurrentShow);
  window.addEventListener('essential:schedule:loaded', highlightCurrentShow);
})();
</script><script id="np-share-binder">
(function(){
  function bindShareButtons(){
    var btns = document.querySelectorAll('#np-share-toolbar .np-share-btn');
    btns.forEach(function(btn){
      btn.onclick = function(ev){
        ev.preventDefault();
        ev.stopPropagation();
        var p = btn.getAttribute('data-platform');
        if (typeof openShare === 'function' && p){ openShare(p); }
      };
    });
  }
  if (document.readyState === 'complete' || document.readyState === 'interactive') {
    setTimeout(bindShareButtons, 80);
  } else {
    document.addEventListener('DOMContentLoaded', function(){ setTimeout(bindShareButtons, 80); });
  }
  var tb = document.getElementById('np-share-toolbar');
  if (tb && window.MutationObserver){
    var obs = new MutationObserver(function(){ bindShareButtons(); });
    obs.observe(tb, {childList:true, subtree:true});
  }
})();
</script><script id="np-share-href-enhancer">
(function(){
  function s(){ try { return (window.shareSentence && window.shareSentence()) || ""; } catch(e){ return ""; } }
  function build(pf){
    var text = s() || "";
    var link = " https://essential.radio";
    var p = (pf||"").toLowerCase();
    if (p === 'whatsapp' || p === 'wa') return 'https://api.whatsapp.com/send?text=' + encodeURIComponent(text + link);
    if (p === 'twitter' || p === 'x')   return 'https://twitter.com/intent/tweet?text=' + encodeURIComponent(text + link);
    if (p === 'facebook' || p === 'fb'){
      var u = 'https://essential.radio';
      return 'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(u) + '&quote=' + encodeURIComponent(text);
    }
    return '#';
  }
  function ensureAnchors(){
    var tb = document.getElementById('np-share-toolbar');
    if(!tb) return;
    tb.querySelectorAll('.np-share-btn').forEach(function(el){
      var p = el.getAttribute('data-platform') || '';
      if (el.tagName !== 'A'){
        var a = document.createElement('a');
        a.className = el.className;
        a.setAttribute('data-platform', p);
        a.innerHTML = el.innerHTML;
        el.parentNode.replaceChild(a, el);
        el = a;
      }
      el.setAttribute('href', build(p));
      el.setAttribute('target', '_blank');
      el.setAttribute('rel', 'noopener');
      el.setAttribute('role', 'button');
      // Remove any old onclick that might cancel navigation
      try { el.onclick = null; } catch(e){}
    });
  }
  function updateHrefs(){
    var tb = document.getElementById('np-share-toolbar');
    if(!tb) return;
    tb.querySelectorAll('.np-share-btn').forEach(function(a){
      var p = a.getAttribute('data-platform') || '';
      a.setAttribute('href', build(p));
      a.setAttribute('target', '_blank');
      a.setAttribute('rel', 'noopener');
      try { a.onclick = null; } catch(e){}
    });
  }
  function init(){ ensureAnchors(); updateHrefs(); }
  if (document.readyState === 'complete' || document.readyState === 'interactive') { setTimeout(init, 60); }
  else { document.addEventListener('DOMContentLoaded', function(){ setTimeout(init, 60); }); }
  setInterval(updateHrefs, 3000);
  window.addEventListener('essential:nowplaying:update', updateHrefs);
})();
</script><script id="np-share-move-to-front">
(function(){
  function moveToolbar(){
    var card = document.getElementById('now-playing-card');
    var tb = document.getElementById('np-share-toolbar');
    if (card && tb && tb.parentNode !== card) {
      // If it's outside, append to the card so z-index stacking is consistent
      try { card.appendChild(tb); } catch(e){}
    } else if (card && tb && card.lastElementChild !== tb){
      // If it's in the card but not last, move it to the end for safety
      try { card.appendChild(tb); } catch(e){}
    }
  }
  if (document.readyState === 'complete' || document.readyState === 'interactive'){
    setTimeout(moveToolbar, 50);
  } else {
    document.addEventListener('DOMContentLoaded', function(){ setTimeout(moveToolbar, 50); });
  }
  // Rerun if card contents change
  var card = document.getElementById('now-playing-card');
  if (card && window.MutationObserver){
    var obs = new MutationObserver(function(){ moveToolbar(); });
    obs.observe(card, {childList:true, subtree:true});
  }
})();
</script><script id="np-share-click-clean">
(function(){
  function norm(p){
    if(!p) return "";
    p = String(p).toLowerCase().trim();
    if (p === 'x') p = 'twitter';
    if (p === 'fb' || p === 'facebook') p = 'facebook';
    if (p === 'wa' || p === 'whatsapp') p = 'whatsapp';
    if (p === 'twitter' || p === 'facebook' || p === 'whatsapp') return p;
    return p;
  }
  /* shareSentence replaced by extractor */ catch(e){ return ""; }
  }
  function build(platform){
    var p = norm(platform);
    var text = shareSentence() || "";
    var cleanQuote = text.replace(/\s*https?:\/\/essential\.radio\/?/i, "").trim();
    var link = " https://essential.radio";
    if (p === 'whatsapp'){
      return 'https://api.whatsapp.com/send?text=' + encodeURIComponent((text || cleanQuote) + link);
    }
    if (p === 'twitter'){
      return 'https://twitter.com/intent/tweet?text=' + encodeURIComponent((text || cleanQuote) + link);
    }
    if (p === 'facebook'){
      var u = 'https://essential.radio';
      return 'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(u) + '&quote=' + encodeURIComponent(cleanQuote);
    }
    return '#';
  }
  function ensureAnchors(){
    var tb = document.getElementById('np-share-toolbar');
    if(!tb) return;
    tb.querySelectorAll('.np-share-btn').forEach(function(el){
      // remove old onclick handlers that might prevent default
      try { el.onclick = null; } catch(e){}
      // ensure <a> tag with target/rel
      var p = el.getAttribute('data-platform');
      if (el.tagName !== 'A') {
        var a = document.createElement('a');
        a.className = el.className;
        a.setAttribute('data-platform', p || '');
        a.innerHTML = el.innerHTML;
        el.parentNode.replaceChild(a, el);
        el = a;
      }
      el.setAttribute('href', build(p));
      el.setAttribute('target', '_blank');
      el.setAttribute('rel', 'noopener');
      // also ensure role=button for accessibility
      el.setAttribute('role', 'button');
    });
  }
  function updateHrefs(){
    var tb = document.getElementById('np-share-toolbar');
    if(!tb) return;
    tb.querySelectorAll('.np-share-btn').forEach(function(a){
      var p = a.getAttribute('data-platform');
      a.setAttribute('href', build(p));
      a.setAttribute('target', '_blank');
      a.setAttribute('rel', 'noopener');
      // nuke any residual onclick each refresh
      try { a.onclick = null; } catch(e){}
    });
  }
  function init(){
    ensureAnchors();
    updateHrefs();
  }
  if (document.readyState === 'complete' || document.readyState === 'interactive') {
    setTimeout(init, 40);
  } else {
    document.addEventListener('DOMContentLoaded', function(){ setTimeout(init, 40); });
  }
  setInterval(updateHrefs, 3000);
  window.addEventListener('essential:nowplaying:update', updateHrefs);
})();
</script><script id="np-share-title-artist-extractor">
(function(){
  function txt(el){ return (el && (el.textContent||"").trim()) || ""; }
  function q(sel){ return document.querySelector(sel); }
  function clean(s){
    s = (s||"").replace(/\s+/g,' ').trim();
    s = s.replace(/\bLIVE\b/gi, '').replace(/\bNow Playing\b/gi, '').replace(/\bOn Air Now\b/gi, '');
    s = s.replace(/\bMore music soon\b/gi, '');
    s = s.replace(/^[–—\-:|]+|[–—\-:|]+$/g, '').trim();
    return s;
  }
  function splitGuess(s){
    if(!s) return {title:"", artist:""};
    var m = s.match(/^(.*?)\s+by\s+(.*)$/i);
    if(m) return {title: clean(m[1]), artist: clean(m[2])};
    m = s.match(/^(.*?)\s*[–\-]\s*(.*)$/);
    if(m){
      var left = clean(m[1]), right = clean(m[2]);
      // Heuristic: if either side contains "feat." treat left as artist
      if (/feat\.|ft\./i.test(right)) { return {title: right, artist: left}; }
      return {title: right, artist: left};
    }
    return {title:"", artist:""};
  }
  function fromDataAttrs(){
    var c = document.getElementById('now-playing-card');
    if(!c) return {title:"",artist:""};
    var t = c.getAttribute('data-song-title') || c.dataset?.songTitle || "";
    var a = c.getAttribute('data-song-artist') || c.dataset?.songArtist || "";
    return {title: clean(t), artist: clean(a)};
  }
  function fromSelectors(){
    var titleSelectors = [
      '#npTitle', '#np-title', '#np_title',
      '#nowPlayingTitle', '#nowPlaying .track-title', '#now-playing-card .track-title',
      '[data-np-title]', '[data-role="title"]', '.np-title', '.np-song', '.song-title'
    ];
    var artistSelectors = [
      '#npArtist', '#np-artist', '#np_artist',
      '#nowPlayingArtist', '#nowPlaying .track-artist', '#now-playing-card .track-artist',
      '[data-np-artist]', '[data-role="artist"]', '.np-artist', '.artist-name'
    ];
    for (var i=0;i<titleSelectors.length;i++){
      var t = clean(txt(q(titleSelectors[i])));
      if (t){
        for (var j=0;j<artistSelectors.length;j++){
          var a = clean(txt(q(artistSelectors[j])));
          if (a) return {title:t, artist:a};
        }
        return {title:t, artist:""};
      }
    }
    return {title:"", artist:""};
  }
  function fromCombined(){
    var lines = [
      txt(q('#now-playing-card .np-marquee')),
      txt(q('#now-playing-card #np-marquee')),
      txt(q('#nowPlaying')), txt(q('#onAirNow')), txt(q('#now-playing-card'))
    ].map(clean).filter(Boolean);
    for (var i=0;i<lines.length;i++){
      var g = splitGuess(lines[i]);
      if (g.title || g.artist) return g;
    }
    return {title:"", artist:""};
  }
  function fromJS(){
    try {
      // Common globals some players expose
      if (window.NOW_PLAYING && (NOW_PLAYING.title || NOW_PLAYING.artist)){
        return {title: clean(NOW_PLAYING.title||""), artist: clean(NOW_PLAYING.artist||"")};
      }
      if (window.nowPlaying && (nowPlaying.title || nowPlaying.artist)){
        return {title: clean(nowPlaying.title||""), artist: clean(nowPlaying.artist||"")};
      }
      if (window.NP_STATE && NP_STATE.current){
        return {title: clean(NP_STATE.current.title||""), artist: clean(NP_STATE.current.artist||"")};
      }
    } catch(e){}
    return {title:"", artist:""};
  }
  function best(){
    var sources = [fromDataAttrs, fromSelectors, fromCombined, fromJS];
    for (var i=0;i<sources.length;i++){
      var r = sources[i]();
      if (r.title && r.artist) return r;
    }
    // If we didn’t get both, try to fill missing piece from another source
    var t="", a="";
    sources.forEach(function(fn){
      var r = fn(); if (r.title && !t) t=r.title; if (r.artist && !a) a=r.artist;
    });
    return {title: t, artist: a};
  }

  window.shareSentence = function(){
    
    var r = (typeof best === 'function') ? best() : {title:"",artist:""};
    var title = (r && r.title) ? r.title : "";
    var artist = (r && r.artist) ? r.artist : "";
    if (title && artist) return "I'm listening to " + title + " by " + artist + " on Essential Radio";
    if (title && !artist) return "I'm listening to " + title + " on Essential Radio";
    if (!title && artist) return "I'm listening to " + artist + " on Essential Radio";
    return "I'm listening to Essential Radio";
    
  };

  // Trigger an update for share hrefs
  try { window.dispatchEvent(new Event('essential:nowplaying:update')); } catch(e){}
})();
</script><script id="np-share-toolbar-js">
(function(){
  function inToolbar(el){ while(el){ if (el.id==='np-share-toolbar') return true; el=el.parentElement; } return false; }
  function firstOutside(root, sel){
    var list=(root||document).querySelectorAll(sel);
    for(var i=0;i<list.length;i++){ if(!inToolbar(list[i])) return list[i]; }
    return null;
  }
  function txt(el){ return (el && (el.textContent||'').trim()) || ''; }
  function clean(s){
    s=(s||'').replace(/\s+/g,' ').trim();
    s=s.replace(/\b(Share|LIVE|Now Playing|On Air Now|More music soon)\b/gi,'');
    s=s.replace(/^[–—\-:|]+|[–—\-:|]+$/g,'').replace(/\s{2,}/g,' ').trim();
    return s;
  }
  function splitTA(s){
    s=clean(s); if(!s) return {title:'',artist:''};
    var m=s.match(/^(.+?)\s+by\s+(.+)$/i); if(m) return {title:clean(m[1]), artist:clean(m[2])};
    var d=s.match(/^(.+?)\s*[–\-]\s*(.+)$/); if(d) return {artist:clean(d[1]), title:clean(d[2])};
    return {title:s, artist:''};
  }
  function readTA(){
    var card=document.getElementById('now-playing-card')||document;
    var titleEl=firstOutside(card,'#npTitle, .np-title, .track-title, [data-role="title"], #nowPlayingTitle');
    var artistEl=firstOutside(card,'#npArtist, .np-artist, .track-artist, [data-role="artist"], #nowPlayingArtist');
    var title=clean(txt(titleEl)); var artist=clean(txt(artistEl));
    if(!title && !artist && card && card.getAttribute){
      title=clean(card.getAttribute('data-song-title')||(card.dataset&&card.dataset.songTitle)||'');
      artist=clean(card.getAttribute('data-song-artist')||(card.dataset&&card.dataset.songArtist)||'');
    }
    if(!title && !artist){
      var combinedEl=firstOutside(card,'.np-marquee, #np-marquee, #nowPlaying, #now-playing, #onAirNow, .np-text, .now-playing');
      var combined=clean(txt(combinedEl));
      var g=splitTA(combined); title=title||g.title; artist=artist||g.artist;
    }
    return {title:title, artist:artist};
  }
  function shareSentence(){
    var r=readTA();
    var t=(r.title||'').replace(/\s+on\s+Essential\s+Radio\s*$/i,'').trim();
    var a=(r.artist||'').replace(/\s+on\s+Essential\s+Radio\s*$/i,'').trim();
    if(t && a) return "I'm listening to " + t + " by " + a + " on Essential Radio";
    if(t && !a) return "I'm listening to " + t + " on Essential Radio";
    if(!t && a) return "I'm listening to " + a + " on Essential Radio";
    return "I'm listening to Essential Radio";
  }
  function buildHref(platform){
    var text=shareSentence(); var url='https://essential.radio'; var p=(platform||'').toLowerCase();
    if(p==='whatsapp'||p==='wa') return 'https://api.whatsapp.com/send?text='+encodeURIComponent(text+' '+url);
    if(p==='twitter'||p==='x')   return 'https://twitter.com/intent/tweet?text='+encodeURIComponent(text)+'&url='+encodeURIComponent(url);
    if(p==='facebook'||p==='fb') return 'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(url)+'&quote='+encodeURIComponent(text);
    return '#';
  }
  function refreshAnchors(){
    var tb=document.getElementById('np-share-toolbar'); if(!tb) return;
    tb.querySelectorAll('.np-share-btn').forEach(function(a){
      var p=a.getAttribute('data-platform')||'';
      a.href=buildHref(p); a.target='_blank'; a.rel='noopener';
    });
  }
  function observeNP(){
    var targets=[document.getElementById('now-playing-card'),
                 document.getElementById('now-playing'),
                 document.getElementById('nowPlaying')].filter(Boolean);
    if(targets.length && window.MutationObserver){
      var obs=new MutationObserver(function(){ refreshAnchors(); });
      targets.forEach(function(t){ obs.observe(t,{subtree:true,childList:true,characterData:true}); });
    }
    refreshAnchors();
  }
  if(document.readyState==='complete'||document.readyState==='interactive'){ setTimeout(observeNP,60); }
  else{ document.addEventListener('DOMContentLoaded', function(){ setTimeout(observeNP,60); }); }
  window.addEventListener('essential:nowplaying:update', refreshAnchors);
  setInterval(refreshAnchors,5000);
})();
</script><script>
(function(){
  function getCard() {
    return document.querySelector("#now-playing-card") || document.querySelector("#nowPlaying") || null;
  }
  function extractNowPlayingText() {
    const card = getCard();
    if (!card) return "";
    const pick = card.querySelector(".np-text,.np-title,.title,.song,.artist,.np-artist");
    let raw = pick ? (pick.innerText || pick.textContent || "") : (card.innerText || card.textContent || "");
    raw = (raw || "")
      .replace(/\bShare\b:?/gi, "")
      .replace(/\bNow\s*Playing\b:?/gi, "")
      .replace(/\bLIVE\b:?/gi, "")
      .replace(/\bon\s+essential\s+radio\b/gi, "")
      .replace(/\s{2,}/g, " ")
      .trim();
    raw = raw.replace(/^[\-\–\—:\|]+|[\-\–\—:\|]+$/g, "").trim();
    return raw;
  }
  function buildSentence() {
    const t = extractNowPlayingText();
    let sentence = t ? `I'm listening to ${t} on Essential Radio`
                     : `I'm listening to Essential Radio`;
    sentence = sentence.replace(/(?:\s*on Essential Radio){2,}/gi, " on Essential Radio").trim();
    return sentence;
  }
  window.shareSentence = buildSentence;
  function rewriteShareLinks(scope=document) {
    const text = encodeURIComponent(buildSentence());
    const url  = encodeURIComponent(location.href);
    const links = Array.from(scope.querySelectorAll('a[href*="facebook.com/sharer"],a[href*="twitter.com/intent/tweet"],a[href*="api.whatsapp.com/send"]'));
    links.forEach(a => {
      const href = a.getAttribute("href") || "";
      if (href.includes("facebook.com/sharer")) {
        a.setAttribute("href", `https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`);
      } else if (href.includes("twitter.com/intent/tweet")) {
        a.setAttribute("href", `https://twitter.com/intent/tweet?text=${text}&url=${url}`);
      } else if (href.includes("api.whatsapp.com/send")) {
        a.setAttribute("href", `https://api.whatsapp.com/send?text=${text}%20${url}`);
      }
      if (!a.getAttribute("aria-label")) a.setAttribute("aria-label", "Share the current track");
      a.setAttribute("rel","noopener");
      a.setAttribute("target","_blank");
    });
  }
  document.addEventListener("DOMContentLoaded", function(){
    rewriteShareLinks(document);
  });
  const card = getCard();
  if (card && window.MutationObserver) {
    const obs = new MutationObserver(() => rewriteShareLinks(document));
    obs.observe(card, { childList: true, subtree: true, characterData: true });
  }
  const platforms = document.querySelector("#share-platforms");
  if (platforms && window.MutationObserver) {
    const obs2 = new MutationObserver(() => rewriteShareLinks(platforms));
    obs2.observe(platforms, { childList: true, subtree: true, characterData: true });
  }
})();
</script><script id="mixcloud-compact-js">
(function () {
  function compact(el) {
    if (!el || !el.src || !/mixcloud\.com\/widget\/iframe/i.test(el.src)) return;
    try {
      const u = new URL(el.src, document.baseURI);
      u.searchParams.set("mini", "1");
      u.searchParams.set("hide_cover", "1");
      u.searchParams.set("hide_tracklist", "1"); // many accounts respect this
      u.searchParams.set("autoplay", "0");
      const newSrc = u.toString();
      if (el.src !== newSrc) el.src = newSrc;
      el.setAttribute("scrolling", "no");
      el.setAttribute("title", el.getAttribute("title") || "Mixcloud player");
    } catch (e) {
      /* ignore URL parse issues */
    }
  }

  function sweep(root) {
    (root instanceof HTMLIFrameElement ? [root] : root.querySelectorAll('iframe[src*="mixcloud.com/widget/iframe"]'))
      .forEach(compact);
  }

  document.addEventListener("DOMContentLoaded", function () {
    sweep(document);
    const obs = new MutationObserver(muts => {
      for (const m of muts) {
        m.addedNodes && m.addedNodes.forEach(n => {
          if (n.nodeType !== 1) return;
          if (n.tagName === "IFRAME") return sweep(n);
          if (n.querySelectorAll) sweep(n);
        });
      }
    });
    obs.observe(document.body, { childList: true, subtree: true });
  });
})();
</script><style>
  /* Minimal style so it sits like a compact utility button */
  .er-install-btn {
    display: none;
    margin-left: .5rem;
    padding: .35rem .6rem;
    border: 0;
    border-radius: .5rem;
    font-weight: 600;
    cursor: pointer;
    line-height: 1;
    background: #ffd400; /* Essential yellow */
    color: #000;
    box-shadow: 0 1px 2px rgba(0,0,0,.2);
  }
  .er-install-btn:focus { outline: 2px solid #000; outline-offset: 2px; }
</style><script>
(function(){
  // Register service worker if supported
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function () {
      navigator.serviceWorker.register('/sw.js').catch(()=>{});
    });
  }

  let deferredPrompt = null;

  function createInstallButton() {
    const btn = document.createElement('button');
    btn.id = 'install-btn';
    btn.className = 'er-install-btn';
    btn.type = 'button';
    btn.textContent = 'Install app';
    btn.title = 'Install Essential Radio';
    btn.setAttribute('aria-label', 'Install Essential Radio');
    btn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      try {
        const { outcome } = await deferredPrompt.userChoice;
        // console.log('Install choice:', outcome);
      } catch(e){}
      deferredPrompt = null;
      btn.style.display = 'none';
    });
    return btn;
  }

  function placeNextToToggle(btn){
    const ids = ['theme-toggle','dark-toggle','darkModeToggle','mode-toggle','toggle-theme'];
    let toggle = null;
    for (const id of ids) {
      toggle = document.getElementById(id);
      if (toggle) break;
    }
    // Fallback: try a button with data attribute or icon class likely used for theme
    if (!toggle) toggle = document.querySelector('[data-theme-toggle], .theme-toggle, .dark-toggle');

    if (toggle && toggle.parentElement) {
      // Insert after the toggle button
      if (toggle.nextSibling) {
        toggle.parentElement.insertBefore(btn, toggle.nextSibling);
      } else {
        toggle.parentElement.appendChild(btn);
      }
      return true;
    }
    // If we couldn't find it, add to body top-right as fallback
    btn.style.position = 'fixed';
    btn.style.top = '10px';
    btn.style.right = '10px';
    document.body.appendChild(btn);
    return false;
  }

  const installBtn = createInstallButton();

  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    // Insert the button the first time we become eligible
    if (!installBtn.isConnected) placeNextToToggle(installBtn);
    installBtn.style.display = '';
  });

  window.addEventListener('appinstalled', () => {
    deferredPrompt = null;
    if (installBtn) installBtn.style.display = 'none';
  });

  // If already installed, hide button if shown
  if (window.matchMedia('(display-mode: standalone)').matches) {
    installBtn.style.display = 'none';
  }
})();
</script><script>
(function(){
  // If the native prompt event never fires (iOS), show a hint after a short delay.
  const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
  const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
  let promptSeen = false;
  window.addEventListener('beforeinstallprompt', () => { promptSeen = true; });

  function showHint(){
    if (document.querySelector('.install-hint')) return;
    const el = document.createElement('div');
    el.className = 'install-hint';
    el.innerHTML = 'To install: tap <strong>Share</strong> and choose <strong>Add to Home Screen</strong>';
    document.body.appendChild(el);
    el.style.display = 'block';
    setTimeout(() => el.remove(), 8000);
  }

  // Show hint only on iOS Safari (no native beforeinstallprompt), not if already installed
  window.addEventListener('load', () => {
    setTimeout(() => {
      if (isIOS && !isStandalone && !promptSeen) showHint();
    }, 1800);
  });
})();
</script><script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js').then(reg => {
      console.log('Service worker registered', reg);
    }).catch(err => {
      console.error('Service worker registration failed', err);
    });
  });
}
</script><script>
  // --- Auto-refresh when specific modals are open ---

  let _newsTimer = null;
  let _travelTimer = null;

  function startNewsAuto() {
    if (_newsTimer) return;
    // one immediate refresh
    try { window.fetchRNHNews?.(); } catch {}
    try { window.fetchScottishNews?.(); } catch {}
    // then every 60s
    _newsTimer = setInterval(() => {
      try { window.fetchRNHNews?.(); } catch {}
      try { window.fetchScottishNews?.(); } catch {}
    }, 60000);
  }
  function stopNewsAuto() {
    clearInterval(_newsTimer); _newsTimer = null;
  }

  function refreshAllTravelIframes() {
    const modal = document.getElementById('travelModal');
    if (!modal) return;
    // cache-bust every iframe in the travel modal
    modal.querySelectorAll('iframe').forEach((ifr) => {
      const base = (ifr.getAttribute('src') || '').split('?')[0];
      ifr.src = `${base}?ts=${Date.now()}`;
    });
  }
  function startTravelAuto() {
    if (_travelTimer) return;
    refreshAllTravelIframes();            // immediate
    _travelTimer = setInterval(refreshAllTravelIframes, 60000); // then every 60s
  }
  function stopTravelAuto() {
    clearInterval(_travelTimer); _travelTimer = null;
  }

  // Patch existing modal open/close helpers
  const _openModal = window.openModal;
  window.openModal = function (id) {
    _openModal(id);
    if (id === 'newsModal') startNewsAuto();
    if (id === 'travelModal') startTravelAuto();
  };

  const _closeModal = window.closeModal;
  window.closeModal = function (id) {
    _closeModal(id);
    if (id === 'newsModal') stopNewsAuto();
    if (id === 'travelModal') stopTravelAuto();
    // If no modals remain open, belt-and-braces stop
    const anyOpen = [...document.querySelectorAll('.modal')]
      .some(m => m.style.display === 'block' || m.style.display === 'flex');
    if (!anyOpen) { stopNewsAuto(); stopTravelAuto(); }
  };

  // Pause timers when tab not visible
  document.addEventListener('visibilitychange', () => {
    if (document.visibilityState !== 'visible') {
      stopNewsAuto(); stopTravelAuto();
    }
  });
</script><script>
// ===== News & Travel modal auto-refresh (inline) =====
(function(){
  function isOpen(modal){
    if (!modal) return false;
    const cs = getComputedStyle(modal);
    return cs.display !== 'none' && modal.offsetParent !== null;
  }
  let _newsTimer = null;
  function startNewsAuto(){
    if (_newsTimer) return;
    try { window.fetchRNHNews && window.fetchRNHNews(); } catch(e){}
    try { window.fetchScottishNews && window.fetchScottishNews(); } catch(e){}
    _newsTimer = setInterval(() => {
      try { window.fetchRNHNews && window.fetchRNHNews(); } catch(e){}
      try { window.fetchScottishNews && window.fetchScottishNews(); } catch(e){}
    }, 60000);
  }
  function stopNewsAuto(){ if (_newsTimer){ clearInterval(_newsTimer); _newsTimer = null; } }

  let _travelTimer = null;
  function refreshAllTravelIframes(){
    const modal = document.getElementById('travelModal');
    if (!modal) return;
    modal.querySelectorAll('iframe').forEach((ifr) => {
      const base = (ifr.getAttribute('src') || '').split('?')[0];
      if (!base) return;
      try { const url = new URL(base, location.href); url.searchParams.set('ts', Date.now()); ifr.src = url.toString(); } catch{}
    });
  }
  function startTravelAuto(){ if (_travelTimer) return; refreshAllTravelIframes(); _travelTimer = setInterval(refreshAllTravelIframes, 60000); }
  function stopTravelAuto(){ if (_travelTimer){ clearInterval(_travelTimer); _travelTimer = null; } }

  const _openModal = window.openModal;
  if (typeof _openModal === 'function'){
    window.openModal = function(id){
      _openModal(id);
      if (id === 'newsModal')   startNewsAuto();
      if (id === 'travelModal') startTravelAuto();
    };
  }
  const _closeModal = window.closeModal;
  if (typeof _closeModal === 'function'){
    window.closeModal = function(id){
      _closeModal(id);
      if (id === 'newsModal')   stopNewsAuto();
      if (id === 'travelModal') stopTravelAuto();
      const anyOpen = Array.from(document.querySelectorAll('.modal')).some(m => isOpen(m));
      if (!anyOpen){ stopNewsAuto(); stopTravelAuto(); }
    };
  }

  const targetIds = ['newsModal','travelModal'];
  const obs = new MutationObserver(() => {
    targetIds.forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      if (isOpen(el)){
        if (id === 'newsModal') startNewsAuto();
        if (id === 'travelModal') startTravelAuto();
      } else {
        if (id === 'newsModal') stopNewsAuto();
        if (id === 'travelModal') stopTravelAuto();
      }
    });
  });
  obs.observe(document.body, { attributes:true, childList:true, subtree:true, attributeFilter:['style','class'] });

  function resumeRefresh(){
    const news = document.getElementById('newsModal');
    const trav = document.getElementById('travelModal');
    if (isOpen(news)){ startNewsAuto(); }
    if (isOpen(trav)){ startTravelAuto(); }
  }
  window.addEventListener('focus', resumeRefresh);
  document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible') resumeRefresh();
    else { stopNewsAuto(); stopTravelAuto(); }
  });
})();
</script><script>
// ==== Listen Again (Mixcloud) — auto-refresh on open/resume ====
(function(){
  const MODAL_ID = 'listenModal'; // your real modal ID
  const CONTAINER_SEL = '#listenAgainContainer';

  // Register with the modal auto-refresh system (if it exists)
  window.refreshModalById = window.refreshModalById || {};
  window.refreshModalById[MODAL_ID] = refreshListenAgain;

  async function refreshListenAgain(){
    const modal = document.getElementById(MODAL_ID);
    const box = modal && modal.querySelector(CONTAINER_SEL);
    if (!modal || !box) return;

    const username = modal.getAttribute('data-mixcloud-username') || 'essentialradio';
    const limit = parseInt(modal.getAttribute('data-limit') || '12', 10);

    const url = new URL(`https://api.mixcloud.com/${encodeURIComponent(username)}/cloudcasts/`);
    url.searchParams.set('limit', String(limit));
    url.searchParams.set('ts', Date.now()); // cache-bust so today's uploads appear

    box.innerHTML = `<p>Loading…</p>`;
    try {
      const res = await fetch(url.toString(), { cache: 'no-store' });
      if (!res.ok) throw new Error('HTTP ' + res.status);
      const data = await res.json();
      box.innerHTML = renderCloudcasts(data);
      wireEmbeds(box);
    } catch (e) {
      console.warn('[ListenAgain] fetch failed:', e);
      box.innerHTML = `<p>Couldn’t load Listen Again right now.</p>`;
    }
  }

  function renderCloudcasts(api){
    const items = Array.isArray(api?.data) ? api.data : [];
    if (!items.length) return `<p>No shows yet — check back soon.</p>`;
    return `
      <div class="la-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;">
        ${items.map(it => {
          const title = escapeHTML(it?.name || 'Untitled');
          const mcUrl = `https://www.mixcloud.com${it?.key || ''}`;
          const img = it?.pictures?.medium || it?.pictures?.thumbnail || '';
          const when = it?.created_time ? new Date(it.created_time).toLocaleString('en-GB', { hour: '2-digit', minute: '2-digit', day: '2-digit', month: 'short' }) : '';
          return `
            <article class="la-card" data-mc-url="${mcUrl}" style="background:var(--panel,#111);border:1px solid var(--border,#333);border-radius:12px;overflow:hidden;">
              <div class="la-thumb" style="aspect-ratio:1.6/1;background:#000;">
                ${img ? `<img src="${img}" alt="" style="width:100%;height:100%;object-fit:cover;display:block;">` : ``}
              </div>
              <div class="la-meta" style="padding:10px;">
                <div class="la-title" style="font-weight:600;line-height:1.3;">${title}</div>
                ${when ? `<div class="la-time" style="opacity:.8;font-size:.9em;margin-top:4px;">${when}</div>` : ``}
                <button class="la-play" style="margin-top:8px;">Play</button>
                <a class="la-open" href="${mcUrl}" target="_blank" rel="noopener" style="margin-left:8px;">Open</a>
              </div>
            </article>`;
        }).join('')}
      </div>`;
  }

  function wireEmbeds(root){
    root.querySelectorAll('.la-card .la-play').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const card = e.currentTarget.closest('.la-card');
        const url = card?.getAttribute('data-mc-url');
        if (!url) return;
        const embed = `${url}/embed`;
        card.innerHTML = `
          <div style="position:relative; padding-top:120px;">
            <iframe title="Mixcloud player" width="100%" height="180" frameborder="0" allow="autoplay"
              src="${embed}?hide_cover=1&mini=1&ts=${Date.now()}"></iframe>
          </div>`;
      });
    });
  }

  function escapeHTML(s=''){ return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;', "'":'&#39;'}[c])); }

  // Fallback: refresh when opening modal via click
  document.addEventListener('click', (e) => {
    const t = e.target;
    if (t && (t.matches('[data-open="listenModal"]') || t.closest?.('[data-open="listenModal"]'))) {
      setTimeout(refreshListenAgain, 30);
    }
  });

  // Refresh again if modal is open when app/tab becomes visible
  function isOpen(el){ const cs = getComputedStyle(el); return cs.display !== 'none' && el.offsetParent !== null; }
  window.addEventListener('focus', () => {
    const m = document.getElementById(MODAL_ID);
    if (m && isOpen(m)) refreshListenAgain();
  });
  document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible') {
      const m = document.getElementById(MODAL_ID);
      if (m && isOpen(m)) refreshListenAgain();
    }
  });
})();
</script><script id="modal-refresh-on-open">
// === Central modal refresh-on-open system ================================
// Usage: add data-refresh-fn="yourFunctionName" to a .modal element.
// When openModal('thatModalId') is called, we'll run window[yourFunctionName]()
// immediately. Also re-run on window focus if that modal remains open.

(function(){
  // Global registry: id -> function
  window.refreshModalById = window.refreshModalById || {};

  function isOpen(modal){
    if (!modal) return false;
    const cs = getComputedStyle(modal);
    return cs.display !== 'none' && modal.offsetParent !== null;
  }

  // Patch openModal once
  const _openModal = window.openModal;
  if (typeof _openModal === 'function'){
    window.openModal = function(id){
      _openModal(id);

      // Resolve refresh function from data-refresh-fn or global registry
      const modal = document.getElementById(id);
      if (!modal) return;

      // Attribute wins first
      const fnName = modal.getAttribute('data-refresh-fn');
      let fn = null;
      if (fnName && typeof window[fnName] === 'function') {
        fn = window[fnName];
      } else if (window.refreshModalById && window.refreshModalById[id]) {
        fn = window.refreshModalById[id];
      }

      // Run immediately on open
      try { fn && fn(); } catch(e){ console.warn('[ModalRefresh] error in', fnName || '(registered fn)', e); }
    };
  }

  // Also: if page regains focus and a modal is still open, re-run its refresh
  window.addEventListener('focus', () => {
    const open = Array.from(document.querySelectorAll('.modal')).find(m => isOpen(m));
    if (!open) return;
    const id = open.id;
    const fnName = open.getAttribute('data-refresh-fn');
    let fn = null;
    if (fnName && typeof window[fnName] === 'function') {
      fn = window[fnName];
    } else if (window.refreshModalById && window.refreshModalById[id]) {
      fn = window.refreshModalById[id];
    }
    try { fn && fn(); } catch(e){ console.warn('[ModalRefresh] focus refresh error in', fnName || '(registered fn)', e); }
  });

  // Optional safety: if a modal is toggled open via direct style changes, observe
  const obs = new MutationObserver(() => {
    document.querySelectorAll('.modal').forEach(m => {
      if (isOpen(m)) {
        const id = m.id;
        const fnName = m.getAttribute('data-refresh-fn');
        let fn = null;
        if (fnName && typeof window[fnName] === 'function') {
          fn = window[fnName];
        } else if (window.refreshModalById && window.refreshModalById[id]) {
          fn = window.refreshModalById[id];
        }
        try { fn && fn(); } catch(e){ /* no-op */ }
      }
    });
  });
  obs.observe(document.body, { attributes:true, childList:true, subtree:true, attributeFilter:['style','class'] });
})();
</script><script id="presenter-click-hijack">
// Hijack ON AIR NOW presenter click to open the specific presenter modal if we can find it.
// Fallback to the big Presenters list if there's no match.
(function(){
  function slugify(str){
    return (str||'')
      .toLowerCase()
      .normalize('NFKD')           // split accents
      .replace(/[\u0300-\u036f]/g,'') // remove accents
      .replace(/&/g,'and')
      .replace(/[^a-z0-9]+/g,'-')  // non-alphanum -> dashes
      .replace(/^-+|-+$/g,'')      // trim dashes
      .replace(/--+/g,'-');        // collapse
  }

  // Try common patterns to locate a specific presenter modal element in the DOM.
  function findPresenterModalByName(name){
    if (!name) return null;
    const s = slugify(name);

    // 1) Common id patterns
    const idCandidates = [
      `presenter-${s}`,
      `modal-presenter-${s}`,
      `modal-${s}`,
      s // just in case ids are already slugs (e.g., "brian-woolfson")
    ];
    for (const id of idCandidates){
      const el = document.getElementById(id);
      if (el && el.classList.contains('modal')) return el;
    }

    // 2) Any .modal with a matching data attribute
    const dataSelectors = [
      `[data-presenter='${s}']`,
      `[data-presenter*='${s}']`,
      `[data-presenter-slug='${s}']`
    ];
    for (const sel of dataSelectors){
      const el = document.querySelector(`.modal${sel}`);
      if (el) return el;
    }

    // 3) Scan presenter modals by inner text of a known heading element
    const candidates = document.querySelectorAll('.modal.presenter-modal, .modal .presenter-modal, .modal[data-type="presenter"]');
    for (const m of candidates){
      const heading = m.querySelector('.presenter-name, h2, h3');
      if (heading) {
        const text = heading.textContent.trim();
        if (slugify(text) === s) return m;
      }
    }
    return null;
  }

  document.addEventListener('click', function(e){
    const link = e.target.closest('#onAirNow .presenter-link');
    if (!link) return;

    e.preventDefault();
    e.stopPropagation();

    const name = link.textContent.trim();
    const specific = findPresenterModalByName(name);

    // Close other modals
    if (typeof window.closeAllModals === 'function') window.closeAllModals();

    if (specific && specific.id) {
      // Open just the specific person
      if (typeof window.openModal === 'function') {
        window.openModal(specific.id);
      } else {
        specific.style.display = 'block';
      }
    } else if (typeof window.openLivePresenterModal === 'function') {
      // Some sites keep a resolver; use it as a secondary attempt
      try {
        const opened = window.openLivePresenterModal(name);
        if (opened) return;
      } catch(e){ /* continue to fallback */ }
      // Fallback to full presenters list
      if (typeof window.openModal === 'function') window.openModal('presentersModal');
    } else if (typeof window.openModal === 'function') {
      window.openModal('presentersModal');
    }
  }, { capture: true });
})();
</script><script id="modal-a11y-focus-trap">
// === Modal accessibility + focus trap + Escape close =====================
(function(){
  // Utility: find or create an id for a heading
  function ensureHeadingLabel(modal){
    const content = modal.querySelector('.modal-content');
    if (!content) return;
    content.setAttribute('role','dialog');
    content.setAttribute('aria-modal','true');
    // Find first h2/h3 as label
    let heading = content.querySelector('h2, h3');
    if (heading){
      if (!heading.id) heading.id = 'modalHeading_' + Math.random().toString(36).slice(2,8);
      content.setAttribute('aria-labelledby', heading.id);
    } else {
      // Fallback: label by title attribute or data-title
      const title = content.getAttribute('data-title') || modal.getAttribute('aria-label') || 'Dialog';
      content.setAttribute('aria-label', title);
    }
    // Make container programmatically focusable
    if (!content.hasAttribute('tabindex')) content.setAttribute('tabindex','-1');
  }

  function getFocusable(container){
    return Array.from(container.querySelectorAll(
      'a[href], area[href], input:not([disabled]):not([type="hidden"]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, audio[controls], video[controls], [contenteditable=""], [tabindex]:not([tabindex="-1"])'
    )).filter(el => el.offsetParent !== null || el === document.activeElement);
  }

  // State
  let activeModal = null;
  let lastFocused = null;

  // Patch openModal to add a11y, focus trap & Esc
  const prevOpen = window.openModal;
  if (typeof prevOpen === 'function'){
    window.openModal = function(id){
      lastFocused = document.activeElement;
      prevOpen(id);
      const modal = document.getElementById(id);
      if (!modal) return;

      // Setup ARIA
      ensureHeadingLabel(modal);

      // Focus management
      const content = modal.querySelector('.modal-content');
      if (!content) return;
      activeModal = modal;

      // Trap focus handler
      function onKeydown(e){
        if (!activeModal) return;
        if (e.key === 'Escape'){
          e.stopPropagation();
          if (typeof window.closeAllModals === 'function') window.closeAllModals();
          else modal.style.display = 'none';
          // Restore focus
          setTimeout(() => { try { lastFocused && lastFocused.focus(); } catch(_){} }, 0);
          return;
        }
        if (e.key === 'Tab'){
          const focusables = getFocusable(content);
          if (focusables.length === 0){
            // Keep focus on the dialog
            e.preventDefault();
            content.focus();
            return;
          }
          const first = focusables[0];
          const last = focusables[focusables.length - 1];
          if (e.shiftKey){
            if (document.activeElement === first || document.activeElement === content){
              e.preventDefault();
              last.focus();
            }
          } else {
            if (document.activeElement === last){
              e.preventDefault();
              first.focus();
            }
          }
        }
      }

      // Attach listeners if not already
      if (!modal._a11yBound){
        modal._a11yBound = true;
        document.addEventListener('keydown', onKeydown, true);

        // Close buttons should restore focus
        modal.querySelectorAll('.close, [data-close-modal]').forEach(btn => {
          btn.addEventListener('click', () => {
            setTimeout(() => { try { lastFocused && lastFocused.focus(); } catch(_){} }, 0);
          }, { capture: true });
        });

        // When modal is hidden by any means, clear state
        const obs = new MutationObserver(() => {
          const visible = getComputedStyle(modal).display !== 'none';
          if (!visible && activeModal === modal){
            activeModal = null;
            document.removeEventListener('keydown', onKeydown, true);
          }
        });
        obs.observe(modal, { attributes:true, attributeFilter:['style','class'] });
      }

      // Initial focus
      setTimeout(() => {
        const focusables = getFocusable(content);
        if (focusables.length) {
          // Prefer any element with [autofocus]
          const auto = content.querySelector('[autofocus]');
          (auto || focusables[0]).focus();
        } else {
          content.focus();
        }
      }, 0);
    };
  }

  // Also ensure all existing modals have ARIA on load (helps static analysis/readers)
  window.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.modal').forEach(ensureHeadingLabel);
  });
})();
</script><div class="artist" id="mobileNpArtist"></div><script id="mobile-now-bar-js">
(function(){
  function text(el){ return (el && el.textContent || '').trim(); }
  function pick(sel){ return document.querySelector(sel); }

  // Try to read from common spots used in your page
  function getNowPlaying(){
    // 1) Explicit fields if present
    const t1 = pick('#now-playing-card .np-title');
    const a1 = pick('#now-playing-card .np-artist');
    if (t1 || a1) return { title: text(t1), artist: text(a1) };

    // 2) Any labelled spans inside now-playing card
    const card = pick('#now-playing-card');
    if (card){
      // Heuristic: first strong/b element as title, next as artist
      const strongs = card.querySelectorAll('strong, b');
      if (strongs.length >= 1){
        const title = text(strongs[0]);
        const artist = strongs.length >= 2 ? text(strongs[1]) : '';
        if (title) return { title, artist };
      }
      // Or try data attributes (some builds use them)
      const dataTitle = card.getAttribute('data-title');
      const dataArtist = card.getAttribute('data-artist');
      if (dataTitle || dataArtist) return { title: dataTitle||'', artist: dataArtist||'' };
    }

    // 3) Fallback: combine any line in #nowPlaying block
    const np = pick('#nowPlaying');
    if (np){
      const line = text(np);
      // Try a simple split "Artist – Title" or "Title - Artist"
      if (line.includes('–')){
        const [l,r] = line.split('–').map(s=>s.trim());
        // Unsure of order; return best guess
        return { title: r||l, artist: l||'' };
      }
      if (line.includes('-')){
        const [l,r] = line.split('-').map(s=>s.trim());
        return { title: r||l, artist: l||'' };
      }
      return { title: line, artist: '' };
    }

    return { title: '', artist: '' };
  }

  function updateBar(){
    const { title, artist } = getNowPlaying();
    const tEl = document.getElementById('mobileNpTitle');
    const aEl = document.getElementById('mobileNpArtist');
    if (tEl) tEl.textContent = title || 'Essential Radio';
    if (aEl) aEl.textContent = artist || '';
  }

  // Hook play button to your existing #play-toggle button
  function setupControls(){
    const mobileBtn = document.getElementById('mobilePlayToggle');
    if (!mobileBtn) return;
    mobileBtn.addEventListener('click', function(){
      const mainBtn = document.getElementById('play-toggle');
      if (mainBtn) mainBtn.click();
    });
  }

  // Periodically sync (cheap) and also on visibility changes
  document.addEventListener('DOMContentLoaded', function(){
    setupControls();
    updateBar();
    // Sync every 5s (lightweight text copy)
    setInterval(updateBar, 5000);
  });

  document.addEventListener('visibilitychange', function(){
    if (!document.hidden) updateBar();
  });

  // If your existing code dispatches a custom event when now-playing changes,
  // you can listen here for instant updates. Example:
  // document.addEventListener('nowPlayingUpdated', updateBar);
})();
</script><script id="mobile-now-bar-visibility">
(() => {
  const mobileBar = document.getElementById('mobileNowBar');
  const player = document.getElementById('player-box');
  if (!mobileBar || !player) return;

  function applyVisibility(inView){
    if (window.matchMedia('(max-width: 768px)').matches) {
      mobileBar.style.display = inView ? 'none' : 'flex';
      document.body.style.paddingBottom = inView ? '' : '64px';
    } else {
      mobileBar.style.display = 'none';
      document.body.style.paddingBottom = '';
    }
  }

  const obs = new IntersectionObserver(([entry]) => {
    const inView = !!(entry && entry.isIntersecting);
    applyVisibility(inView);
  }, { root: null, threshold: 0.2 });

  obs.observe(player);

  // Re-evaluate on resize / orientation change
  window.addEventListener('resize', () => {
    // If desktop, always hide
    if (!window.matchMedia('(max-width: 768px)').matches) {
      mobileBar.style.display = 'none';
      document.body.style.paddingBottom = '';
    }
  });

  // Initial state in case we load mid-scroll
  requestAnimationFrame(() => {
    const rect = player.getBoundingClientRect();
    const inView = rect.top < window.innerHeight && rect.bottom > 0;
    applyVisibility(inView);
  });
})();
</script><div aria-label="Mini player" id="mobileNowBar" role="region"><div id="mobileNowBar-inner"><button aria-label="Play/Pause" id="mobilePlayBtn" title="Play/Pause">▷</button><div id="mobileNowText" title="Now Playing">Artist – Title</div></div></div><script id="mobile-mini-player-script">
(function () {
  const $ = (sel, root=document) => root.querySelector(sel);

  const mobileBar  = $('#mobileNowBar');
  const mobileBtn  = $('#mobilePlayBtn');
  const mobileText = $('#mobileNowText');
  const mainToggle = $('#play-toggle');
  const playerBox  = $('#player-box') || $('.left-panel');

  function clickMain() { if (mainToggle) mainToggle.click(); }
  if (mobileBtn) mobileBtn.addEventListener('click', clickMain);

  function setIcon(isPlaying) {
    if (!mobileBtn) return;
    mobileBtn.textContent = isPlaying ? '❚❚' : '▷';
    mobileBtn.setAttribute('aria-label', isPlaying ? 'Pause' : 'Play');
  }

  const audioEl = document.querySelector('audio');
  if (audioEl) {
    setIcon(!audioEl.paused);
    audioEl.addEventListener('play',  () => setIcon(true));
    audioEl.addEventListener('pause', () => setIcon(false));
  } else if (mainToggle) {
    const mo = new MutationObserver(() => {
      const pressed = (mainToggle.getAttribute('aria-pressed') === 'true'
                    || mainToggle.dataset.state === 'playing'
                    || mainToggle.classList.contains('playing'));
      setIcon(!!pressed);
    });
    mo.observe(mainToggle, { attributes: true, attributeFilter: ['aria-pressed','data-state','class'] });
  }

  function updateMini(artist, title) {
    if (!mobileText) return;
    const a = (artist || '').replace(/\s+on\s+Essential\s+Radio\s*$/i,'').trim();
    const t = (title  || '').replace(/\s+on\s+Essential\s+Radio\s*$/i,'').trim();
    const line = (a && t) ? `${a} – ${t}` : (a || t || 'Essential Radio');
    mobileText.textContent = line;
    mobileText.title = line;
  }

  function readFromNowPlayingBlock(){
    const np = document.getElementById('now-playing');
    if (!np) return {artist:'', title:''};
    const text = (np.textContent || '').replace(/\s+/g,' ').trim();
    const m = text.match(/^(?:Now Playing:)?\s*(?:LIVE\s*)?(.*)\s+by\s+(.*)$/i);
    if (m) return { title: m[1].trim(), artist: m[2].trim() };
    if (text.includes('–')) {
      const idx = text.indexOf('–');
      return { artist: text.slice(0, idx).trim(), title: text.slice(idx+1).trim() };
    }
    if (text.includes('-')) {
      const idx = text.indexOf('-');
      return { artist: text.slice(0, idx).trim(), title: text.slice(idx+1).trim() };
    }
    return {artist:'', title:''};
  }

  function scrapeNowPlaying() {
    let r = readFromNowPlayingBlock();
    if (r.title || r.artist) { updateMini(r.artist, r.title); return; }

    const titleSel  = ['#npTitle', '.np-title', '.track-title', '#nowPlayingTitle', '#now-playing-card .track-title'];
    const artistSel = ['#npArtist', '.np-artist', '.track-artist', '#nowPlayingArtist', '#now-playing-card .track-artist'];
    const pick = (list) => {
      for (const s of list) {
        const el = document.querySelector(s);
        if (el && el.textContent.trim()) return el.textContent.trim();
      }
      return '';
    };
    const title = pick(titleSel);
    const artist = pick(artistSel);
    if (title || artist) { updateMini(artist, title); return; }

    const card = document.getElementById('now-playing-card');
    if (card) {
      const t = card.getAttribute('data-song-title') || (card.dataset && card.dataset.songTitle) || '';
      const a = card.getAttribute('data-song-artist') || (card.dataset && card.dataset.songArtist) || '';
      if (t || a) { updateMini(a, t); return; }
    }

    updateMini('', '');
  }

  scrapeNowPlaying();
  const interval = setInterval(scrapeNowPlaying, 8000);

  const np = document.getElementById('now-playing') || document.getElementById('now-playing-card');
  if (np && 'MutationObserver' in window) {
    const moNP = new MutationObserver(scrapeNowPlaying);
    moNP.observe(np, { childList: true, subtree: true, characterData: true, attributes: true });
  }

  window.addEventListener('essential:nowplaying:update', scrapeNowPlaying);
  window.addEventListener('np:update', (ev) => {
    const d = ev.detail || {}; updateMini(d.artist, d.title);
  });

  if (playerBox && 'IntersectionObserver' in window) {
    const io = new IntersectionObserver((entries) => {
      const visible = entries[0].isIntersecting;
      if (!mobileBar) return;
      mobileBar.style.opacity = visible ? '0' : '1';
      mobileBar.style.pointerEvents = visible ? 'none' : 'auto';
      mobileBar.style.transform = visible ? 'translateY(8px)' : 'translateY(0)';
    }, { threshold: 0.2 });
    io.observe(playerBox);
  }
})();
</script><script id="wire-refresh-yellow-both">
(function(){
  async function unifiedRefresh(){
    try{
      var dateEl = document.getElementById('dateSelect');
      var hourEl = document.getElementById('hourSelect');
      var searchEl = document.getElementById('searchInput');
      var prevDate   = dateEl ? dateEl.value : "";
      var prevHour   = hourEl ? hourEl.value : "";
      var prevSearch = searchEl ? searchEl.value : "";

      var btn = document.getElementById('songsearchRefreshBtn');
      if (btn){ btn.disabled = true; btn.textContent = 'Refreshing…'; }

      if (typeof window.refreshSongSearch === 'function'){
        await window.refreshSongSearch();
      } else {
        // Fallback fetch — matches earlier working endpoint
        var url = 'https://essentialradio.github.io/player/playout_log_rolling.json';
        url += (url.indexOf('?')===-1?'?':'&') + 'ts=' + Date.now();
        var res = await fetch(url, { cache: 'no-store' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        var data = await res.json();
        try { window.fullData = data; } catch(_) {}
        try { fullData = data; } catch(_) {}
        if (typeof populateDropdowns === 'function'){ try { populateDropdowns(data); } catch(_){} }
      }

      // Restore date
      if (dateEl && prevDate) dateEl.value = prevDate;

      // Ensure hour remains valid; if not, pick latest for that date
      if (hourEl && dateEl){
        var opts = Array.from(hourEl.options).map(function(o){ return o.value; });
        if (opts.indexOf(prevHour) !== -1){
          hourEl.value = prevHour;
        } else if (typeof updateHourDropdown === 'function'){
          try { updateHourDropdown(dateEl.value, null); } catch(_) {}
        }
      }

      // Restore search
      if (searchEl) searchEl.value = prevSearch;

      if (typeof renderTable === 'function'){
        try { renderTable((typeof fullData!=='undefined'&&fullData) || (window.fullData||[])); } catch(_){}
      }
    }catch(e){
      console.warn('[SongSearch] Refresh failed:', e);
    }finally{
      var btn = document.getElementById('songsearchRefreshBtn');
      if (btn){ btn.disabled = false; btn.textContent = 'Refresh'; }
    }
  }

  function init(){
    var btn = document.getElementById('songsearchRefreshBtn');
    if (btn && !btn.__wired){
      btn.addEventListener('click', function(){ unifiedRefresh(); });
      btn.__wired = true;
    }
  }

  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', init, { once: true });
  } else {
    init();
  }
})();
</script><script id="np-enhancements">
// === Smooth rAF bar animation & robust resets ===
let _npRafId = null;
function hardResetBar(){
  try {
    const prog = document.getElementById('np-progress');
    const bar = prog && prog.querySelector ? prog.querySelector('.bar') : null;
    if (!bar || !prog) return;
    prog.classList.remove('ending-soon');
    bar.style.transition = 'none';
    bar.style.width = '100%';
    void bar.offsetWidth; // reflow
    bar.style.transition = 'width 0.4s linear';
  } catch(e){}
}

function startBarAnimation(startMs, endMs){
  try {
    const prog = document.getElementById('np-progress');
    const bar = prog && prog.querySelector ? prog.querySelector('.bar') : null;
    if (!bar || !prog) return;
    prog.style.display = 'block';
    cancelAnimationFrame(_npRafId);
    function frame(){
      const now = Date.now();
      const total = Math.max(0, endMs - startMs);
      const remaining = Math.max(0, endMs - now);
      const pct = total > 0 ? (remaining / total) * 100 : 0;
      bar.style.width = (pct > 100 ? 100 : (pct < 0 ? 0 : pct)) + '%';
      prog.setAttribute('aria-valuenow', Math.round(pct));
      if (remaining <= 10000) prog.classList.add('ending-soon'); else prog.classList.remove('ending-soon');
      if (remaining > 0) { _npRafId = requestAnimationFrame(frame); }
    }
    _npRafId = requestAnimationFrame(frame);
  } catch(e){}
}

document.addEventListener('visibilitychange', () => {
  if (!document.hidden && window._npLastTiming) {
    startBarAnimation(window._npLastTiming.startMs, window._npLastTiming.endMs);
  } else if (document.hidden) {
    cancelAnimationFrame(_npRafId);
  }
});

</script><script id="global-modal-close-helpers">
(function(){
  function closeAllModals(){
    document.querySelectorAll('.modal').forEach(function(m){
      m.style.display = 'none';
      m.classList && m.classList.remove('active');
    });
    document.body.classList.remove('modal-open');
    if (typeof toggleLogoVisibility === 'function') toggleLogoVisibility();
  }
  // Backdrop click closes any open modal
  document.addEventListener('click', function(e){
    if (e.target && e.target.classList && e.target.classList.contains('modal')) {
      closeAllModals();
    }
  }, true);
  // ESC closes
  document.addEventListener('keydown', function(e){
    if (e.key === 'Escape') { closeAllModals(); }
  });
  // Close button inside a modal
  document.addEventListener('click', function(e){
    var btn = e.target.closest && e.target.closest('.close');
    if (!btn) return;
    var modal = btn.closest('.modal');
    if (modal){
      modal.style.display = 'none';
      modal.classList && modal.classList.remove('active');
      if (!document.querySelector('.modal.active')) {
        document.body.classList.remove('modal-open');
      }
      if (typeof toggleLogoVisibility === 'function') toggleLogoVisibility();
    }
  });

  window.closeAllModals = closeAllModals;
})();
</script><style id="schedule-highlight-polish">
  /* Ensure badge anchor exists */
  .show-entry { position: relative; }

  /* Visual highlight */
  .show-entry.live-now,
  .show-entry.current,
  .show-entry.current-show,
  .show-entry.show--current {
    background: color-mix(in srgb, #ffd000 16%, transparent);
    box-shadow: 0 0 0 2px #ffd00022 inset;
  }

  /* Left bar */
  .show-entry.live-now::before {
    content: "";
    position: absolute; inset: 0 auto 0 0; width: 6px; background: #ffd000;
    border-radius: 6px;
  }

  /* “ON AIR NOW” pill */
  .show-entry.live-now::after {
    content: var(--now-flag, "ON AIR NOW");
    position: absolute; top: 8px; right: 8px;
    font: 600 12px/1.2 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    padding: 4px 8px; border-radius: 999px;
    background: #d60000; color: #fff; letter-spacing: .02em;
    text-transform: uppercase;
  }

  @media (prefers-reduced-motion: reduce) {
    html:focus-within { scroll-behavior: auto; }
  }
</style><script>
(() => {
  const MS_DAY = 86400000;

  function todayName() {
    return new Date().toLocaleDateString('en-GB', { weekday: 'long', timeZone: 'Europe/London' });
  }

  // normalise "HH:MM–HH:MM" with any dash and stray spaces
  function parseRange(text) {
    if (!text) return null;
    const t = String(text).replace(/\s*/g, '').replace(/[–—-]/, '-');
    const m = t.match(/^(\d{1,2}):(\d{2})-(\d{1,2}):(\d{2})$/);
    if (!m) return null;
    const [, h1, m1, h2, m2] = m.map(Number);
    return { start: `${h1}:${String(m1).padStart(2,'0')}`, end: `${h2}:${String(m2).padStart(2,'0')}` };
  }

  function nextByClock(base, hhmm) {
    const [H, M] = hhmm.split(':').map(Number);
    const d = new Date(base);
    d.setHours(H, M, 0, 0);
    return d;
  }

  function clearHighlights(container) {
    container.querySelectorAll('.live-now, .current, .current-show, .show--current')
      .forEach(el => {
        el.classList.remove('live-now','current','current-show','show--current');
        el.removeAttribute('aria-live');
        el.removeAttribute('aria-label');
      });
  }

  // ========= Modal highlighter =========
  function highlightLiveShows() {
    const container = document.querySelector('#modalDaySchedule');
    if (!container) return;

    // treat the container as a day-card if it already is one
    const dayCards = container.matches('.day-card')
      ? [container]
      : container.querySelectorAll('.day-card');

    // clear any prior state within modal
    container.querySelectorAll('.live-now, .current, .current-show, .show--current')
      .forEach(el => el.classList.remove('live-now','current','current-show','show--current'));

    const now = new Date();
    const today = todayName().toLowerCase();

    dayCards.forEach(dayCard => {
      const heading = (dayCard.querySelector('h2, h3')?.textContent || '').trim().toLowerCase();
      const isToday = heading.includes(today);

      dayCard.querySelectorAll('.show-entry').forEach(entry => {
        const t = entry.querySelector('time')?.textContent || entry.textContent;
        const range = parseRange(t);
        if (!range || !isToday) return;

        let start = nextByClock(now, range.start);
        let end   = nextByClock(now, range.end);
        if (end <= start) end = new Date(end.getTime() + MS_DAY);

        if (now >= start && now < end) {
          entry.classList.add('live-now');
          try { entry.style.setProperty('--now-flag', '"ON AIR NOW"'); } catch {}
          entry.setAttribute('aria-live', 'polite');
          entry.setAttribute('aria-label', 'On air now');
        }
      });
    });
  }

  // ========= Main page highlighter =========
  let lastScrollId = null;

  function findScheduleContainer() {
    return document.querySelector('#mainSchedule, .schedule, .schedule-list, .day-card') || document.body;
  }

  function extractRange(node) {
    const t = (node.querySelector?.('time')?.textContent || node.textContent || '').trim();
    const r = parseRange(t);
    if (!r) return null;
    const now = new Date();
    let s = nextByClock(now, r.start);
    let e = nextByClock(now, r.end);
    if (e <= s) e = new Date(e.getTime() + MS_DAY);
    return [s, e];
  }

  function isNowWithin(s, e, now = new Date()) {
    return now >= s && now < e;
  }

  function highlightCurrentShow() {
    // If the modal is visible, let the modal highlighter do its thing
    const schedModal = document.getElementById('scheduleModal');
    if (schedModal && isVisible(schedModal)) return;

    const container = findScheduleContainer();
    if (!container) return;

    const nodes = container.querySelectorAll('.show-entry, .show, .schedule-item, li');
    let winner = null;

    nodes.forEach(node => {
      const range = extractRange(node);
      if (!range) return;
      const [s, e] = range;
      if (isNowWithin(s, e)) winner = node;
    });

    clearHighlights(container);

    if (winner) {
      let id = winner.getAttribute('data-id') || winner.id ||
               String(Array.from(nodes).indexOf(winner));

      winner.classList.add('show--current', 'current-show', 'current', 'live-now');
      try { winner.style.setProperty('--now-flag', '"ON AIR NOW"'); } catch {}

      // Smooth scroll respecting reduced motion
      const prefersReduced = window.matchMedia?.('(prefers-reduced-motion: reduce)').matches;
      const behavior = prefersReduced ? 'auto' : 'smooth';

      if (lastScrollId !== id) {
        lastScrollId = id;
        setTimeout(() => {
          try { winner.scrollIntoView({ behavior, block: 'center' }); } catch {}
        }, 60);
      }
    }
  }

  // ========= Utilities =========
  function isVisible(el) {
    if (!el) return false;
    const cs = getComputedStyle(el);
    if (cs.display === 'none' || cs.visibility === 'hidden' || cs.opacity === '0') return false;
    if (el.classList.contains('show')) return true;
    return el.offsetParent !== null || cs.position === 'fixed';
  }

  // ========= Wiring =========
  // 1) Keep main schedule highlight fresh
  highlightCurrentShow();
  setInterval(highlightCurrentShow, 60000);

  // 2) Re-run when DOM changes significantly (e.g., schedule re-render)
  new MutationObserver(() => highlightCurrentShow())
    .observe(document.body, { childList: true, subtree: true });

  // 3) When modal opens or its content changes, highlight inside
  const modal = document.getElementById('scheduleModal');
  const modalDay = document.getElementById('modalDaySchedule');

  if (modal) {
    // Observe visibility/class changes on the modal shell
    new MutationObserver(() => {
      if (isVisible(modal)) {
        highlightLiveShows();
        if (!window.__modalTick) {
          window.__modalTick = setInterval(highlightLiveShows, 60000);
        }
      } else if (window.__modalTick) {
        clearInterval(window.__modalTick);
        window.__modalTick = null;
      }
    }).observe(modal, { attributes: true, attributeFilter: ['class', 'style'] });
  }

  if (modalDay) {
    // Observe content changes within the modal day card
    new MutationObserver(() => highlightLiveShows())
      .observe(modalDay, { childList: true, subtree: true });
  }

  // 4) Also re-highlight on click of any known open buttons (best-effort)
  document.addEventListener('click', (e) => {
    const t = e.target.closest('[data-open="schedule"], .schedule-open, #openSchedule, a[href="#scheduleModal"]');
    if (t) setTimeout(highlightLiveShows, 50);
  });

  // expose for debugging
  window.highlightCurrentShow = highlightCurrentShow;
  window.highlightLiveShows = highlightLiveShows;
})();
</script><script>
(function() {
  function ready(fn){ if(document.readyState!=='loading'){ fn(); } else { document.addEventListener('DOMContentLoaded', fn); } }

  ready(function() {
    var clock = document.getElementById('liveClock');
    if (!clock) return;

    // Create a placeholder to return the clock to its original spot
    var placeholderId = 'liveClock-return-anchor';
    var placeholder = document.getElementById(placeholderId);
    if (!placeholder) {
      placeholder = document.createElement('div');
      placeholder.id = placeholderId;
      clock.parentNode.insertBefore(placeholder, clock.nextSibling);
    }

    // Helper to insert clock before play button inside #player-box
    function moveClockToPlayerBox() {
      var player = document.getElementById('player-box');
      var playBtn = document.getElementById('play-toggle');
      if (!player || !playBtn) return;
      // Insert clock before play button
      if (playBtn.parentNode === player) {
        player.insertBefore(clock, playBtn);
      } else {
        // fallback: prepend to player-box
        player.insertBefore(clock, player.firstChild);
      }
    }

    function moveClockHome() {
      if (placeholder && placeholder.parentNode) {
        placeholder.parentNode.insertBefore(clock, placeholder);
      }
    }

    var mq = window.matchMedia('(max-width: 768px)');
    function apply() {
      if (mq.matches) {
        moveClockToPlayerBox();
      } else {
        moveClockHome();
      }
    }
    apply();
    mq.addEventListener ? mq.addEventListener('change', apply) : mq.addListener(apply);
    window.addEventListener('orientationchange', apply);
    window.addEventListener('resize', function(){
      // debounce-ish
      clearTimeout(window.__clockMoveTO);
      window.__clockMoveTO = setTimeout(apply, 120);
    });
  });
})();
</script><script src="/artwork-unified.js?v=20250929" defer></script><script src="/artwork-ios-patch.js?v=20250929-1104" defer></script><script src="/nowplaying-refresh-test.js?v=20251006" defer></script><script>
document.addEventListener('DOMContentLoaded', function () {
  // Lazy-load all images except key hero elements
  document.querySelectorAll('img:not(#artwork):not(.logo-overhang)').forEach(function(img){
    if(!img.hasAttribute('loading')) img.setAttribute('loading','lazy');
    if(!img.hasAttribute('decoding')) img.setAttribute('decoding','async');
  });

  // Ensure .modal elements have a11y attributes even if dynamically injected
  document.querySelectorAll('.modal').forEach(function(modal){
    modal.setAttribute('role', modal.getAttribute('role') || 'dialog');
    modal.setAttribute('aria-modal', modal.getAttribute('aria-modal') || 'true');
    modal.setAttribute('tabindex', modal.getAttribute('tabindex') || '-1');
  });
});
</script><script>
// Hide the currently playing track from the "recently played" list.
(function(){
  function norm(s){ return (s==null?'':String(s)).trim().replace(/\s+/g,' ').toUpperCase(); }
  function filterRecentAgainstNowPlaying(){
    try{
      var artistEl = document.getElementById('np-artist') || document.getElementById('mobileNpArtist');
      var titleEl  = document.getElementById('np-title');
      var list = document.getElementById('recent-list');
      if(!list) return;
      // Always reset visibility first so we don't keep things hidden after track changes
      Array.from(list.children).forEach(function(el){ if (el && el.style) el.style.display = ''; });
      if(!artistEl || !titleEl) return;
      var a = norm(artistEl.textContent);
      var t = norm(titleEl.textContent);
      if(!a || !t) return;
      var children = Array.from(list.children);
      for (var i=0;i<children.length;i++){
        var row = children[i];
        var txt = norm(row.textContent);
        // Match both artist and title tokens within the row
        if (txt.includes(a) && txt.includes(t)) {
          row.style.display = 'none';
          break; // hide only the first matching row
        }
      }
    }catch(e){}
  }
  window._filterRecentAgainstNowPlaying = filterRecentAgainstNowPlaying;
  document.addEventListener('DOMContentLoaded', function(){
    filterRecentAgainstNowPlaying();
    var list = document.getElementById('recent-list');
    if (list && window.MutationObserver) {
      var mo = new MutationObserver(filterRecentAgainstNowPlaying);
      mo.observe(list, {childList:true, subtree:false});
    }
    var a = document.getElementById('np-artist') || document.getElementById('mobileNpArtist');
    var t = document.getElementById('np-title');
    if (a && window.MutationObserver) {
      var moA = new MutationObserver(filterRecentAgainstNowPlaying);
      moA.observe(a, {childList:true, subtree:true, characterData:true});
    }
    if (t && window.MutationObserver) {
      var moT = new MutationObserver(filterRecentAgainstNowPlaying);
      moT.observe(t, {childList:true, subtree:true, characterData:true});
    }
  });
})();
</script><div tabindex="-1" aria-modal="true" role="dialog" class="modal" id="collegeModal"><div tabindex="-1" aria-modal="true" role="dialog" class="modal-content"><span class="close" onclick="closeModal('collegeModal')">×</span><h2>College Info</h2><div class="college-toolbar"><div class="segmented" role="tablist" aria-label="Filter section"><button type="button" class="seg active" data-filter="ALL" aria-selected="true">All</button><button type="button" class="seg" data-filter="INTERNAL" aria-selected="false">Internal</button><button type="button" class="seg" data-filter="EXTERNAL" aria-selected="false">External</button></div><div class="toolbar-right"><label for="collegeSelect" class="sr-only">Choose item</label><select id="collegeSelect" aria-label="Choose item"></select></div></div><div id="collegeWrap"><article id="collegeDetail" class="college-detail" aria-live="polite"><div class="placeholder">Choose an item from the dropdown to view full details.</div></article><div id="collegeGrid" class="college-grid" aria-live="polite"></div></div></div></div></div></div><script id="playlist-text-loader">
(function(){
  const PLAYLIST_URL = 'playlist.txt';
  const wrap = document.getElementById('playlistWrap');
  const grid = document.getElementById('playlistGrid');
  const isiOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
  const PLACEHOLDER = 'Essential Radio Logo.png';
  const artCache = new Map();

  function normaliseQuery(s){
    return String(s||'')
      .replace(/[\u2013\u2014]/g, '-')
      .replace(/\s+\[[^\]]*\]/g, '')
      .replace(/\s+\([^)]*\)/g, '')
      .replace(/\s{2,}/g, ' ')
      .trim();
  }

  async function getArtwork(artist, title){
    const key = artist + ' — ' + title;
    if (artCache.has(key)) return artCache.get(key);
    const q = encodeURIComponent(normaliseQuery(artist + ' - ' + title));
    try{
      const r = await fetch('/api/artwork?q=' + q, { cache: 'no-store' });
      if (!r.ok) throw new Error('HTTP ' + r.status);
      const { url } = await r.json();
      const finalUrl = url || PLACEHOLDER;
      artCache.set(key, finalUrl);
      return finalUrl;
    }catch(e){
      artCache.set(key, PLACEHOLDER);
      return PLACEHOLDER;
    }
  }

  function parsePlaylist(text){
    const lines = text.split(/\r?\n/);
    let section = 'A';
    const sections = { A: [], B: [], C: [] };
    function push(line){
      const raw = line.trim();
      if (!raw) return;
      const hasNew = /\*NEW\*/i.test(raw);
      const hasUp = /\*UP\*/i.test(raw);
      const hasDown = /\*DOWN\*/i.test(raw);
      const cleaned = raw.replace(/\*(NEW|UP|DOWN)\*/gi, '').trim();
      let artist = cleaned, title = '';
      const idx = cleaned.lastIndexOf(' - ');
      if (idx !== -1){ artist = cleaned.slice(0, idx).trim(); title = cleaned.slice(idx + 3).trim(); }
      sections[section].push({ artist, title, flags: { hasNew, hasUp, hasDown } });
    }
    for (let i=0;i<lines.length;i++){
      const l = lines[i].trim();
      if (/^A\s*-\s*List/i.test(l)) { section = 'A'; continue; }
      if (/^B\s*-\s*List/i.test(l)) { section = 'B'; continue; }
      if (/^C\s*-\s*List/i.test(l)) { section = 'C'; continue; }
      push(l);
    }
    return sections;
  }

  function sectionHTML(letter, items){
    const label = letter + '-List';
    const rows = items.map((t, i) => {
      const id = `trk-${letter}-${i}`;
      const boldOn = t.flags.hasNew ? ['<strong>','</strong>'] : ['',''];
      const badge = t.flags.hasNew ? '<span class="badge new">NEW</span>' : '';
      const arrow = t.flags.hasUp ? '<span class="move-tag up" aria-label="Up">▲</span>' : (t.flags.hasDown ? '<span class="move-tag down" aria-label="Down">▼</span>' : '');
      return `<div class="track" id="${id}">
        <img class="cover" alt="" src="${PLACEHOLDER}" ${isiOS ? '' : 'loading="lazy"'} />
        <div class="meta">
          <div class="artist">${boldOn[0]}${t.artist}${boldOn[1]} ${badge}</div>
          <div class="title">${boldOn[0]}${t.title}${boldOn[1]}</div>
        </div>
        <div class="move">${arrow}</div>
      </div>`;
    }).join('');
    return `<section class="playlist-section" data-section="${letter}">
      <h3>${label}</h3>
      ${rows || '<div class="muted">No tracks.</div>'}
    </section>`;
  }

  function render(sections){
    grid.innerHTML = ['A','B','C'].map(l => sectionHTML(l, sections[l])).join('');
  }

  async function hydrateCovers(sections){
    for (const l of ['A','B','C']){
      for (let i=0; i<sections[l].length; i++){
        const t = sections[l][i];
        const img = document.getElementById(`trk-${l}-${i}`)?.querySelector('img.cover');
        if (!img) continue;
        const url = await getArtwork(t.artist, t.title);
        img.src = url || PLACEHOLDER;
      }
    }
  }

  let activeFilter = 'A';
  function applyFilters(){
    if (activeFilter === 'ALL') wrap.classList.remove('single-list'); else wrap.classList.add('single-list');
    grid.querySelectorAll('.playlist-section').forEach(sec => {
      const letter = sec.getAttribute('data-section');
      sec.style.display = (activeFilter === 'ALL' || letter === activeFilter) ? '' : 'none';
    });
  }

  function attachInteractions(){
    const segs = wrap.querySelectorAll('.segmented .seg');
    segs.forEach(btn => btn.addEventListener('click', () => {
      segs.forEach(b => { b.classList.toggle('active', b===btn); b.setAttribute('aria-selected', b===btn ? 'true':'false'); });
      activeFilter = (btn.getAttribute('data-filter') || 'A').toUpperCase();
      try { history.replaceState(null, '', '#list=' + activeFilter); } catch(e) {}
      applyFilters();
    }));

    try {
      const url = new URL(location.href);
      const q = (url.searchParams.get('list') || '').toUpperCase();
      const h = ((location.hash.match(/list=(ALL|A|B|C)/i) || [,''])[1] || '').toUpperCase();
      const pick = (q || h || 'A');
      if (['ALL','A','B','C'].includes(pick)){
        activeFilter = pick;
        segs.forEach(b => {
          const on = (b.getAttribute('data-filter') || 'A').toUpperCase() === activeFilter;
          b.classList.toggle('active', on);
          b.setAttribute('aria-selected', on ? 'true' : 'false');
        });
      }
    } catch(e){}
    applyFilters();
  }

  function refreshPlaylist(){
    const url = PLAYLIST_URL + (PLAYLIST_URL.includes('?') ? '&' : '?') + 'v=' + Date.now();
    grid.textContent = 'Loading…';
    fetch(url).then(r => { if(!r.ok) throw new Error('HTTP ' + r.status); return r.text(); })
      .then(txt => {
        const data = parsePlaylist(txt);
        render(data);
        attachInteractions();
        hydrateCovers(data);
      })
      .catch(err => {
        grid.innerHTML = '<p style="color:#ff7d7d">Could not load playlist (' + err.message + ')</p>';
      });
  }
  window.refreshPlaylist = refreshPlaylist;
  document.addEventListener('DOMContentLoaded', refreshPlaylist);
})();
</script><script id="college-loader-min">
(function(){
  const MASTER_URL = 'reads.txt';
  const selectEl = document.getElementById('collegeSelect');
  const detailEl = document.getElementById('collegeDetail');
  const segs = document.querySelectorAll('#collegeModal .segmented .seg');

  function escapeHtml(s){return String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));}

  function parseMaster(text){
    const lines = text.split(/\r?\n/);
    let section = 'INTERNAL';
    const items = [];
    let i = 0;
    const reSection = /^\s*\[(internal|external)\]\s*$/i;
    const reFromTo = /^\s*From\s*-\s*(\d{1,2}\/\d{1,2}\/\d{2,4})\s*To\s*-\s*(\d{1,2}\/\d{1,2}\/\d{2,4})\s*$/i;

    def = (x) => typeof x !== 'undefined' && x !== null;

    def

    function consumeUntilNonBlank(){ while(i < lines.length && /^\s*$/.test(lines[i])) i++; }

    while(i < lines.length){
      while(i < lines.length && reSection.test(lines[i])){ section = lines[i].match(reSection)[1].toUpperCase(); i++; }
      consumeUntilNonBlank(); if (i >= lines.length) break;
      const mFT = lines[i].match(reFromTo);
      if (!mFT){ i++; continue; }
      const from = mFT[1]; const to = mFT[2]; i++;
      consumeUntilNonBlank();
      const title = (lines[i] || '').trim(); i++;
      const bodyLines = [];
      while(i < lines.length && !/^\s*$/.test(lines[i]) && !reFromTo.test(lines[i]) && !reSection.test(lines[i])){ bodyLines.push(lines[i]); i++; }
      items.push({ section, from, to, title, body: bodyLines.join('\n').trim() });
      while(i < lines.length && /^\s*$/.test(lines[i])) i++;
    }
    return items;
  }

  function fmtRange(it){ return `${it.from} – ${it.to}`; }

  let ALL_ITEMS = [];
  function populateSelect(mode){
    const filtered = ALL_ITEMS.filter(it => mode === 'ALL' || it.section === mode);
    const groups = { INTERNAL: [], EXTERNAL: [] };
    filtered.forEach(it => groups[it.section||'INTERNAL'].push(it));

    function optionHTML(it, idx){
      const label = `${fmtRange(it)} · ${it.title}`;
      return `<option value="${idx}">${escapeHtml(label)}</option>`;
    }

    let html = '<option value="" selected disabled>Choose an item…</option>';
    if (mode === 'ALL'){
      if (groups.INTERNAL.length){ html += `<optgroup label="Internal">` + groups.INTERNAL.map(it=>optionHTML(it, it._i)).join('') + `</optgroup>`; }
      if (groups.EXTERNAL.length){ html += `<optgroup label="External">` + groups.EXTERNAL.map(it=>optionHTML(it, it._i)).join('') + `</optgroup>`; }
    } else {
      html += filtered.map(it => optionHTML(it, it._i)).join('');
    }
    selectEl.innerHTML = html;
  }

  function renderDetail(it){
    if (!it){
      detailEl.innerHTML = '<div class="placeholder">Choose an item from the dropdown to view full details.</div>';
      return;
    }
    const sectBadge = `<span class="badge ${it.section==='INTERNAL'?'internal':'external'}">${it.section.toLowerCase()}</span>`;
    detailEl.innerHTML = `
      <div class="detail-head">
        <h3 class="detail-title">${escapeHtml(it.title)}</h3>
        <span class="date-pill">${escapeHtml(fmtRange(it))}</span>
        ${sectBadge}
      </div>
      <div class="detail-body">
        ${it.body ? it.body.split(/\n/).map(p => `<p>${escapeHtml(p)}</p>`).join('') : '<p class="muted">No extra details.</p>'}
      </div>
    `;
    detailEl.scrollTop = 0;
  }

  function applyMode(mode){
    populateSelect(mode);
    renderDetail(null);
  }

  function initControls(){
    segs.forEach(btn => btn.addEventListener('click', ()=>{
      segs.forEach(b => { b.classList.toggle('active', b===btn); b.setAttribute('aria-selected', b===btn ? 'true':'false'); });
      const mode = (btn.dataset.filter || 'ALL').toUpperCase();
      applyMode(mode);
    }));
    selectEl.addEventListener('change', () => {
      const idx = selectEl.value ? parseInt(selectEl.value,10) : NaN;
      const item = Number.isInteger(idx) ? ALL_ITEMS.find(x => x._i === idx) : null;
      renderDetail(item || null);
    });
  }

  function refreshCollege(){
    const url = MASTER_URL + (MASTER_URL.includes('?') ? '&' : '?') + 'v=' + Date.now();
    return fetch(url)
      .then(r => { if(!r.ok) throw new Error('HTTP ' + r.status); return r.text(); })
      .then(txt => {
        const items = parseMaster(txt);
        items.forEach((it, i)=> it._i = i);
        ALL_ITEMS = items;
        applyMode('ALL');
      })
      .catch(err => {
        detailEl.innerHTML = '<p style="color:#ff7d7d">Could not load reads.txt (' + err.message + ')</p>';
      });
  }

  window.refreshCollege = refreshCollege;
  document.addEventListener('DOMContentLoaded', () => { refreshCollege().then(initControls); });
})();
</script><script id="requests-modal-refresh">
(function(){
  function reloadRequestsIframe(id){
    if (id !== 'requestsModal') return;
    const modal = document.getElementById(id);
    if (!modal) return;
    const iframe = modal.querySelector('iframe');
    if (!iframe) return;
    const src = iframe.getAttribute('src');
    if (src) iframe.setAttribute('src', src);
  }

  const originalOpenModal = window.openModal;
  window.openModal = function(id){
    if (typeof originalOpenModal === 'function') {
      originalOpenModal(id);
    }
    reloadRequestsIframe(id);
  };

  const originalOpenPresenterModal = window.openPresenterModal;
  window.openPresenterModal = function(id){
    if (typeof originalOpenPresenterModal === 'function') {
      originalOpenPresenterModal(id);
    }
    reloadRequestsIframe(id);
  };
})();
</script></body><style>
/* === Desktop modal centring fix === */
@media (min-width: 769px) {
  .modal {
    display: flex;
    align-items: c

enter;       /* centre vertically */
    justify-content: center;   /* centre horizontally */
    padding: 20px;              /* keep away from edges */
  }
  .modal-content {
    margin: 0 !important;       /* remove old 8% top margin */
    max-height: 90vh;           /* fit within viewport */
    overflow-y: auto !important;/* scroll inside if needed */
  }
}
</style><style>
/* === Desktop modal centring fix (safe) ===
   Only center when the modal is actually visible. We do NOT force display:flex globally.
*/
@media (min-width: 769px) {
  /* Keep base hidden state intact */
  .modal { /* no display change here */ padding: 20px; }

  /* When a modal is explicitly shown via inline style or common 'open' classes, center it */
  .modal[style*="display: block"],
  .modal.show,
  .modal.active,
  .modal.is-open,
  .modal.open {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
  }

  .modal-content {
    margin: 0 !important;
    max-height: 90vh !important;
    overflow-y: auto !important;
  }
}
</style><style>
/* === Desktop modal centring fix (v3, force reset) === */
@media (min-width: 769px) {
  /* Force the base state back to hidden on desktop */
  .modal {
    display: none !important;            /* neutralize any earlier display:flex */
    align-items: center;                 /* harmless while hidden */
    justify-content: center;             /* harmless while hidden */
    padding: 20px;
  }

  /* Only centre when explicitly opened */
  .modal[style*="display: block"],
  .modal.show,
  .modal.active,
  .modal.is-open,
  .modal.open {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
  }

  .modal-content {
    margin: 0 !important;
    max-height: 90vh !important;
    overflow-y: auto !important;
  }
}

.show--current::after, .current-show::after, .show-entry.current::after, .show.current::after, .schedule-item.current::after, .live-now::after {
  content: var(--now-flag, "ON AIR NOW");
  position: absolute;
  top: 6px;
  right: 10px;
  font-size: .72rem;
  font-weight: 800;
  letter-spacing: .06em;
  padding: 4px 8px;
  border-radius: 999px;
  background: #e0322f;
  color: #fff;
  box-shadow: 0 2px 8px rgba(224,50,47,.35);
  z-index: 2;
  line-height: 1;
  white-space: nowrap;
}
/* Center #artwork on mobile (and generally) */
#artwork{
  display:block;               /* so margin auto works */
  margin:0 auto;               /* center in block layout */
  align-self:center;           /* center if parent is flex */
  justify-self:center;         /* center if parent is grid */
  max-width:300px;
  width:clamp(160px, 60vw, 300px);
}

</style></html>