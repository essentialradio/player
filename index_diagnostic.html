<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Now Playing — Diagnostic</title>
<style>
  body { font-family: sans-serif; padding: 1rem; background: #111; color: #eee; }
  pre { background: #222; padding: 1rem; border-radius: 4px; }
  .good { color: #4caf50; }
  .bad { color: #f44336; }
</style>
</head>
<body>
<h1>Now Playing — Diagnostic</h1>

<div id="status">Loading…</div>
<pre id="debug"></pre>

<script>
const statusEl = document.getElementById('status');
const debugEl = document.getElementById('debug');

async function fetchMetadata() {
  try {
    const r = await fetch('/api/metadata?ts=' + Date.now(), { cache: 'no-store' });
    if (!r.ok) throw new Error(r.status + ' ' + r.statusText);
    const j = await r.json();

    debugEl.textContent = JSON.stringify(j, null, 2);

    if (j.artist && j.title) {
      statusEl.innerHTML = `<span class="good">${j.artist} – ${j.title}</span>`;
    } else {
      statusEl.innerHTML = `<span class="bad">No track info</span>`;
    }
  } catch (err) {
    statusEl.innerHTML = `<span class="bad">Error fetching metadata</span>`;
    console.error(err);
  }
}

// first fetch, then repeat
fetchMetadata();
setInterval(fetchMetadata, 10000);
</script>
</body>
</html>
